"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([[985985],{15680:(e,n,a)=>{a.d(n,{xA:()=>s,yg:()=>d});var t=a(296540);function r(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function l(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function i(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?l(Object(a),!0).forEach((function(n){r(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function p(e,n){if(null==e)return{};var a,t,r=function(e,n){if(null==e)return{};var a,t,r={},l=Object.keys(e);for(t=0;t<l.length;t++)a=l[t],n.indexOf(a)>=0||(r[a]=e[a]);return r}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(t=0;t<l.length;t++)a=l[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var y=t.createContext({}),o=function(e){var n=t.useContext(y),a=n;return e&&(a="function"==typeof e?e(n):i(i({},n),e)),a},s=function(e){var n=o(e.components);return t.createElement(y.Provider,{value:n},e.children)},g="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},u=t.forwardRef((function(e,n){var a=e.components,r=e.mdxType,l=e.originalType,y=e.parentName,s=p(e,["components","mdxType","originalType","parentName"]),g=o(a),u=r,d=g["".concat(y,".").concat(u)]||g[u]||m[u]||l;return a?t.createElement(d,i(i({ref:n},s),{},{components:a})):t.createElement(d,i({ref:n},s))}));function d(e,n){var a=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var l=a.length,i=new Array(l);i[0]=u;var p={};for(var y in n)hasOwnProperty.call(n,y)&&(p[y]=n[y]);p.originalType=e,p[g]="string"==typeof e?e:r,i[1]=p;for(var o=2;o<l;o++)i[o]=a[o];return t.createElement.apply(null,i)}return t.createElement.apply(null,a)}u.displayName="MDXCreateElement"},921277:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>y,contentTitle:()=>i,default:()=>m,frontMatter:()=>l,metadata:()=>p,toc:()=>o});var t=a(58168),r=(a(296540),a(15680));const l={title:"\u4f7f\u7528\u4e0e\u5b9e\u8df5",language:"zh-CN"},i=void 0,p={unversionedId:"query-acceleration/materialized-view/async-materialized-view/use-guide",id:"version-2.1/query-acceleration/materialized-view/async-materialized-view/use-guide",title:"\u4f7f\u7528\u4e0e\u5b9e\u8df5",description:"\x3c!--",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/version-2.1/query-acceleration/materialized-view/async-materialized-view/use-guide.md",sourceDirName:"query-acceleration/materialized-view/async-materialized-view",slug:"/query-acceleration/materialized-view/async-materialized-view/use-guide",permalink:"/zh-CN/docs/query-acceleration/materialized-view/async-materialized-view/use-guide",draft:!1,tags:[],version:"2.1",frontMatter:{title:"\u4f7f\u7528\u4e0e\u5b9e\u8df5",language:"zh-CN"},sidebar:"docs",previous:{title:"\u529f\u80fd\u63cf\u8ff0",permalink:"/zh-CN/docs/query-acceleration/materialized-view/async-materialized-view/functions-and-demands"},next:{title:"\u5e38\u89c1\u95ee\u9898",permalink:"/zh-CN/docs/query-acceleration/materialized-view/async-materialized-view/faq"}},y={},o=[{value:"\u5f02\u6b65\u7269\u5316\u89c6\u56fe\u4f7f\u7528\u539f\u5219",id:"\u5f02\u6b65\u7269\u5316\u89c6\u56fe\u4f7f\u7528\u539f\u5219",level:2},{value:"\u7269\u5316\u89c6\u56fe\u5237\u65b0\u65b9\u5f0f\u9009\u62e9\u539f\u5219",id:"\u7269\u5316\u89c6\u56fe\u5237\u65b0\u65b9\u5f0f\u9009\u62e9\u539f\u5219",level:2},{value:"\u5206\u533a\u7269\u5316\u89c6\u56fe\u5e38\u89c1\u4f7f\u7528\u65b9\u5f0f",id:"\u5206\u533a\u7269\u5316\u89c6\u56fe\u5e38\u89c1\u4f7f\u7528\u65b9\u5f0f",level:2},{value:"\u67e5\u770b\u7269\u5316\u89c6\u56fe\u72b6\u6001",id:"\u67e5\u770b\u7269\u5316\u89c6\u56fe\u72b6\u6001",level:2},{value:"\u67e5\u770b\u7269\u5316\u89c6\u56fe\u5143\u6570\u636e",id:"\u67e5\u770b\u7269\u5316\u89c6\u56fe\u5143\u6570\u636e",level:3},{value:"\u67e5\u770b\u7269\u5316\u89c6\u56fe Task \u72b6\u6001",id:"\u67e5\u770b\u7269\u5316\u89c6\u56fe-task-\u72b6\u6001",level:3},{value:"\u5982\u4f55\u4f7f\u7528\u7269\u5316\u89c6\u56fe\u52a0\u901f\u67e5\u8be2",id:"\u5982\u4f55\u4f7f\u7528\u7269\u5316\u89c6\u56fe\u52a0\u901f\u67e5\u8be2",level:2},{value:"\u4f7f\u7528\u573a\u666f",id:"\u4f7f\u7528\u573a\u666f",level:2},{value:"\u573a\u666f\u4e00\uff1a\u591a\u8868\u8fde\u63a5\u805a\u5408\u67e5\u8be2\u52a0\u901f",id:"\u573a\u666f\u4e00\u591a\u8868\u8fde\u63a5\u805a\u5408\u67e5\u8be2\u52a0\u901f",level:3},{value:"\u573a\u666f\u4e8c\uff1a\u65e5\u5fd7\u67e5\u8be2\u52a0\u901f",id:"\u573a\u666f\u4e8c\u65e5\u5fd7\u67e5\u8be2\u52a0\u901f",level:3},{value:"\u573a\u666f\u4e09\uff1a\u6e56\u4ed3\u4e00\u4f53\u8054\u90a6\u6570\u636e\u67e5\u8be2",id:"\u573a\u666f\u4e09\u6e56\u4ed3\u4e00\u4f53\u8054\u90a6\u6570\u636e\u67e5\u8be2",level:3},{value:"\u573a\u666f\u56db\uff1a\u6570\u636e\u5efa\u6a21\uff08ETL\uff09",id:"\u573a\u666f\u56db\u6570\u636e\u5efa\u6a21etl",level:3}],s={toc:o},g="wrapper";function m(e){let{components:n,...a}=e;return(0,r.yg)(g,(0,t.A)({},s,a,{components:n,mdxType:"MDXLayout"}),(0,r.yg)("h2",{id:"\u5f02\u6b65\u7269\u5316\u89c6\u56fe\u4f7f\u7528\u539f\u5219"},"\u5f02\u6b65\u7269\u5316\u89c6\u56fe\u4f7f\u7528\u539f\u5219"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"\u65f6\u6548\u6027\u8003\u8651\uff1a"),"\u5f02\u6b65\u7269\u5316\u89c6\u56fe\u901a\u5e38\u7528\u4e8e\u5bf9\u6570\u636e\u65f6\u6548\u6027\u8981\u6c42\u4e0d\u9ad8\u7684\u573a\u666f\uff0c\u4e00\u822c\u662f T+1 \u7684\u6570\u636e\u3002\u5982\u679c\u65f6\u6548\u6027\u8981\u6c42\u9ad8\uff0c\u5e94\u8003\u8651\u4f7f\u7528\u540c\u6b65\u7269\u5316\u89c6\u56fe\u3002")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"\u52a0\u901f\u6548\u679c\u4e0e\u4e00\u81f4\u6027\u8003\u8651\uff1a"),"\u5728\u67e5\u8be2\u52a0\u901f\u573a\u666f\uff0c\u521b\u5efa\u7269\u5316\u89c6\u56fe\u65f6\uff0cDBA \u5e94\u5c06\u5e38\u89c1\u67e5\u8be2 SQL \u6a21\u5f0f\u5206\u7ec4\uff0c\u5c3d\u91cf\u4f7f\u7ec4\u4e4b\u95f4\u65e0\u91cd\u5408\u3002SQL \u6a21\u5f0f\u7ec4\u5212\u5206\u8d8a\u6e05\u6670\uff0c\u7269\u5316\u89c6\u56fe\u6784\u5efa\u7684\u8d28\u91cf\u8d8a\u9ad8\u3002\u4e00\u4e2a\u67e5\u8be2\u53ef\u80fd\u4f7f\u7528\u591a\u4e2a\u7269\u5316\u89c6\u56fe\uff0c\u540c\u65f6\u4e00\u4e2a\u7269\u5316\u89c6\u56fe\u4e5f\u53ef\u80fd\u88ab\u591a\u4e2a\u67e5\u8be2\u4f7f\u7528\u3002\u6784\u5efa\u7269\u5316\u89c6\u56fe\u9700\u8981\u7efc\u5408\u8003\u8651\u547d\u4e2d\u7269\u5316\u89c6\u56fe\u7684\u54cd\u5e94\u65f6\u95f4\uff08\u52a0\u901f\u6548\u679c\uff09\u3001\u6784\u5efa\u6210\u672c\u3001\u6570\u636e\u4e00\u81f4\u6027\u8981\u6c42\u7b49\u3002")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"\u7269\u5316\u89c6\u56fe\u5b9a\u4e49\u4e0e\u6784\u5efa\u6210\u672c\u8003\u8651\uff1a")),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"\u7269\u5316\u89c6\u56fe\u5b9a\u4e49\u548c\u539f\u67e5\u8be2\u8d8a\u63a5\u8fd1\uff0c\u67e5\u8be2\u52a0\u901f\u6548\u679c\u8d8a\u597d\uff0c\u4f46\u7269\u5316\u7684\u901a\u7528\u6027\u548c\u590d\u7528\u6027\u8d8a\u5dee\uff0c\u610f\u5473\u7740\u6784\u5efa\u6210\u672c\u8d8a\u9ad8\u3002")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"\u7269\u5316\u89c6\u56fe\u5b9a\u4e49\u8d8a\u901a\u7528\uff08\u4f8b\u5982\u6ca1\u6709 WHERE \u6761\u4ef6\u548c\u66f4\u591a\u805a\u5408\u7ef4\u5ea6\uff09\uff0c\u67e5\u8be2\u52a0\u901f\u6548\u679c\u8f83\u4f4e\uff0c\u4f46\u7269\u5316\u7684\u901a\u7528\u6027\u548c\u590d\u7528\u6027\u8d8a\u597d\uff0c\u610f\u5473\u7740\u6784\u5efa\u6210\u672c\u8d8a\u4f4e\u3002"))))),(0,r.yg)("p",null,"\u9700\u8981\u6ce8\u610f\uff1a"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"\u7269\u5316\u89c6\u56fe\u6570\u91cf\u63a7\u5236\uff1a"),"\u7269\u5316\u89c6\u56fe\u5e76\u975e\u8d8a\u591a\u8d8a\u597d\u3002\u7269\u5316\u89c6\u56fe\u53c2\u4e0e\u900f\u660e\u6539\u5199\uff0c\u4e14 CBO \u4ee3\u4ef7\u6a21\u578b\u9009\u62e9\u9700\u8981\u65f6\u95f4\u3002\u7406\u8bba\u4e0a\uff0c\u7269\u5316\u89c6\u56fe\u8d8a\u591a\uff0c\u900f\u660e\u6539\u5199\u7684\u65f6\u95f4\u8d8a\u957f\uff0c\u4e14\u7269\u5316\u89c6\u56fe\u6784\u5efa\u548c\u5237\u65b0\u5360\u7528\u7684\u8d44\u6e90\u8d8a\u5927\u3002")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"\u5b9a\u671f\u68c0\u67e5\u7269\u5316\u89c6\u56fe\u4f7f\u7528\u72b6\u6001\uff1a"),"\u5982\u679c\u672a\u4f7f\u7528\uff0c\u5e94\u53ca\u65f6\u5220\u9664\u3002")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"\u57fa\u8868\u6570\u636e\u66f4\u65b0\u9891\u7387\uff1a"),"\u5982\u679c\u7269\u5316\u89c6\u56fe\u7684\u57fa\u8868\u6570\u636e\u9891\u7e41\u66f4\u65b0\uff0c\u53ef\u80fd\u4e0d\u592a\u9002\u5408\u4f7f\u7528\u7269\u5316\u89c6\u56fe\uff0c\u56e0\u4e3a\u8fd9\u4f1a\u5bfc\u81f4\u7269\u5316\u89c6\u56fe\u9891\u7e41\u5931\u6548\uff0c\u4e0d\u80fd\u7528\u4e8e\u900f\u660e\u6539\u5199\uff08\u53ef\u76f4\u67e5\uff09\u3002\u5982\u679c\u9700\u8981\u4f7f\u7528\u6b64\u7c7b\u7269\u5316\u89c6\u56fe\u8fdb\u884c\u900f\u660e\u6539\u5199\uff0c\u9700\u8981\u5141\u8bb8\u67e5\u8be2\u7684\u6570\u636e\u6709\u4e00\u5b9a\u7684\u65f6\u6548\u5ef6\u8fdf\uff0c\u5e76\u53ef\u4ee5\u8bbe\u5b9a",(0,r.yg)("inlineCode",{parentName:"p"},"grace_period"),"\u3002\u5177\u4f53\u89c1",(0,r.yg)("inlineCode",{parentName:"p"},"grace_period"),"\u7684\u9002\u7528\u4ecb\u7ecd\u3002"))),(0,r.yg)("h2",{id:"\u7269\u5316\u89c6\u56fe\u5237\u65b0\u65b9\u5f0f\u9009\u62e9\u539f\u5219"},"\u7269\u5316\u89c6\u56fe\u5237\u65b0\u65b9\u5f0f\u9009\u62e9\u539f\u5219"),(0,r.yg)("p",null,"\u5f53\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6\u65f6\uff0c\u5efa\u8bae\u521b\u5efa\u5206\u533a\u7269\u5316\u89c6\u56fe\uff1a"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"\u7269\u5316\u89c6\u56fe\u7684\u57fa\u8868\u6570\u636e\u91cf\u5f88\u5927\uff0c\u5e76\u4e14\u57fa\u8868\u662f\u5206\u533a\u8868\u3002")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"\u7269\u5316\u89c6\u56fe\u4f7f\u7528\u7684\u8868\u9664\u4e86\u5206\u533a\u8868\u5916\uff0c\u5176\u4ed6\u8868\u4e0d\u7ecf\u5e38\u53d8\u5316\u3002")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"\u7269\u5316\u89c6\u56fe\u7684\u5b9a\u4e49 SQL \u548c\u5206\u533a\u5b57\u6bb5\u6ee1\u8db3\u5206\u533a\u63a8\u5bfc\u7684\u8981\u6c42\uff0c\u5373\u7b26\u5408\u5206\u533a\u589e\u91cf\u66f4\u65b0\u7684\u8981\u6c42\u3002\u8be6\u7ec6\u8981\u6c42\u53ef\u53c2\u8003\uff1a",(0,r.yg)("a",{parentName:"p",href:"../../../sql-manual/sql-statements/Data-Definition-Statements/Create/CREATE-ASYNC-MATERIALIZED-VIEW/#refreshmethod"},"CREATE-ASYNC-MATERIALIZED-VIEW"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"\u7269\u5316\u89c6\u56fe\u5206\u533a\u6570\u4e0d\u591a\u3002"))),(0,r.yg)("p",null,"\u5f53\u7269\u5316\u89c6\u56fe\u7684\u90e8\u5206\u5206\u533a\u5931\u6548\u65f6\uff0c\u900f\u660e\u6539\u5199\u53ef\u4ee5\u4f7f\u7528\u7269\u5316\u89c6\u56fe\u7684\u6709\u6548\u5206\u533a UNION ALL \u57fa\u8868\u8fd4\u56de\u6570\u636e\u3002\u5982\u679c\u4e0d\u80fd\u6784\u5efa\u5206\u533a\u7269\u5316\u89c6\u56fe\uff0c\u53ef\u4ee5\u8003\u8651\u9009\u62e9\u5168\u91cf\u5237\u65b0\u7684\u7269\u5316\u89c6\u56fe\u3002"),(0,r.yg)("h2",{id:"\u5206\u533a\u7269\u5316\u89c6\u56fe\u5e38\u89c1\u4f7f\u7528\u65b9\u5f0f"},"\u5206\u533a\u7269\u5316\u89c6\u56fe\u5e38\u89c1\u4f7f\u7528\u65b9\u5f0f"),(0,r.yg)("p",null,"\u5f53\u7269\u5316\u89c6\u56fe\u7684\u57fa\u8868\u6570\u636e\u91cf\u5f88\u5927\uff0c\u4e14\u57fa\u8868\u662f\u5206\u533a\u8868\u65f6\uff0c\u5982\u679c\u7269\u5316\u89c6\u56fe\u7684\u5b9a\u4e49 SQL \u548c\u5206\u533a\u5b57\u6bb5\u6ee1\u8db3\u5206\u533a\u63a8\u5bfc\u7684\u8981\u6c42\uff0c\u6b64\u79cd\u573a\u666f\u6bd4\u8f83\u9002\u5408\u6784\u5efa\u5206\u533a\u7269\u5316\u89c6\u56fe\u3002\u5206\u533a\u63a8\u5bfc\u7684\u8be6\u7ec6\u8981\u6c42\u53ef\u53c2\u8003 ",(0,r.yg)("a",{parentName:"p",href:"../../../sql-manual/sql-statements/Data-Definition-Statements/Create/CREATE-ASYNC-MATERIALIZED-VIEW/#refreshmethod"},"CREATE-ASYNC-MATERIALIZED-VIEW "),"\u548c",(0,r.yg)("a",{parentName:"p",href:"../../../query-acceleration/materialized-view/async-materialized-view/faq#q12%E6%9E%84%E5%BB%BA%E5%88%86%E5%8C%BA%E7%89%A9%E5%8C%96%E8%A7%86%E5%9B%BE%E6%8A%A5%E9%94%99"},"\u5f02\u6b65\u7269\u5316\u89c6\u56fe FAQ \u6784\u5efa\u95ee\u9898 12"),"\u3002"),(0,r.yg)("p",null,"\u7269\u5316\u89c6\u56fe\u7684\u5206\u533a\u662f\u8ddf\u968f\u57fa\u8868\u7684\u5206\u533a\u6620\u5c04\u521b\u5efa\u7684\uff0c\u4e00\u822c\u548c\u57fa\u8868\u7684\u5206\u533a\u662f 1:1 \u6216\u8005 1:n \u7684\u5173\u7cfb\u3002"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"\u5982\u679c\u57fa\u8868\u7684\u5206\u533a\u53d1\u751f\u6570\u636e\u53d8\u66f4\uff0c\u5982\u65b0\u589e\u5206\u533a\u3001\u5220\u9664\u5206\u533a\u7b49\u60c5\u51b5\uff0c\u7269\u5316\u89c6\u56fe\u5bf9\u5e94\u7684\u5206\u533a\u4e5f\u4f1a\u5931\u6548\u3002\u5931\u6548\u7684\u5206\u533a\u4e0d\u80fd\u7528\u4e8e\u900f\u660e\u6539\u5199\uff0c\u4f46\u53ef\u4ee5\u76f4\u67e5\u3002\u900f\u660e\u6539\u5199\u65f6\u53d1\u73b0\u7269\u5316\u89c6\u56fe\u7684\u5206\u533a\u6570\u636e\u5931\u6548\uff0c\u5931\u6548\u7684\u5206\u533a\u4f1a\u901a\u8fc7\u8054\u5408\u57fa\u8868\u6765\u54cd\u5e94\u67e5\u8be2\u3002"),(0,r.yg)("p",{parentName:"li"},"  \u786e\u8ba4\u7269\u5316\u89c6\u56fe\u5206\u533a\u72b6\u6001\u7684\u547d\u4ee4\u8be6\u89c1\u67e5\u770b\u7269\u5316\u89c6\u56fe\u72b6\u6001\uff0c\u4e3b\u8981\u662f",(0,r.yg)("inlineCode",{parentName:"p"},"show partitions from mv_name"),"\u547d\u4ee4\u3002")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"\u5982\u679c\u7269\u5316\u89c6\u56fe\u5f15\u7528\u7684\u975e\u5206\u533a\u8868\u53d1\u751f\u6570\u636e\u53d8\u66f4\uff0c\u4f1a\u89e6\u53d1\u7269\u5316\u89c6\u56fe\u6240\u6709\u5206\u533a\u5931\u6548\uff0c\u5bfc\u81f4\u6b64\u7269\u5316\u89c6\u56fe\u4e0d\u80fd\u7528\u4e8e\u900f\u660e\u6539\u5199\u3002\u9700\u8981\u5237\u65b0\u7269\u5316\u89c6\u56fe\u6240\u6709\u5206\u533a\u7684\u6570\u636e\uff0c\u547d\u4ee4\u4e3a",(0,r.yg)("inlineCode",{parentName:"p"},"REFRESH MATERIALIZED VIEW mv1 AUTO;"),"\u3002\u6b64\u547d\u4ee4\u4f1a\u5c1d\u8bd5\u5237\u65b0\u7269\u5316\u89c6\u56fe\uff0c\u5982\u679c\u6ee1\u8db3\u5206\u533a\u589e\u91cf\u6784\u5efa\u7684\u6761\u4ef6\u5219\u8fdb\u884c\u5206\u533a\u589e\u91cf\u6784\u5efa\uff0c\u5426\u5219\u9000\u5316\u4e3a\u5168\u91cf\u6784\u5efa\u3002"),(0,r.yg)("p",{parentName:"li"},"  \u56e0\u6b64\uff0c\u4e00\u822c\u5c06\u6570\u636e\u9891\u7e41\u53d8\u5316\u7684\u8868\u653e\u5728\u5206\u533a\u7269\u5316\u89c6\u56fe\u5f15\u7528\u7684\u5206\u533a\u8868\uff0c\u5c06\u4e0d\u7ecf\u5e38\u53d8\u5316\u7684\u7ef4\u8868\u653e\u5728\u975e\u5f15\u7528\u5206\u533a\u8868\u7684\u4f4d\u7f6e\u3002"))),(0,r.yg)("p",null,"\u5206\u533a\u7269\u5316\u89c6\u56fe\u7684\u900f\u660e\u6539\u5199\u662f\u5206\u533a\u7c92\u5ea6\u7684\uff0c\u5373\u4f7f\u7269\u5316\u89c6\u56fe\u7684\u90e8\u5206\u5206\u533a\u5931\u6548\uff0c\u6b64\u7269\u5316\u89c6\u56fe\u4ecd\u7136\u53ef\u7528\u4e8e\u900f\u660e\u6539\u5199\u3002\u4f46\u5982\u679c\u53ea\u67e5\u8be2\u4e86\u4e00\u4e2a\u5206\u533a\uff0c\u5e76\u4e14\u7269\u5316\u89c6\u56fe\u8fd9\u4e2a\u5206\u533a\u6570\u636e\u5931\u6548\u4e86\uff0c\u90a3\u4e48\u6b64\u7269\u5316\u89c6\u56fe\u4e0d\u80fd\u7528\u4e8e\u900f\u660e\u6539\u5199\u3002"),(0,r.yg)("p",null,"\u4e3e\u4f8b 1\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"  CREATE TABLE IF NOT EXISTS lineitem (\n    l_orderkey INTEGER NOT NULL, \n    l_partkey INTEGER NOT NULL, \n    l_suppkey INTEGER NOT NULL, \n    l_linenumber INTEGER NOT NULL, \n    l_ordertime DATETIME NOT NULL, \n    l_quantity DECIMALV3(15, 2) NOT NULL, \n    l_extendedprice DECIMALV3(15, 2) NOT NULL, \n    l_discount DECIMALV3(15, 2) NOT NULL, \n    l_tax DECIMALV3(15, 2) NOT NULL, \n    l_returnflag CHAR(1) NOT NULL, \n    l_linestatus CHAR(1) NOT NULL, \n    l_shipdate DATE NOT NULL, \n    l_commitdate DATE NOT NULL, \n    l_receiptdate DATE NOT NULL, \n    l_shipinstruct CHAR(25) NOT NULL, \n    l_shipmode CHAR(10) NOT NULL, \n    l_comment VARCHAR(44) NOT NULL\n  ) DUPLICATE KEY(\n    l_orderkey, l_partkey, l_suppkey, \n    l_linenumber\n  ) PARTITION BY RANGE(l_ordertime) (\n    FROM \n      ('2024-05-01') TO ('2024-06-30') INTERVAL 1 DAY\n  ) DISTRIBUTED BY HASH(l_orderkey) BUCKETS 3 PROPERTIES (\"replication_num\" = \"1\"); \n  \n    insert into lineitem values      (1, 2, 3, 4, '2024-05-01 01:45:05', 5.5, 6.5, 0.1, 8.5, 'o', 'k', '2024-05-01', '2024-05-01', '2024-05-01', 'a', 'b', 'yyyyyyyyy'),    \n     (1, 2, 3, 4, '2024-05-15 02:35:05', 5.5, 6.5, 0.15, 8.5, 'o', 'k', '2024-05-15', '2024-05-15', '2024-05-15', 'a', 'b', 'yyyyyyyyy'),     \n     (2, 2, 3, 5, '2024-05-25 08:30:06', 5.5, 6.5, 0.2, 8.5, 'o', 'k', '2024-05-25', '2024-05-25', '2024-05-25', 'a', 'b', 'yyyyyyyyy'),     \n     (3, 4, 3, 6, '2024-06-02 09:25:07', 5.5, 6.5, 0.3, 8.5, 'o', 'k', '2024-06-02', '2024-06-02', '2024-06-02', 'a', 'b', 'yyyyyyyyy'),     \n     (4, 4, 3, 7, '2024-06-15 13:20:09', 5.5, 6.5, 0, 8.5, 'o', 'k', '2024-06-15', '2024-06-15', '2024-06-15', 'a', 'b', 'yyyyyyyyy'),     \n     (5, 5, 6, 8, '2024-06-25 15:15:36', 5.5, 6.5, 0.12, 8.5, 'o', 'k', '2024-06-25', '2024-06-25', '2024-06-25', 'a', 'b', 'yyyyyyyyy'),     \n     (5, 5, 6, 9, '2024-06-29 21:10:52', 5.5, 6.5, 0.1, 8.5, 'o', 'k', '2024-06-30', '2024-06-30', '2024-06-30', 'a', 'b', 'yyyyyyyyy'),     \n     (5, 6, 5, 10, '2024-06-03 22:05:50', 7.5, 8.5, 0.1, 10.5, 'k', 'o', '2024-06-03', '2024-06-03', '2024-06-03', 'c', 'd', 'xxxxxxxxx');     \n  \n   CREATE TABLE IF NOT EXISTS partsupp (\n    ps_partkey INTEGER NOT NULL, \n    ps_suppkey INTEGER NOT NULL, \n    ps_availqty INTEGER NOT NULL, \n    ps_supplycost DECIMALV3(15, 2) NOT NULL, \n    ps_comment VARCHAR(199) NOT NULL\n  ) DUPLICATE KEY(ps_partkey, ps_suppkey) DISTRIBUTED BY HASH(ps_partkey) BUCKETS 3 PROPERTIES (\"replication_num\" = \"1\"); \n  \n  \n      insert into partsupp values     \n      (2, 3, 9, 10.01, 'supply1'),     \n      (4, 3, 9, 10.01, 'supply2'),     \n      (5, 6, 9, 10.01, 'supply3'),     \n      (6, 5, 10, 11.01, 'supply4');\n")),(0,r.yg)("p",null,"\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c",(0,r.yg)("inlineCode",{parentName:"p"},"orders"),"\u8868\u7684",(0,r.yg)("inlineCode",{parentName:"p"},"o_ordertime"),"\u5b57\u6bb5\u662f\u5206\u533a\u5b57\u6bb5\uff0c\u7c7b\u578b\u662f",(0,r.yg)("inlineCode",{parentName:"p"},"DATETIME"),"\uff0c\u6309\u7167\u5929\u5206\u533a\u3002"),(0,r.yg)("p",null,"\u67e5\u8be2\u4e3b\u8981\u662f\u6309\u7167\u201c\u5929\u201d\u7684\u7c92\u5ea6\uff0c\u67e5\u8be2\u7c92\u5ea6\u6bd4\u8f83\u7c97\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"SELECT \n  l_linestatus, \n  sum(\n    l_extendedprice * (1 - l_discount)\n  ) AS revenue, \n  ps_partkey \nFROM \n  lineitem \n  LEFT JOIN partsupp ON l_partkey = ps_partkey \n  and l_suppkey = ps_suppkey \nWHERE \n  date_trunc(l_ordertime, 'day') <= DATE '2024-05-25' \n  AND date_trunc(l_ordertime, 'day') >= DATE '2024-05-05' \nGROUP BY \n  l_linestatus, \n  ps_partkey;\n")),(0,r.yg)("p",null,"\u4e3a\u4e86\u4e0d\u8ba9\u7269\u5316\u89c6\u56fe\u6bcf\u6b21\u5237\u65b0\u7684\u5206\u533a\u6570\u91cf\u8fc7\u591a\uff0c\u7269\u5316\u89c6\u56fe\u7684\u5206\u533a\u7c92\u5ea6\u53ef\u4ee5\u548c\u57fa\u8868",(0,r.yg)("inlineCode",{parentName:"p"},"orders"),"\u4e00\u81f4\uff0c\u6309\u201c\u5929\u201d\u5206\u533a\u3002"),(0,r.yg)("p",null,"\u7269\u5316\u89c6\u56fe\u7684\u5b9a\u4e49 SQL \u7684\u7c92\u5ea6\u53ef\u4ee5\u6309\u7167\u201c\u5929\u201d\uff0c\u5e76\u4e14\u6309\u7167\u201c\u5929\u201d\u6765\u805a\u5408\u6570\u636e\uff0c"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"CREATE MATERIALIZED VIEW rollup_partition_mv \nBUILD IMMEDIATE REFRESH AUTO ON MANUAL \npartition by(order_date) \nDISTRIBUTED BY RANDOM BUCKETS 2 \nPROPERTIES ('replication_num' = '1') \nAS \nSELECT \n  l_linestatus, \n  sum(\n    l_extendedprice * (1 - l_discount)\n  ) AS revenue, \n  ps_partkey, \n  date_trunc(l_ordertime, 'day') as order_date \nFROM \n  lineitem \n  LEFT JOIN partsupp ON l_partkey = ps_partkey \n  and l_suppkey = ps_suppkey \nGROUP BY \n  l_linestatus, \n  ps_partkey, \n  date_trunc(l_ordertime, 'day');\n")),(0,r.yg)("h2",{id:"\u67e5\u770b\u7269\u5316\u89c6\u56fe\u72b6\u6001"},"\u67e5\u770b\u7269\u5316\u89c6\u56fe\u72b6\u6001"),(0,r.yg)("p",null,"\u901a\u5e38\u7269\u5316\u89c6\u56fe\u4f1a\u51fa\u73b0\u4e24\u79cd\u72b6\u6001\uff1a"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"\u72b6\u6001\u6b63\u5e38\uff1a"),"\u6307\u7684\u662f\u5f53\u524d\u7269\u5316\u89c6\u56fe\u662f\u5426\u53ef\u7528\u4e8e\u900f\u660e\u6539\u5199\u3002")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"\u4e0d\u53ef\u7528\u3001\u72b6\u6001\u4e0d\u6b63\u5e38\uff1a"),"\u6307\u7684\u662f\u7269\u5316\u89c6\u56fe\u4e0d\u80fd\u7528\u4e8e\u900f\u660e\u6539\u5199\u7684\u7b80\u79f0\u3002\u5c3d\u7ba1\u5982\u6b64\uff0c\u8be5\u7269\u5316\u89c6\u56fe\u8fd8\u662f\u53ef\u4ee5\u76f4\u67e5\u7684\u3002"))),(0,r.yg)("h3",{id:"\u67e5\u770b\u7269\u5316\u89c6\u56fe\u5143\u6570\u636e"},"\u67e5\u770b\u7269\u5316\u89c6\u56fe\u5143\u6570\u636e"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"select * from mv_infos('database'='db_name')\nwhere Name = 'mv_name' \\G \n")),(0,r.yg)("p",null,"\u8fd4\u56de\u7ed3\u679c\u5982\u4e0b\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"*************************** 1. row ***************************\n                Id: 139570\n              Name: mv11\n           JobName: inner_mtmv_139570\n             State: NORMAL\nSchemaChangeDetail: \n      RefreshState: SUCCESS\n       RefreshInfo: BUILD IMMEDIATE REFRESH AUTO ON MANUAL\n          QuerySql: SELECT l_shipdate, l_orderkey, O_ORDERDATE, count(*)\nFROM lineitem  \nLEFT OUTER JOIN orders on l_orderkey = o_orderkey\nGROUP BY l_shipdate, l_orderkey, O_ORDERDATE\n           EnvInfo: EnvInfo{ctlId='0', dbId='16813'}\n      MvProperties: {}\n   MvPartitionInfo: MTMVPartitionInfo{partitionType=FOLLOW_BASE_TABLE, relatedTable=lineitem, relatedCol='l_shipdate', partitionCol='l_shipdate'}\nSyncWithBaseTables: 1\n")),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"SyncWithBaseTables\uff1a")," \u8868\u793a\u7269\u5316\u89c6\u56fe\u548c\u57fa\u8868\u7684\u6570\u636e\u662f\u5426\u4e00\u81f4\u3002"),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"\u5bf9\u4e8e\u5168\u91cf\u6784\u5efa\u7684\u7269\u5316\u89c6\u56fe\uff0c\u6b64\u5b57\u6bb5\u4e3a 1\uff0c\u8868\u660e\u6b64\u7269\u5316\u89c6\u56fe\u53ef\u7528\u4e8e\u900f\u660e\u6539\u5199\u3002")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"\u5bf9\u4e8e\u5206\u533a\u589e\u91cf\u7684\u7269\u5316\u89c6\u56fe\uff0c\u5206\u533a\u7269\u5316\u89c6\u56fe\u662f\u5426\u53ef\u7528\uff0c\u662f\u4ee5\u5206\u533a\u7c92\u5ea6\u53bb\u770b\u7684\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5373\u4f7f\u7269\u5316\u89c6\u56fe\u7684\u90e8\u5206\u5206\u533a\u4e0d\u53ef\u7528\uff0c\u4f46\u53ea\u8981\u67e5\u8be2\u7684\u662f\u6709\u6548\u5206\u533a\uff0c\u90a3\u4e48\u6b64\u7269\u5316\u89c6\u56fe\u4f9d\u65e7\u53ef\u7528\u4e8e\u900f\u660e\u6539\u5199\u3002\u662f\u5426\u80fd\u900f\u660e\u6539\u5199\uff0c\u4e3b\u8981\u770b\u67e5\u8be2\u6240\u7528\u5206\u533a\u7684 ",(0,r.yg)("inlineCode",{parentName:"p"},"SyncWithBaseTables")," \u5b57\u6bb5\u662f\u5426\u4e00\u81f4\u3002\u5982\u679c ",(0,r.yg)("inlineCode",{parentName:"p"},"SyncWithBaseTables")," \u662f 1\uff0c\u6b64\u5206\u533a\u53ef\u7528\u4e8e\u900f\u660e\u6539\u5199\uff1b\u5982\u679c\u662f 0\uff0c\u5219\u4e0d\u80fd\u7528\u4e8e\u900f\u660e\u6539\u5199\u3002")))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"JobName\uff1a"),"\u7269\u5316\u89c6\u56fe\u6784\u5efa Job \u7684\u540d\u79f0\uff0c\u6bcf\u4e2a\u7269\u5316\u89c6\u56fe\u6709\u4e00\u4e2a Job\uff0c\u6bcf\u6b21\u5237\u65b0\u4f1a\u6709\u4e00\u4e2a\u65b0\u7684 Task\uff0cJob \u548c Task \u662f 1:n \u7684\u5173\u7cfb")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"State\uff1a"),"\u5982\u679c\u53d8\u4e3a SCHEMA_CHANGE\uff0c\u4ee3\u8868\u57fa\u8868\u7684 Schema \u53d1\u751f\u4e86\u53d8\u5316\uff0c\u6b64\u65f6\u7269\u5316\u89c6\u56fe\u5c06\u4e0d\u80fd\u7528\u6765\u900f\u660e\u6539\u5199 (\u4f46\u662f\u4e0d\u5f71\u54cd\u76f4\u63a5\u67e5\u8be2\u7269\u5316\u89c6\u56fe)\uff0c\u4e0b\u6b21\u5237\u65b0\u4efb\u52a1\u5982\u679c\u6267\u884c\u6210\u529f\uff0c\u5c06\u6062\u590d\u4e3a NORMAL\u3002")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"SchemaChangeDetail\uff1a")," \u8868\u793a SCHEMA_CHANGE \u53d1\u751f\u7684\u539f\u56e0\u3002")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"RefreshState\uff1a")," \u7269\u5316\u89c6\u56fe\u6700\u540e\u4e00\u6b21\u4efb\u52a1\u5237\u65b0\u7684\u72b6\u6001\u3002\u5982\u679c\u4e3a FAIL\uff0c\u4ee3\u8868\u6267\u884c\u5931\u8d25\uff0c\u53ef\u4ee5\u901a\u8fc7 ",(0,r.yg)("inlineCode",{parentName:"p"},"tasks() "),"\u547d\u4ee4\u8fdb\u4e00\u6b65\u5b9a\u4f4d\u5931\u8d25\u539f\u56e0\u3002Task \u547d\u4ee4\u89c1\u672c\u6587",(0,r.yg)("a",{parentName:"p",href:"#%E6%9F%A5%E7%9C%8B%E7%89%A9%E5%8C%96%E8%A7%86%E5%9B%BE-task-%E7%8A%B6%E6%80%81"},"\u67e5\u770b\u7269\u5316\u89c6\u56fe Task \u72b6\u6001"),"\u3002")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"SyncWithBaseTables\uff1a")," \u662f\u5426\u548c\u57fa\u8868\u6570\u636e\u540c\u6b65\u30021 \u4e3a\u540c\u6b65\uff0c0 \u4e3a\u4e0d\u540c\u6b65\u3002\u5982\u679c\u4e0d\u540c\u6b65\uff0c\u53ef\u901a\u8fc7 ",(0,r.yg)("inlineCode",{parentName:"p"},"show partitions")," \u8fdb\u4e00\u6b65\u5224\u65ad\u54ea\u4e2a\u5206\u533a\u4e0d\u540c\u6b65\u3002",(0,r.yg)("inlineCode",{parentName:"p"},"show partitions")," \u89c1\u4e0b\u6587\u5206\u533a\u7269\u5316\u89c6\u56fe\u67e5\u770b SyncWithBaseTables \u72b6\u6001\u65b9\u6cd5\u3002"))),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"\u5206\u533a\u7269\u5316\u89c6\u56fe\u67e5\u770b SyncWithBaseTables \u72b6\u6001\u65b9\u6cd5")),(0,r.yg)("p",null,"\u8fd0\u884c ",(0,r.yg)("inlineCode",{parentName:"p"},"show partitions from mv_name"),"\u67e5\u770b\u67e5\u8be2\u4f7f\u7528\u7684\u5206\u533a\u662f\u5426\u6709\u6548\uff0c\u8fd4\u56de\u7ed3\u679c\u5982\u4e0b\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-Plain"},"show partitions from mv11;\n+-------------+---------------------+----------------+---------------------+--------+--------------+--------------------------------------------------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+-----------+------------+-------------------------+-----------+--------------------+--------------+\n| PartitionId | PartitionName       | VisibleVersion | VisibleVersionTime  | State  | PartitionKey | Range                                                                          | DistributionKey | Buckets | ReplicationNum | StorageMedium | CooldownTime        | RemoteStoragePolicy | LastConsistencyCheckTime | DataSize  | IsInMemory | ReplicaAllocation       | IsMutable | SyncWithBaseTables | UnsyncTables |\n+-------------+---------------------+----------------+---------------------+--------+--------------+--------------------------------------------------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+-----------+------------+-------------------------+-----------+--------------------+--------------+\n| 140189      | p_20231016_20231017 | 1              | 2024-06-21 10:31:45 | NORMAL | l_shipdate   | [types: [DATEV2]; keys: [2023-10-16]; ..types: [DATEV2]; keys: [2023-10-17]; ) | l_orderkey      | 10      | 1              | HDD           | 9999-12-31 23:59:59 |                     | NULL                     | 0.000     | false      | tag.location.default: 1 | true      | true               | []           |\n| 139995      | p_20231018_20231019 | 2              | 2024-06-21 10:31:44 | NORMAL | l_shipdate   | [types: [DATEV2]; keys: [2023-10-18]; ..types: [DATEV2]; keys: [2023-10-19]; ) | l_orderkey      | 10      | 1              | HDD           | 9999-12-31 23:59:59 |                     | NULL                     | 880.000 B | false      | tag.location.default: 1 | true      | true               | []           |\n| 139898      | p_20231019_20231020 | 2              | 2024-06-21 10:31:43 | NORMAL | l_shipdate   | [types: [DATEV2]; keys: [2023-10-19]; ..types: [DATEV2]; keys: [2023-10-20]; ) | l_orderkey      | 10      | 1              | HDD           | 9999-12-31 23:59:59 |                     | NULL                     | 878.000 B | false      | tag.location.default: 1 | true      | true               | []           |\n+-------------+---------------------+----------------+---------------------+--------+--------------+--------------------------------------------------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+-----------+------------+-------------------------+-----------+--------------------+--------------+\n")),(0,r.yg)("p",null,"\u4e3b\u8981\u67e5\u770b ",(0,r.yg)("inlineCode",{parentName:"p"},"SyncWithBaseTables")," \u5b57\u6bb5\u662f\u5426\u4e3a true\u3002false \u8868\u793a\u6b64\u5206\u533a\u4e0d\u53ef\u7528\u4e8e\u900f\u660e\u6539\u5199\u3002"),(0,r.yg)("h3",{id:"\u67e5\u770b\u7269\u5316\u89c6\u56fe-task-\u72b6\u6001"},"\u67e5\u770b\u7269\u5316\u89c6\u56fe Task \u72b6\u6001"),(0,r.yg)("p",null,"\u6bcf\u4e2a\u7269\u5316\u89c6\u56fe\u6709\u4e00\u4e2a Job\uff0c\u6bcf\u6b21\u5237\u65b0\u4f1a\u6709\u4e00\u4e2a\u65b0\u7684 Task\uff0cJob \u548c Task \u662f 1:n \u7684\u5173\u7cfb\u3002"),(0,r.yg)("p",null,"\u6839\u636e ",(0,r.yg)("inlineCode",{parentName:"p"},"JobName")," \u67e5\u770b\u7269\u5316\u89c6\u56fe\u7684 Task \u72b6\u6001\uff0c\u8fd0\u884c\u5982\u4e0b\u8bed\u53e5\uff0c\u53ef\u4ee5\u67e5\u770b\u5237\u65b0\u4efb\u52a1\u7684\u72b6\u6001\u548c\u8fdb\u5ea6\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},'select * from tasks("type"="mv")\nwhere mvName = \'mv_name\'\norder by CreateTime desc \\G\n')),(0,r.yg)("p",null,"\u8fd4\u56de\u7ed3\u679c\u5982\u4e0b\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},'*************************** 1. row ***************************\n               TaskId: 167019363907545\n                JobId: 139872\n              JobName: inner_mtmv_139570\n                 MvId: 139570\n               MvName: mv11\n         MvDatabaseId: 16813\n       MvDatabaseName: regression_test_nereids_rules_p0_mv\n               Status: SUCCESS\n             ErrorMsg: \n           CreateTime: 2024-06-21 10:31:43\n            StartTime: 2024-06-21 10:31:43\n           FinishTime: 2024-06-21 10:31:45\n           DurationMs: 2466\n          TaskContext: {"triggerMode":"SYSTEM","isComplete":false}\n          RefreshMode: COMPLETE\nNeedRefreshPartitions: ["p_20231023_20231024","p_20231019_20231020","p_20231020_20231021","p_20231027_20231028","p_20231030_20231031","p_20231018_20231019","p_20231024_20231025","p_20231021_20231022","p_20231029_20231030","p_20231028_20231029","p_20231025_20231026","p_20231022_20231023","p_20231031_20231101","p_20231016_20231017","p_20231026_20231027"]\n  CompletedPartitions: ["p_20231023_20231024","p_20231019_20231020","p_20231020_20231021","p_20231027_20231028","p_20231030_20231031","p_20231018_20231019","p_20231024_20231025","p_20231021_20231022","p_20231029_20231030","p_20231028_20231029","p_20231025_20231026","p_20231022_20231023","p_20231031_20231101","p_20231016_20231017","p_20231026_20231027"]\n             Progress: 100.00% (15/15)\n          LastQueryId: fe700ca3d6504521-bb522fc9ccf615e3\n')),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"NeedRefreshPartitions\uff0cCompletedPartitions \u8bb0\u5f55\u7684\u662f\u6b64\u6b21 Task \u5237\u65b0\u7684\u5206\u533a\u3002")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Status\uff1a\u5982\u679c\u4e3a FAILED\uff0c\u4ee3\u8868\u8fd0\u884c\u5931\u8d25\uff0c\u53ef\u901a\u8fc7 ErrorMsg \u67e5\u770b\u5931\u8d25\u539f\u56e0\uff0c\u4e5f\u53ef\u901a\u8fc7 LastQueryId \u6765\u641c\u7d22 Doris \u7684\u65e5\u5fd7\uff0c\u83b7\u53d6\u66f4\u8be6\u7ec6\u7684\u9519\u8bef\u4fe1\u606f\u3002\u76ee\u524d\u4efb\u52a1\u5931\u8d25\u4f1a\u5bfc\u81f4\u5df2\u6709\u7269\u5316\u89c6\u56fe\u4e0d\u53ef\u7528\uff0c\u540e\u9762\u4f1a\u6539\u6210\u5c3d\u7ba1\u4efb\u52a1\u5931\u8d25\uff0c\u4f46\u662f\u5df2\u5b58\u5728\u7684\u7269\u5316\u89c6\u56fe\u53ef\u7528\u4e8e\u900f\u660e\u6539\u5199\u3002")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"ErrorMsg\uff1a\u5931\u8d25\u539f\u56e0\u3002")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"RefreshMode\uff1acomplete \u4ee3\u8868\u5237\u65b0\u4e86\u5168\u90e8\u5206\u533a\uff0cPARTIAL \u4ee3\u8868\u5237\u65b0\u4e86\u90e8\u5206\u5206\u533a\uff0cNOT_REFRESH \u4ee3\u8868\u4e0d\u9700\u8981\u5237\u65b0\u4efb\u4f55\u5206\u533a\u3002"))),(0,r.yg)("admonition",{title:"\u5907\u6ce8",type:"info"},(0,r.yg)("ul",{parentName:"admonition"},(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"\u5982\u679c\u7269\u5316\u89c6\u56fe\u521b\u5efa\u7684\u65f6\u5019\u8bbe\u7f6e\u4e86 ",(0,r.yg)("inlineCode",{parentName:"p"},"grace_period")," \u5c5e\u6027\uff0c\u90a3\u4e48\u5373\u4f7f ",(0,r.yg)("inlineCode",{parentName:"p"},"SyncWithBaseTables")," \u662f false \u6216\u8005 0\uff0c\u6709\u4e9b\u60c5\u51b5\u4e0b\u5b83\u4f9d\u7136\u53ef\u7528\u4e8e\u900f\u660e\u6539\u5199\u3002")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("inlineCode",{parentName:"p"},"grace_period")," \u7684\u5355\u4f4d\u662f\u79d2\uff0c\u6307\u7684\u662f\u5bb9\u8bb8\u7269\u5316\u89c6\u56fe\u548c\u6240\u7528\u57fa\u8868\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u65f6\u95f4\u3002"),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"\u5982\u679c\u8bbe\u7f6e\u6210 0\uff0c\u610f\u5473\u7740\u8981\u6c42\u7269\u5316\u89c6\u56fe\u548c\u57fa\u8868\u6570\u636e\u4fdd\u6301\u4e00\u81f4\uff0c\u6b64\u7269\u5316\u89c6\u56fe\u624d\u53ef\u7528\u4e8e\u900f\u660e\u6539\u5199\u3002")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"\u5982\u679c\u8bbe\u7f6e\u6210 10\uff0c\u610f\u5473\u7740\u7269\u5316\u89c6\u56fe\u548c\u57fa\u8868\u6570\u636e\u5141\u8bb8 10 \u79d2\u7684\u5ef6\u8fdf\uff0c\u5982\u679c\u7269\u5316\u89c6\u56fe\u7684\u6570\u636e\u548c\u57fa\u8868\u7684\u6570\u636e\u6709\u5ef6\u8fdf\uff0c\u5728 10 \u79d2\u5185\uff0c\u6b64\u7269\u5316\u89c6\u56fe\u90fd\u53ef\u4ee5\u7528\u4e8e\u900f\u660e\u6539\u5199\u3002")))))),(0,r.yg)("h2",{id:"\u5982\u4f55\u4f7f\u7528\u7269\u5316\u89c6\u56fe\u52a0\u901f\u67e5\u8be2"},"\u5982\u4f55\u4f7f\u7528\u7269\u5316\u89c6\u56fe\u52a0\u901f\u67e5\u8be2"),(0,r.yg)("p",null,"\u4f7f\u7528\u7269\u5316\u89c6\u56fe\u67e5\u8be2\u52a0\u901f\uff0c\u9996\u5148\u9700\u8981\u67e5\u770b profile \u6587\u4ef6\uff0c\u627e\u5230\u4e00\u4e2a\u67e5\u8be2\u6d88\u8017\u65f6\u95f4\u6700\u591a\u7684\u64cd\u4f5c\uff0c\u4e00\u822c\u51fa\u73b0\u5728\u8fde\u63a5\uff08Join\uff09\u3001\u805a\u5408\uff08Aggregate\uff09\u3001\u8fc7\u6ee4\uff08Filter\uff09\u6216\u8005\u8868\u8fbe\u5f0f\u8ba1\u7b97\uff08Calculated Expressions\uff09\u3002"),(0,r.yg)("p",null,"\u5bf9\u4e8e Join\u3001Aggregate\u3001Filters\u3001Calculated Expressions\uff0c\u6784\u5efa\u7269\u5316\u89c6\u56fe\u90fd\u80fd\u8d77\u5230\u52a0\u901f\u67e5\u8be2\u7684\u4f5c\u7528\u3002\u5982\u679c\u4e00\u4e2a\u67e5\u8be2\u4e2d Join \u5360\u7528\u4e86\u5927\u91cf\u7684\u8ba1\u7b97\u8d44\u6e90\uff0c\u800c Aggregate \u76f8\u5bf9\u800c\u8a00\u5360\u7528\u8f83\u5c0f\u7684\u8d44\u6e90\uff0c\u5219\u53ef\u4ee5\u9488\u5bf9 Join \u6784\u5efa\u7269\u5316\u89c6\u56fe\u3002"),(0,r.yg)("p",null,"\u63a5\u4e0b\u6765\uff0c\u5c06\u8be6\u7ec6\u8bf4\u660e\u5982\u4f55\u9488\u5bf9\u4e0a\u8ff0\u56db\u79cd\u64cd\u4f5c\u6784\u5efa\u7269\u5316\u89c6\u56fe\uff1a"),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"1. \u5bf9\u4e8e Join")),(0,r.yg)("p",null,"\u53ef\u4ee5\u63d0\u53d6\u67e5\u8be2\u4e2d\u4f7f\u7528\u7684\u516c\u5171\u7684\u8868\u8fde\u63a5\u6a21\u5f0f\u6765\u6784\u5efa\u7269\u5316\u89c6\u56fe\u3002\u900f\u660e\u6539\u5199\u5982\u679c\u4f7f\u7528\u4e86\u6b64\u7269\u5316\u89c6\u56fe\uff0c\u53ef\u4ee5\u8282\u7701 Join \u8fde\u63a5\u7684\u8ba1\u7b97\u3002\u5c06\u67e5\u8be2\u4e2d\u7684 Filters \u53bb\u9664\uff0c\u8fd9\u6837\u5c31\u662f\u4e00\u4e2a\u6bd4\u8f83\u901a\u7528\u7684 Join \u7269\u5316\u89c6\u56fe\u3002"),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"2. \u5bf9\u4e8e Aggregate")),(0,r.yg)("p",null,"\u5efa\u8bae\u5c3d\u91cf\u4f7f\u7528\u4f4e\u57fa\u6570\u7684\u5b57\u6bb5\u4f5c\u4e3a\u7ef4\u5ea6\u6765\u6784\u5efa\u7269\u5316\u89c6\u56fe\u3002\u5982\u679c\u7ef4\u5ea6\u76f8\u5173\uff0c\u90a3\u4e48\u805a\u5408\u540e\u7684\u6570\u91cf\u53ef\u4ee5\u5c3d\u91cf\u51cf\u5c11\u3002"),(0,r.yg)("p",null,"\u6bd4\u5982\u8868 t1\uff0c\u539f\u8868\u7684\u6570\u636e\u91cf\u662f 1000000\uff0c\u67e5\u8be2\u8bed\u53e5 SQL \u4e2d\u6709 ",(0,r.yg)("inlineCode",{parentName:"p"},"group by a, b, c"),"\u3002\u5982\u679c a\uff0cb\uff0cc \u7684\u57fa\u6570\u5206\u522b\u662f 100\uff0c50\uff0c15\uff0c\u90a3\u4e48\u805a\u5408\u540e\u7684\u6570\u636e\u5927\u6982\u5728 75000 \u5de6\u53f3\uff0c\u8bf4\u660e\u6b64\u7269\u5316\u89c6\u56fe\u662f\u6709\u6548\u7684\u3002\u5982\u679c a\uff0cb\uff0cc \u5177\u6709\u76f8\u5173\u6027\uff0c\u90a3\u4e48\u805a\u5408\u540e\u7684\u6570\u636e\u91cf\u4f1a\u8fdb\u4e00\u6b65\u51cf\u5c11\u3002"),(0,r.yg)("p",null,"\u5982\u679c a, b, c \u7684\u57fa\u6570\u5f88\u9ad8\uff0c\u4f1a\u5bfc\u81f4\u805a\u5408\u540e\u7684\u6570\u636e\u6025\u901f\u81a8\u80c0\u3002\u5982\u679c\u805a\u5408\u540e\u7684\u6570\u636e\u6bd4\u539f\u8868\u7684\u6570\u636e\u8fd8\u591a\uff0c\u53ef\u80fd\u8fd9\u6837\u7684\u573a\u666f\u4e0d\u592a\u9002\u5408\u6784\u5efa\u7269\u5316\u89c6\u56fe\u3002\u6bd4\u5982 c \u7684\u57fa\u6570\u662f 3500\uff0c\u90a3\u4e48\u805a\u5408\u540e\u7684\u6570\u636e\u91cf\u5728 17000000 \u5de6\u53f3\uff0c\u6bd4\u539f\u8868\u6570\u636e\u91cf\u5927\u7684\u591a\uff0c\u6784\u5efa\u8fd9\u6837\u7684\u7269\u5316\u89c6\u56fe\u6027\u80fd\u52a0\u901f\u6536\u76ca\u4f4e\u3002"),(0,r.yg)("p",null,"\u7269\u5316\u89c6\u56fe\u7684\u805a\u5408\u7c92\u5ea6\u8981\u6bd4\u67e5\u8be2\u7ec6\uff0c\u5373\u7269\u5316\u89c6\u56fe\u7684\u805a\u5408\u7ef4\u5ea6\u5305\u542b\u67e5\u8be2\u7684\u805a\u5408\u7ef4\u5ea6\uff0c\u8fd9\u6837\u624d\u80fd\u63d0\u4f9b\u67e5\u8be2\u6240\u9700\u7684\u6570\u636e\u3002\u67e5\u8be2\u53ef\u4ee5\u4e0d\u5199 Group By\uff0c\u540c\u7406\uff0c\u7269\u5316\u89c6\u56fe\u7684\u805a\u5408\u51fd\u6570\u5e94\u8be5\u5305\u542b\u67e5\u8be2\u7684\u805a\u5408\u51fd\u6570\u3002"),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"3. \u5bf9\u4e8e Filter")),(0,r.yg)("p",null,"\u5982\u679c\u67e5\u8be2\u4e2d\u7ecf\u5e38\u51fa\u73b0\u5bf9\u76f8\u540c\u5b57\u6bb5\u7684\u8fc7\u6ee4\uff0c\u90a3\u4e48\u901a\u8fc7\u5728\u7269\u5316\u89c6\u56fe\u4e2d\u6dfb\u52a0\u76f8\u5e94\u7684 Filter\uff0c\u53ef\u4ee5\u51cf\u5c11\u7269\u5316\u89c6\u56fe\u4e2d\u7684\u6570\u636e\u91cf\uff0c\u4ece\u800c\u63d0\u9ad8\u67e5\u8be2\u65f6\u547d\u4e2d\u7269\u5316\u89c6\u56fe\u7684\u6027\u80fd\u3002"),(0,r.yg)("p",null,"\u8981\u6ce8\u610f\u7684\u662f\uff0c\u7269\u5316\u89c6\u56fe\u5e94\u8be5\u6bd4\u67e5\u8be2\u4e2d\u51fa\u73b0\u7684 Filter \u5c11\uff0c\u67e5\u8be2\u7684 Filter \u8981\u5305\u542b\u7269\u5316\u7684 Filter\u3002\u6bd4\u5982\u67e5\u8be2\u662f ",(0,r.yg)("inlineCode",{parentName:"p"},"a > 10 and b > 5"),"\uff0c\u7269\u5316\u89c6\u56fe\u53ef\u4ee5\u6ca1\u6709 Filter\uff0c\u5982\u679c\u6709 Filter \u7684\u8bdd\u5e94\u5bf9 a \u548c b \u8fc7\u6ee4\uff0c\u5e76\u4e14\u6570\u636e\u8303\u56f4\u8981\u6c42\u6bd4\u67e5\u8be2\u5927\uff0c\u4f8b\u5982\u7269\u5316\u89c6\u56fe\u53ef\u4ee5\u662f ",(0,r.yg)("inlineCode",{parentName:"p"},"a > 5 and b > 5\uff0cb > 0"),"\uff0c\u4e5f\u53ef\u4ee5\u662f a > 5 \u7b49\u3002"),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"4. \u5bf9\u4e8e Calculated Expressions")),(0,r.yg)("p",null,"\u4ee5 case when\u3001\u5904\u7406\u5b57\u7b26\u4e32\u7b49\u51fd\u6570\u4e3a\u4f8b\uff0c\u8fd9\u90e8\u5206\u8868\u8fbe\u5f0f\u8ba1\u7b97\u975e\u5e38\u6d88\u8017\u6027\u80fd\uff0c\u5982\u679c\u5728\u7269\u5316\u89c6\u56fe\u4e2d\u80fd\u591f\u63d0\u524d\u8ba1\u7b97\u597d\uff0c\u900f\u660e\u6539\u5199\u4f7f\u7528\u8ba1\u7b97\u597d\u7684\u7269\u5316\u89c6\u56fe\u5219\u53ef\u4ee5\u63d0\u9ad8\u67e5\u8be2\u7684\u6027\u80fd\u3002"),(0,r.yg)("p",null,"\u5efa\u8bae\u7269\u5316\u89c6\u56fe\u7684\u5217\u6570\u91cf\u5c3d\u91cf\u4e0d\u8981\u8fc7\u591a\u3002\u5982\u679c\u67e5\u8be2\u4f7f\u7528\u4e86\u591a\u4e2a\u5b57\u6bb5\uff0c\u5e94\u8be5\u6839\u636e\u6700\u5f00\u59cb\u7684\u67e5\u8be2 SQL \u6a21\u5f0f\u5206\u7ec4\uff0c\u5206\u522b\u6784\u5efa\u5bf9\u5e94\u5217\u7684\u7269\u5316\u89c6\u56fe\uff0c\u907f\u514d\u5355\u4e2a\u7269\u5316\u89c6\u56fe\u7684\u5217\u8fc7\u591a\u3002"),(0,r.yg)("p",null,"\u4ee5\u805a\u5408\u67e5\u8be2\u52a0\u901f\u4e3a\u4f8b\uff1a"),(0,r.yg)("p",null,"\u67e5\u8be2 1\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"SELECT \n  l_linestatus, \n  sum(\n    l_extendedprice * (1 - l_discount)\n  ) AS revenue, \n  o_shippriority \nFROM \n  orders \n  LEFT JOIN lineitem ON l_orderkey = o_orderkey \nWHERE \n  o_orderdate <= DATE '2024-06-30' \n  AND o_orderdate >= DATE '2024-05-01' \nGROUP BY \n  l_linestatus, \n  o_shippriority,\n  l_partkey;\n")),(0,r.yg)("p",null,"\u67e5\u8be2 2\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"SELECT \n  l_linestatus, \n  sum(\n    l_extendedprice * (1 - l_discount)\n  ) AS revenue, \n  o_shippriority \nFROM \n  orders \n  LEFT JOIN lineitem ON l_orderkey = o_orderkey \nWHERE \n  o_orderdate <= DATE '2024-06-30' \n  AND o_orderdate >= DATE '2024-05-01' \nGROUP BY \n  l_linestatus, \n  o_shippriority,\n  l_suppkey;\n")),(0,r.yg)("p",null,"\u6839\u636e\u4ee5\u4e0a\u4e24\u4e2a SQL \u67e5\u8be2\uff0c\u6211\u4eec\u53ef\u4ee5\u6784\u5efa\u4e00\u4e2a\u66f4\u4e3a\u901a\u7528\u7684\u5305\u542b Aggregate \u7684\u7269\u5316\u89c6\u56fe\u3002\u5728\u8fd9\u4e2a\u7269\u5316\u89c6\u56fe\u4e2d\uff0c\u6211\u4eec\u5c06 l_partkey \u548c l_suppkey \u90fd\u4f5c\u4e3a\u805a\u5408\u7684 group by \u7ef4\u5ea6\uff0c\u5e76\u5c06 o_orderdate \u4f5c\u4e3a\u8fc7\u6ee4\u6761\u4ef6\u3002\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0co_orderdate \u4e0d\u4ec5\u5728\u7269\u5316\u89c6\u56fe\u7684\u6761\u4ef6\u8865\u507f\u4e2d\u4f7f\u7528\uff0c\u540c\u65f6\u4e5f\u9700\u8981\u88ab\u5305\u542b\u5728\u7269\u5316\u89c6\u56fe\u7684\u805a\u5408 group by \u7ef4 \u5ea6\u4e2d\u3002"),(0,r.yg)("p",null,"\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u6784\u5efa\u7684\u7269\u5316\u89c6\u56fe\u540e\uff0c\u67e5\u8be2 1 \u548c\u67e5\u8be2 2 \u90fd\u53ef\u4ee5\u547d\u4e2d\u8be5\u7269\u5316\u89c6\u56fe\uff0c\u7269\u5316\u89c6\u56fe\u5b9a\u4e49\u5982\u4e0b\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"CREATE MATERIALIZED VIEW common_agg_mv\nBUILD IMMEDIATE REFRESH AUTO ON MANUAL\nDISTRIBUTED BY RANDOM BUCKETS 2\nPROPERTIES  ('replication_num' = '1')\nAS \nSELECT \n  l_linestatus, \n  sum(\n    l_extendedprice * (1 - l_discount)\n  ) AS revenue, \n  o_shippriority,\n  l_suppkey,\n  l_partkey,\n  o_orderdate\nFROM \n  orders \n  LEFT JOIN lineitem ON l_orderkey = o_orderkey \nGROUP BY \n  l_linestatus, \n  o_shippriority,\n  l_suppkey,\n  l_partkey,\n  o_orderdate;\n")),(0,r.yg)("h2",{id:"\u4f7f\u7528\u573a\u666f"},"\u4f7f\u7528\u573a\u666f"),(0,r.yg)("h3",{id:"\u573a\u666f\u4e00\u591a\u8868\u8fde\u63a5\u805a\u5408\u67e5\u8be2\u52a0\u901f"},"\u573a\u666f\u4e00\uff1a\u591a\u8868\u8fde\u63a5\u805a\u5408\u67e5\u8be2\u52a0\u901f"),(0,r.yg)("p",null,"\u901a\u8fc7\u6784\u5efa\u66f4\u901a\u7528\u7684\u7269\u5316\u89c6\u56fe\u80fd\u591f\u52a0\u901f\u591a\u8868\u8fde\u63a5\u805a\u5408\u67e5\u8be2\u3002"),(0,r.yg)("p",null,"\u4ee5\u4e0b\u9762\u4e09\u4e2a\u67e5\u8be2 SQL \u4e3a\u4f8b\uff1a"),(0,r.yg)("p",null,"\u67e5\u8be2 1\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"SELECT \n  l_linestatus, \n  l_extendedprice * (1 - l_discount)\n  o_shippriority \nFROM \n  orders \n  LEFT JOIN lineitem ON l_orderkey = o_orderkey \nWHERE \n  o_orderdate <= DATE '2024-06-30' \n  AND o_orderdate >= DATE '2024-05-01';\n")),(0,r.yg)("p",null,"\u67e5\u8be2 2\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"SELECT \n  l_linestatus, \n  sum(\n    l_extendedprice * (1 - l_discount)\n  ) AS revenue, \n  o_orderdate, \n  o_shippriority \nFROM \n  orders \n  LEFT JOIN lineitem ON l_orderkey = o_orderkey \nWHERE \n  o_orderdate <= DATE '2024-06-30' \n  AND o_orderdate >= DATE '2024-05-01' \nGROUP BY \n  l_linestatus, \n  o_orderdate, \n  o_shippriority;\n")),(0,r.yg)("p",null,"\u67e5\u8be2 3\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"SELECT \n  l_linestatus, \n  l_extendedprice * (1 - l_discount),\n  o_orderdate, \n  o_shippriority \nFROM \n  orders \n  LEFT JOIN lineitem ON l_orderkey = o_orderkey;\n")),(0,r.yg)("p",null,"\u5bf9\u4e8e\u5982\u4e0a\u67e5\u8be2\uff0c\u53ef\u4ee5\u6784\u5efa\u5982\u4e0b\u7269\u5316\u89c6\u56fe\u6765\u6ee1\u8db3\u4e0a\u8ff0\u6240\u6709\u67e5\u8be2\u3002"),(0,r.yg)("p",null,"\u7269\u5316\u89c6\u56fe\u7684\u5b9a\u4e49\u4e2d\u53bb\u9664\u4e86\u67e5\u8be2 1 \u548c\u67e5\u8be2 2 \u7684\u8fc7\u6ee4\u6761\u4ef6\uff0c\u5f97\u5230\u4e86\u4e00\u4e2a\u66f4\u901a\u7528\u7684 Join\uff0c\u5e76\u63d0\u524d\u8ba1\u7b97\u4e86\u8868\u8fbe\u5f0f",(0,r.yg)("inlineCode",{parentName:"p"},"l_extendedprice * (1 - l_discount)"),"\uff0c\u8fd9\u6837\u5f53\u67e5\u8be2\u547d\u4e2d\u7269\u5316\u89c6\u56fe\u65f6\uff0c\u53ef\u4ee5\u8282\u7701\u8868\u8fbe\u5f0f\u7684\u8ba1\u7b97\u3002"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"CREATE MATERIALIZED VIEW common_join_mv\nBUILD IMMEDIATE REFRESH AUTO ON MANUAL\nDISTRIBUTED BY RANDOM BUCKETS 2\nPROPERTIES  ('replication_num' = '1')\nAS \nSELECT \n  l_linestatus, \n  l_extendedprice * (1 - l_discount),\n  o_orderdate, \n  o_shippriority \nFROM \n  orders \n  LEFT JOIN lineitem ON l_orderkey = o_orderkey;\n")),(0,r.yg)("p",null,"\u5982\u679c\u4e0a\u8ff0\u7269\u5316\u89c6\u56fe\u4e0d\u80fd\u6ee1\u8db3\u67e5\u8be2 2 \u7684\u52a0\u901f\u6027\u80fd\u8981\u6c42\uff0c\u53ef\u4ee5\u6784\u5efa\u805a\u5408\u7269\u5316\u89c6\u56fe\u3002\u4e3a\u4e86\u4fdd\u6301\u901a\u7528\u6027\uff0c\u53ef\u4ee5\u53bb\u9664\u5bf9",(0,r.yg)("inlineCode",{parentName:"p"},"o_orderdate"),"\u5b57\u6bb5\u7684\u8fc7\u6ee4\u6761\u4ef6\u3002"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"CREATE MATERIALIZED VIEW target_agg_mv\nBUILD IMMEDIATE REFRESH AUTO ON MANUAL\nDISTRIBUTED BY RANDOM BUCKETS 2\nPROPERTIES  ('replication_num' = '1')\nAS \nSELECT \n  l_linestatus, \n  sum(\n    l_extendedprice * (1 - l_discount)\n  ) AS revenue, \n  o_orderdate, \n  o_shippriority \nFROM \n  orders \n  LEFT JOIN lineitem ON l_orderkey = o_orderkey \nGROUP BY \n  l_linestatus, \n  o_orderdate, \n  o_shippriority;\n")),(0,r.yg)("h3",{id:"\u573a\u666f\u4e8c\u65e5\u5fd7\u67e5\u8be2\u52a0\u901f"},"\u573a\u666f\u4e8c\uff1a\u65e5\u5fd7\u67e5\u8be2\u52a0\u901f"),(0,r.yg)("p",null,"\u5728\u65e5\u5fd7\u67e5\u8be2\u52a0\u901f\u573a\u666f\u4e2d\uff0c\u5efa\u8bae\u4e0d\u5c40\u9650\u4e8e\u5355\u72ec\u4f7f\u7528\u5f02\u6b65\u7269\u5316\u89c6\u56fe\uff0c\u53ef\u4ee5\u7ed3\u5408\u540c\u6b65\u7269\u5316\u89c6\u56fe\u3002"),(0,r.yg)("p",null,"\u4e00\u822c\u57fa\u8868\u662f\u5206\u533a\u8868\uff0c\u6309\u7167\u5c0f\u65f6\u5206\u533a\u5c45\u591a\uff0c\u5355\u8868\u805a\u5408\u67e5\u8be2\uff0c\u4e00\u822c\u8fc7\u6ee4\u6761\u4ef6\u662f\u6309\u7167\u65f6\u95f4\uff0c\u8fd8\u6709\u4e00\u4e9b\u6807\u8bc6\u4f4d\u3002\u6709\u65f6\u67e5\u8be2\u7684\u54cd\u5e94\u901f\u5ea6\u65e0\u6cd5\u8fbe\u5230\u8981\u6c42\uff0c\u4e00\u822c\u53ef\u4ee5\u6784\u5efa\u540c\u6b65\u7269\u5316\u89c6\u56fe\u8fdb\u884c\u52a0\u901f\u3002"),(0,r.yg)("p",null,"\u4f8b\u5982\uff0c\u57fa\u8868\u7684\u5b9a\u4e49\u53ef\u80fd\u5982\u4e0b\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE IF NOT EXISTS test (\n`app_name` VARCHAR(64) NULL COMMENT '\u6807\u8bc6', \n`event_id` VARCHAR(128) NULL COMMENT '\u6807\u8bc6', \n`decision` VARCHAR(32) NULL COMMENT '\u679a\u4e3e\u503c', \n`time` DATETIME NULL COMMENT '\u67e5\u8be2\u65f6\u95f4', \n`id` VARCHAR(35) NOT NULL COMMENT 'od', \n`code` VARCHAR(64) NULL COMMENT '\u6807\u8bc6', \n`event_type` VARCHAR(32) NULL COMMENT '\u4e8b\u4ef6\u7c7b\u578b' \n)\nDUPLICATE KEY(app_name, event_id)\nPARTITION BY RANGE(time)                                    \n(                                                                                                                                      \n    FROM (\"2024-07-01 00:00:00\") TO (\"2024-07-15 00:00:00\") INTERVAL 1 HOUR                                                                     \n)     \nDISTRIBUTED BY HASH(event_id)\nBUCKETS 3 PROPERTIES (\"replication_num\" = \"1\");\n")),(0,r.yg)("p",null,"\u7269\u5316\u89c6\u56fe\u53ef\u4ee5\u6309\u7167\u5206\u949f\u805a\u5408\u6570\u636e\uff0c\u8fd9\u6837\u4e5f\u80fd\u8fbe\u5230\u4e00\u5b9a\u7684\u805a\u5408\u6548\u679c\u3002\u4f8b\u5982\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"CREATE MATERIALIZED VIEW sync_mv\n    AS\n    SELECT \n      decision,\n      code, \n      app_name, \n      event_id, \n      event_type, \n      date_trunc(time, 'minute'), \n      DATE_FORMAT(\n        `time`, '%Y-%m-%d'\n      ), \n      cast(FLOOR(MINUTE(time) / 15) as decimal(9, 0)),\n      count(id) as cnt\n    from \n      test \n    group by \n      code, \n      app_name, \n      event_id, \n      event_type, \n      date_trunc(time, 'minute'), \n      decision, \n      DATE_FORMAT(time, '%Y-%m-%d'), \n      cast(FLOOR(MINUTE(`time`) / 15) as decimal(9, 0));\n")),(0,r.yg)("p",null,"\u67e5\u8be2\u8bed\u53e5\u53ef\u80fd\u5982\u4e0b\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"SELECT \n    decision, \n    CONCAT(\n        CONCAT(\n          DATE_FORMAT(\n            `time`, '%Y-%m-%d'\n          ), \n          '', \n          LPAD(\n            cast(FLOOR(MINUTE(`time`) / 15) as decimal(9, 0)) * 15, \n            5, \n            '00'\n          ), \n          ':00'\n        )\n      ) as time, \n      count(id) as cnt \n    from \n      test \n    where \n    date_trunc(time, 'minute') BETWEEN '2024-07-02 18:00:00' \n      AND '2024-07-03 20:00:00' \n    group by \n      decision, \n      DATE_FORMAT(\n        `time`, \"%Y-%m-%d\"\n      ), \n      cast(FLOOR(MINUTE(`time`) / 15) as decimal(9, 0));\n")),(0,r.yg)("h3",{id:"\u573a\u666f\u4e09\u6e56\u4ed3\u4e00\u4f53\u8054\u90a6\u6570\u636e\u67e5\u8be2"},"\u573a\u666f\u4e09\uff1a\u6e56\u4ed3\u4e00\u4f53\u8054\u90a6\u6570\u636e\u67e5\u8be2"),(0,r.yg)("p",null,"\u5f88\u591a\u7528\u6237\u6709\u57fa\u4e8e Doris \u8fdb\u884c\u8054\u90a6\u6570\u636e\u67e5\u8be2\u7684\u9700\u6c42\uff0cDoris \u7684\u591a\u6e90\u6570\u636e\u76ee\u5f55\uff08Multi-Catalog\uff09\u529f\u80fd\u4f7f\u5f97\u8fd9\u4e00\u9700\u6c42\u53d8\u5f97\u5341\u5206\u4fbf\u6377\u3002\u7528\u6237\u53ea\u9700\u521b\u5efa\u4e00\u4e2a Catalog\uff0c\u65e0\u9700\u5c06\u6570\u636e\u8fc1\u79fb\u5230 Doris\uff0c\u5373\u53ef\u901a\u8fc7 Doris \u5bf9\u5916\u90e8\u6570\u636e\u8fdb\u884c\u67e5\u8be2\u3002"),(0,r.yg)("p",null,"\u7136\u800c\uff0c\u8fd9\u79cd\u65b9\u5f0f\u4e5f\u53ef\u80fd\u5e26\u6765\u4e00\u4e9b\u95ee\u9898\u3002\u56e0\u4e3a\u67e5\u8be2\u5916\u90e8\u6570\u636e\u7684\u901f\u5ea6\u53ef\u80fd\u4f1a\u53d7\u5230\u7f51\u7edc\u53ca\u7b2c\u4e09\u65b9\u670d\u52a1\u7684\u5f71\u54cd\uff0c\u5bfc\u81f4\u54cd\u5e94\u901f\u5ea6\u8f83\u6162\uff0c\u5bf9\u4e8e\u54cd\u5e94\u901f\u5ea6\u8981\u6c42\u6bd4\u8f83\u9ad8\u7684\u573a\u666f\uff0c\u53ef\u80fd\u96be\u4ee5\u6ee1\u8db3\u9700\u6c42\u3002"),(0,r.yg)("p",null,"\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u53ef\u4ee5\u57fa\u4e8e\u5916\u90e8 Catalog \u521b\u5efa\u5f02\u6b65\u7269\u5316\u89c6\u56fe\u3002\u7531\u4e8e\u7269\u5316\u89c6\u56fe\u672c\u8eab\u7684\u6570\u636e\u662f\u5b58\u50a8\u5728 Doris \u5185\u90e8\u7684\uff0c\u6240\u4ee5\u67e5\u8be2\u7269\u5316\u89c6\u56fe\u7684\u901f\u5ea6\u4f1a\u5f88\u5feb\u3002\u56e0\u6b64\uff0c\u5bf9\u4e8e\u54cd\u5e94\u901f\u5ea6\u8981\u6c42\u6bd4\u8f83\u9ad8\u7684\u573a\u666f\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u57fa\u4e8e\u5916\u90e8 Catalog \u521b\u5efa\u4e00\u4e2a\u7269\u5316\u89c6\u56fe\u3002"),(0,r.yg)("admonition",{title:"\u63d0\u793a",type:"tip"},(0,r.yg)("p",{parentName:"admonition"},"\u5728\u6e56\u4ed3\u4e00\u4f53\u573a\u666f\u4e0b\uff0c\u4f7f\u7528\u5916\u8868\u900f\u660e\u6539\u5199\u4e4b\u524d\u9700\u8981\u6253\u5f00 ",(0,r.yg)("inlineCode",{parentName:"p"},"materialized_view_rewrite_enable_contain_external_table")," \u5f00\u5173\uff0c\u8be6\u60c5\u53ef\u53c2\u8003",(0,r.yg)("a",{parentName:"p",href:"../async-materialized-view/functions-and-demands"},"\u5f02\u6b65\u7269\u5316\u89c6\u56fe\u529f\u80fd\u63cf\u8ff0"),"\u3002")),(0,r.yg)("h3",{id:"\u573a\u666f\u56db\u6570\u636e\u5efa\u6a21etl"},"\u573a\u666f\u56db\uff1a\u6570\u636e\u5efa\u6a21\uff08ETL\uff09"),(0,r.yg)("p",null,"\u6709\u65f6\u7528\u6237\u4f1a\u4f7f\u7528\u4e8b\u5b9e\u8868\u548c\u7ef4\u5ea6\u8868\u52a0\u5de5\u6210\u4e00\u5f20\u6c47\u603b\u8868\uff0c\u4e4b\u540e\u5bf9\u6b64\u6c47\u603b\u8868\u8fdb\u884c Ad-hoc \u67e5\u8be2\u3002\u6b64\u6c47\u603b\u8868\u4e5f\u53ef\u4f5c\u4e3a\u57fa\u7840\u6307\u6807\u8868\uff0c\u7528\u4e8e\u540e\u7eed\u7684\u5efa\u6a21\u3002"),(0,r.yg)("p",null,"\u6b64\u65f6\uff0c\u53ef\u4ee5\u5229\u7528\u7269\u5316\u89c6\u56fe\u5bf9\u57fa\u8868\u7684\u6570\u636e\u8fdb\u884c\u5efa\u6a21\u3002\u4e4b\u540e\uff0c\u8fd8\u53ef\u4ee5\u5229\u7528\u521b\u5efa\u597d\u7684\u7269\u5316\u89c6\u56fe\u521b\u5efa\u66f4\u9ad8\u5c42\u7ea7\u7684\u7269\u5316\u89c6\u56fe\uff082.1.3 \u652f\u6301\uff09\uff0c\u7075\u6d3b\u6ee1\u8db3\u4e0d\u540c\u7684\u9700\u6c42\u3002"),(0,r.yg)("p",null,"\u4e0d\u540c\u5c42\u7ea7\u7684\u7269\u5316\u89c6\u56fe\u90fd\u53ef\u4ee5\u81ea\u5df1\u8bbe\u7f6e\u5237\u65b0\u65b9\u5f0f\uff0c\u4f8b\u5982\uff1a"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"\u7b2c\u4e00\u5c42\u7684\u7269\u5316\u89c6\u56fe\u53ef\u4ee5\u8bbe\u7f6e\u4e3a\u5b9a\u65f6\u5237\u65b0\uff0c\u7b2c\u4e8c\u5c42\u7684\u8bbe\u7f6e\u4e3a\u89e6\u53d1\u5237\u65b0\u3002\u8fd9\u6837\uff0c\u7b2c\u4e00\u5c42\u7684\u7269\u5316\u89c6\u56fe\u5237\u65b0\u5b8c\u6210\u540e\uff0c\u4f1a\u81ea\u52a8\u89e6\u53d1\u7b2c\u4e8c\u5c42\u7269\u5316\u89c6\u56fe\u7684\u5237\u65b0\u3002")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"\u5982\u679c\u6bcf\u5c42\u7684\u7269\u5316\u89c6\u56fe\u90fd\u8bbe\u7f6e\u4e3a\u5b9a\u65f6\u5237\u65b0\uff0c\u90a3\u4e48\u7b2c\u4e8c\u5c42\u7269\u5316\u89c6\u56fe\u5237\u65b0\u7684\u65f6\u5019\uff0c\u4e0d\u4f1a\u8003\u8651\u7b2c\u4e00\u5c42\u7684\u7269\u5316\u89c6\u56fe\u6570\u636e\u662f\u5426\u548c\u57fa\u8868\u540c\u6b65\uff0c\u53ea\u4f1a\u628a\u7b2c\u4e00\u5c42\u7269\u5316\u89c6\u56fe\u7684\u6570\u636e\u52a0\u5de5\u540e\u540c\u6b65\u5230\u7b2c\u4e8c\u5c42\u3002"))))}m.isMDXComponent=!0}}]);