<!doctype html>
<html lang="zh-Hans-CN" dir="ltr" class="docs-wrapper docs-doc-page docs-version-3.0 plugin-docs plugin-id-default docs-doc-id-releasenotes/v2.1/release-2.1.0" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
<meta name="generator" content="Docusaurus v2.4.3">
<link rel="alternate" type="application/rss+xml" href="/zh-CN/blog/rss.xml" title="Apache Doris RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-CN/blog/atom.xml" title="Apache Doris Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DT7W9E9722"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-DT7W9E9722",{anonymize_ip:!0})</script>



<link rel="preconnect" href="https://analytics.apache.org/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://analytics.apache.org/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","43"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script>



<link rel="icon" href="/zh-CN/images/logo-only.png">
<link rel="manifest" href="/zh-CN/manifest.json">
<meta name="theme-color" content="#FFFFFF">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/zh-CN/img/docusaurus.png">
<link rel="mask-icon" href="/zh-CN/img/docusaurus.svg" color="rgb(37, 194, 160)">
<meta name="msapplication-TileImage" content="/zh-CN/img/docusaurus.png">
<meta name="msapplication-TileColor" content="#000">



<link rel="stylesheet" href="https://cdn-font.hyperos.mi.com/font/css?family=MiSans:100,200,300,400,450,500,600,650,700,900:Chinese_Simplify,Latin&display=swap">
<link rel="stylesheet" href="https://cdn-font.hyperos.mi.com/font/css?family=MiSans_Latin:100,200,300,400,450,500,600,650,700,900:Latin&display=swap">
<script src="/js/custom-script.js"></script><title data-rh="true">Release 2.1.0 - Apache Doris</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://doris.apache.org/zh-CN/docs/3.0/releasenotes/v2.1/release-2.1.0"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="docusaurus_version" content="3.0"><meta data-rh="true" name="docusaurus_tag" content="docs-default-3.0"><meta data-rh="true" name="docsearch:version" content="3.0"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-3.0"><meta data-rh="true" property="og:title" content="Release 2.1.0 - Apache Doris"><meta data-rh="true" name="description" content="&lt;!--"><meta data-rh="true" property="og:description" content="&lt;!--"><link data-rh="true" rel="icon" href="/zh-CN/images/favicon.ico"><link data-rh="true" rel="canonical" href="https://doris.apache.org/zh-CN/docs/3.0/releasenotes/v2.1/release-2.1.0"><link data-rh="true" rel="alternate" href="https://doris.apache.org/docs/3.0/releasenotes/v2.1/release-2.1.0" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://doris.apache.org/zh-CN/docs/3.0/releasenotes/v2.1/release-2.1.0" hreflang="zh-Hans-CN"><link data-rh="true" rel="alternate" href="https://doris.apache.org/docs/3.0/releasenotes/v2.1/release-2.1.0" hreflang="x-default"><link rel="stylesheet" href="https://cdnd.selectdb.com/zh-CN/assets/css/styles.eec5f0e7.css">
<link rel="preload" href="https://cdnd.selectdb.com/zh-CN/assets/js/runtime~main.3e4959a3.js" as="script">
<link rel="preload" href="https://cdnd.selectdb.com/zh-CN/assets/js/main.d9d2e727.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><div class="announcementBar_s0pr" style="background-color:#3C2FD4;color:#FFFFFF" role="banner"><div class="announcementBarPlaceholder_qxfj"></div><div class="announcementBarContent_dpRF"><a href="https://github.com/apache/doris" target="_blank" style="display: flex; width: 100%; align-items: center; justify-content: center; margin-left: 4px; text-decoration: none; color: white">Do you ❤️ Doris? Give us a 🌟 on GitHub 
                <img style="width: 1.2rem; height: 1.2rem; margin-left: 0.4rem;" src="/images/github-white-icon.svg">
                    </a></div><button type="button" class="clean-btn close announcementBarClose_iXyO" aria-label="关闭"><svg viewBox="0 0 15 15" width="14" height="14" style="color:white"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner" style="padding:"><div class="navbar__items"><div class="navbar-left"><div class="navbar-logo-wrapper flex items-center"><a class="navbar__brand" href="/zh-CN/"><div class="navbar__logo"><img src="https://cdnd.selectdb.com/images/logo.svg" alt="Apache Doris" class="themedImage_ToTc themedImage--light_HNdA"><img src="https://cdnd.selectdb.com/images/logo.svg" alt="Apache Doris" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbarLeftToc_UHDb"><a class="navbar__item navbar__link" style="text-align:center;padding:0 0.625rem" target="_blank" href="/zh-CN/docs/gettingStarted/what-is-new">Docs</a><a class="navbar__item navbar__link" style="text-align:center;padding:0 0.625rem" href="/zh-CN/blog">Blog</a><a class="navbar__item navbar__link" style="text-align:center;padding:0 0.625rem" href="/zh-CN/users">Users</a><a href="https://github.com/apache/doris/discussions" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link" style="text-align:center;padding:0 0.625rem">Discussions</a><a class="navbar__item navbar__link" style="text-align:center;padding:0 0.625rem" href="/zh-CN/ecosystem/cluster-management">Ecosystem</a><a class="navbar__item navbar__link" style="text-align:center;padding:0 0.625rem" href="/zh-CN/community/join-community">Community</a></div></div></div><div class="navbar__items navbar__items--right"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><div class="docs-search searchBox_H2mL"><div class="navbar__search searchBarContainer_PzyC"><input placeholder="搜索" aria-label="Search" class="navbar__search-input navbarSearchInput_tb6T"><div class="loadingRing__K5d searchBarLoadingRing_e2f0"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_m7ml"><kbd class="searchHint_zuPL">ctrl</kbd><kbd class="searchHint_zuPL">K</kbd></div></div></div><div class="custom-navbar-item navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg class="icon-language" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M7.75756 14.3L10.5816 6.91667H11.8759L14.7 14.3H13.4057L12.7501 12.4167H9.74113L9.06873 14.3H7.75756ZM10.1109 11.35H12.3467L11.254 8.3H11.2036L10.1109 11.35ZM2.84908 12.45L1.97498 11.5833L5.11841 8.48333C4.72618 8.05 4.38439 7.60267 4.09302 7.14133C3.80165 6.68044 3.54389 6.19444 3.31976 5.68333H4.61412C4.80463 6.06111 5.00635 6.39711 5.21927 6.69133C5.43219 6.986 5.68434 7.29444 5.97571 7.61667C6.43519 7.12778 6.81621 6.62511 7.11879 6.10867C7.42137 5.59178 7.67352 5.03889 7.87523 4.45H1V3.23333H5.33694V2H6.58087V3.23333H10.9178V4.45H9.11916C8.89503 5.18333 8.59805 5.89155 8.22824 6.57467C7.85842 7.25822 7.39895 7.90555 6.84983 8.51667L8.3459 10.0167L7.87523 11.2833L5.95891 9.38333L2.84908 12.45Z" fill="#4C576C"></path></svg></a><ul class="dropdown__menu"><li><a href="/docs/3.0/releasenotes/v2.1/release-2.1.0" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-align:center;padding:0 0.625rem">English</a></li><li><a href="/zh-CN/docs/3.0/releasenotes/v2.1/release-2.1.0" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-align:center;padding:0 0.625rem">中文</a></li></ul></div><div class="custom-navbar-item navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/zh-CN/docs/3.0/install/source-install/compilation-with-docker"><span class="text-sm">Versions: <!-- -->3.0</span></a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" style="text-align:center;padding:0 0.625rem" href="/zh-CN/docs/3.0/releasenotes/v2.1/release-2.1.0">3.0</a></li><li><a class="dropdown__link" style="text-align:center;padding:0 0.625rem" href="/zh-CN/docs/releasenotes/v2.1/release-2.1.0">2.1</a></li><li><a class="dropdown__link" style="text-align:center;padding:0 0.625rem" href="/zh-CN/docs/2.0/releasenotes/v2.1/release-2.1.0">2.0</a></li><li><a class="dropdown__link" style="text-align:center;padding:0 0.625rem" href="/zh-CN/docs/1.2/releasenotes/v2.1/release-2.1.0">1.2</a></li><li><a class="dropdown__link" style="text-align:center;padding:0 0.625rem" href="/zh-CN/docs/dev/releasenotes/v2.1/release-2.1.0">dev</a></li></ul></div><a class="navbar__item navbar__link header-right-button-primary navbar-download-mobile" style="text-align:center;padding:0 0.625rem" href="/zh-CN/download">Download</a><a href="https://github.com/apache/doris" target="_blank" rel="noopener noreferrer" class="github-btn desktop header-right-button-github"></a><a href="https://join.slack.com/t/apachedoriscommunity/shared_invite/zt-2kl08hzc0-SPJe4VWmL_qzrFd2u2XYQA" target="_blank" rel="noopener noreferrer" class="slack-btn desktop header-right-button-slack"></a><a class="header-right-button-primary navbar-download-desktop" href="/zh-CN/download">Download</a></div></div><div class="navbar__bottom"><div class="docs-nav-mobile"><a class="navbar__item navbar__link" style="text-align:center;padding:0 0.625rem" href="/zh-CN/docs/3.0/gettingStarted/what-is-new">Getting Started</a><a class="navbar__item navbar__link" style="text-align:center;padding:0 0.625rem" href="/zh-CN/docs/3.0/install/source-install/compilation-with-docker">Guides</a><a class="navbar__item navbar__link" style="text-align:center;padding:0 0.625rem" href="/zh-CN/docs/3.0/benchmark/ssb">Benchmark</a><a class="navbar__item navbar__link" style="text-align:center;padding:0 0.625rem" href="/zh-CN/docs/3.0/ecosystem/spark-doris-connector">Ecosystem</a><a class="navbar__item navbar__link" style="text-align:center;padding:0 0.625rem" href="/zh-CN/docs/3.0/faq/install-faq">FAQ</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" style="text-align:center;padding:0 0.625rem" href="/zh-CN/docs/3.0/releasenotes/all-release">Releases</a><div class="navbar__item"><a href="https://github.com/apache/doris/discussions" target="_blank" style="display: flex; align-items: center; justify-content: center; text-decoration: none;">Forum<img style="width: 1.2rem; height: 1.2rem; margin-left: 0.2rem;" src="/images/forum-logo.svg">
                    </a></div></div></div><div class="navbar__bottom"></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><div class="main-wrapper docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar"><nav aria-label="文档侧边栏" class="menu custom-scrollbar menu_Y1UP menuWithAnnouncementBar_fPny"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh-CN/docs/3.0/releasenotes/all-release">最新发布</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a id="menu__group" class="menu__link menu__link_level_1 menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh-CN/docs/3.0/releasenotes/v3.0/release-3.0.0">v3.0</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a id="menu__group" class="menu__link menu__link_level_1 menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/zh-CN/docs/3.0/releasenotes/v2.1/release-2.1.7">v2.1</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list menu__list_level_2"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/3.0/releasenotes/v2.1/release-2.1.7">Release 2.1.7</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/3.0/releasenotes/v2.1/release-2.1.6">Release 2.1.6</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/3.0/releasenotes/v2.1/release-2.1.5">Release 2.1.5</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/3.0/releasenotes/v2.1/release-2.1.4">Release 2.1.4</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/3.0/releasenotes/v2.1/release-2.1.3">Release 2.1.3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/3.0/releasenotes/v2.1/release-2.1.2">Release 2.1.2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/3.0/releasenotes/v2.1/release-2.1.1">Release 2.1.1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh-CN/docs/3.0/releasenotes/v2.1/release-2.1.0">Release 2.1.0</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a id="menu__group" class="menu__link menu__link_level_1 menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh-CN/docs/3.0/releasenotes/v2.0/release-2.0.15">v2.0</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a id="menu__group" class="menu__link menu__link_level_1 menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh-CN/docs/3.0/releasenotes/v1.2/release-1.2.8">v1.2</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a id="menu__group" class="menu__link menu__link_level_1 menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh-CN/docs/3.0/releasenotes/v1.1/release-1.1.5">v1.1</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/zh-CN/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">v2.1</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Release 2.1.0</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Release 2.1.0</h1></header><p>亲爱的社区小伙伴们，我们很高兴地向大家宣布，在 3 月 8 日我们引来了 Apache Doris 2.1.0 版本的正式发布，欢迎大家下载使用。</p><ul><li><p>在查询性能方面，2.1 系列版本我们着重提升了开箱盲测性能，力争不做调优的情况下取得较好的性能表现，包含了对复杂 SQL 查询性能的进一步提升，在 TPC-DS 1TB 测试数据集上获得超过 100% 的性能提升，查询性能居于业界领先地位。</p></li><li><p>在数据湖分析场景，我们进行了大量性能方面的改进、相对于 Trino 和 Spark 分别有 4-6 倍的性能提升，并引入了多 SQL 方言兼容、便于用户可以从原有系统无缝切换至 Apache Doris。在面向数据科学以及其他形式的大规模数据读取场景，我们引入了基于 Arrow Flight 的高速读取接口，数据传输效率提升 100 倍。</p></li><li><p>在半结构化数据分析场景，我们引入了全新的 Variant 和 IP 数据类型，完善了一系列分析函数，面向复杂半结构化数据的存储和分析处理更加得心应手。</p></li><li><p>在 2.1.0 版本中我们也引入了基于多表的异步物化视图以提升查询性能，支持透明改写加速、自动刷新、外表到内表的物化视图以及物化视图直查，基于这一能力物化视图也可用于数据仓库分层建模、作业调度和数据加工。</p></li><li><p>在存储方面，我们引入了自增列、自动分区、MemTable 前移以及服务端攒批的能力，使得大规模数据实时写入的效率更高。</p></li><li><p>在负载管理方面，我们进一步完善了 Workload Group 资源组的隔离能力，并增加了运行时查看 SQL 资源用量的能力，进一步提升了多负载场景下的稳定性。</p></li></ul><p>在 2.1.0 版本的研发过程中，<strong>有 237 位贡献者为 Apache Doris 带来了接近 6000 个 Commits。</strong> 同时 2.1.0 版本也同样经过了近百家社区用户的大规模打磨，在测试过程中向我们反馈了许多有价值的优化项，在此向所有参与版本研发、测试和需求反馈的贡献者们表示最衷心的感谢。后续我们将会持续敏捷发版来响应所有用户对功能和稳定性的更高追求，欢迎大家在使用过程中给予我们更多反馈。</p><ul><li><p>GitHub 下载：<a href="https://github.com/apache/doris/releases" target="_blank" rel="noopener noreferrer">https://github.com/apache/doris/releases</a></p></li><li><p>官网下载：<a href="https://doris.apache.org/download" target="_blank" rel="noopener noreferrer">https://doris.apache.org/download</a></p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="复杂查询性能提升-100tpc-ds-业界领先">复杂查询性能提升 100%，TPC-DS 业界领先<a href="#复杂查询性能提升-100tpc-ds-业界领先" class="hash-link" aria-label="复杂查询性能提升 100%，TPC-DS 业界领先的直接链接" title="复杂查询性能提升 100%，TPC-DS 业界领先的直接链接">​</a></h2><p> 在 2.1 系列版本中，我们着重提升了开箱盲测性能，力争不做调优的情况下取得较好的性能表现，包含了对复杂 SQL 查询性能的进一步提升。在此我们以 TPC-DS 1TB 作为性能测试对比的基准，重点对比最新 2.1.0 版本与 2.0.5 版本的性能提升。集群规模均为 1FE、3BE，其中 BE 节点的服务器配置为 48C 192G。从以下测试结果中可以看到：</p><ul><li><p>2.1.0 版本的总查询耗时为 245.7 秒，相较于 2.0.5 版本的 489.6 秒，<strong>性能提升达到 100 %；</strong></p></li><li><p>在全部 99 个 SQL 中，有近三分之一的 SQL 查询性能提升达到 2 倍以上，超过 80 个 SQL 都获得显著性能提升；</p></li><li><p>不论是基础的过滤、排序、聚合，或者复杂的多表关联查询、子查询以及窗口函数计算，2.1.0 版本都有更为明显的性能优势；</p></li><li><p>2.0.5 版本或 2.1.0 版本，都可以完整执行 TPC-DS 的 99 个查询。</p></li></ul><p><img loading="lazy" alt="复杂查询性能提升 100%，TPC-DS 业界领先" src="https://cdnd.selectdb.com/zh-CN/assets/images/2.1-Doris-TPC-DS-best-performance-196cfa22d1783b3e3a367bed4e300dd1.png" width="1280" height="675" class="img_ev3q"></p><p>以上详细测试结果我们将在后续提交到 Apache Doris 官网文档中，也欢迎所有用户在完成最新版本的部署后进行测试复现。</p><p>与此同时，我们也对业内多个 OLAP 系统在同等硬件资源和多个测试数据规模下进行了性能测试，不论大宽表场景或多表关联场景，Apache Doris 都具备着极为明显的性能优势。毫无疑问，<strong>Apache Doris 已在业界同类产品中性能居于最领先地位</strong>！</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="优化器更智能">优化器更智能<a href="#优化器更智能" class="hash-link" aria-label="优化器更智能的直接链接" title="优化器更智能的直接链接">​</a></h3><p>在 Apache Doris 2.0 版本中我们引入了全新查询优化器，在绝大多数场景无需任何调优即可实现极致的查询性能。而在最新发布的 Apache Doris 2.1 版本中，查询优化器在整体代际更新的基础上，进行了优化规则的扩展和枚举框架的完善，面向复杂分析场景更加得心应手：</p><ul><li><p><strong>优化器基础设施完善</strong>：在多种优化器基础设施方面进行了补充和增强，例如对统计信息推导和代价模型方面的持续改进，使之能够收集更多的特征信息为复杂优化提供基础；</p></li><li><p><strong>优化规则持续扩展</strong>：得益于丰富的实际场景反馈，新版本中查询优化器增强了包括算子下压在内的许多经典规则，结合上述基础设施扩充而引入的新优化规则，使得新版本的查询优化器能覆盖更广泛的使用场景；</p></li><li><p><strong>枚举框架进一步优化</strong>：在查询优化器 Cascades 和 DPhyper 两大融合框架的基础上，继续深耕框架能力、优化框架性能，确立了更为清晰的枚举策略，兼顾计划质量和枚举效率，为高性能引擎提供坚实基础。例如将 Cascades 默认枚举表上限从 5 提升到了 8、有效扩大了高质量计划的覆盖范围，同时进一步优化 DPhyper 枚举效率、使之能够枚举出更优计划。</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="无统计信息优化">无统计信息优化<a href="#无统计信息优化" class="hash-link" aria-label="无统计信息优化的直接链接" title="无统计信息优化的直接链接">​</a></h3><p>针对海量数据规模以及数据湖分析场景下，针对统计信息收集难度高、收集时间久的问题，在 2.1 版本中查询优化器利用多种启发式技术，大大提升了<strong>无统计信息场景下</strong>的计划质量，使得在没有统计信息的场景下也可获得较好的查询计划。同时扩展了 Runtime Filter 的下压场景和自适应能力，在执行过程中能够自适应地动态调整部分表达式谓词，使得 Apache Doris 在不依赖统计信息的情况下也具有优异的性能表现。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="parallel-adaptive-scan-并行自适应扫描">Parallel Adaptive Scan 并行自适应扫描<a href="#parallel-adaptive-scan-并行自适应扫描" class="hash-link" aria-label="Parallel Adaptive Scan 并行自适应扫描的直接链接" title="Parallel Adaptive Scan 并行自适应扫描的直接链接">​</a></h3><p>在复杂数据分析场景下，每次查询都需要扫描大量的数据进行计算，因此 IO 瓶颈很大程度上决定了查询性能的上限。为了提升 Scan IO 的性能，Apache Doris 采取了并行读取的技术，每个扫描线程读取 1 个或者多个 Tablet（即用户建表时指定的 Bucket），但如若用户建表时指定的 Bucket 数目不合理、那么磁盘扫描线程就无法并行工作，直接影响查询性能。为此，在 2.1 版本中我们引入了 Tablet 内的并行扫描技术，可以将多个 Tablet 进行池化，在磁盘扫描端可以根据行数来拆分多个线程并行扫描（最多支持 48 个线程），从而有效避免分桶数不合理导致的查询性能问题。</p><p><img loading="lazy" alt="Parallel Adaptive Scan 并行自适应扫描" src="https://cdnd.selectdb.com/zh-CN/assets/images/2.1-doris-parallel-adaptive-scan-ac95c58d6afe58c11121e37ee355685e.png" width="1280" height="424" class="img_ev3q"></p><p>因此在 2.1 版本以后，我们建议用户<strong>在建表时设置的分桶数=整个集群磁盘的数量</strong>，在 IO 层面能将整个集群所有的 IO 资源全部利用起来。</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_S0QG"><p>当前 2.1.0 版本的 Parallel Adaptive Scan 只能针对 Unqiue Key 模型的 Merge-on-Write 表以及 Duplicate Key 模型生效，预计在 2.1.1 版本中会增加对 Unique Key 模型 Merge-on-Read 表和 Aggregate Key 模型的支持。</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="local-shuffle">Local Shuffle<a href="#local-shuffle" class="hash-link" aria-label="Local Shuffle的直接链接" title="Local Shuffle的直接链接">​</a></h3><p>在部分场景下，数据分布不均会导致多个 Instance 的查询执行出现长尾。而为了解决单个 BE 节点上多个 Instance 之间的数据倾斜问题，在 Apache Doris 2.1 版本中我们引入了 Local Shuffle 技术，尽可能将数据打散从而加速查询。例如在某一典型的聚合查询中，数据在经过聚合之前将会通过一个 Local Shuffle 节点被均匀分布在不同的 Pipeline Task 中，如下图所示：</p><p><img loading="lazy" alt="Local Shuffle" src="https://cdnd.selectdb.com/zh-CN/assets/images/2.1-doris-local-shuffle-6f7365d5417f254f369c691827d034eb.png" width="1220" height="1280" class="img_ev3q"></p><p>在具备了 Parallel Adaptive Scan 和 Local Shuffle 能力之后，Apache Doris 能够规避由于分桶数不合理、数据分布不均带来的性能问题。</p><p>在此我们分别使用 Clickbench（大宽表场景）和 TPC-H（多表 Join 的复杂分析场景）数据集模拟建表分桶不合理的情况，在 Clickbench 数据集中我们建表 Bucket 数量分别设为 1 和 16，在 TPC-H 100G 数据集下我们建表时每个 Partition 的 Bucket 数目分别设为 1 和 16。在开启 Parallel Adaptive Scan 和 Local Shuffle 之后，整体查询性能表现比较平稳，即使不合理的数据分布也能取得优异的性能表现。</p><p><img loading="lazy" alt="Local Shuffle Clickbench and TPCH-100" src="https://cdnd.selectdb.com/zh-CN/assets/images/2.1-doris-clickbench-tpch-85fffd14ee5ac4bef3cfc65074044bdc.png" width="1280" height="702" class="img_ev3q"></p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_S0QG"><p>参考文档：<a href="https://doris.apache.org/zh-CN/docs/query-acceleration/pipeline-execution-engine" target="_blank" rel="noopener noreferrer">Pipeline X 执行引擎</a></p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="arm-架构深度适配性能提升-230">ARM 架构深度适配，性能提升 230%<a href="#arm-架构深度适配性能提升-230" class="hash-link" aria-label="ARM 架构深度适配，性能提升 230%的直接链接" title="ARM 架构深度适配，性能提升 230%的直接链接">​</a></h2><p>在 Apache Doris 2.1 版本中我们针对 ARM 架构进行了深度的适配和指令集优化，可以在 ARM 架构上充分发挥 Apache Doris 的性能优势。相较于 2.0 版本，2.1 版本在 ClickBench、SSB 100G、TPC-H 100G 以及 TPC-DS 1TB 等多个测试数据集中取得了超过 100% 的性能提升。在此我们以大宽表场景的 ClickBench 以及多表关联场景的 TPC-H 为例，集群配置均为 1FE 3BE、BE 节点的服务器配置为 16C 64G 的 ARM 服务器，测试结论如下：</p><ul><li><p>在大宽表场景中，ClickBench 测试数据集 43 个 SQL 的总查询耗时从 102.36 秒降低至 30.73 秒，性能提升超过 230%；</p></li><li><p>在多表关联场景中，TPC-H 22 个 SQL 的总查询耗时从 174.8 秒降低至 90.4 秒，性能提升 93%；</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="数据湖分析">数据湖分析<a href="#数据湖分析" class="hash-link" aria-label="数据湖分析的直接链接" title="数据湖分析的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="性能提升">性能提升<a href="#性能提升" class="hash-link" aria-label="性能提升的直接链接" title="性能提升的直接链接">​</a></h3><p>在 2.1 版本中，我们对数据湖分析方面做了大量改进，包括对 HDFS 和对象存储的 IO 优化、Parquet/ORC 文件格式的读取反序列优化、浮点类型解压优化、谓词下推执行优化、缓存策略以及扫描任务调度策略的优化，以及针对不同数据源的统计信息准确性的提升及更精准的优化器代价模型。基于以上优化，Apache Doris 在数据湖分析场景下的性能得到大幅度提升。</p><p><img loading="lazy" alt="Doris 数据湖分析 - 性能提升" src="https://cdnd.selectdb.com/zh-CN/assets/images/2.1-doris-TPC-DS-326352a5581f27b587ff6e7d451c0ee4.png" width="950" height="550" class="img_ev3q"></p><p>在此我们以 TPC-DS 1TB 场景下进行测试，Apache Doris 2.1 版本和 Trino 435 版本的性能测试结果如下：</p><ul><li><p>在无缓存情况下，Apache Doris 的总体运行耗时间为 717s、Trino 为 1296s，查询耗时降低了 45%，全部 99 条 SQL 中有 80% 比 Trino 更快；</p></li><li><p>在开启文件缓存功能并命中的情况下，Apache Doris 的总体性能可以进一步提升 2.2 倍以上，<strong>较 Trino 有 4 倍以上的性能提升，全部 99 条 SQL 性能均优于 Trino</strong>。</p></li></ul><p>与此同时也在 TPC-DS 10TB 场景下对 Apache Doris 2.1 版本与 Spark 3.5.0 以及 3.3.1 版本进行了性能测试，查询性能分别提升 4.2 倍和 6.1 倍。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="多-sql-方言兼容">多 SQL 方言兼容<a href="#多-sql-方言兼容" class="hash-link" aria-label="多 SQL 方言兼容的直接链接" title="多 SQL 方言兼容的直接链接">​</a></h3><p>当用户从原有 OLAP 系统（如 Clickhouse、Trino、Presto、Hive 等）迁移至 Apache Doris 时，一方面因为 SQL 方言存在差异，需要同步修改大量的业务查询逻辑进行适配，无法进行平滑迁移。另一方面，当使用 Apache Doris 作为统一数据分析网关时，需要对接原先的 Hive、Spark 等系统、以满足不同数据源的查询需求。</p><p>因此在 Apache Doris 2.1 版本中我们引入了多 SQL 方言转换功能，用户可以直接使用原先系统的 SQL 方言在 Doris 中进行数据查询而无需修改业务逻辑。在部署好 SQL 转换服务后，用户只需通过会话变量 <code>sql_dialect</code>设置当前会话的 SQL 方言类型，即可使用对应的 SQL 方言进行查询。</p><p>该功能目前为实验性质功能，当前已经支持 ClickHouse、Presto、Trino、Hive、Spark。在此我们以 Trino 为例，部署完 SQL 转换服务后，在会话变量中设置 <code>set sql_dialect = trino</code> ，即可直接采取 Trino SQL 语法执行查询。在某些社区用户的实际线上业务 SQL 兼容性测试中，在全部 3w 多条查询语句中与 Trino SQL 兼容度高达 99% 以上。也欢迎所有用户在使用过程中向我们反馈不兼容的 Case，帮助 Apache Doris 更加完善。</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_S0QG"><ul><li><p>演示 Demo: <a href="https://www.bilibili.com/video/BV1cS421A7kA/?spm_id_from=333.999.0.0" target="_blank" rel="noopener noreferrer">https://www.bilibili.com/video/BV1cS421A7kA/?spm_id_from=333.999.0.0</a></p></li><li><p>参考文档：<a href="https://doris.apache.org/zh-CN/docs/lakehouse/sql-dialect.md" target="_blank" rel="noopener noreferrer">SQL 方言兼容</a></p></li></ul></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="高速数据读取数据传输效率提升-100-倍">高速数据读取，数据传输效率提升 100 倍<a href="#高速数据读取数据传输效率提升-100-倍" class="hash-link" aria-label="高速数据读取，数据传输效率提升 100 倍的直接链接" title="高速数据读取，数据传输效率提升 100 倍的直接链接">​</a></h3><p>如今许多大数据系统都采取列式内存数据格式，以 MySQL/JDBC/ODBC 作为与数据库系统交互的主流协议与标准。在数据输出至外部系统的过程中，需要将数据从系统特定的列存格式序列化为 MySQL/JDBC/ODBC 协议的行存格式，再反序列化回客户端的列存格式，这会使数据传输速度大幅降低，在面向数据科学或其他形式的大规模数据读写时，数据传输的效率缺陷愈发明显。</p><p>作为用于大规模数据处理的列式内存格式，Apache Arrow 提供了高效的数据结构、允许不同系统间更快共享数据。如果源数据库和目标客户端都支持 Apache Arrow 作为列式内存格式，使用 Arrow Flight SQL 协议传输将无需序列化和反序列化数据，消除数据传输中的开销。同时 Arrow Flight 还可以利用多节点和多核架构，通过完全并行化优化吞吐能力。</p><p><img loading="lazy" alt="高速数据读取，数据传输效率提升 100 倍" src="https://cdnd.selectdb.com/zh-CN/assets/images/2.1-doris-arrow-flight-3585c9cac786689f50ad42c8b76d3b8e.png" width="1280" height="436" class="img_ev3q"></p><p>在过去如果需要采取 Python 读取 Apache Doris 中的数据，需要将 Apache Doris 中列存的 Block 序列化为 MySQL 协议的行存 Bytes，然后在 Python 客户端再反序列化到 Pandas 中，传输过程带来的性能损耗非常大。</p><p>在 Apache Doris 2.1 版本中，我们提供了基于 Arrow Flight 的 HTTP Data API 高吞吐数据读写接口。相比于过去的 MySQL 协议，使用 Arrow Flight SQL 后，我们在 Apache Doris 中先将列存的 Block 转为同样列存的 Arrow RecordBatch，这一步转换效率非常高、且传输过程中无需再次序列化和反序列化，而后在 Python 客户端再将 Arrow RecordBatch 转到同样列存的 Pandas DataFrame 中，这一步转换同样非常快。通过 Arrow Flight 提供的 Python 客户端 Pandas/Numpy 等数据科学工具，可以快速从 Apache Doris 中读取数据并在本地进行分析。</p><p>基于此，Apache Doris 可以与整个 AI 和数据科学生态进行良好的整合，这也是未来的重要发展方向。</p><div class="language-C++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-C++ codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">conn = flight_sql.connect(uri=&quot;grpc://{FE_HOST}:{fe.conf:arrow_flight_sql_port}&quot;, db_kwargs={</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            adbc_driver_manager.DatabaseOptions.USERNAME.value: &quot;user&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            adbc_driver_manager.DatabaseOptions.PASSWORD.value: &quot;pass&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        })</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cursor = conn.cursor()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cursor.execute(&quot;select * from arrow_flight_sql_test order by k0;&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">print(cursor.fetchallarrow().to_pandas())</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>针对常见的数据类型，我们通过不同的 MySQL 客户端进行了对比测试，基于 Arrow Flight SQL 数据传输性能相较于 MySQL 协议提升了近百倍。</p><p><img loading="lazy" alt="Arrow Flight SQL" src="https://cdnd.selectdb.com/zh-CN/assets/images/2.1-doris-arrow-flight-sql-f8707eb6a387ed03a83fd20c373e810a.png" width="1280" height="502" class="img_ev3q"></p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_S0QG"><p>演示 Demo：<a href="https://www.bilibili.com/video/BV1mj421Z7b7/?spm_id_from=333.999.0.0" target="_blank" rel="noopener noreferrer">https://www.bilibili.com/video/BV1mj421Z7b7/?spm_id_from=333.999.0.0</a></p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="其他">其他<a href="#其他" class="hash-link" aria-label="其他的直接链接" title="其他的直接链接">​</a></h3><ul><li><p>Paimon Catalog：Paimon 版本升级至 0.6.0，优化了 Read Optimized 表的读取，在 Paimon 数据充分合并的场景下，可以有 10 倍的性能提升；</p></li><li><p>Iceberg Catalog：Iceberg 版本升级至 1.4.3，同时解决了 AWS S3 认证的若干兼容性问题；</p></li><li><p>Hudi Catalog：Hudi 版本升级至 0.14.1，同时解决了 Hudi Flink Catalog 的若干兼容性问题。</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="多表物化视图">多表物化视图<a href="#多表物化视图" class="hash-link" aria-label="多表物化视图的直接链接" title="多表物化视图的直接链接">​</a></h2><p>作为一种典型的“空间换时间”策略，物化视图通过预先计算和存储 SQL 查询结果，当执行相同查询时可以直接从物化视图表中获取结果，在大幅提升查询性能的同时、更是减少重复计算带来的系统资源消耗。</p><p>在过去版本中 Apache Doris 提供了强一致的单表物化视图、保证基表和物化视图表的原子性，并支持了查询语句在物化视图上的智能路由。</p><p><strong>在 Apache Doris 2.1 版本中，我们引入了全新的异步物化视图，可以基于多表来构建。</strong> 异步物化视图可以全量或者分区增量构建，也可以手动或者周期性地构建刷新数据。在多表关联查询且表数据量较大的场景下，优化器会根据代价模型进行透明改写、并自动寻找最优物化视图来响应查询，<strong>以大幅提升查询性能</strong>。与此同时，也提供了从外表到内表的物化视图以及直查物化视图的能力，基于此特性，<strong>异步物化视图也可用于数据仓库分层建模、作业调度和数据加工</strong>。异步物化视图使用方式如下：</p><p><strong>表定义：</strong></p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">use tpch;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE TABLE IF NOT EXISTS orders  (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    o_orderkey       integer not null,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    o_custkey        integer not null,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    o_orderstatus    char(1) not null,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    o_totalprice     decimalv3(15,2) not null,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    o_orderdate      date not null,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    o_orderpriority  char(15) not null,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    o_clerk          char(15) not null,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    o_shippriority   integer not null,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    o_comment        varchar(79) not null</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    DUPLICATE KEY(o_orderkey, o_custkey)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    PARTITION BY RANGE(o_orderdate)(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    FROM (&#x27;2023-10-17&#x27;) TO (&#x27;2023-10-20&#x27;) INTERVAL 1 DAY)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    DISTRIBUTED BY HASH(o_orderkey) BUCKETS 3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    PROPERTIES (&quot;replication_num&quot; = &quot;1&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">insert into orders values</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   (1, 1, &#x27;ok&#x27;, 99.5, &#x27;2023-10-17&#x27;, &#x27;a&#x27;, &#x27;b&#x27;, 1, &#x27;yy&#x27;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   (2, 2, &#x27;ok&#x27;, 109.2, &#x27;2023-10-18&#x27;, &#x27;c&#x27;,&#x27;d&#x27;,2, &#x27;mm&#x27;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   (3, 3, &#x27;ok&#x27;, 99.5, &#x27;2023-10-19&#x27;, &#x27;a&#x27;, &#x27;b&#x27;, 1, &#x27;yy&#x27;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE TABLE IF NOT EXISTS lineitem (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_orderkey    integer not null,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_partkey     integer not null,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_suppkey     integer not null,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_linenumber  integer not null,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_quantity    decimalv3(15,2) not null,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_extendedprice  decimalv3(15,2) not null,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_discount    decimalv3(15,2) not null,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_tax         decimalv3(15,2) not null,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_returnflag  char(1) not null,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_linestatus  char(1) not null,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_shipdate    date not null,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_commitdate  date not null,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_receiptdate date not null,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_shipinstruct char(25) not null,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_shipmode     char(10) not null,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_comment      varchar(44) not null</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    DUPLICATE KEY(l_orderkey, l_partkey, l_suppkey, l_linenumber)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    PARTITION BY RANGE(l_shipdate)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    (FROM (&#x27;2023-10-17&#x27;) TO (&#x27;2023-10-20&#x27;) INTERVAL 1 DAY)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    DISTRIBUTED BY HASH(l_orderkey) BUCKETS 3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    PROPERTIES (&quot;replication_num&quot; = &quot;1&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">insert into lineitem values</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> (1, 2, 3, 4, 5.5, 6.5, 7.5, 8.5, &#x27;o&#x27;, &#x27;k&#x27;, &#x27;2023-10-17&#x27;, &#x27;2023-10-17&#x27;, &#x27;2023-10-17&#x27;, &#x27;a&#x27;, &#x27;b&#x27;, &#x27;yyyyyyyyy&#x27;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> (2, 2, 3, 4, 5.5, 6.5, 7.5, 8.5, &#x27;o&#x27;, &#x27;k&#x27;, &#x27;2023-10-18&#x27;, &#x27;2023-10-18&#x27;, &#x27;2023-10-18&#x27;, &#x27;a&#x27;, &#x27;b&#x27;, &#x27;yyyyyyyyy&#x27;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> (3, 2, 3, 6, 7.5, 8.5, 9.5, 10.5, &#x27;k&#x27;, &#x27;o&#x27;, &#x27;2023-10-19&#x27;, &#x27;2023-10-19&#x27;, &#x27;2023-10-19&#x27;, &#x27;c&#x27;, &#x27;d&#x27;, &#x27;xxxxxxxxx&#x27;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> CREATE TABLE IF NOT EXISTS partsupp (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ps_partkey     INTEGER NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ps_suppkey     INTEGER NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ps_availqty    INTEGER NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ps_supplycost  DECIMALV3(15,2)  NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ps_comment     VARCHAR(199) NOT NULL </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DUPLICATE KEY(ps_partkey, ps_suppkey)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DISTRIBUTED BY HASH(ps_partkey) BUCKETS 3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;replication_num&quot; = &quot;1&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>创建物化视图：</strong></p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE MATERIALIZED VIEW mv1 </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        BUILD DEFERRED REFRESH AUTO ON MANUAL</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        partition by(l_shipdate)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        DISTRIBUTED BY RANDOM BUCKETS 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        PROPERTIES (&#x27;replication_num&#x27; = &#x27;1&#x27;) </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        AS </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        select l_shipdate, o_orderdate, l_partkey, </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            l_suppkey, sum(o_totalprice) as sum_total</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            from lineitem</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            left join orders on lineitem.l_orderkey = orders.o_orderkey </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                             and l_shipdate = o_orderdate</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            group by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            l_shipdate,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            o_orderdate,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            l_partkey,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            l_suppkey;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>目前异步物化视图已经具备以下功能：</strong></p><ul><li><p><strong>透明改写加速：</strong>支持常见算子的透明改写，如 Select、Where、Join、Group by、Aggregation 等，可以直接通过建立物化视图，对现有的查询进行加速。例如在 BI 报表场景，某些报表查询延时比较高，就可以通过建立合适的物化视图进行加速。</p></li><li><p><strong>自动刷新：</strong>物化视图支持不同刷新策略，如定时刷新和手动刷新，也支持不同的刷新粒度，如全量刷新、分区粒度的增量刷新等。</p></li><li><p><strong>外表到内表的物化视图：</strong>可以对存放在 Hive、Hudi、Iceberg 等数据湖系统上的数据建立物化视图，加速对数据湖的访问，也可以通过物化视图的方式将数据湖中的数据同步到 Apache Doris 内表中。</p></li><li><p><strong>物化视图直查：</strong>用户也可以将物化视图的构建看做 ETL 的过程，把物化视图看做是 ETL 加工后的结果数据，由于物化视图本身也是一个表，所以用户可以直接查询物化视图。</p></li></ul><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_S0QG"><ul><li>演示 Demo: <a href="https://www.bilibili.com/video/BV1s2421T71z/?spm_id_from=333.999.0.0" target="_blank" rel="noopener noreferrer">https://www.bilibili.com/video/BV1s2421T71z/?spm_id_from=333.999.0.0</a></li><li>参考文档：<a href="https://doris.apache.org/zh-CN/docs/query-acceleration/materialized-view/async-materialized-view/overview" target="_blank" rel="noopener noreferrer">异步物化视图</a></li></ul></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="存储能力增强">存储能力增强<a href="#存储能力增强" class="hash-link" aria-label="存储能力增强的直接链接" title="存储能力增强的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="自增列-auto_increment">自增列 AUTO_INCREMENT<a href="#自增列-auto_increment" class="hash-link" aria-label="自增列 AUTO_INCREMENT的直接链接" title="自增列 AUTO_INCREMENT的直接链接">​</a></h3><p>自增列 AUTO_INCREMENT 是 OLTP 数据库中常见的一项功能，提供了一种方便高效的方式来为新插入的数据行自动分配唯一标识符。由于自增列的可用值分配涉及到全局事务，因此在分布式 OLAP 数据库中并不常见。在 Apache Doris 2.1 版本中，我们通过创新性的自增序列预分配策略，提供了高效的自增列实现。基于自增列的唯一性保证，用户可以利用自增列实现高效的字典编码和查询分页。</p><p><strong>字典编码：</strong> 在进行 PV/UV 统计或人群圈选等需要精确去重的查询时，可以使用自增列对 UserID 或订单 ID 等字符串值创建字典表，将用户数据批量或者实时写入字典表即可生成字典，根据各种维度的条件对对应的 Bitmap 进行聚合运算；</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE TABLE `demo`.`dictionary_tbl` (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `user_id` varchar(50) NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `aid` BIGINT NOT NULL AUTO_INCREMENT</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">) ENGINE=OLAP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">UNIQUE KEY(`user_id`)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DISTRIBUTED BY HASH(`user_id`) BUCKETS 32</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;replication_allocation&quot; = &quot;tag.location.default: 3&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;enable_unique_key_merge_on_write&quot; = &quot;true&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>查询分页</strong>：在页面展示数据时，往往需要做分页展示。传统的分页通常使用 SQL 中的 <code>limit</code>, <code>offset</code> + <code>order by</code> 进行查询。在进行深分页查询时，即使查询数据量较少、数据库仍需将全部数据读取至内存进行全量排序，查询效率比较低下。采取自增列可以为每一行生成唯一标识、查询时记住上一页最大唯一标识并用于下一页的查询条件，实现更高效的分页查询。</p><p>以下表为例，unique_value 是一个唯一值：</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE TABLE `demo`.`records_tbl2` (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `key` int(11) NOT NULL COMMENT &quot;&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `name` varchar(26) NOT NULL COMMENT &quot;&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `address` varchar(41) NOT NULL COMMENT &quot;&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `city` varchar(11) NOT NULL COMMENT &quot;&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `nation` varchar(16) NOT NULL COMMENT &quot;&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `region` varchar(13) NOT NULL COMMENT &quot;&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `phone` varchar(16) NOT NULL COMMENT &quot;&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `mktsegment` varchar(11) NOT NULL COMMENT &quot;&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `unique_value` BIGINT NOT NULL AUTO_INCREMENT</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">) DUPLICATE KEY (`key`, `name`)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DISTRIBUTED BY HASH(`key`) BUCKETS 10</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;replication_num&quot; = &quot;3&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在分页展示中，每页展示 100 条数据，使用如下方式获取第一页的数据：</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">select * from records_tbl2 order by unique_value limit 100;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过程序记录下返回结果中<code>unique_value</code>中的最大值，假设为 99，则可用如下方式查询第二页的数据：</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">select * from records_tbl2 where unique_value &gt; 99 order by unique_value limit 100;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果要直接查询一个靠后页面的内容，此时不方便直接获取之前页面数据中<code>unique_value</code>的最大值时，例如要直接获取第 101 页的内容，则可以使用如下方式进行查询</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">select key, name, address, city, nation, region, phone, mktsegment</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from records_tbl2, (select unique_value as max_value from records_tbl2 order by uniuqe_value limit 1 offset 9999) as previous_data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">where records_tbl2.uniuqe_value &gt; previous_data.max_value</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">order by unique_value limit 100;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_S0QG"><p>演示 Demo：<a href="https://www.bilibili.com/video/BV1VC411h7Gr/?spm_id_from=333.999.0.0" target="_blank" rel="noopener noreferrer">https://www.bilibili.com/video/BV1VC411h7Gr/?spm_id_from=333.999.0.0</a></p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="自动分区-auto-partition">自动分区 Auto Partition<a href="#自动分区-auto-partition" class="hash-link" aria-label="自动分区 Auto Partition的直接链接" title="自动分区 Auto Partition的直接链接">​</a></h3><p>在 Apache Doris 2.1 版本之前一直采取手动分区的形式，用户需要提前把分区建立好，否则在导入数据过程中会因为找不到对应分区而出错。而自动分区功能支持了在导入数据过程中自动检测分区列的数据对应的分区是否存在。如果不存在，则会自动创建分区并正常进行导入。</p><p>自动分区功能使用方式如下：</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE TABLE `DAILY_TRADE_VALUE`</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `TRADE_DATE`              datev2 NULL COMMENT &#x27;交易日期&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `TRADE_ID`                varchar(40) NULL COMMENT &#x27;交易编号&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ......</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">UNIQUE KEY(`TRADE_DATE`, `TRADE_ID`)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">AUTO PARTITION BY RANGE date_trunc(`TRADE_DATE`, &#x27;year&#x27;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DISTRIBUTED BY HASH(`TRADE_DATE`) BUCKETS 10</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;replication_num&quot; = &quot;1&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>警告</div><div class="admonitionContent_S0QG"><p>注意事项</p><ol><li><p>当前自动分区功能仅支持一个分区列，并且分区列必须为 NOT NULL 列；</p></li><li><p>自动分区当前已支持 Range 分区和 List 分区，其中 Range 分区函数仅支持 <code>date_trunc</code>、分区列仅支持 <code>DATE</code> 或者 <code>DATETIME</code> 格式；List 分区不支持函数调用，分区列支持 <code>BOOLEAN、TINYINT、SMALLINT、INT、BIGINT、LARGEINT、DATE、DATETIME、CHAR、VARCHAR</code> 数据类型，分区值为枚举值；</p></li><li><p>使用 List 分区时，一旦分区列的值当前不存在，自动分区功能都会为其创建一个独立的新分区。</p></li></ol></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_S0QG"><p>参考文档：<a href="https://doris.apache.org/zh-CN/docs/table-design/data-partitioning/basic-concepts" target="_blank" rel="noopener noreferrer">数据划分</a></p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="insert-into-select-导入性能提升-100">INSERT INTO SELECT 导入性能提升 100%<a href="#insert-into-select-导入性能提升-100" class="hash-link" aria-label="INSERT INTO SELECT 导入性能提升 100%的直接链接" title="INSERT INTO SELECT 导入性能提升 100%的直接链接">​</a></h3><p><code>INSERT INTO…SELECT</code> 语句是 ETL 中最高频使用的操作之一，可以快速完成数据在库表之间的迁移、转换以及清洗合并，提升 <code>INSERT INTO…SELECT</code> 性能可以更好满足用户对数据快速提取和分析的需求。在 Apache Doris 2.0 版本中，我们引入了单副本导入功能（Single Replica Load）来减少多副本的重复写入和 Compaction 工作，但是导入性能还存在优化的空间。</p><p>在 Apache Doris 2.1 版本中，为了进一步提升<code>INSERT INTO…SELECT</code> 性能，我们实现了 MemTable 前移以进一步减少导入过程中的开销，能在大多数场景中能在 2.0 版本的基础上取得 100% 的导入性能提升。</p><p><img loading="lazy" alt="INSERT INTO SELECT 导入性能提升 100%" src="https://cdnd.selectdb.com/zh-CN/assets/images/2.1-doris-INSERT-INTO-SELECT-a423f62c84e5ee2112933fcb2c8e6f21.png" width="961" height="571" class="img_ev3q"></p><p>MemTable 前移和非前移的流程对比如上图所示，Sink 节点不再发送编码后的 Block，而是在本地处理完 MemTable 将生成的 Segment 数据发给下游节点，减少了数据多次编码的开销，同时使内存反压更准确和及时。此外，我们使用了 Streaming RPC 来替代了 Ping-pong RPC，减少了数据传输过程中的等待。</p><p>在此我们对 2.1 版本开启 MemTable 前移后的导入性能进行了测试，测试环境如下：1 FE+3 BE、每个节点 16C 64G、3 块高性能云盘（保证磁盘 I/O 不成为瓶颈）</p><p>可以看到在单副本场景下，2.1 版本开启 MemTable 前移后、导入耗时降低至 2.0 版本的 36%，三副本场景下导入耗时降低至 2.0 版本的 54%，整体导入性能提升超过 100%。</p><table><thead><tr><th align="left">INSERT INTO 表</th><th align="left">Doris 2.0 非前移默认</th><th align="left">Doris 2.1MemTable 前移</th></tr></thead><tbody><tr><td align="left">linitem 1 副本 (38G)</td><td align="left">30.2 s</td><td align="left">11.1 s</td></tr><tr><td align="left">linitem 3 副本 (38G)</td><td align="left">47.4 s</td><td align="left">25.4 s</td></tr></tbody></table><p><img loading="lazy" alt="INSERT INTO SELECT 导入性能提升 100%" src="https://cdnd.selectdb.com/zh-CN/assets/images/2.1-insert-into-table-a67da860f18aaceefabc007c5bf60705.png" width="1280" height="375" class="img_ev3q"></p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_S0QG"><p>MemTable 前移在 2.1 版本中默认开启，用户无需修改原有的导入命令即可获得大幅性能提升。如果在使用过程中遇到问题、希望回退到原有的导入方式，可以在 MySQL 连接中设置环境变量 <code>enable_memtable_on_sink_node=false</code> 来关闭 MemTable 前移。</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="高频实时导入服务端攒批-group-commit">高频实时导入/服务端攒批 Group Commit<a href="#高频实时导入服务端攒批-group-commit" class="hash-link" aria-label="高频实时导入/服务端攒批 Group Commit的直接链接" title="高频实时导入/服务端攒批 Group Commit的直接链接">​</a></h3><p>在数据导入过程中，不同批次导入的数据都会写入内存表中，随后在磁盘中上形成一个个 RowSet 文件，每个 Rowset 文件对应一次数据导入版本。后台 Compaction 进程会自动对多个版本的 RowSet 文件进行合并，将多个 RowSet 小文件合并成 RowSet 大文件以优化查询性能以及存储空间，而每一次的 Compaction 进程都会产生对 CPU、内存以及磁盘 IO 资源的消耗。在实际数据写入场景中，写入越实时高频、生成 RowSet 版本数越高、Compaction 所消耗的资源就越大。为了避免高频写入带来的过多资源消耗甚至 OOM，Apache Doris 引入了反压机制，即在版本过多的情况下会返回 -235，并对数据的版本数量进行控制。</p><p><img loading="lazy" alt="高频实时导入/服务端攒批 Group Commit" src="https://cdnd.selectdb.com/zh-CN/assets/images/2.1-doris-group-commit-d6b8b226770cf1fdb5836854ed595e49.png" width="1280" height="912" class="img_ev3q"></p><p>从 Apache Doris 2.1 版本开始，我们引入了服务端攒批 Group Commit，大幅强化了高并发、高频实时写入的能力。</p><p>顾名思义，Group Commit 会把用户侧的多次写入在 BE 端进行积攒后批量提交。对于用户而言，无需控制写入程序的频率，Doris 会自动把用户提交的多次写入在内部合并为一个版本，从而可以大幅提升用户侧的写入频次。</p><p><img loading="lazy" alt="高频实时导入/服务端攒批 Group Commit" src="https://cdnd.selectdb.com/zh-CN/assets/images/2.1-doris-group-commit-2-4bc76d5f1b65ab702ea7156c1eab24a4.png" width="1280" height="757" class="img_ev3q"></p><p>当前 Group Commit 已经支持同步模式 <code>sync_mode</code> 和异步模式 <code>async_mode</code>。同步模式下会将多个导入在一个事务提交，事务提交后导入返回，在导入完成后数据立即可见。异步模式下数据会先写入 WAL，Apache Doris 会根据负载和表的<code>group_commit_interval</code>属性异步提交数据，提交之后数据可见。为了防止 WAL 占用较大的磁盘空间，单次导入数据量较大时，会自动切换为<code>sync_mode</code>。</p><p>我们分别采取 JDBC 和 Stream Load 两种方式对高并发写入场景下 Group Commit（异步模式 <code>async_mode</code>）的写入性能进行了测试，测试报告如下：</p><ul><li><p><strong>JDBC 写入</strong>：</p><ul><li><p>集群配置为 1FE 1BE，数据集为 TPC-H SF10 Lineitem 表，总共约 22GB、1.8 亿行；</p></li><li><p>经测试，在并发数 20、单次 Insert 数据行数 100 行下，导入效率达到 10.69w 行/秒、导入吞吐达 11.46 MB/秒，BE 节点的 CPU 使用率稳定保持在 10%-20%；</p></li></ul></li><li><p><strong>Stream Load 写入</strong>：</p><ul><li><p>集群配置为 1FE 3BE，数据集为 httplogs、总共 31GB、2.47 亿行。在未开启 Group Commit 和 开启 Group Commit 的异步模式时，通过设置不同的单并发数据量和并发数，对比数据的写入性能。</p></li><li><p>经测试，在并发数 10、单次导入数据量 1 MB 下，未开启 Group Commit 时会提示 -235 错误，开启后可稳定运行且导入效率达 81w 行/秒、导入吞吐达 104 MB/秒；在并发数 10、单次导入数据量 10MB 下，开启 Group Commit 后耗时降低至原先的 55%、导入吞吐提升 79%；</p></li></ul></li></ul><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_S0QG"><ul><li><p>演示 Demo：<a href="https://www.bilibili.com/video/BV1um411o7Ha/?spm_id_from=333.999.0.0" target="_blank" rel="noopener noreferrer">https://www.bilibili.com/video/BV1um411o7Ha/?spm_id_from=333.999.0.0</a></p></li><li><p>参考文档和完整测试报告：<a href="https://doris.apache.org/zh-CN/docs/data-operate/import/import-way/group-commit-manual" target="_blank" rel="noopener noreferrer">Group Commit</a></p></li></ul></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="半结构化数据分析">半结构化数据分析<a href="#半结构化数据分析" class="hash-link" aria-label="半结构化数据分析的直接链接" title="半结构化数据分析的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="variant-数据类型">Variant 数据类型<a href="#variant-数据类型" class="hash-link" aria-label="Variant 数据类型的直接链接" title="Variant 数据类型的直接链接">​</a></h3><p>过去 Apache Doris 在应对复杂半结构化数据的存储和分析处理时，一般有两种方式：</p><ol><li><p>一种方式是用户提前预定好表结构，加工成宽表，在数据进入前将数据解析好，这种方案的优点是写入性能好，查询也不需要解析，但是使用不够灵活、对表结构发起变更增加运维、研发的成本。</p></li><li><p>使用 Doris 中的 JSON 类型、或是存成 JSON String，将原始 JSON 数据不经过加工直接入库，查询的时候，用解析函数处理。优点是不需要额外的数据加工、预定义表结构拍平嵌套结构，运维、研发方便，但存在解析性能以及数据读取效率低下的问题。</p></li></ol><p>为了解决上述半结构化数据的挑战，在 Apache Doris 2.1 版本中我们引入全新的数据类型<code>VARIANT</code>，支持存储半结构化数据、允许存储包含不同数据类型（如整数、字符串、布尔值等）的复杂数据结构，无需在表结构中提前定义具体的列，其存储和查询与传统的 String、JSONB 等行存类型发生了本质的改变，期望其作为半结构化数据首选数据类型，给用户带来更加高效的数据处理机制。</p><p>Variant 类型特别适用于处理结构可能随时会发生变化的复杂嵌套结构。在写入过程中，Variant 类型可以自动根据列的结构和类型推断列信息，并将其合并到现有表的 Schema 中，将 JSON 键及其对应的值灵活存储为动态子列。同时，一个表可以同时包含灵活的 Variant 对象列和预先定义类型的更严格的静态列，从而在数据存储、查询上提供了更大的灵活性。除此之外，Variant 类型能够与 Doris 核心特性融合，利用列式存储、向量化引擎、优化器等技术，为用户带来极高性价比的查询性能及存储性能。</p><p><strong>使用方式如下：</strong></p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">-- 无索引</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE TABLE IF NOT EXISTS ${table_name} (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    k BIGINT,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    v VARIANT</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">table_properties;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-- 在v列创建索引，可选指定分词方式，默认不分词</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE TABLE IF NOT EXISTS ${table_name} (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    k BIGINT,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    v VARIANT,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    INDEX idx_var(v) USING INVERTED [PROPERTIES(&quot;parser&quot; = &quot;english|unicode|chinese&quot;)] [COMMENT &#x27;your comment&#x27;]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">table_properties;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-- 查询，使用`[]`形式访问子列</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SELECT v[&quot;properties&quot;][&quot;title&quot;] from ${table_name}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>相比 JSON 类型的优势</strong></p><p>在 Apache Doris 中 JSON 类型是以二进制 JSONB 格式进行存储，整行 JSON 以行存的形式存储到 Segment 文件中。而 VARIANT 类型在写入的时候进行类型推断，将写入的 JSON 列存化，查询不需要进行解析。此外 Variant 类型针对稀疏场景的 JSON 进行优化，只提取频繁出现的列，稀疏的列会以单独的格式进行存储。</p><p>为了验证引入 Variant 数据类型后在存储以及查询上所带来的优势，我们基于 ClickBench 测试数据集进行了存储空间和查询性能的测试。</p><p>在存储空间方面，相同数据采取 Variant 类型，所占用的存储空间跟预定义的静态列的存储空间持平，相比于 JSON 类型则减少了约 65%。在一些低基数场景，由于列存的优势，存储资源的成本效应会更加明显。</p><p><img loading="lazy" alt="相比 JSON 类型的优势" src="https://cdnd.selectdb.com/zh-CN/assets/images/2.1-comparied-to-Json-5fe5e1dea3cfefdc4d7a456edb28dd9e.png" width="1120" height="416" class="img_ev3q"></p><p>在查询性能方面，如下表可知，Variant 类型与预定义静态列的查询性能差异在 10% 左右；<strong>而对于 JSON 类型来说，Variant 类型的热查询速度相比于 JSON 类型提升了 8 倍以上，冷查询有着数量级的提升。</strong>（由于 I/O 原因，JSONB 类型的冷查询大部分超时）。</p><p><img loading="lazy" alt="相比 JSON 类型的优势" src="https://cdnd.selectdb.com/zh-CN/assets/images/2.1-comparied-to-Json-2-c7606d1a83dc41edf2ccb6e5b050d90b.png" width="1280" height="459" class="img_ev3q"></p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>警告</div><div class="admonitionContent_S0QG"><p>注意事项：</p><ul><li><p>目前 Variant 暂不支持 Aggregate 模型，也不支持将 Variant 类型作为 Unique 或 Duplicate 模型的主键及排序键；</p></li><li><p>推荐使用 RANDOM 模式或者开启 Group Commit 导入，写入性能更高效；</p></li><li><p>日期、Decimal 等非标准 JSON 类型尽可能提取出来作为静态字段，性能更好；</p></li><li><p>二维及其以上的数组以及数组嵌套对象，列存化会被存成 JSONB 编码，性能不如原生数组；</p></li><li><p>查询过滤、聚合需要带 Cast，存储层会根据存储类型和 Cast 目标类型来提示（hint）存储引擎谓词下推，加速查询。</p></li></ul></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_S0QG"><ul><li><p>演示 Demo: <a href="https://www.bilibili.com/video/BV13u4m1g7ra/?spm_id_from=333.999.0.0" target="_blank" rel="noopener noreferrer">https://www.bilibili.com/video/BV13u4m1g7ra/?spm_id_from=333.999.0.0</a></p></li><li><p>参考文档：<a href="https://doris.apache.org/zh-CN/docs/sql-manual/sql-data-types/semi-structured/VARIANT.md" target="_blank" rel="noopener noreferrer">VARIANT</a></p></li></ul></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ip-数据类型">IP 数据类型<a href="#ip-数据类型" class="hash-link" aria-label="IP 数据类型的直接链接" title="IP 数据类型的直接链接">​</a></h3><p>在网络流量监控的场景中，IP 地址是一个常见的字段，大量的统计分析基于 IP 地址进行。在 Apache Doris 2.1 版本中，将原生支持 IPv4 和 IPv6 数据类型，用高效的二进制形式存储 IP 数据。相比于使用明文的 IP String，内存和存储空间可节省 60% 左右。</p><p>同时基于 IP 类型，我们增加了常用的 20 多个 IP 处理函数，如：</p><ul><li>IPV4_NUM_TO_STRING：将类型为 Int16、Int32、Int64 且大端表示的 IPv4 的地址，返回相应 IPv4 的字符串表现形式；</li><li>IPV4_CIDR_TO_RANGE：接收一个 IPv4 和一个包含 CIDR 的 Int16 值，返回一个结构体，其中包含两个 IPv4 字段分别表示子网的较低范围（min）和较高范围（max）；</li><li>INET_ATON：获取包含 IPv4 地址的字符串，格式为 A.B.C.D（点分隔的十进制数字）</li></ul><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_S0QG"><p>参考文档：<a href="https://doris.apache.org/zh-CN/docs/sql-manual/sql-data-types/ip/IPV6" target="_blank" rel="noopener noreferrer">IPV6</a></p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="复杂数据类型分析函数完善">复杂数据类型分析函数完善<a href="#复杂数据类型分析函数完善" class="hash-link" aria-label="复杂数据类型分析函数完善的直接链接" title="复杂数据类型分析函数完善的直接链接">​</a></h3><p>在 Apache Doris 2.1 版本中我们丰富了行转列和 IN 能支持的数据类型。如：</p><ul><li><code>explode_map</code>：支持 MAP 类型数据行转列（仅在新优化器中实现）</li></ul><p>支持 Map 类型 Explode 行转列，将 Map 字段的 N 个 Key Value 对展开成 N 行，每行的 Map 字段替换成 Key 和 Value 两个字段。<code>explode_map</code> 需要和 Lateral View 一起使用，可以接多个 Lateral View, 结果则是每个 <code>explode_map</code> 之后的行数以笛卡尔积的形式展示。</p><p>具体使用如下：</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">-- 建表语句</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> CREATE TABLE `sdu` (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `id` INT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `name` TEXT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `score` MAP&lt;TEXT,INT&gt; NULL</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">) ENGINE=OLAP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DUPLICATE KEY(`id`)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">COMMENT &#x27;OLAP&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DISTRIBUTED BY HASH(`id`) BUCKETS 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;replication_allocation&quot; = &quot;tag.location.default: 1&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-- insert 数据</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">insert into sdu values (0, &quot;zhangsan&quot;, {&quot;Chinese&quot;:&quot;80&quot;,&quot;Math&quot;:&quot;60&quot;,&quot;English&quot;:&quot;90&quot;});</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">insert into sdu values (1, &quot;lisi&quot;, {&quot;null&quot;:null});</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">insert into sdu values (2, &quot;wangwu&quot;, {&quot;Chinese&quot;:&quot;88&quot;,&quot;Math&quot;:&quot;90&quot;,&quot;English&quot;:&quot;96&quot;});</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">insert into sdu values (3, &quot;lisi2&quot;, {null:null});</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">insert into sdu values (4, &quot;amory&quot;, NULL);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; select name, course_0, score_0 from sdu lateral view explode_map(score) tmp as course_0,score_0;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+----------+----------+---------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| name     | course_0 | score_0 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+----------+----------+---------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| zhangsan | Chinese  |      80 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| zhangsan | Math     |      60 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| zhangsan | English  |      90 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| lisi     | null     |    NULL |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| wangwu   | Chinese  |      88 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| wangwu   | Math     |      90 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| wangwu   | English  |      96 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| lisi2    | NULL     |    NULL |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+----------+----------+---------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; select name, course_0, score_0, course_1, score_1 from sdu lateral view explode_map(score) tmp as course_0,score_0 lateral view explode_map(score) tmp1 as course_1,score_1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+----------+----------+---------+----------+---------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| name     | course_0 | score_0 | course_1 | score_1 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+----------+----------+---------+----------+---------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| zhangsan | Chinese  |      80 | Chinese  |      80 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| zhangsan | Chinese  |      80 | Math     |      60 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| zhangsan | Chinese  |      80 | English  |      90 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| zhangsan | Math     |      60 | Chinese  |      80 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| zhangsan | Math     |      60 | Math     |      60 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| zhangsan | Math     |      60 | English  |      90 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| zhangsan | English  |      90 | Chinese  |      80 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| zhangsan | English  |      90 | Math     |      60 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| zhangsan | English  |      90 | English  |      90 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| lisi     | null     |    NULL | null     |    NULL |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| wangwu   | Chinese  |      88 | Chinese  |      88 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| wangwu   | Chinese  |      88 | Math     |      90 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| wangwu   | Chinese  |      88 | English  |      96 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| wangwu   | Math     |      90 | Chinese  |      88 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| wangwu   | Math     |      90 | Math     |      90 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| wangwu   | Math     |      90 | English  |      96 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| wangwu   | English  |      96 | Chinese  |      88 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| wangwu   | English  |      96 | Math     |      90 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| wangwu   | English  |      96 | English  |      96 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| lisi2    | NULL     |    NULL | NULL     |    NULL |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+----------+----------+---------+----------+---------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>explode_map_outer</code> 和 <code>explode_outer</code> 的目的一致，可以将当前 MAP 类型的列中是 NULL 的数据行展示出来。</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; select name, course_0, score_0 from sdu lateral view explode_map_outer(score) tmp as course_0,score_0;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+----------+----------+---------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| name     | course_0 | score_0 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+----------+----------+---------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| zhangsan | Chinese  |      80 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| zhangsan | Math     |      60 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| zhangsan | English  |      90 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| lisi     | null     |    NULL |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| wangwu   | Chinese  |      88 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| wangwu   | Math     |      90 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| wangwu   | English  |      96 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| lisi2    | NULL     |    NULL |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| amory    | NULL     |    NULL |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+----------+----------+---------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>增加 IN 谓词支持 Struct 类型数据的能力（仅在新优化器中实现）</li></ul><p>IN 谓词的左参数支持 <code>struct() function</code> 构建的 Struct 类型的数据，也支持 Select 某表中某一列是 Struct 类型的数据，右边的参数支持一个由 <code>struct() function</code> 构建的 Struct 类型的数据的数组。IN 谓词支持 Struct 类型可以有效替换 Where 条件中如果需要大量的 or 连词连接的表达式，如： <code>(a = 1 and b = &#x27;2&#x27;) or (a = 1 and b = &#x27;3&#x27;) or (...)</code> 可以通过 IN 实现为 <code>struct(a,b) in (struct(1, &#x27;2&#x27;), struct(1, &#x27;3&#x27;), ...)</code></p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; select struct(1,&quot;2&quot;)  in (struct(1,3), struct(1,&quot;2&quot;), struct(1,1), null);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| cast(struct(1, &#x27;2&#x27;) as STRUCT&lt;col1:TINYINT,col2:TEXT&gt;) IN (NULL, cast(struct(1, &#x27;2&#x27;) as STRUCT&lt;col1:TINYINT,col2:TEXT&gt;), cast(struct(1, 1) as STRUCT&lt;col1:TINYINT,col2:TEXT&gt;), cast(struct(1, 3) as STRUCT&lt;col1:TINYINT,col2:TEXT&gt;)) |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|                                                                                                                                                                                                                                    1 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; select struct(1,&quot;2&quot;) not in (struct(1,3), struct(1,&quot;2&quot;), struct(1,1), null);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| ( not cast(struct(1, &#x27;2&#x27;) as STRUCT&lt;col1:TINYINT,col2:TEXT&gt;) IN (NULL, cast(struct(1, &#x27;2&#x27;) as STRUCT&lt;col1:TINYINT,col2:TEXT&gt;), cast(struct(1, 1) as STRUCT&lt;col1:TINYINT,col2:TEXT&gt;), cast(struct(1, 3) as STRUCT&lt;col1:TINYINT,col2:TEXT&gt;))) |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|                                                                                                                                                                                                                                           0 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>MAP_AGG</code>：接收 expr1 作为键，expr2 作为对应的值，返回一个 MAP </li></ul><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_S0QG"><p>参考文档：<a href="https://doris.apache.org/zh-CN/docs/sql-manual/sql-functions/aggregate-functions/map-agg.md" target="_blank" rel="noopener noreferrer">MAP_AGG</a></p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="负载管理">负载管理<a href="#负载管理" class="hash-link" aria-label="负载管理的直接链接" title="负载管理的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="资源硬隔离">资源硬隔离<a href="#资源硬隔离" class="hash-link" aria-label="资源硬隔离的直接链接" title="资源硬隔离的直接链接">​</a></h3><p>在 Apache Doris 2.0 版本我们引入了 Workload Group，可以实现对 CPU 资源的软限制。Workload Group 软限的优点是可以提升资源的利用率，但同时也会带来查询延迟的不确定性，这对那些期望查询性能稳定性的用户来说是难以接受的。因此在 Apache Doris 2.1 版本中我们对 Workload Group 实现了 CPU 硬限，即无论当前物理机的整体 CPU 是否空闲，配置了硬限的 Group 最大 CPU 用量不能超过配置的值。</p><p>这意味着不管单机的资源是否充足，该 Workload Group 的最大可用 CPU 资源都是固定的，只要用户的查询负载不发生大的变化，那么查询性能就会相对稳定。由于影响一个查询性能稳定性的因素很多，除了 CPU 之外，内存、IO 以及软件层面的资源竞争也都会产生影响，因此当集群的负载在空闲和满载之间切换时，即使配置了 CPU 的硬限，查询性能的稳定性也会产生波动，但是预期的表现应该是优于软限制。</p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>警告</div><div class="admonitionContent_S0QG"><p>注意事项</p><ol><li><p>Doris 2.0 版本的 CPU 隔离是基于优先级队列实现的，而在 2.1 版本中 Apache Doris 是基于 CGroup 实现了 CPU 资源的隔离，因此从 2.0 版本升级到 2.1 版本时，需要在使用前完成 CGroup 的配置，详细注意事项参考官网文档。</p></li><li><p>目前 Workload Group 支持的工作负载类型包括查询间的隔离以及导入与查询之间的隔离，需要注意的是如果期望对导入负载进行彻底的限制，那么需要开启 MemTable 前移。</p></li><li><p>用户需要通过开关指定当前集群的 CPU 限制模式是软限还是硬限，暂不支持两种模式同时运行，两种模式的切换可以参考官网文档，后续我们也会根据用户的实际需求决定是否要同时支持这两种模式。</p></li></ol></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_S0QG"><ul><li>演示 Demo：<a href="https://www.bilibili.com/video/BV1Fz421X7XE/?spm_id_from=333.999.0.0" target="_blank" rel="noopener noreferrer">https://www.bilibili.com/video/BV1Fz421X7XE/?spm_id_from=333.999.0.0</a></li><li>参考文档：<a href="https://doris.apache.org/zh-CN/docs/admin-manual/resource-admin/workload-group.md" target="_blank" rel="noopener noreferrer">Workload Group</a></li></ul></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="topsql">TopSQL<a href="#topsql" class="hash-link" aria-label="TopSQL的直接链接" title="TopSQL的直接链接">​</a></h3><p>当集群出现预期外的大查询导致集群整体负载上升、查询可用性下降时，用户难以快速找到这些大查询并进行相应的降级操作。因此在 Apache Doris 2.1 版本中我们支持了运行时查看 SQL 资源用量的功能，具体指标如下：</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql [(none)]&gt;desc function active_queries();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+------------------------+--------+------+-------+---------+-------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| Field                  | Type   | Null | Key   | Default | Extra |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+------------------------+--------+------+-------+---------+-------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| BeHost                 | TEXT   | No   | false | NULL    | NONE  |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| BePort                 | BIGINT | No   | false | NULL    | NONE  |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| QueryId                | TEXT   | No   | false | NULL    | NONE  |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| StartTime              | TEXT   | No   | false | NULL    | NONE  |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| QueryTimeMs            | BIGINT | No   | false | NULL    | NONE  |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| WorkloadGroupId        | BIGINT | No   | false | NULL    | NONE  |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| QueryCpuTimeMs         | BIGINT | No   | false | NULL    | NONE  |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| ScanRows               | BIGINT | No   | false | NULL    | NONE  |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| ScanBytes              | BIGINT | No   | false | NULL    | NONE  |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| BePeakMemoryBytes      | BIGINT | No   | false | NULL    | NONE  |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| CurrentUsedMemoryBytes | BIGINT | No   | false | NULL    | NONE  |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| ShuffleSendBytes       | BIGINT | No   | false | NULL    | NONE  |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| ShuffleSendRows        | BIGINT | No   | false | NULL    | NONE  |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| Database               | TEXT   | No   | false | NULL    | NONE  |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| FrontendInstance       | TEXT   | No   | false | NULL    | NONE  |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| Sql                    | TEXT   | No   | false | NULL    | NONE  |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+------------------------+--------+------+-------+---------+-------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>active_queries()</code> 函数记录了查询在各个 BE 上运行时的审计信息，该函数可以当做普通的 Doris 表来看待，支持查询、谓词过滤、排序和 Join 等操作。常用的指标包括 SQL 的运行时间、CPU 时间、单 BE 的峰值内存、Scan 的数据量以及 Shuffle 的数据量，也可以从 BE 的粒度做上卷，查看 SQL 全局的资源用量。</p><p>需要注意的是这里只显示运行时的 SQL，查询结束的 SQL 不会在这里显示，而是写入审计日志中（目前主要是 fe.audit.log）。常用的 SQL 如下：</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">查看集群中目前运行时间最久的n个sql</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select QueryId,max(QueryTimeMs) as query_time from active_queries() group by QueryId order by query_time desc limit 10;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">查看目前集群中CPU耗时最长的n个sql</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select QueryId, sum(QueryCpuTimeMs) as cpu_time from active_queries() group by QueryId order by cpu_time desc limit 10</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">查看目前集群中scan行数最多的n个sql以及他们的运行时间</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select t1.QueryId,t1.scan_rows, t2.query_time from </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    (select QueryId, sum(ScanRows) as scan_rows from active_queries()  group by QueryId order by scan_rows desc limit 10) t1 </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    left join (select QueryId,max(QueryTimeMs) as query_time from active_queries() group by QueryId) t2 on t1.QueryId = t2.QueryId</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">查看目前各个BE的负载情况，按照CPU时间/scan行数/shuffle字节数降序排列</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select BeHost,sum(QueryCpuTimeMs) as query_cpu_time, sum(ScanRows) as scan_rows,sum(ShuffleSendBytes) as shuffle_bytes from active_queries() group by BeHost order by query_cpu_time desc,scan_rows desc ,shuffle_bytes desc limit 10</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">查看单BE峰值内存最高的N个sql</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select QueryId,max(BePeakMemoryBytes) as be_peak_mem from active_queries() group by QueryId order by be_peak_mem desc limit 10;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>目前主要展示的负载类型包括 Select 和<code>Insert Into……Select</code>，预计在 2.1 版本之上的三位迭代版本中会支持 Stream Load 和 Broker Load 的资源用量展示。</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_S0QG"><p>参考文档：<a href="https://doris.apache.org/zh-CN/docs/sql-manual/sql-functions/table-functions/active_queries.md" target="_blank" rel="noopener noreferrer">ACTIVE_QUERIES</a></p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他-1">其他<a href="#其他-1" class="hash-link" aria-label="其他的直接链接" title="其他的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="decimal256">Decimal256<a href="#decimal256" class="hash-link" aria-label="Decimal256的直接链接" title="Decimal256的直接链接">​</a></h3><p>为了更好的满足金融类或者财务类客户以及一些高端制造业客户对于数字类型进行精确计算的需求，2.1 新版本中提供了更高精度的 Decimal 数据类型，最高支持 76 位有效数字（该类型处于 Experimental 状态，需要手工开启配置项 set enable_decimal256=true 才能使用）。</p><p>示例：</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE TABLE `test_arithmetic_expressions_256` (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      k1 decimal(76, 30),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      k2 decimal(76, 30)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    DISTRIBUTED BY HASH(k1)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    PROPERTIES (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;replication_num&quot; = &quot;1&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    );</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">insert into test_arithmetic_expressions_256 values</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  (1.000000000000000000000000000001, 9999999999999999999999999999999999999999999998.999999999999999999999999999998),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  (2.100000000000000000000000000001, 4999999999999999999999999999999999999999999999.899999999999999999999999999998),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  (3.666666666666666666666666666666, 3333333333333333333333333333333333333333333333.333333333333333333333333333333);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>查询语句及结果：</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">select k1, k2, k1 + k2 a from test_arithmetic_expressions_256 order by 1, 2;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+----------------------------------+-------------------------------------------------------------------------------+-------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| k1                               | k2                                                                            | a                                                                             |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+----------------------------------+-------------------------------------------------------------------------------+-------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| 1.000000000000000000000000000001 | 9999999999999999999999999999999999999999999998.999999999999999999999999999998 | 9999999999999999999999999999999999999999999999.999999999999999999999999999999 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| 2.100000000000000000000000000001 | 4999999999999999999999999999999999999999999999.899999999999999999999999999998 | 5000000000000000000000000000000000000000000001.999999999999999999999999999999 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| 3.666666666666666666666666666666 | 3333333333333333333333333333333333333333333333.333333333333333333333333333333 | 3333333333333333333333333333333333333333333336.999999999999999999999999999999 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+----------------------------------+-------------------------------------------------------------------------------+-------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3 rows in set (0.09 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>警告</div><div class="admonitionContent_S0QG"><p>注意事项</p><ul><li>Decimal256 类型对于计算 CPU 的消耗更高，因此在性能上会有一些损耗。</li></ul></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="任务调度-job-scheduler">任务调度 Job Scheduler<a href="#任务调度-job-scheduler" class="hash-link" aria-label="任务调度 Job Scheduler的直接链接" title="任务调度 Job Scheduler的直接链接">​</a></h3><p>同社区用户多次交流中，我们发现许多场景下用户使用 Apache Doris 时都存在定时调度的需求，例如：</p><ul><li><p>周期性的 Backup；</p></li><li><p>过期数据定时清理；</p></li><li><p>周期性的导入任务，如定时通过 Catalog 的方式去进行增量或全量数据同步；</p></li><li><p>定期 ETL，如部分用户定期从宽表中 Load 数据至指定表、从明细表中定时拉取数据存至聚合表、ODS 层表定时打宽并写入原有宽表更新；</p></li></ul><p>尽管诸如 Airflow、DolphinScheduler 等可供选择的外部调度系统非常多，但仍面临一致性的问题——在极端情况下，外部调度系统触发 Doris 导入任务并执行成功，因意外情况忽然宕机时，外部调度系统无法正确获取执行结果，会认为此次调度失败，导致触发调度系统的容错机制，通常是重试或者直接失败。而无论采用哪种策略，最终都会导致以下几个情况发生：</p><ul><li><p><strong>资源浪费</strong>：由于调度系统误认为任务失败，可能会重新调度执行已经成功的任务，导致不必要的资源消耗。</p></li><li><p><strong>数据重复或丢失</strong>：如果调度系统选择重试导入任务，可能导致数据重复导入，造成数据冗余和不一致。另一方面，如果调度系统直接标记任务为失败，可能导致实际已成功导入的数据被忽略或丢失。</p></li><li><p><strong>时间延误</strong>：由于调度系统的容错机制被触发，可能需要进行额外的任务调度和重试，导致整体数据处理时间延长，影响业务效率和响应速度。</p></li><li><p><strong>系统稳定性下降</strong>：频繁的重试或直接失败可能导致调度系统和 Doris 的负载增加，进而影响系统的稳定性和性能。</p></li></ul><p>因此我们在 Apache Doris 2.1 版本中引入了 Job Scheduler 功能并具备了自行任务调度的能力。Doris Job Scheduler 是根据既定计划运行的任务，用于在特定时间或指定时间间隔触发预定义的操作，从而帮助我们自动执行一些任务。从功能上来讲，它类似于操作系统上的定时任务（如：Linux 中的 cron、Windows 中的计划任务），但 Doris 的 Job 调度可以精确到秒级。对于导入场景，我们能够做到完全的一致性保障。除此之外，Doris 内置的 Jon Scheduler 还具有以下特点：</p><ol><li><p><strong>高效调度</strong>：Job Scheduler 可以在指定的时间间隔内安排任务和事件，确保数据处理的高效性。采用时间轮算法保证事件能够精准做到秒级触发。</p></li><li><p><strong>灵活调度</strong>：Job Scheduler 提供了多种调度选项，如按 分、小时、天或周的间隔进行调度，同时支持一次性调度以及循环（周期）事件调度，并且周期调度也可以指定开始时间、结束时间。</p></li><li><p><strong>事件池和高性能处理队列</strong>：Job Scheduler 采用 Disruptor 实现高性能的生产消费者模型，最大可能的避免任务执行过载。</p></li><li><p><strong>调度记录可追溯</strong>：Job Scheduler 会存储最新的 Task 执行记录（可配置），通过简单的命令即可查看任务执行记录，确保过程可追溯。</p></li><li><p><strong>高可用</strong>：依托于 Doris 自身的高可用机制，Job 可以很轻松的做到自恢复，高可用。</p></li></ol><p>在此我们创建一个定时调度任务作为示例：</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// 从  2023-11-17 起每天定时执行 insert语句直到 2038 年结束</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">JOB e_daily</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ON SCHEDULE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      EVERY 1 DAY </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      STARTS &#x27;2023-11-17 23:59:00&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ENDS &#x27;2038-01-19 03:14:07&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    COMMENT &#x27;Saves total number of sessions&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    DO</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        INSERT INTO site_activity.totals (time, total)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        SELECT CURRENT_TIMESTAMP, COUNT(*)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        FROM site_activity.sessions where create_time &gt;=  days_add(now(),-1) ;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意事项</div><div class="admonitionContent_S0QG"><p>当前 Job Scheduler 仅支持 Insert 内表，参考文档：<a href="https://doris.apache.org/zh-CN/docs/sql-manual/sql-statements/Data-Definition-Statements/Create/CREATE-JOB.md" target="_blank" rel="noopener noreferrer">CREATE-JOB</a></p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="behavior-changed">Behavior Changed<a href="#behavior-changed" class="hash-link" aria-label="Behavior Changed的直接链接" title="Behavior Changed的直接链接">​</a></h2><ul><li><p>Unique Key 模型默认开启 Merge On Write 写时合并，新创建的 Unique Key 模型的表将自动设置 <code>enable_unique_key_merge_on_write=true</code>。</p></li><li><p>倒排索引 Invert Index 经过一年多时间的打磨，已实现了对原本的位图索引 Bitmap Index 功能和场景的全覆盖，且功能上和性能上都大幅优于原本的位图索引 Bitmap Index，因此从 Apache Doris 2.1 版本起，我们将默认停止对位图索引 Bitmap Index 的支持，已经创建的位图索引保持不变将继续生效，不允许创建新的位图索引，在未来我们将会移除位图索引的相关代码。</p></li><li><p><code>cpu_resource_limit</code>不再支持，其本身是限制 BE 上 Scanner 线程数目的功能，而 Workload Group 也能支持设置 BE Scanner 线程数目，所以已设置的 <code>cpu_resource_limit </code>将失效。</p></li><li><p>Segment Compaction 主要应对单批次大数据量的导入，可以在同一批次数据中进行多个 Segment 的 Compaction 操作，在 2.1 版本开始 Segment Compaction 将默认开启，<code>enable_segcompaction</code> 默认值设置为 True。</p></li><li><p>Audit Log 插件</p><ul><li><p>从 2.1 版本开始，Apache Doris 开始内置 Audit Log 审计日志插件，用户只需通过设置全局变量 <code>enable_audit_plugin</code> 开启或关闭审计日志功能。</p></li><li><p>对于之前已经安装过审计日志插件的用户，升级后可以继续使用原有插件，也可以通过 uninstall 命令卸载原有插件后，使用新的插件。但注意，切换插件后，审计日志表也将切换到新的表中。</p></li><li><p>具体可参阅：<a href="https://doris.apache.org/zh-CN/docs/admin-manual/audit-plugin.md" target="_blank" rel="noopener noreferrer">审计日志插件</a></p></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="致谢">致谢<a href="#致谢" class="hash-link" aria-label="致谢的直接链接" title="致谢的直接链接">​</a></h2><p>467887319, 924060929, acnot, airborne12, AKIRA, alan_rodriguez, AlexYue, allenhooo, amory, amory, AshinGau, beat4ocean, BePPPower, bigben0204, bingquanzhao, BirdAmosBird, BiteTheDDDDt, bobhan1, caiconghui, camby, camby, CanGuan, caoliang-web, catpineapple, Centurybbx, chen, ChengDaqi2023, ChenyangSunChenyang, Chester, ChinaYiGuan, ChouGavinChou, chunping, colagy, CSTGluigi, czzmmc, daidai, dalong, dataroaring, DeadlineFen, DeadlineFen, deadlinefen, deardeng, didiaode18, DongLiang-0, dong-shuai, Doris-Extras, Dragonliu2018, DrogonJackDrogon, DuanXujianDuan, DuRipeng, dutyu, echo-dundun, ElvinWei, englefly, Euporia, feelshana, feifeifeimoon, feiniaofeiafei, felixwluo, figurant, flynn, fornaix, FreeOnePlus, Gabriel39, gitccl, gnehil, GoGoWen, gohalo, guardcrystal, hammer, HappenLee, HB, hechao, HelgeLarsHelge, herry2038, HeZhangJianHe, HHoflittlefish777, HonestManXin, hongkun-Shao, HowardQin, hqx871, httpshirley, htyoung, huanghaibin, HuJerryHu, HuZhiyuHu, Hyman-zhao, i78086, irenesrl, ixzc, jacktengg, jacktengg, jackwener, jayhua, Jeffrey, jiafeng.zhang, Jibing-Li, JingDas, julic20s, kaijchen, kaka11chen, KassieZ, kindred77, KirsCalvinKirs, KirsCalvinKirs, kkop, koarz, LemonLiTree, LHG41278, liaoxin01, LiBinfeng-01, LiChuangLi, LiDongyangLi, Lightman, lihangyu, lihuigang, LingAdonisLing, liugddx, LiuGuangdongLiu, LiuHongLiu, liuJiwenliu, LiuLijiaLiu, lsy3993, LuGuangmingLu, LuoMetaLuo, luozenglin, Luwei, Luzhijing, lxliyou001, Ma1oneZhang, mch_ucchi, Miaohongkai, morningman, morrySnow, Mryange, mymeiyi, nanfeng, nanfeng, Nitin-Kashyap, PaiVallishPai, Petrichor, plat1ko, py023, q763562998, qidaye, QiHouliangQi, ranxiang327, realize096, rohitrs1983, sdhzwc, seawinde, seuhezhiqiang, seuhezhiqiang, shee, shuke987, shysnow, songguangfan, Stalary, starocean999, SunChenyangSun, sunny, SWJTU-ZhangLei, TangSiyang2001, Tanya-W, taoxutao, Uniqueyou, vhwzIs, walter, walter, wangbo, Wanghuan, wangqt, wangtao, wangtianyi2004, wenluowen, whuxingying, wsjz, wudi, wudongliang, wuwenchihdu, wyx123654, xiangran0327, Xiaocc, XiaoChangmingXiao, xiaokang, XieJiann, Xinxing, xiongjx, xuefengze, xueweizhang, XueYuhai, XuJianxu, xuke-hat, xy, xy720, xyfsjq, xzj7019, yagagagaga, yangshijie, YangYAN, yiguolei, yiguolei, yimeng, YinShaowenYin, Yoko, yongjinhou, ytwp, yuanyuan8983, yujian, yujun777, Yukang-Lian, Yulei-Yang, yuxuan-luo, zclllyybb, ZenoYang, zfr95, zgxme, zhangdong, zhangguoqiang, zhangstar333, zhangstar333, zhangy5, ZhangYu0123, zhannngchen, ZhaoLongZhao, zhaoshuo, zhengyu, zhiqqqq, ZhongJinHacker, ZhuArmandoZhu, zlw5307, ZouXinyiZou, zxealous, zy-kkk, zzwwhh, zzzxl1993, zzzzzzzs</p></div></article><div class="flex items-center justify-end col mt-10"><a href="https://github.com/apache/doris-website/issues/new?title=Issue on docs&amp;body=Path:false" target="_blank" rel="noopener noreferrer" class="mr-6 footerBtn_e3I8"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.48038 2.9C9.71132 2.5 10.2887 2.5 10.5196 2.9L18.1406 16.1C18.3716 16.5 18.0829 17 17.621 17H2.37898C1.9171 17 1.62842 16.5 1.85936 16.1L9.48038 2.9Z" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"></path><path d="M10.5699 7.9516C10.5874 7.5628 10.2769 7.23804 9.88766 7.23804C9.49847 7.23804 9.18796 7.5628 9.20543 7.9516L9.41597 12.6385C9.42731 12.8908 9.63513 13.0895 9.88766 13.0895C10.1402 13.0895 10.348 12.8908 10.3593 12.6385L10.5699 7.9516ZM9.89338 13.7638C9.65338 13.7638 9.44766 13.8323 9.28766 13.9923C9.12766 14.1409 9.04766 14.3352 9.04766 14.5752C9.04766 14.8152 9.12766 15.0095 9.28766 15.1695C9.45909 15.318 9.6648 15.398 9.89338 15.398C10.1219 15.398 10.3162 15.318 10.4762 15.158C10.6477 14.998 10.7277 14.8038 10.7277 14.5752C10.7277 14.3352 10.6477 14.1409 10.4762 13.9923C10.3162 13.8323 10.1219 13.7638 9.89338 13.7638Z" fill="currentColor"></path></svg> <span class="ml-2">Report issue</span></a></div><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh-CN/docs/3.0/releasenotes/v2.1/release-2.1.1"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Release 2.1.1</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh-CN/docs/3.0/releasenotes/v2.0/release-2.0.15"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Release 2.0.15</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_jeP5 thin-scrollbar theme-doc-toc-desktop"><span class="ml-4">本页导航</span><ul class="table-of-contents table-of-contents__left-border"><li><a href="#复杂查询性能提升-100tpc-ds-业界领先" class="table-of-contents__link toc-highlight">复杂查询性能提升 100%，TPC-DS 业界领先</a><ul><li><a href="#优化器更智能" class="table-of-contents__link toc-highlight">优化器更智能</a></li><li><a href="#无统计信息优化" class="table-of-contents__link toc-highlight">无统计信息优化</a></li><li><a href="#parallel-adaptive-scan-并行自适应扫描" class="table-of-contents__link toc-highlight">Parallel Adaptive Scan 并行自适应扫描</a></li><li><a href="#local-shuffle" class="table-of-contents__link toc-highlight">Local Shuffle</a></li></ul></li><li><a href="#arm-架构深度适配性能提升-230" class="table-of-contents__link toc-highlight">ARM 架构深度适配，性能提升 230%</a></li><li><a href="#数据湖分析" class="table-of-contents__link toc-highlight">数据湖分析</a><ul><li><a href="#性能提升" class="table-of-contents__link toc-highlight">性能提升</a></li><li><a href="#多-sql-方言兼容" class="table-of-contents__link toc-highlight">多 SQL 方言兼容</a></li><li><a href="#高速数据读取数据传输效率提升-100-倍" class="table-of-contents__link toc-highlight">高速数据读取，数据传输效率提升 100 倍</a></li><li><a href="#其他" class="table-of-contents__link toc-highlight">其他</a></li></ul></li><li><a href="#多表物化视图" class="table-of-contents__link toc-highlight">多表物化视图</a></li><li><a href="#存储能力增强" class="table-of-contents__link toc-highlight">存储能力增强</a><ul><li><a href="#自增列-auto_increment" class="table-of-contents__link toc-highlight">自增列 AUTO_INCREMENT</a></li><li><a href="#自动分区-auto-partition" class="table-of-contents__link toc-highlight">自动分区 Auto Partition</a></li><li><a href="#insert-into-select-导入性能提升-100" class="table-of-contents__link toc-highlight">INSERT INTO SELECT 导入性能提升 100%</a></li><li><a href="#高频实时导入服务端攒批-group-commit" class="table-of-contents__link toc-highlight">高频实时导入/服务端攒批 Group Commit</a></li></ul></li><li><a href="#半结构化数据分析" class="table-of-contents__link toc-highlight">半结构化数据分析</a><ul><li><a href="#variant-数据类型" class="table-of-contents__link toc-highlight">Variant 数据类型</a></li><li><a href="#ip-数据类型" class="table-of-contents__link toc-highlight">IP 数据类型</a></li><li><a href="#复杂数据类型分析函数完善" class="table-of-contents__link toc-highlight">复杂数据类型分析函数完善</a></li></ul></li><li><a href="#负载管理" class="table-of-contents__link toc-highlight">负载管理</a><ul><li><a href="#资源硬隔离" class="table-of-contents__link toc-highlight">资源硬隔离</a></li><li><a href="#topsql" class="table-of-contents__link toc-highlight">TopSQL</a></li></ul></li><li><a href="#其他-1" class="table-of-contents__link toc-highlight">其他</a><ul><li><a href="#decimal256" class="table-of-contents__link toc-highlight">Decimal256</a></li><li><a href="#任务调度-job-scheduler" class="table-of-contents__link toc-highlight">任务调度 Job Scheduler</a></li></ul></li><li><a href="#behavior-changed" class="table-of-contents__link toc-highlight">Behavior Changed</a></li><li><a href="#致谢" class="table-of-contents__link toc-highlight">致谢</a></li></ul></div></div></div></div></main></div></div></div><div class="footer pt-16 pb-10"><div class="container"><div class="footer-box"><div class="left"><img src="/zh-CN/images/asf_logo_apache.svg" alt="" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/zh-CN/images/asf_logo_apache.svg" alt="" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">ASF</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Foundation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="footer__link-item">License<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/events/current-event" target="_blank" rel="noopener noreferrer" class="footer__link-item">Events<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sponsorship<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Security<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Thanks<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zh-CN/download">Download</a></li><li class="footer__item"><a class="footer__link-item" href="/zh-CN/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/zh-CN/ecosystem/cluster-management">Ecosystem</a></li><li class="footer__item"><a class="footer__link-item" href="/zh-CN/users">Users</a></li><li class="footer__item"><a href="https://github.com/apache/doris/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zh-CN/community/how-to-contribute/">How to contribute</a></li><li class="footer__item"><a href="https://github.com/apache/doris/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Source code<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/zh-CN/community/team">Doris team</a></li><li class="footer__item"><a href="https://github.com/apache/doris/issues/30669" target="_blank" rel="noopener noreferrer" class="footer__link-item">Roadmap<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://cwiki.apache.org/confluence/display/DORIS/Doris+Improvement+Proposals" target="_blank" rel="noopener noreferrer" class="footer__link-item">Improvement proposal<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div><div class="right"><div class="footer__title">Join the community</div><div class="social-list"><div class="social"><a href="mailto:dev@doris.apache.org" target="_blank" title="mail" class="item"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 32 32" fill="none"><path d="M5.6003 6H26.3997C27.8186 6 28.982 7.10964 29 8.46946L16.0045 15.454L3.01202 8.47829C3.02405 7.11258 4.1784 6 5.6003 6ZM3.01202 11.1508L3 23.5011C3 24.8756 4.16938 26 5.6003 26H26.3997C27.8306 26 29 24.8756 29 23.5011V11.145L16.3111 17.8028C16.1157 17.9058 15.8813 17.9058 15.6889 17.8028L3.01202 11.1508Z" fill="currentColor"></path></svg></a><a href="https://github.com/apache/doris" target="_blank" title="github" class="item"><svg width="2em" height="2em" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16.0001 2.66675C8.63342 2.66675 2.66675 8.63341 2.66675 16.0001C2.66524 18.7991 3.54517 21.5276 5.1817 23.7983C6.81824 26.0691 9.12828 27.7668 11.7841 28.6508C12.4508 28.7668 12.7001 28.3668 12.7001 28.0161C12.7001 27.7001 12.6828 26.6508 12.6828 25.5334C9.33342 26.1508 8.46675 24.7174 8.20008 23.9668C8.04942 23.5828 7.40008 22.4001 6.83342 22.0828C6.36675 21.8334 5.70008 21.2161 6.81608 21.2001C7.86675 21.1828 8.61608 22.1668 8.86675 22.5668C10.0668 24.5828 11.9841 24.0161 12.7494 23.6668C12.8668 22.8001 13.2161 22.2174 13.6001 21.8841C10.6334 21.5508 7.53342 20.4001 7.53342 15.3001C7.53342 13.8494 8.04942 12.6507 8.90008 11.7161C8.76675 11.3827 8.30008 10.0161 9.03342 8.18275C9.03342 8.18275 10.1494 7.83342 12.7001 9.55075C13.7855 9.2495 14.907 9.09787 16.0334 9.10008C17.1668 9.10008 18.3001 9.24942 19.3668 9.54942C21.9161 7.81608 23.0334 8.18408 23.0334 8.18408C23.7668 10.0174 23.3001 11.3841 23.1668 11.7174C24.0161 12.6507 24.5334 13.8334 24.5334 15.3001C24.5334 20.4174 21.4174 21.5508 18.4508 21.8841C18.9334 22.3001 19.3508 23.1001 19.3508 24.3508C19.3508 26.1334 19.3334 27.5668 19.3334 28.0174C19.3334 28.3668 19.5841 28.7828 20.2508 28.6494C22.8975 27.7558 25.1973 26.0547 26.8266 23.7856C28.4559 21.5165 29.3327 18.7936 29.3334 16.0001C29.3334 8.63341 23.3668 2.66675 16.0001 2.66675V2.66675Z" fill="currentColor"></path></svg></a><a href="https://twitter.com/doris_apache" target="_blank" title="twitter" class="item"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 32 32" fill="none"><path d="M4.625 4.625H11.2809L27.375 27.375H20.7191L4.625 4.625ZM7.52549 6.10639L21.5236 25.8936H24.4746L10.4764 6.10639H7.52549Z" fill="currentColor"></path><path d="M14.4268 18.4803L6.53447 27.375H4.625L13.5581 17.2525L14.4268 18.4803ZM18.1299 14.3066L26.7203 4.625H24.7017L17.2525 13.0662L18.1299 14.3066Z" fill="currentColor"></path></svg></a><a href="https://join.slack.com/t/apachedoriscommunity/shared_invite/zt-2kl08hzc0-SPJe4VWmL_qzrFd2u2XYQA" title="slack" target="_blank" class="item"><svg width="2em" height="2em" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_125_278)"><path d="M12.5875 16.6906C11.0844 16.6906 9.86562 17.9094 9.86562 19.4125V26.2375C9.86562 26.9594 10.1524 27.6517 10.6628 28.1622C11.1733 28.6726 11.8656 28.9594 12.5875 28.9594C13.3094 28.9594 14.0017 28.6726 14.5122 28.1622C15.0226 27.6517 15.3094 26.9594 15.3094 26.2375V19.4531C15.3094 17.9094 14.0906 16.6906 12.5875 16.6906ZM3 19.4531C3 20.175 3.28677 20.8673 3.79722 21.3778C4.30767 21.8882 4.99999 22.175 5.72187 22.175C6.44376 22.175 7.13608 21.8882 7.64653 21.3778C8.15698 20.8673 8.44375 20.175 8.44375 19.4531V16.7312H5.7625C4.25938 16.6906 3 17.9094 3 19.4531ZM12.5875 3C11.8656 3 11.1733 3.28677 10.6628 3.79722C10.1524 4.30767 9.86562 4.99999 9.86562 5.72187C9.86562 6.44376 10.1524 7.13608 10.6628 7.64653C11.1733 8.15698 11.8656 8.44375 12.5875 8.44375H15.3094V5.72187C15.3094 4.21875 14.0906 3 12.5875 3ZM5.72187 15.3094H12.5469C13.2688 15.3094 13.9611 15.0226 14.4715 14.5122C14.982 14.0017 15.2688 13.3094 15.2688 12.5875C15.2688 11.8656 14.982 11.1733 14.4715 10.6628C13.9611 10.1524 13.2688 9.86562 12.5469 9.86562H5.72187C4.99999 9.86562 4.30767 10.1524 3.79722 10.6628C3.28677 11.1733 3 11.8656 3 12.5875C3 13.3094 3.28677 14.0017 3.79722 14.5122C4.30767 15.0226 4.99999 15.3094 5.72187 15.3094ZM26.2375 9.86562C24.7344 9.86562 23.5156 11.0844 23.5156 12.5875V15.3094H26.2375C26.9594 15.3094 27.6517 15.0226 28.1622 14.5122C28.6726 14.0017 28.9594 13.3094 28.9594 12.5875C28.9594 11.8656 28.6726 11.1733 28.1622 10.6628C27.6517 10.1524 26.9594 9.86562 26.2375 9.86562ZM16.6906 5.72187V12.5875C16.6906 13.3094 16.9774 14.0017 17.4878 14.5122C17.9983 15.0226 18.6906 15.3094 19.4125 15.3094C20.1344 15.3094 20.8267 15.0226 21.3372 14.5122C21.8476 14.0017 22.1344 13.3094 22.1344 12.5875V5.72187C22.1344 4.99999 21.8476 4.30767 21.3372 3.79722C20.8267 3.28677 20.1344 3 19.4125 3C18.6906 3 17.9983 3.28677 17.4878 3.79722C16.9774 4.30767 16.6906 4.99999 16.6906 5.72187ZM22.1344 26.2781C22.1344 24.775 20.9156 23.5562 19.4125 23.5562H16.6906V26.2781C16.6906 27 16.9774 27.6923 17.4878 28.2028C17.9983 28.7132 18.6906 29 19.4125 29C20.1344 29 20.8267 28.7132 21.3372 28.2028C21.8476 27.6923 22.1344 27 22.1344 26.2781ZM26.2781 16.6906H19.4125C18.6906 16.6906 17.9983 16.9774 17.4878 17.4878C16.9774 17.9983 16.6906 18.6906 16.6906 19.4125C16.6906 20.1344 16.9774 20.8267 17.4878 21.3372C17.9983 21.8476 18.6906 22.1344 19.4125 22.1344H26.2375C27.7406 22.1344 28.9594 20.9156 28.9594 19.4125C29 17.9094 27.7812 16.6906 26.2781 16.6906Z" fill="currentColor"></path></g><defs><clipPath id="clip0_125_278"><rect width="26" height="26" fill="currentColor" transform="translate(3 3)"></rect></clipPath></defs></svg></a></div><div class="social"><a href="https://www.youtube.com/@apachedoris/channels" title="youtube" target="_blank" class="item"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 32 32" fill="none"><path d="M28.5167 7.83429C28.9436 8.25423 29.2532 8.77539 29.4154 9.34742C29.8205 11.5462 30.0159 13.7775 29.999 16.0121C30.0144 18.2382 29.819 20.4609 29.4154 22.6515C29.2532 23.2235 28.9436 23.7446 28.5167 24.1645C28.0898 24.5845 27.5601 24.889 26.9785 25.0486C24.7728 25.625 16.0124 25.625 16.0124 25.625C16.0124 25.625 7.22652 25.625 5.04638 25.0486C4.46489 24.889 3.9351 24.5845 3.5082 24.1645C3.08132 23.7446 2.77176 23.2235 2.60948 22.6515C2.19736 20.4617 1.9934 18.239 2.00025 16.0121C1.9918 13.7767 2.19577 11.5455 2.60948 9.34742C2.77176 8.77539 3.08132 8.25423 3.5082 7.83429C3.9351 7.41436 4.46489 7.10985 5.04638 6.95021C7.25103 6.36354 16.0124 6.37502 16.0124 6.37502C16.0124 6.37502 24.796 6.37502 26.9785 6.95021C27.5601 7.10985 28.0898 7.41436 28.5167 7.83429ZM12.5 21.25L21.25 16.008L12.5 10.75V21.25Z" fill="currentColor"></path></svg></a><a href="https://www.linkedin.com/company/doris-apache/" title="linkedin" target="_blank" class="item"><svg width="2rem" height="2rem" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.29925 26.9996H9.66738V11.6781H4.29925V26.9996ZM22.1628 11.1949C19.9409 11.1949 18.7157 11.9388 17.3054 13.7407V11.6777H11.9459V26.9996H17.305V18.6738C17.305 16.9168 18.145 15.1982 20.1535 15.1982C22.162 15.1982 22.6559 16.9164 22.6559 18.632V27H28V18.2902C28 12.2386 24.3854 11.1949 22.1628 11.1949ZM6.99325 4C5.3395 4 4 5.21047 4 6.7046C4 8.19759 5.3395 9.40617 6.99325 9.40617C8.6455 9.40617 9.985 8.19722 9.985 6.7046C9.985 5.21047 8.6455 4 6.99325 4Z" fill="white"></path></svg></a><a href="https://medium.com/@ApacheDoris" title="medium" target="_blank" class="item"><svg width="2em" height="2em" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="Frame"><path id="Vector" d="M17.7967 16.5385C17.8029 18.53 16.9746 20.4425 15.4937 21.8559C14.0128 23.2693 12.0004 24.0681 9.89836 24.0769C7.79633 24.0681 5.78391 23.2693 4.30302 21.8559C2.82212 20.4425 1.99383 18.53 2.00003 16.5385C1.99383 14.5469 2.82212 12.6344 4.30302 11.221C5.78391 9.80759 7.79633 9.00878 9.89836 9C12.0004 9.00878 14.0128 9.80759 15.4937 11.221C16.9746 12.6344 17.8029 14.5469 17.7967 16.5385ZM26.4533 16.5385C26.4533 20.4514 24.6917 23.6348 22.51 23.6348C20.3283 23.6348 18.555 20.4514 18.555 16.5385C18.555 12.6255 20.3283 9.44214 22.51 9.44214C24.6917 9.44214 26.4533 12.6255 26.4533 16.5385ZM30 16.5385C30 20.0424 29.3817 22.8942 28.6117 22.8942C27.8417 22.8942 27.2233 20.0424 27.2233 16.5385C27.2233 13.0345 27.8417 10.1827 28.6117 10.1827C29.3817 10.1827 30 13.0345 30 16.5385Z" fill="currentColor"></path></g></svg></a><a class="item wechat"><svg width="2em" height="2em" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20.7578 11.5169C21.0708 11.5169 21.3795 11.5398 21.6851 11.573C20.8524 7.73517 16.7052 4.88306 11.9718 4.88306C6.67951 4.88306 2.34412 8.45283 2.34412 12.9854C2.34412 15.6013 3.78679 17.7498 6.19667 19.4161L5.2339 22.2827L8.59917 20.6122C9.80411 20.8478 10.7698 21.0906 11.9718 21.0906C12.2738 21.0906 12.5728 21.0759 12.8703 21.0523C12.682 20.4159 12.5728 19.7485 12.5728 19.0566C12.5728 14.8947 16.1847 11.5169 20.7578 11.5169ZM15.5822 8.9335C16.3072 8.9335 16.7871 9.40601 16.7871 10.1229C16.7871 10.8369 16.3072 11.3153 15.5822 11.3153C14.8601 11.3153 14.1365 10.8369 14.1365 10.1229C14.1365 9.40601 14.8601 8.9335 15.5822 8.9335ZM8.84429 11.3153C8.12218 11.3153 7.3942 10.8368 7.3942 10.1229C7.3942 9.40597 8.12218 8.93346 8.84429 8.93346C9.56559 8.93346 10.0463 9.40597 10.0463 10.1229C10.0463 10.8369 9.56559 11.3153 8.84429 11.3153ZM29.5453 18.9422C29.5453 15.1332 25.6935 12.0285 21.3677 12.0285C16.7871 12.0285 13.1797 15.1332 13.1797 18.9422C13.1797 22.7567 16.7871 25.8547 21.3677 25.8547C22.326 25.8547 23.2932 25.6169 24.2559 25.3777L26.897 26.8086L26.1726 24.4282C28.1056 22.993 29.5453 21.0906 29.5453 18.9422ZM18.7126 17.7498C18.2335 17.7498 17.7499 17.278 17.7499 16.7966C17.7499 16.3219 18.2335 15.8442 18.7126 15.8442C19.4406 15.8442 19.9176 16.3219 19.9176 16.7966C19.9176 17.278 19.4406 17.7498 18.7126 17.7498ZM24.0079 17.7498C23.5324 17.7498 23.0518 17.278 23.0518 16.7966C23.0518 16.3219 23.5324 15.8442 24.0079 15.8442C24.73 15.8442 25.2128 16.3219 25.2128 16.7966C25.2128 17.278 24.73 17.7498 24.0079 17.7498Z" fill="currentColor"></path></svg><div class="wechat-dropdown"><p class="text-[#4c576c] text-xs">Connect on WeChat</p><img src="https://cdnd.selectdb.com/zh-CN/assets/images/doris-wechat-b949e908a3bc2776d824f79a9100bd4b.png" alt=""></div></a></div></div></div></div><div class="footer__copyright">Copyright © 2024 The Apache Software Foundation,Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank">Apache License, Version 2.0</a>. Apache, Doris, Apache Doris, the Apache feather logo and the Apache Doris logo are trademarks of The Apache Software Foundation.</div></div></div></div>
<script src="https://cdnd.selectdb.com/zh-CN/assets/js/runtime~main.3e4959a3.js"></script>
<script src="https://cdnd.selectdb.com/zh-CN/assets/js/main.d9d2e727.js"></script>
</body>
</html>