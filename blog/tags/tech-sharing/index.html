<!doctype html>
<html lang="en-US" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
<meta name="generator" content="Docusaurus v2.4.3">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Doris RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Doris Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DT7W9E9722"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-DT7W9E9722",{anonymize_ip:!0})</script>



<link rel="preconnect" href="https://analytics.apache.org/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://analytics.apache.org/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","43"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script>



<link rel="icon" href="/images/logo-only.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#FFFFFF">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/img/docusaurus.png">
<link rel="mask-icon" href="/img/docusaurus.svg" color="rgb(37, 194, 160)">
<meta name="msapplication-TileImage" content="/img/docusaurus.png">
<meta name="msapplication-TileColor" content="#000">



<link rel="stylesheet" href="https://cdn-font.hyperos.mi.com/font/css?family=MiSans:100,200,300,400,450,500,600,650,700,900:Chinese_Simplify,Latin&display=swap">
<link rel="stylesheet" href="https://cdn-font.hyperos.mi.com/font/css?family=MiSans_Latin:100,200,300,400,450,500,600,650,700,900:Latin&display=swap">
<script src="/js/custom-script.js"></script><title data-rh="true">24 posts tagged with &quot;Tech Sharing&quot; - Apache Doris</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://doris.apache.org/blog/tags/tech-sharing"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="24 posts tagged with &quot;Tech Sharing&quot; - Apache Doris"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/images/favicon.ico"><link data-rh="true" rel="canonical" href="https://doris.apache.org/blog/tags/tech-sharing"><link data-rh="true" rel="alternate" href="https://doris.apache.org/blog/tags/tech-sharing" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://doris.apache.org/zh-CN/blog/tags/tech-sharing" hreflang="zh-Hans-CN"><link data-rh="true" rel="alternate" href="https://doris.apache.org/blog/tags/tech-sharing" hreflang="x-default"><link rel="stylesheet" href="https://cdnd.selectdb.com/assets/css/styles.8df26a34.css">
<link rel="preload" href="https://cdnd.selectdb.com/assets/js/runtime~main.d78c3de7.js" as="script">
<link rel="preload" href="https://cdnd.selectdb.com/assets/js/main.62136e2c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_s0pr" style="background-color:#3C2FD4;color:#FFFFFF" role="banner"><div class="announcementBarPlaceholder_qxfj"></div><div class="announcementBarContent_dpRF"><a href="https://github.com/apache/doris" target="_blank" style="display: flex; width: 100%; align-items: center; justify-content: center; margin-left: 4px; text-decoration: none; color: white">Do you ‚ù§Ô∏è Doris? Give us a üåü on GitHub 
                <img style="width: 1.2rem; height: 1.2rem; margin-left: 0.4rem;" src="/images/github-white-icon.svg">
                    </a></div><button type="button" class="clean-btn close announcementBarClose_iXyO" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14" style="color:white"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner" style="padding:"><div class="navbar__items"><div class="navbar-left"><div class="navbar-logo-wrapper flex items-center"><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="https://cdnd.selectdb.com/images/logo.svg" alt="Apache Doris" class="themedImage_ToTc themedImage--light_HNdA"><img src="https://cdnd.selectdb.com/images/logo.svg" alt="Apache Doris" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbarLeftToc_UHDb"><a class="navbar__item navbar__link" style="text-align:center;padding:0 0.625rem" target="_blank" href="/docs/gettingStarted/what-is-new">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" style="text-align:center;padding:0 0.625rem" href="/blog">Blog</a><a class="navbar__item navbar__link" style="text-align:center;padding:0 0.625rem" href="/users">Users</a><a href="https://github.com/apache/doris/discussions" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link" style="text-align:center;padding:0 0.625rem">Discussions</a><a class="navbar__item navbar__link" style="text-align:center;padding:0 0.625rem" href="/ecosystem/cluster-management">Ecosystem</a><a class="navbar__item navbar__link" style="text-align:center;padding:0 0.625rem" href="/community/join-community">Community</a></div></div></div><div class="navbar__items navbar__items--right"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><div class="docs-search searchBox_H2mL"><div class="navbar__search searchBarContainer_PzyC"><input placeholder="Search" aria-label="Search" class="navbar__search-input navbarSearchInput_tb6T"><div class="loadingRing__K5d searchBarLoadingRing_e2f0"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_m7ml"><kbd class="searchHint_zuPL">ctrl</kbd><kbd class="searchHint_zuPL">K</kbd></div></div></div><div class="custom-navbar-item navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/install/source-install/compilation-with-docker"><span class="text-sm">Versions: </span></a><ul class="dropdown__menu"><li><a class="dropdown__link" style="text-align:center;padding:0 0.625rem" href="/docs/3.0/install/source-install/compilation-with-docker">3.0</a></li><li><a class="dropdown__link" style="text-align:center;padding:0 0.625rem" href="/docs/install/source-install/compilation-with-docker">2.1</a></li><li><a class="dropdown__link" style="text-align:center;padding:0 0.625rem" href="/docs/2.0/install/source-install/compilation-with-docker">2.0</a></li><li><a class="dropdown__link" style="text-align:center;padding:0 0.625rem" href="/docs/1.2/summary/basic-summary">1.2</a></li><li><a class="dropdown__link" style="text-align:center;padding:0 0.625rem" href="/docs/dev/install/source-install/compilation-with-docker">Dev</a></li></ul></div><a class="navbar__item navbar__link header-right-button-primary navbar-download-mobile" style="text-align:center;padding:0 0.625rem" href="/download">Download</a><a href="https://github.com/apache/doris" target="_blank" rel="noopener noreferrer" class="github-btn desktop header-right-button-github"></a><a href="https://join.slack.com/t/apachedoriscommunity/shared_invite/zt-2kl08hzc0-SPJe4VWmL_qzrFd2u2XYQA" target="_blank" rel="noopener noreferrer" class="slack-btn desktop header-right-button-slack"></a><a class="header-right-button-primary navbar-download-desktop" href="/download">Download</a></div></div><div class="navbar__bottom"><div class="docs-nav-mobile"><a class="navbar__item navbar__link" style="text-align:center;padding:0 0.625rem" href="/docs/gettingStarted/what-is-new">Getting Started</a><a class="navbar__item navbar__link" style="text-align:center;padding:0 0.625rem" href="/docs/install/source-install/compilation-with-docker">Guides</a><a class="navbar__item navbar__link" style="text-align:center;padding:0 0.625rem" href="/docs/benchmark/ssb">Benchmark</a><a class="navbar__item navbar__link" style="text-align:center;padding:0 0.625rem" href="/docs/ecosystem/spark-doris-connector">Ecosystem</a><a class="navbar__item navbar__link" style="text-align:center;padding:0 0.625rem" href="/docs/faq/install-faq">FAQ</a><a class="navbar__item navbar__link" style="text-align:center;padding:0 0.625rem" href="/docs/releasenotes/all-release">Releases</a><div class="navbar__item"><a href="https://github.com/apache/doris/discussions" target="_blank" style="display: flex; align-items: center; justify-content: center; text-decoration: none;">Forum<img style="width: 1.2rem; height: 1.2rem; margin-left: 0.2rem;" src="/images/forum-logo.svg">
                    </a></div></div></div><div class="navbar__bottom"></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="main-wrapper"><div class="mb-[4.875rem] container"><div class="lg:row lg:flex"><main class="col col--9 col--offset-1" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>24 posts tagged with &quot;Tech Sharing&quot;</h1><a href="/blog/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><div class="text-center mb-4"><a class="text-[#8592A6] cursor-pointer hover:no-underline" href="/blog">Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class="s-tags"><span class="s-tag">Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:text-[2.5rem] text-center" itemprop="headline"><a itemprop="url" href="/blog/auto-partition-in-apache-doris">Automatic and flexible data sharding: Auto Partition in Apache Doris</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class="authors"><span class="s-author text-black">Apache Doris</span></span><time datetime="2024-08-14T00:00:00.000Z" itemprop="datePublished" class="text-black ml-4">August 14, 2024</time></div></header><div class="markdown" itemprop="articleBody"><p>To handle large datasets, distributed databases introduce strategies like partitioning and bucketing. Data is divided into smaller units based on specific rules and distributed across different nodes, so databases can perform parallel processing for higher performance and data management flexibility.</p><p>Like in many databases, <a href="https://doris.apache.org" target="_blank" rel="noopener noreferrer">Apache Doris</a> shards data into partitions, and then a partition is further divided into buckets. <strong>Partitions</strong> are typically defined by time or other continuous values. This allows query engines to quickly locate the target data during queries by pruning irrelevant data ranges.</p><p><strong>Bucketing</strong>, on the other hand, distributes data based on the hash values of one or more columns, which prevents data skew.</p><p>Prior to version <a href="https://doris.apache.org/blog/release-note-2.1.0" target="_blank" rel="noopener noreferrer">2.1.0</a>, there are two way you can create data partitions in Apache Doris:</p><ul><li><p><strong><a href="https://doris.apache.org/docs/table-design/data-partitioning/manual-partitioning" target="_blank" rel="noopener noreferrer">Manual Partition</a></strong>: Users specify the partitions in the table creation statement, or modify them through DDL statements afterwards.</p></li><li><p><strong><a href="https://doris.apache.org/docs/table-design/data-partitioning/dynamic-partitioning" target="_blank" rel="noopener noreferrer">Dynamic Partition</a></strong>: The system automatically maintains partitions within a pre-defined range based on the data ingestion time.</p></li></ul><p>In Apache Doris 2.1.0, we have introduced <strong><a href="https://doris.apache.org/docs/table-design/data-partitioning/auto-partitioning" target="_blank" rel="noopener noreferrer">Auto Partition</a></strong>. It supports partitioning data by RANGE or by LIST and further enhances flexibility on top of automatic partitioning.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="evolution-of-partitioning-strategies-in-doris">Evolution of partitioning strategies in Doris<a href="#evolution-of-partitioning-strategies-in-doris" class="hash-link" aria-label="Direct link to Evolution of partitioning strategies in Doris" title="Direct link to Evolution of partitioning strategies in Doris">‚Äã</a></h2><p>In the design of data distribution, we focus more on partition planning, because the choice of partition columns and partition intervals heavily depends on the actual data distribution patterns, and a good partition design can largely improve the query and storage efficiency of the table.</p><p>In Doris, the data table is divided into partitions and then buckets in a hierarchical manner. The data within the same bucket then forms a data <strong>tablet</strong>, which is the minimum physical storage unit in Doris for data replication, inter-cluster data scheduling, and load balancing.</p><p><img loading="lazy" alt="Evolution of partitioning strategies in Doris" src="https://cdnd.selectdb.com/assets/images/evolution-of-partitioning-strategies-in-Doris-28ecf81690866d81a59ef418c611a5d4.png" width="1280" height="614" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="manual-partition">Manual Partition<a href="#manual-partition" class="hash-link" aria-label="Direct link to Manual Partition" title="Direct link to Manual Partition">‚Äã</a></h3><p>Doris allows users to manually create data partitions by RANGE and by LIST. </p><p>For time-stamped data like logs and transaction records, users typically create partitions based on the time dimension. Here&#x27;s an example of the CREATE TABLE statement:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">IF</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">EXISTS</span><span class="token plain"> example_range_tbl</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> LARGEINT </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;User ID&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">date</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DATE</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Data import date&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">timestamp</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DATETIME</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Data import timestamp&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">city</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Location of user&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">age</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SMALLINT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Age of user&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">sex</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TINYINT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Sex of user&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">last_visit_date</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DATETIME</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">REPLACE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;1970-01-01 00:00:00&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Last visit date of user&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">cost</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain"> SUM </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;User consumption&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">max_dwell_time</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INT</span><span class="token plain"> MAX </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Maximum dwell time of user&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">min_dwell_time</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INT</span><span class="token plain"> MIN </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;99999&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Minimum dwell time of user&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ENGINE</span><span class="token operator">=</span><span class="token plain">OLAP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">AGGREGATE </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">date</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">timestamp</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">city</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">age</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">sex</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> RANGE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">date</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">p201701</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> LESS THAN </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;2017-02-01&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">p201702</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> LESS THAN </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;2017-03-01&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">p201703</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> LESS THAN </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;2017-04-01&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">p2018</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;2018-01-01&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;2019-01-01&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">16</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;replication_num&quot;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The table is partitioned by the data import date <code>date</code>, and 4 partitions have been pre-created. Within each partition, the data is further divided into 16 buckets based on the hash value of the <code>user_id</code>.</p><p>With this partitioning and bucketing design, when querying data from 2018 onwards, the system only need to scan the <code>p2018</code> partition. This is what the query SQL looks like:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">desc</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> example_range_tbl </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain"> </span><span class="token operator">&gt;=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;20180101&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">--------------------------------------------------------------------------------------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Explain</span><span class="token plain"> String</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Nereids Planner</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">                                                      </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">--------------------------------------------------------------------------------------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PLAN</span><span class="token plain"> FRAGMENT </span><span class="token number">0</span><span class="token plain">                                                                      </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain">   OUTPUT EXPRS:                                                                      </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain">     </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token comment" style="color:rgb(98, 114, 164)">#11]                                                                    |</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain">   </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain">: UNPARTITIONED                                                           </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain">                                                                                      </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">                                                                            </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain">                                                                                      </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain">   </span><span class="token number">0</span><span class="token plain">:VOlapScanNode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">193</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">                                                               </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain">: test</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">example_range_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">example_range_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> PREAGGREGATION: </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">OFF</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">          </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain">      PREDICATES: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token comment" style="color:rgb(98, 114, 164)">#1] &gt;= &#x27;2018-01-01&#x27;)                                          |</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain">      partitions</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">4</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">p2018</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> tablets</span><span class="token operator">=</span><span class="token number">16</span><span class="token operator">/</span><span class="token number">16</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> tabletList</span><span class="token operator">=</span><span class="token number">561490</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">561492</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">561494</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain">      cardinality</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> avgRowSize</span><span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> numNodes</span><span class="token operator">=</span><span class="token number">1</span><span class="token plain">                                       </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain">      pushAggOp</span><span class="token operator">=</span><span class="token plain">NONE                                                                  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain">                                                                                      </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">--------------------------------------------------------------------------------------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If the data is distributed unevenly across partitions, the hash-based bucketing mechanism can further divide the data based on the <code>user_id</code>. This helps to avoid load imbalance on some machines during querying and storage.</p><p>However, in real-world business scenarios, one cluster may have tens of thousands of tables, which means it is impossible to manage them manually.</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">DAILY_TRADE_VALUE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_DATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain">              datev2 </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Trade date&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_ID</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">40</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Trade ID&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">UNIQUE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_DATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_ID</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> RANGE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_DATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p_200001 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2000-01-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2000-02-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p_200002 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2000-02-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2000-03-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p_200003 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2000-03-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2000-04-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p_200004 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2000-04-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2000-05-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p_200005 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2000-05-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2000-06-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p_200006 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2000-06-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2000-07-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p_200007 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2000-07-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2000-08-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p_200008 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2000-08-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2000-09-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p_200009 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2000-09-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2000-10-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p_200010 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2000-10-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2000-11-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p_200011 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2000-11-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2000-12-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p_200012 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2000-12-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2001-01-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p_200101 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2001-01-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2001-02-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_DATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the above example, data is partitioned on a monthly basis. This requires the database administrator (DBA) to manually add a new partition each month and maintain table schema regularly. Imagine the case of real-time data processing, where you might need to create partitions daily or even hourly, manually doing this is no long a choice. That&#x27;s why we introduced Dynamic Partition.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dynamic-partition">Dynamic Partition<a href="#dynamic-partition" class="hash-link" aria-label="Direct link to Dynamic Partition" title="Direct link to Dynamic Partition">‚Äã</a></h3><p>By Dynamic Partition, Doris automatically creates and reclaims data partitions as long as the user specifies the partition unit, the number of historical partitions, and the number of future partitions. This functionality relies on a fixed thread on the Doris Frontend. It continuously polls and checks for new partitions to be created or old partitions to be reclaimed, and updates the partition schema of the table.</p><p>This is an example CREATE TABLE statement for a table which is partitioned by day. The <code>start</code> and <code>end</code> parameters are set to <code>-7</code> and <code>3</code>, respectively, meaning that data partitions for the next 3 days will be pre-created and the historical partitions that are older than 7 days will be reclaimed.</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">DAILY_TRADE_VALUE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_DATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain">              datev2 </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Trade date&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_ID</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">40</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Trade ID&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">UNIQUE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_DATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_ID</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> RANGE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_DATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_DATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;dynamic_partition.enable&quot;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;true&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;dynamic_partition.time_unit&quot;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;DAY&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;dynamic_partition.start&quot;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;-7&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;dynamic_partition.end&quot;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;3&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;dynamic_partition.prefix&quot;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;p&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;dynamic_partition.buckets&quot;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;10&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Over time, the table will always maintain partitions within the range of <code>[current date - 7, current date + 3]</code>. Dynamic Partition is particularly useful for real-time data ingestion scenarios, such as when the ODS (Operational Data Store) layer directly receives data from external sources like Kafka.</p><p>The <code>start</code> and <code>end</code> parameters define a fixed range for the partitions, allowing the user to manage the partitions only within this range. However, if the user needs to include more historical data, they would have to dial up the <code>start</code> value, and that could lead to unnecessary metadata overhead in the cluster.</p><p>Therefore, when applying Dynamic Partition, there is a trade-off between the convenience and efficiency of metadata management.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="developers-words">Developers&#x27; words<a href="#developers-words" class="hash-link" aria-label="Direct link to Developers&#x27; words" title="Direct link to Developers&#x27; words">‚Äã</a></h2><p>As the complexity of business adds up, Dynamic Partition becomes inadequate because:</p><ul><li><p>It only supports partitioning by RANGE but not by LIST.</p></li><li><p>It can only be applied to the current real-world timestamps.</p></li><li><p>It only supports a single continuous partition range, and cannot accommodate partitions outside of that range.</p></li></ul><p>Given these functional limitations, we started to plan a new partitioning mechanism that can both automate partition management and simplify data table maintenance.</p><p>We figured out that the ideal partitioning implementation should:</p><ul><li><p>Save the need for manually creating partitions after table creation; </p></li><li><p>Be able to accommodate all ingested data in corresponding partitions.</p></li></ul><p><strong>The former stands for automation and the latter for flexibility. The essence of realizing them both is associating partition creation with the actual data.</strong></p><p>Then we started to think about: What if we hold off the creation of partitions until the data is ingested, rather than doing it during table creation or through regular polling. Instead of pre-constructing the partition distribution, we can define the &quot;data-to-partition&quot; mapping rules, so the partitions are created after data arrives.</p><p>Compared to Manual Partition, this whole process would be fully automated, eliminating the need for human maintenance. Compared to Dynamic Partition, it avoids having partitions that are not used, or partitions that are needed but not present.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="auto-partition">Auto Partition<a href="#auto-partition" class="hash-link" aria-label="Direct link to Auto Partition" title="Direct link to Auto Partition">‚Äã</a></h2><p>With <a href="https://doris.apache.org/blog/release-note-2.1.0" target="_blank" rel="noopener noreferrer">Apache Doris 2.1.0</a>, we bring the above plan into fruition. During data ingestion, Doris creates data partitions based on the configured rules. The Doris Backend nodes that are responsible for data processing and distribution will attempt to find the appropriate partition for each row of data in the DataSink operator of the execution plan. It no longer filters out data that does not fit into any existing partition or reports an error for such a situation, but automatically generates partitions for all ingested data.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="auto-partition-by-range">Auto Partition by RANGE<a href="#auto-partition-by-range" class="hash-link" aria-label="Direct link to Auto Partition by RANGE" title="Direct link to Auto Partition by RANGE">‚Äã</a></h3><p>Auto Partition by RANGE provides an optimized partitioning solution based on the time dimension. It is more flexible than Dynamic Partition in terms of parameter configuration. The syntax for it is as follows:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">AUTO </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> RANGE </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">FUNC_CALL_EXPR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">FUNC_CALL_EXPR ::</span><span class="token operator">=</span><span class="token plain"> DATE_TRUNC </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">partition_column</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;&lt;interval&gt;&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>&lt;partition_column&gt;</code> above is the partition column (i.e., the column that the partitioning is based on). <code>&lt;interval&gt;</code>specifies the partition unit, which is the desired width of each partition. </p><p>For example, if the partition column is <code>k0</code> and you want to partition by month, the partition statement would be <code>AUTO PARTITION BY RANGE (DATE_TRUNC(k0, &#x27;month&#x27;))</code>. For all the imported data, the system will call <code>DATE_TRUNC(k0, &#x27;month&#x27;)</code> to calculate the left endpoint of the partition, and then the right endpoint by adding one <code>interval</code>.</p><p>Now, we can apply Auto Partition to the <code>DAILY_TRADE_VALUE</code> table introduced in the previous section on Dynamic Partition.</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> DAILY_TRADE_VALUE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_DATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain">    DATEV2 </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Trade Date&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_ID</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">40</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Trade ID&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">AUTO </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> RANGE </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">DATE_TRUNC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_DATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;month&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_DATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After importing some data, these are the partitions we get:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">show</span><span class="token plain"> partitions </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> DAILY_TRADE_VALUE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Empty </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.10</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">into</span><span class="token plain"> DAILY_TRADE_VALUE </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">values</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2015-01-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2020-01-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2024-03-05&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">10000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2024-03-06&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">10001</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Query OK</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">4</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.24</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;label&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;label_2a7353a3f991400e_ae731988fa2bc568&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;status&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;VISIBLE&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;txnId&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;85097&#x27;</span><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">show</span><span class="token plain"> partitions </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> DAILY_TRADE_VALUE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------------+-----------------+----------------+---------------------+--------+--------------+--------------------------------------------------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+----------+------------+-------------------------+-----------+--------------------+--------------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> PartitionId </span><span class="token operator">|</span><span class="token plain"> PartitionName   </span><span class="token operator">|</span><span class="token plain"> VisibleVersion </span><span class="token operator">|</span><span class="token plain"> VisibleVersionTime  </span><span class="token operator">|</span><span class="token plain"> State  </span><span class="token operator">|</span><span class="token plain"> PartitionKey </span><span class="token operator">|</span><span class="token plain"> Range                                                                          </span><span class="token operator">|</span><span class="token plain"> DistributionKey </span><span class="token operator">|</span><span class="token plain"> Buckets </span><span class="token operator">|</span><span class="token plain"> ReplicationNum </span><span class="token operator">|</span><span class="token plain"> StorageMedium </span><span class="token operator">|</span><span class="token plain"> CooldownTime        </span><span class="token operator">|</span><span class="token plain"> RemoteStoragePolicy </span><span class="token operator">|</span><span class="token plain"> LastConsistencyCheckTime </span><span class="token operator">|</span><span class="token plain"> DataSize </span><span class="token operator">|</span><span class="token plain"> IsInMemory </span><span class="token operator">|</span><span class="token plain"> ReplicaAllocation       </span><span class="token operator">|</span><span class="token plain"> IsMutable </span><span class="token operator">|</span><span class="token plain"> SyncWithBaseTables </span><span class="token operator">|</span><span class="token plain"> UnsyncTables </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------------+-----------------+----------------+---------------------+--------+--------------+--------------------------------------------------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+----------+------------+-------------------------+-----------+--------------------+--------------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">588395</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> p20150101000000 </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain"> </span><span class="token number">19</span><span class="token plain">:</span><span class="token number">02</span><span class="token plain">:</span><span class="token number">40</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> NORMAL </span><span class="token operator">|</span><span class="token plain"> TRADE_DATE   </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">DATEV2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">DATEV2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">01</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> TRADE_DATE      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> HDD           </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">9999</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">0.000</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> tag</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">location</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">default</span><span class="token plain">: </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">               </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">         </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">588437</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> p20200101000000 </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain"> </span><span class="token number">19</span><span class="token plain">:</span><span class="token number">02</span><span class="token plain">:</span><span class="token number">40</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> NORMAL </span><span class="token operator">|</span><span class="token plain"> TRADE_DATE   </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">DATEV2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">DATEV2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">01</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> TRADE_DATE      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> HDD           </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">9999</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">0.000</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> tag</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">location</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">default</span><span class="token plain">: </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">               </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">         </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">588416</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> p20240301000000 </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain"> </span><span class="token number">19</span><span class="token plain">:</span><span class="token number">02</span><span class="token plain">:</span><span class="token number">40</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> NORMAL </span><span class="token operator">|</span><span class="token plain"> TRADE_DATE   </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">DATEV2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">01</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">DATEV2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">01</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> TRADE_DATE      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> HDD           </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">9999</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">0.000</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> tag</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">location</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">default</span><span class="token plain">: </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">               </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">         </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------------+-----------------+----------------+---------------------+--------+--------------+--------------------------------------------------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+----------+------------+-------------------------+-----------+--------------------+--------------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">3</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.09</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As is shown, partitions are automatically created for the imported data, and it doesn&#x27;t create partitions that are beyond the range of the existing data.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="auto-partition-by-list">Auto Partition by LIST<a href="#auto-partition-by-list" class="hash-link" aria-label="Direct link to Auto Partition by LIST" title="Direct link to Auto Partition by LIST">‚Äã</a></h3><p>Auto Partition by LIST is to shard data based on non-time-based dimensions, such as <code>region</code> and <code>department</code>. It fills that gap for Dynamic Partition, which does not support data partitioning by LIST. </p><p>Auto Partition by RANGE provides an optimized partitioning solution based on the time dimension. It is more flexible than Dynamic Partition in terms of parameter configuration. The syntax for it is as follows:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">AUTO </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> LIST </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">partition_col</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is an example of Auto Partition by LIST using <code>city</code> as the partition column:</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; CREATE TABLE `str_table` (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -&gt;     `city` VARCHAR NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -&gt;     ......</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -&gt; )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -&gt; DUPLICATE KEY(`city`)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -&gt; AUTO PARTITION BY LIST (`city`)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -&gt; ()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -&gt; DISTRIBUTED BY HASH(`city`) BUCKETS 10</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -&gt; PROPERTIES (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -&gt;     ......</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -&gt; );</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Query OK, 0 rows affected (0.09 sec)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; insert into str_table values (&quot;Denver&quot;), (&quot;Boston&quot;), (&quot;Los_Angeles&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Query OK, 3 rows affected (0.25 sec)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; show partitions from str_table;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+-------------+-----------------+----------------+---------------------+--------+--------------+-------------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+----------+------------+-------------------------+-----------+--------------------+--------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| PartitionId | PartitionName   | VisibleVersion | VisibleVersionTime  | State  | PartitionKey | Range                                     | DistributionKey | Buckets | ReplicationNum | StorageMedium | CooldownTime        | RemoteStoragePolicy | LastConsistencyCheckTime | DataSize | IsInMemory | ReplicaAllocation       | IsMutable | SyncWithBaseTables | UnsyncTables |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+-------------+-----------------+----------------+---------------------+--------+--------------+-------------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+----------+------------+-------------------------+-----------+--------------------+--------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| 589685      | pDenver7        | 2              | 2024-06-01 20:12:37 | NORMAL | city         | [types: [VARCHAR]; keys: [Denver]; ]      | city            | 10      | 1              | HDD           | 9999-12-31 23:59:59 |                     | NULL                     | 0.000    | false      | tag.location.default: 1 | true      | true               | NULL         |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| 589643      | pLos5fAngeles11 | 2              | 2024-06-01 20:12:37 | NORMAL | city         | [types: [VARCHAR]; keys: [Los_Angeles]; ] | city            | 10      | 1              | HDD           | 9999-12-31 23:59:59 |                     | NULL                     | 0.000    | false      | tag.location.default: 1 | true      | true               | NULL         |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| 589664      | pBoston8        | 2              | 2024-06-01 20:12:37 | NORMAL | city         | [types: [VARCHAR]; keys: [Boston]; ]      | city            | 10      | 1              | HDD           | 9999-12-31 23:59:59 |                     | NULL                     | 0.000    | false      | tag.location.default: 1 | true      | true               | NULL         |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+-------------+-----------------+----------------+---------------------+--------+--------------+-------------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+----------+------------+-------------------------+-----------+--------------------+--------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3 rows in set (0.10 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After inserting data for the cities of Denver, Boston, and Los Angeles, the system automatically created corresponding partitions based on the city names. Previously, this type of custom partitioning could only be achieved through manual DDL statements. This is how Auto Partition by LIST simplifies database maintenance.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tips--notes">Tips &amp; notes<a href="#tips--notes" class="hash-link" aria-label="Direct link to Tips &amp; notes" title="Direct link to Tips &amp; notes">‚Äã</a></h3><p><strong>Manually adjust historical partitions</strong></p><p>For tables that receive both real-time data and occasional historical updates, since Auto Partition does not automatically reclaim historical partitions, we recommend two options:</p><ul><li><p>Use Auto Partition, which will automatically create partitions for the occasional historical data updates. </p></li><li><p>Use Auto Partition and manually create a <code>LESS THAN</code> partition to accommodate the historical updates. This allows for a clearer separation of historical and real-time data, and makes data management easier.</p></li></ul><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> DAILY_TRADE_VALUE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain">     </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_DATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain">    DATEV2 </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Trade Date&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain">     </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_ID</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">40</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Trade ID&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> AUTO </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> RANGE </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">DATE_TRUNC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_DATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;DAY&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain">     </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">pHistory</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> LESS THAN </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;2024-01-01&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_DATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> PROPERTIES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain">     </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;replication_num&quot;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Query OK</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.11</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">into</span><span class="token plain"> DAILY_TRADE_VALUE </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">values</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2015-01-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2020-01-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2024-03-05&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">10000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2024-03-06&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">10001</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Query OK</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">4</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.25</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;label&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;label_96dc3d20c6974f4a_946bc1a674d24733&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;status&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;VISIBLE&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;txnId&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;85092&#x27;</span><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">show</span><span class="token plain"> partitions </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> DAILY_TRADE_VALUE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------------+-----------------+----------------+---------------------+--------+--------------+--------------------------------------------------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+----------+------------+-------------------------+-----------+--------------------+--------------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> PartitionId </span><span class="token operator">|</span><span class="token plain"> PartitionName   </span><span class="token operator">|</span><span class="token plain"> VisibleVersion </span><span class="token operator">|</span><span class="token plain"> VisibleVersionTime  </span><span class="token operator">|</span><span class="token plain"> State  </span><span class="token operator">|</span><span class="token plain"> PartitionKey </span><span class="token operator">|</span><span class="token plain"> Range                                                                          </span><span class="token operator">|</span><span class="token plain"> DistributionKey </span><span class="token operator">|</span><span class="token plain"> Buckets </span><span class="token operator">|</span><span class="token plain"> ReplicationNum </span><span class="token operator">|</span><span class="token plain"> StorageMedium </span><span class="token operator">|</span><span class="token plain"> CooldownTime        </span><span class="token operator">|</span><span class="token plain"> RemoteStoragePolicy </span><span class="token operator">|</span><span class="token plain"> LastConsistencyCheckTime </span><span class="token operator">|</span><span class="token plain"> DataSize </span><span class="token operator">|</span><span class="token plain"> IsInMemory </span><span class="token operator">|</span><span class="token plain"> ReplicaAllocation       </span><span class="token operator">|</span><span class="token plain"> IsMutable </span><span class="token operator">|</span><span class="token plain"> SyncWithBaseTables </span><span class="token operator">|</span><span class="token plain"> UnsyncTables </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------------+-----------------+----------------+---------------------+--------+--------------+--------------------------------------------------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+----------+------------+-------------------------+-----------+--------------------+--------------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">577871</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> pHistory        </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain"> </span><span class="token number">08</span><span class="token plain">:</span><span class="token number">53</span><span class="token plain">:</span><span class="token number">49</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> NORMAL </span><span class="token operator">|</span><span class="token plain"> TRADE_DATE   </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">DATEV2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">0000</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">DATEV2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> TRADE_DATE      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> HDD           </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">9999</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">0.000</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> tag</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">location</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">default</span><span class="token plain">: </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">               </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">         </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">577940</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> p20240305000000 </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain"> </span><span class="token number">08</span><span class="token plain">:</span><span class="token number">53</span><span class="token plain">:</span><span class="token number">49</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> NORMAL </span><span class="token operator">|</span><span class="token plain"> TRADE_DATE   </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">DATEV2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">05</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">DATEV2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">06</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> TRADE_DATE      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> HDD           </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">9999</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">0.000</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> tag</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">location</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">default</span><span class="token plain">: </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">               </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">         </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">577919</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> p20240306000000 </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain"> </span><span class="token number">08</span><span class="token plain">:</span><span class="token number">53</span><span class="token plain">:</span><span class="token number">49</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> NORMAL </span><span class="token operator">|</span><span class="token plain"> TRADE_DATE   </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">DATEV2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">06</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">DATEV2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">07</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> TRADE_DATE      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> HDD           </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">9999</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">0.000</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> tag</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">location</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">default</span><span class="token plain">: </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">               </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">         </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------------+-----------------+----------------+---------------------+--------+--------------+--------------------------------------------------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+----------+------------+-------------------------+-----------+--------------------+--------------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">3</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.10</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>NULL partition</strong></p><p>With Auto Partition by LIST, Doris supports storing NULL values in NULL partitions. For example:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> list_nullable</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain">     </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">str</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> AUTO </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> LIST </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">str</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">str</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS auto</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> PROPERTIES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain">     </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;replication_num&quot;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Query OK</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.10</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">into</span><span class="token plain"> list_nullable </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">values</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;123&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Query OK</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.24</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;label&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;label_f5489769c2f04f0d_bfb65510f9737fff&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;status&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;VISIBLE&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;txnId&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;85089&#x27;</span><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">show</span><span class="token plain"> partitions </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> list_nullable</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------------+---------------+----------------+---------------------+--------+--------------+------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+----------+------------+-------------------------+-----------+--------------------+--------------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> PartitionId </span><span class="token operator">|</span><span class="token plain"> PartitionName </span><span class="token operator">|</span><span class="token plain"> VisibleVersion </span><span class="token operator">|</span><span class="token plain"> VisibleVersionTime  </span><span class="token operator">|</span><span class="token plain"> State  </span><span class="token operator">|</span><span class="token plain"> PartitionKey </span><span class="token operator">|</span><span class="token plain"> Range                              </span><span class="token operator">|</span><span class="token plain"> DistributionKey </span><span class="token operator">|</span><span class="token plain"> Buckets </span><span class="token operator">|</span><span class="token plain"> ReplicationNum </span><span class="token operator">|</span><span class="token plain"> StorageMedium </span><span class="token operator">|</span><span class="token plain"> CooldownTime        </span><span class="token operator">|</span><span class="token plain"> RemoteStoragePolicy </span><span class="token operator">|</span><span class="token plain"> LastConsistencyCheckTime </span><span class="token operator">|</span><span class="token plain"> DataSize </span><span class="token operator">|</span><span class="token plain"> IsInMemory </span><span class="token operator">|</span><span class="token plain"> ReplicaAllocation       </span><span class="token operator">|</span><span class="token plain"> IsMutable </span><span class="token operator">|</span><span class="token plain"> SyncWithBaseTables </span><span class="token operator">|</span><span class="token plain"> UnsyncTables </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------------+---------------+----------------+---------------------+--------+--------------+------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+----------+------------+-------------------------+-----------+--------------------+--------------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">577297</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> pX            </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain"> </span><span class="token number">08</span><span class="token plain">:</span><span class="token number">19</span><span class="token plain">:</span><span class="token number">21</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> NORMAL </span><span class="token operator">|</span><span class="token plain"> str          </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> str             </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> HDD           </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">9999</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">0.000</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> tag</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">location</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">default</span><span class="token plain">: </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">               </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">         </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">577276</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> p0            </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain"> </span><span class="token number">08</span><span class="token plain">:</span><span class="token number">19</span><span class="token plain">:</span><span class="token number">21</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> NORMAL </span><span class="token operator">|</span><span class="token plain"> str          </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">     </span><span class="token operator">|</span><span class="token plain"> str             </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> HDD           </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">9999</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">0.000</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> tag</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">location</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">default</span><span class="token plain">: </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">               </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">         </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">577255</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> p1233         </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain"> </span><span class="token number">08</span><span class="token plain">:</span><span class="token number">19</span><span class="token plain">:</span><span class="token number">21</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> NORMAL </span><span class="token operator">|</span><span class="token plain"> str          </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">123</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">  </span><span class="token operator">|</span><span class="token plain"> str             </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> HDD           </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">9999</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">0.000</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> tag</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">location</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">default</span><span class="token plain">: </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">               </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">         </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------------+---------------+----------------+---------------------+--------+--------------+------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+----------+------------+-------------------------+-----------+--------------------+--------------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">3</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.11</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>However, Auto Partition by RANGE does not support NULL partitions, because the NULL values will be stored in the smallest <code>LESS THAN</code> partition, and it is impossible to reliably determine the appropriate range for it. If Auto Partition were to create a NULL partition with a range of (-INFINITY, MIN_VALUE), there would be a risk of this partition being inadvertently deleted in production, as the MIN_VALUE boundary may not accurately represent the intended business logic.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">‚Äã</a></h3><p>Auto Partition covers most of the use cases of Dynamic Partition, while introducing the benefit of upfront partition rule definition. Once the rules are defined, the bulk of partition creation work is automatically handled by Doris instead of a DBA.</p><p>Before utilizing Auto Partition, it&#x27;s important to understand the relevant limitations:</p><ol><li><p>Auto Partition by LIST supports partitioning based on <strong>multiple columns</strong>, but each automatically created partition only contains one single value, and the partition name cannot exceed 50 characters in length. Note that the partition names follow specific naming conventions, which have particular implications for metadata management. That means not all of the 50-character space is at the user&#x27;s disposal.</p></li><li><p>Auto Partition by RANGE only supports a <strong>single partition column</strong>, which must be of type <strong>DATE</strong> or <strong>DATETIME</strong>.</p></li><li><p>Auto Partition by LIST supports <strong>NULLABLE</strong> partition column and inserting NULL values. Auto Partition by RANGE does not support NULLABLE partition column.</p></li><li><p>It is not recommended to use Auto Partition in conjunction with Dynamic Partition after Apache Doris 2.1.3.</p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="performance-comparison">Performance comparison<a href="#performance-comparison" class="hash-link" aria-label="Direct link to Performance comparison" title="Direct link to Performance comparison">‚Äã</a></h2><p>The main functional differences between Auto Partition and Dynamic Partition lie in partition creation and deletion, supported partition types, and their impact on import performance.</p><p>Dynamic Partition uses fixed threads to periodically create and reclaim partitions. It only supports partitioning by RANGE. In contrast, Auto Partition supports both partitioning by RANGE and by LIST. It automatically creates partitions on-demand based on specific rules during data ingestion, providing a higher level of automation and flexibility.</p><p>Dynamic Partition does not slow down data ingestion speed, while Auto Partition causes certain time overheads because it firstly checks for existing partitions and then creates new ones on demand. We will present the performance test results.</p><p><img loading="lazy" alt="Performance comparison" src="https://cdnd.selectdb.com/assets/images/performance-comparison-8d7f8ccd4c4267e74e3af342ada5d6fe.png" width="1280" height="585" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="auto-partition-ingestion-workflow">Auto Partition: ingestion workflow<a href="#auto-partition-ingestion-workflow" class="hash-link" aria-label="Direct link to Auto Partition: ingestion workflow" title="Direct link to Auto Partition: ingestion workflow">‚Äã</a></h2><p>This part is about how data ingestion is implemented with the Auto Partition mechanism, and we use <a href="https://doris.apache.org/docs/data-operate/import/stream-load-manual" target="_blank" rel="noopener noreferrer">Stream Load</a> as an example. When Doris initiates a data import, one of the Doris Backend nodes takes on the role of the Coordinator. It is responsible for the initial data processing work and then dispatching the data to the appropriate BE nodes, known as the Executors, for execution.</p><p><img loading="lazy" alt="Auto Partition: ingestion workflow" src="https://cdnd.selectdb.com/assets/images/auto-partition-ingestion-workflow-3343361208ec317008cf169ac91398be.png" width="1280" height="731" class="img_ev3q"></p><p>In the final Datasink Node of the Coordinator&#x27;s execution pipeline, the data needs to be routed to the correct partitions, buckets, and Doris Backend node locations before it can be successfully transmitted and stored.</p><p>To enable this data transfer, the Coordinator and Executor nodes establish a communication channels:</p><ul><li><p>The sending end is called the Node Channel.</p></li><li><p>The receiving end is called the Tablets Channel.</p></li></ul><p>This is how Auto Partition comes into play during the process of determining the correct partitions for the data: </p><p><img loading="lazy" alt="Auto Partition: ingestion workflow" src="https://cdnd.selectdb.com/assets/images/auto-partition-ingestion-workflow-2-7e25e7fd75a37f9da1de58c0f2c46f11.png" width="1280" height="348" class="img_ev3q"></p><p>Previously, without Auto Partition, when a table does not have the required partition, the behavior in Doris is for the BE nodes to accumulate errors until a <code>DATA_QUALITY_ERROR</code> is reported. Now, with Auto Partition enabled, a request will be initiated to the Doris Frontend to create the necessary partition on-the-fly. After the partition creation transaction is completed, the Doris Frontend responds to the Coordinator, which then opens the corresponding communication channels (Node Channel and Tablets Channel) to continue the data ingestion process. This is a seamless experience for users. </p><p>In a real-world cluster environment, the time spent by the Coordinator waiting for the Doris Frontend to complete partition creation can incur large overheads. This is due to the inherent latency of Thrift RPC calls, as well as lock contention on the Frontend under high load conditions.</p><p>To improve the data ingestion efficiency in Auto Partition, Doris has implemented batching to largely reduce the number of RPC calls made to the FE. This brings a notable performance enhancement for data write operations.</p><p>Note that when the FE Master completes the partition creation transaction, the new partition becomes immediately visible. However, if the import process ultimately fails or is canceled, the created partitions are not automatically reclaimed.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="auto-partition-performance">Auto Partition performance<a href="#auto-partition-performance" class="hash-link" aria-label="Direct link to Auto Partition performance" title="Direct link to Auto Partition performance">‚Äã</a></h2><p>We tested the performance and stability of Auto Partition in Doris, covering different use cases:</p><p><strong>Case 1</strong>: 1 Frontend + 3 Backend; 6 randomly generated datasets, each having 100 million rows and 2,000 partitions; ingested the 6 datasets concurrently into 6 tables</p><ul><li><p><strong>Objective</strong>: Evaluate the performance of Auto Partition under high pressure and check for any performance degradation.</p></li><li><p><strong>Results</strong>: Auto Partition brings an <strong>average performance loss less than 5%</strong>, with all import transactions running stably.</p></li></ul><p><img loading="lazy" alt="Auto Partition performance" src="https://cdnd.selectdb.com/assets/images/auto-partition-performance-4739a5a3e97dfe4b88cf2d94b0542c14.png" width="1280" height="581" class="img_ev3q"></p><p><strong>Case 2</strong>: 1 Frontend + 3 Backend; ingesting 100 rows per second from Flink by Routine Load; testing with 1, 10, and 20 concurrent transactions (tables), respectively</p><ul><li><p><strong>Objective</strong>: Identify any potential  or data backlog issues that could arise with Auto Partition under different concurrency levels.</p></li><li><p><strong>Results</strong>: With or without Auto Partition enabled, the data ingestion was successful without any backpressure issues across all the concurrency levels tested, even at 20 concurrent transactions when the CPU utilization reached close to 100%.</p></li></ul><p><img loading="lazy" alt="Auto Partition performance" src="https://cdnd.selectdb.com/assets/images/auto-partition-performance-2-8a3981c9825d5ca4e6b4e3f5aec38708.png" width="1280" height="557" class="img_ev3q"></p><p>To conclude the results of these tests, the impact of enabling Auto Partition on data ingestion performance is minimal.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion-and-future-plans">Conclusion and future plans<a href="#conclusion-and-future-plans" class="hash-link" aria-label="Direct link to Conclusion and future plans" title="Direct link to Conclusion and future plans">‚Äã</a></h2><p>Auto Partition has simplified DDL and partition management since Apache Doris 2.1.0. It is useful in large-scale data processing and makes it easy for users to migrate from other database systems to Apache Doris. </p><p>Moreover, we are committed to expanding the capabilities of Auto Partition to support more complex data types.</p><p>Plans for Auto Partition by RANGE:</p><ul><li><p>Support numeric values;</p></li><li><p>Allowing users to specify the left and right boundaries of the partition range.</p></li></ul><p>Plans for Auto Partition by LIST:</p><ul><li>Allow merging multiple values into the same partition based on specific rules.</li></ul><p>Join <a href="https://join.slack.com/t/apachedoriscommunity/shared_invite/zt-2gmq5o30h-455W226d79zP3L96ZhXIoQ" target="_blank" rel="noopener noreferrer">Apache Doris open-source community</a> for more information and further guidance.</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><div class="text-center mb-4"><a class="text-[#8592A6] cursor-pointer hover:no-underline" href="/blog">Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class="s-tags"><span class="s-tag">Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:text-[2.5rem] text-center" itemprop="headline"><a itemprop="url" href="/blog/evolution-of-the-apache-doris-execution-engine">Steps to industry-leading query speed: evolution of the Apache Doris execution engine</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class="authors"><span class="s-author text-black">Apache Doris</span></span><time datetime="2024-06-18T00:00:00.000Z" itemprop="datePublished" class="text-black ml-4">June 18, 2024</time></div></header><div class="markdown" itemprop="articleBody"><p>What makes a modern database system? The three key modules are query optimizer, execution engine, and storage engine. Among them, the role of execution engine to the DBMS is like the chef to a restaurant. This article focuses on the execution engine of the <a href="https://doris.apache.org" target="_blank" rel="noopener noreferrer">Apache Doris</a> data warehouse, explaining the secret to its high performance.</p><p>To illustrate the role of the execution engine, let&#x27;s follow the execution process of an SQL statement: </p><ul><li>Upon receiving an SQL query, the query optimizer performs syntax/lexical analysis and generates the optimal execution plan based on the cost model and optimization rules.</li></ul><ul><li>The execution engine then schedules the plan to the nodes, which operate on data in the underlying storage engine and then return the query results.</li></ul><p>The execution engine performs operations like data reading, filtering, sorting, and aggregation. The efficiency of these steps determines query performance and resource utilization. That&#x27;s why different execution models bring distinction in query efficiency.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="volcano-model">Volcano Model<a href="#volcano-model" class="hash-link" aria-label="Direct link to Volcano Model" title="Direct link to Volcano Model">‚Äã</a></h2><p>The Volcano Model (originally known as the Iterator Model) predominates in analytical databases, followed by the Materialization Model and Vectorized Model. In a Volcano Model, each operation is abstracted as an operator, so the entire SQL query is an operator tree. During query execution, the tree is traversed top-down by calling the <code>next()</code> interface, and data is pulled and processed from the bottom up. This is called a <strong>pull-based</strong> execution model. </p><p>The Volcano Model is flexible, scalable, and easy to implement and optimize. It underpins Apache Doris before version 2.1.0. When a user initiates an SQL query, Doris parses the query, generates a distributed execution plan, and dispatches tasks to the nodes for execution. Each individual task is an <strong>instance</strong>. Take a simple query as an example: </p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">select age, sex from employees where age &gt; 30</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="Volcano Model" src="https://cdnd.selectdb.com/assets/images/doris-volcano-model-bf7cd6bf0fe5c369d9ae4ac0efa617d4.png" width="1280" height="874" class="img_ev3q"></p><p>In an instance, data flows between operators are propelled by the <code>next()</code> method. If the <code>next()</code> method of an operator is called, it will first call the <code>next()</code> of its child operator, obtain data from it, and then process the data to produce output. </p><p><code>next()</code> is a synchronous method. In other words, the current operator will be blocked if its child operator does not provide data for it. In this case, the <code>next()</code> method of the root operator needs to be called in a loop until all data is processed, which is when the instance finishes its computation.</p><p>Such execution mechanism faces a few bottlenecks in single-node, multi-core use cases:</p><ul><li><p><strong>Thread blocking</strong>: In a fixed-size thread pool, if an instance occupies a thread and it is blocked, that will easily cause a deadlock when there are a large number of instances requesting execution simultaneously. This is especially the case when the current instance is dependent on other instances. Additionally, if a node is running more instances than the number of CPU cores it has, the system scheduling mechanism will be heavily relied upon and a huge context switching overhead can be produced. In a colocation scenario, this will lead to an even larger thread switching overhead.</p></li><li><p><strong>CPU contention</strong>: The threads might compete for CPU resources so queries of different sizes and between different tenants might interfere with each other.</p></li><li><p><strong>Underutilization of the multi-core computing capabilities</strong>: Execution concurrency relies heavily on data distribution. Specifically, the number of instances running on a node is limited by the number of data buckets on that node. In this case, it&#x27;s important to set an appropriate number of buckets. If you shard the data into too many buckets, that will become a burden for the system and bring unnecessary overheads; if the buckets are too few, you will not be able to utilize your CPU cores to the fullest. However, in a production environment, it is not always easy to estimate the proper number of buckets you need, thus performance loss. </p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pipeline-execution-engine">Pipeline Execution Engine<a href="#pipeline-execution-engine" class="hash-link" aria-label="Direct link to Pipeline Execution Engine" title="Direct link to Pipeline Execution Engine">‚Äã</a></h2><p>Based on the known issues of Volcano Model, we&#x27;ve replaced it with the Pipeline Execution Engine since Apache Doris 2.0.0. </p><p>As the name suggests, the Pipeline Execution Engine breaks down the execution plan into pipeline tasks, and schedules these pipeline tasks into a thread pool in a time-sharing manner. If a pipeline task is blocked, it will be put on hold to release the thread it is occupying. Meanwhile, it supports various scheduling strategies, meaning that you can allocate CPU resources to different queries and tenants more flexibly. </p><p>Additionally, the Pipeline Execution Engine pools together data within data buckets, so the number of running instances is no longer capped by the number of buckets. This not only enhances Apache Doris&#x27; utilization of multi-core systems, but also improves system performance and stability by avoiding frequent thread creation and deletion.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example">Example<a href="#example" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example">‚Äã</a></h3><p>This is the execution plan of a join query. It includes two instances:</p><p><img loading="lazy" alt="Pipeline Execution Engine" src="https://cdnd.selectdb.com/assets/images/doris-pipeline-execution-engine-0f462e7876f79b16a3dd1cb21daa8444.png" width="1280" height="678" class="img_ev3q"></p><p>As illustrated, the Probe operation can only be executed after the hash table is built, while the Build operation is reliant on the computation results of the Exchange operator. Each of the two instances is divided into two pipeline tasks as such. Then these tasks will be scheduled in the &quot;ready&quot; queue of the thread pool. Following the specified strategies, the threads obtain the tasks to process. In a pipeline task, after one data block is finished, if the relevant data is ready and its runtime stays within the maximum allowed duration, the thread will continue to compute the next data block. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="design--implementation">Design &amp; implementation<a href="#design--implementation" class="hash-link" aria-label="Direct link to Design &amp; implementation" title="Direct link to Design &amp; implementation">‚Äã</a></h3><p><strong>Avoid thread blocking</strong></p><p>As is mentioned earlier, the Volcano Model is faced with a few bottlenecks: </p><ol><li>If too many threads are blocked, the thread pool will be saturated and unable to respond to subsequent queries.</li></ol><ol start="2"><li>Thread scheduling is entirely managed by the operating system, without any user-level control or customization.</li></ol><p>How does Pipeline Execution Engine avoid such issues?</p><ol><li>We fix the size of the thread pool to match the CPU core count. Then we split all operators that are prone to blocking into pipeline tasks. For example, we use individual threads for disk I/O operations and RPC operations.</li></ol><ol start="2"><li>We design a user-space polling scheduler. It continuously checks the state of all executable pipeline tasks and assigns executable tasks to threads. With this in place, the operating system doesn&#x27;t have to frequently switch threads, thus less overheads. It also allows customized scheduling strategies, such as assigning priorities to tasks.</li></ol><p><img loading="lazy" alt="Design &amp;amp; implementation" src="https://cdnd.selectdb.com/assets/images/pipeline-design-implementation-21c2bccd9d7d386133decbf17c2040fb.png" width="1280" height="587" class="img_ev3q"></p><p><strong>Parallelization</strong></p><p>Before version 2.0, Apache Doris requires users to set a concurrency parameter for the execution engine (<code>parallel_fragment_exec_instance_num</code>), which does not dynamically change based on the workloads. Therefore, it is a burden for users to figure out an appropriate concurrency level that leads to optimal performance.</p><p>What&#x27;s the industry&#x27;s solution to this?</p><p>Presto&#x27;s idea is to shuffle the data into a reasonable number of partitions during execution, which requires minimal concurrency control from users. On the other hand, DuckDB introduces an extra synchronization mechanism instead of shuffling. We decide to follow Presto&#x27;s track of Presto because the DuckDB solution inevitably involves the use of locks, which works against our purpose of avoiding blocking.</p><p>Unlike Presto, Apache Doris doesn&#x27;t need an extra Local Exchange mechanism to shards the data into an appropriate number of partitions. With its massively parallel processing (MPP) architecture, Doris already does so during shuffling. (In Presto&#x27;s case, it re-partitions the data via Local Exchange for higher execution concurrency. For example, in hash aggregation, Doris further shards the data based on the aggregation key in order to fully utilize the CPU cores. Also, this can downsize the hash table that each execution thread has to build.)</p><p><img loading="lazy" alt="Design &amp;amp; implementation" src="https://cdnd.selectdb.com/assets/images/pipeline-design-implementation-2-a687d57ca081c1170f31ab0145d5caff.png" width="1280" height="686" class="img_ev3q"></p><p>Based on the MPP architecture, we only need two improvements before we achieve what we want in Doris:</p><ul><li><strong>Increase the concurrency level during shuffling</strong>. For this, we only need to have the frontend (FE) perceive the backend (BE) environment and then set a reasonable number of partitions.</li></ul><ul><li><strong>Implement concurrent execution after data reading by the scan layer</strong>. To do this, we need a logical restructuring of the scan layer to decouple the threads from the number of data tablets. This is a pooling process. We pool the data read by scanner threads, so it can be fetched by multiple pipeline tasks directly. </li></ul><p><img loading="lazy" alt="Design &amp;amp; implementation" src="https://cdnd.selectdb.com/assets/images/pipleine-design-implementation-3-fbbbb04f5de750bad1fd28694ca3b1d7.jpeg" width="1280" height="670" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pipelinex">PipelineX<a href="#pipelinex" class="hash-link" aria-label="Direct link to PipelineX" title="Direct link to PipelineX">‚Äã</a></h2><p>Introduced in Apache Doris 2.0.0, the pipeline execution engine has been improving query performance and stability under hybrid workload scenarios (queries of different sizes and from different tenants). In <a href="https://doris.apache.org/blog/release-note-2.1.0" target="_blank" rel="noopener noreferrer">version 2.1.0</a>, we&#x27;ve tackled the known issues and upgraded this from an experimental feature to a robust and reliable solution, which is what we call <a href="https://doris.apache.org/docs/query/pipeline/pipeline-x-execution-engine" target="_blank" rel="noopener noreferrer">PipelineX</a>.</p><p>PipelineX has provided answers to the following issues that used to challenge the Pipeline Execution Engine:</p><ul><li><strong>Limited execution concurrency</strong></li></ul><ul><li><strong>High execution overhead</strong></li></ul><ul><li><strong>High scheduling overhead</strong></li></ul><ul><li><strong>Poor readability of operator profile</strong></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="execution-concurrency">Execution concurrency<a href="#execution-concurrency" class="hash-link" aria-label="Direct link to Execution concurrency" title="Direct link to Execution concurrency">‚Äã</a></h3><p>The Pipeline Execution Engine remains under the restriction of the static concurrency parameter at FE and the tablet count at the storage layer, making itself unable to capitalize on the full computing resources. Plus, it is easily affected by data skew. </p><p>For example, suppose that Table A contains 100 million rows but it has only 1 tablet, which means it is not sharded enough, let&#x27;s see what can happen when you perform an aggregation query on it: </p><div class="language-C++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-C++ codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"> SELECT COUNT(*) FROM A GROUP BY A.COL_1;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>During query execution, the query plan is divided into two <strong>fragments</strong>. Each fragment, consisting of multiple operators, is dispatched by frontend (FE) to backend (BE). The BE starts threads to execute the fragments concurrently.</p><p><img loading="lazy" alt="Pipeline Execution concurrency" src="https://cdnd.selectdb.com/assets/images/doris-pipelinex-4e2f29eb887b9b2dc157ab32aea356b4.png" width="1280" height="707" class="img_ev3q"></p><p>Now, let&#x27;s focus on Fragment 0 for further elaboration. Because there is only one tablet, Fragment 0 can only be executed by one thread. That means aggregation of 100 million rows by one single thread. If you have 16 CPU cores, ideally, the system can allocate 8 threads to execute Fragment 0. In this case, there is a concurrency disparity of 8 to 1. This is how <strong>the number of tablets restricts execution concurrency</strong> and also why we introduce the idea of <strong>Local Shuffle mechanism to remove that restriction</strong> in Apache Doris 2.1.0. So this is how it works in PipelineX: </p><ul><li>The threads execute their own pipeline tasks, but the pipeline tasks only maintain their runtime state (known as <strong>Local State</strong>), while the information that shared across all pipeline tasks (known as <strong>Global State</strong>) is managed by one pipeline object.</li></ul><ul><li>On a single BE, the Local Shuffle mechanism is responsible for data distribution and data balancing across pipeline tasks.</li></ul><p><img loading="lazy" alt="Pipeline Execution concurrency" src="https://cdnd.selectdb.com/assets/images/doris-pipelinex-1-6f7365d5417f254f369c691827d034eb.png" width="1220" height="1280" class="img_ev3q"></p><p>Apart from decoupling execution concurrency from tablet count, Local Shuffle can avoid performance loss due to data skew. Again, we will explain with the foregoing example.</p><p>This time, we shard Table A into two tablets instead of one, but the data is not evenly distributed. Tablet 1 and Tablet 3 hold 10 million and 90 million rows, respectively. The Pipeline Execution Engine and PipelineX Execution Engine respond differently to such data skew:</p><ul><li><strong>Pipeline Execution Engine</strong>: Thread 1 and Thread 2 executes Fragment 1 concurrently. The latter takes 9 times as long as Thread 1 because of the different data sizes they deal with.</li></ul><ul><li><strong>PipelineX Execution Engine</strong>: With Local Shuffle, data is distributed evenly to the two threads, so they take almost equal time to finish.</li></ul><p><img loading="lazy" alt="Pipeline vs PipelineX execution engine" src="https://cdnd.selectdb.com/assets/images/doris-pipelinex-3-4be6cbf01667eb21a88ce0914e3a404a.png" width="1280" height="972" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="execution-overhead">Execution overhead<a href="#execution-overhead" class="hash-link" aria-label="Direct link to Execution overhead" title="Direct link to Execution overhead">‚Äã</a></h3><p>Under the Pipeline Execution Engine, because the expressions of different instances are individual, each instance is initialized individually. However, since the initialization parameters of instances share a lot in common, we can reuse the shared states to reduce execution overheads. This is what PipelineX does: it initializes the Global State at a time, and the Local State sequentially.</p><p><img loading="lazy" alt="Execution overhead" src="https://cdnd.selectdb.com/assets/images/pipeline-execution-overhead-f3d56f790b260c95154e1039faf202d9.png" width="1280" height="625" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="scheduling-overhead">Scheduling overhead<a href="#scheduling-overhead" class="hash-link" aria-label="Direct link to Scheduling overhead" title="Direct link to Scheduling overhead">‚Äã</a></h3><p>In the Pipeline Execution Engine, the blocked tasks are put into a blocked queue, where a dedicated thread takes polls and moves the executable tasks over to the runnable queue. This dedicated scheduling thread consumes a CPU core, and incurs overheads that can be particularly noticeable on systems with limited computing resources.</p><p><strong>As a better solution, PipelineX encapsulates the blocking conditions as dependencies, and the task status (blocked or runnable) will be triggered to change by event notifications.</strong> Specifically, when RPC data arrives, the relevant task will be considered as ready by the ExchangeSourceOperator and then moved to the runnable queue.</p><p><img loading="lazy" alt="Scheduling overhead" src="https://cdnd.selectdb.com/assets/images/pipeline-scheduling-overhead-8fc879065b8ec7b550448f12d8cbad7d.png" width="1280" height="740" class="img_ev3q"></p><p>That means <strong>PipelineX implements event-driven scheduling</strong>. A query execution plan can be depicted as a DAG, where the pipeline tasks are abstracted as nodes and the dependencies as edges. Whether a pipeline task gets executed depends on whether all its associated dependencies have satisfied the requisite conditions.</p><p><img loading="lazy" alt="Scheduling overhead" src="https://cdnd.selectdb.com/assets/images/pipeline-scheduling-overhead-2-2141c79fe8435bc10d6f4e933e009ef4.jpeg" width="1280" height="723" class="img_ev3q"></p><p>For simplicity of illustration, the above DAG only shows the dependencies between the upstream and downstream pipeline tasks. In fact, all blocking conditions are abstracted as dependencies. The complete execution workflow of a pipeline task is as follows:</p><p><img loading="lazy" alt="Scheduling overhead" src="https://cdnd.selectdb.com/assets/images/pipeline-scheduling-overhead-3-7a77f777afc96de866410fd9624ce605.png" width="1280" height="629" class="img_ev3q"></p><p>In event-driven execution, a pipeline task will only be executed after all its dependencies satisfy the conditions; otherwise, it will be added to the blocked queue. When an external event arrives, all blocked tasks will be re-evaluated to see if they&#x27;re runnable.</p><p>The event-driven design of PipelineX eliminates the need for a polling thread and thus the consequential performance loss under high cluster loads. Moreover, the encapsulation of dependencies enables a more flexible scheduling framework, making it easier to spill data to disks.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="operator-profile">Operator profile<a href="#operator-profile" class="hash-link" aria-label="Direct link to Operator profile" title="Direct link to Operator profile">‚Äã</a></h3><p>PipelineX has reorganized the metrics in the operator profiles, adding new ones and obsoleting irrelevant ones. Besides, with the dependencies encapsulated, we monitor how long the dependencies take to get ready by the metric <code>WaitForDependency</code>, so the profile can provide a clear picture of the time spent in each step. These are two examples:</p><ul><li><p><strong>Scan Operator</strong>: The total execution time of <code>OLAP_SCAN_OPERATOR</code> is 457.750ms, including that spent in data reading by the scanner (436.883ms) and that in actual execution.</p><div class="language-C++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-C++ codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">OLAP_SCAN_OPERATOR  (id=4.  table  name  =  Z03_DI_MID):</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -  ExecTime:  457.750ms</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -  WaitForDependency[OLAP_SCAN_OPERATOR_DEPENDENCY]Time:  436.883ms</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><strong>Exchange Source Operator</strong>: The execution time of <code>EXCHANGE_OPERATOR</code> is 86.691us. The time spent waiting for data from upstream is 409.256us.</p><div class="language-C++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-C++ codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">EXCHANGE_OPERATOR  (id=3):</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -  ExecTime:  86.691us</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -  WaitForDependencyTime:  0ns</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        -  WaitForData0:  409.256us</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="whats-next">What&#x27;s next<a href="#whats-next" class="hash-link" aria-label="Direct link to What&#x27;s next" title="Direct link to What&#x27;s next">‚Äã</a></h2><p>From the Volcano Model to the Pipeline Execution Engine, Apache Doris 2.0.0 has overcome the deadlocks under high cluster load and greatly increased CPU utilization. Now, from the Pipeline Execution Engine to PipelineX, Apache Doris 2.1.0 is more production-friendly as it has ironed out the kinks in concurrency, overheads, and operator profile. </p><p>What&#x27;s next in our roadmap is to support spilling data to disk in PipelineX to further improve query speed and system reliability. We also plan to advance further in terms of automation, such as self-adaptive concurrency and auto execution plan optimization, accompanied by NUMA technologies to harvest better performance from hardware resources. </p><p>If you want to talk to the amazing Doris developers who lead these changes, you are more than welcome to join the <a href="https://join.slack.com/t/apachedoriscommunity/shared_invite/zt-2gmq5o30h-455W226d79zP3L96ZhXIoQ" target="_blank" rel="noopener noreferrer">Apache Doris</a> community.</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><div class="text-center mb-4"><a class="text-[#8592A6] cursor-pointer hover:no-underline" href="/blog">Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class="s-tags"><span class="s-tag">Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:text-[2.5rem] text-center" itemprop="headline"><a itemprop="url" href="/blog/job-scheduler-for-task-automation">Another lifesaver for data engineers: Apache Doris Job Scheduler for task automation</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class="authors"><span class="s-author text-black">Apache Doris</span></span><time datetime="2024-06-06T00:00:00.000Z" itemprop="datePublished" class="text-black ml-4">June 6, 2024</time></div></header><div class="markdown" itemprop="articleBody"><p>Job scheduling is an important part of data management as it enables regular data updates and cleanups. In a data platform, it is often undertaken by workflow orchestration tools like <a href="https://airflow.apache.org" target="_blank" rel="noopener noreferrer">Apache Airflow</a> and <a href="https://dolphinscheduler.apache.org/en-us" target="_blank" rel="noopener noreferrer">Apache Dolphinscheduler</a>. However, adding another component to the data architecture also means investing extra resources for management and maintenance. That&#x27;s why <a href="https://doris.apache.org/blog/release-note-2.1.0" target="_blank" rel="noopener noreferrer">Apache Doris 2.1.0</a> introduces a built-in Job Scheduler. It is strategically more tailored to Apache Doris, and brings higher scheduling flexibility and architectural simplicity. </p><p>The Doris Job Scheduler triggers the pre-defined operations at specific time points or intervals, thus allowing for efficient and reliable task automation. Its key capabilities include: </p><ul><li><p><strong>Efficiency</strong>: It adopts the TimeWheel algorithm to ensure that the triggering of tasks is precise to the second.</p></li><li><p><strong>Flexibility</strong>: It supports both one-time jobs and regular jobs. For the latter, users can define the start/end time, and intervals of minutes, hours, days, or weeks.</p></li><li><p><strong>Execution thread pool and processing queue</strong>: It is supported by a Disruptor-based single-producer, multi-consumer model to avoid task execution overload.</p></li><li><p><strong>Traceability</strong>: It keeps track of the latest task execution records (configurable), which are queryable by a simple command. </p></li><li><p><strong>Availability</strong>: Like Apache Doris itself, the Doris Job Scheduler is easily recoverable and highly available.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="syntax--examples">Syntax &amp; examples<a href="#syntax--examples" class="hash-link" aria-label="Direct link to Syntax &amp; examples" title="Direct link to Syntax &amp; examples">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="syntax-description">Syntax description<a href="#syntax-description" class="hash-link" aria-label="Direct link to Syntax description" title="Direct link to Syntax description">‚Äã</a></h3><p>A valid job statement consists of the following elements:</p><ul><li><p><code>CREATE JOB</code>: Specifies the job name as a unique identifier.</p></li><li><p>The <code>ON SCHEDULE</code> clause: Specifies the type, trigger time, and frequency of the job.</p><ul><li><p><code>AT timestamp</code>: This is used to specify a one-time job. <code>AT CURRENT_TIMESTAMP</code> means that the job will run immediately upon creation. </p></li><li><p><code>EVERY</code>: This is used to specify a regular job. You can define the execution frequency of the job. The interval can be measured in weeks, days, hours, and minutes.</p><ul><li>The <code>EVERY</code> clause supports an optional <code>STARTS</code> clause  with a timestamp to define the start time of the recurring schedule. <code>CURRENT_TIMESTAMP</code> can be used. It also supports an optional <code>ENDS</code> clause to specify the end time for the job.</li></ul></li></ul></li><li><p>The <code>DO</code> clause defines the action to be performed when the job is executed. At this time, the only supported operation is INSERT.</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    JOB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    job_name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ON</span><span class="token plain"> SCHEDULE schedule</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;string&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DO</span><span class="token plain"> execute_sql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">schedule: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AT </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">timestamp</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token operator">|</span><span class="token plain"> EVERY </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">interval</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">STARTS </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">timestamp</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">ENDS </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">timestamp</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">interval</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    quantity { WEEK </span><span class="token operator">|</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DAY</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HOUR</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">MINUTE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Example:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> JOB my_job </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ON</span><span class="token plain"> SCHEDULE EVERY </span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">MINUTE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DO</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INTO</span><span class="token plain"> db1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">tbl1 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> db2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">tbl2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above statement creates a job named <code>my_job</code>, which is to load data from <code>db2.tbl2</code> to <code>db1.tbl1</code> every minute.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="more-examples">More examples<a href="#more-examples" class="hash-link" aria-label="Direct link to More examples" title="Direct link to More examples">‚Äã</a></h3><p><strong>Create a one-time job</strong>: Load data from <code>db2.tbl2</code> to <code>db1.tbl1</code> at 2025-01-01 00:00:00.</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> JOB my_job </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ON</span><span class="token plain"> SCHEDULE AT </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2025-01-01 00:00:00&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DO</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INTO</span><span class="token plain"> db1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">tbl1 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> db2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">tbl2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Create a regular job without specifying the end time</strong>: Load data from <code>db2.tbl2</code> to <code>db1.tbl1</code> once a day starting from 2025-01-01 00:00:00.</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> JOB my_job </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ON</span><span class="token plain"> SCHEDULE EVERY </span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DAY</span><span class="token plain"> STARTS </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2025-01-01 00:00:00&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DO</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INTO</span><span class="token plain"> db1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">tbl1 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> db2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">tbl2 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain">  create_time </span><span class="token operator">&gt;=</span><span class="token plain">  days_add</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token function" style="color:rgb(80, 250, 123)">now</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Create a regular job within a specified period</strong>: Load data from <code>db2.tbl2</code> to <code>db1.tbl1</code> once a day, beginning at 2025-01-01 00:00:00 and finishing at 2026-01-01 00:10:00.</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> JOB my_job </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ON</span><span class="token plain"> SCHEDULER EVERY </span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DAY</span><span class="token plain"> STARTS </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2025-01-01 00:00:00&#x27;</span><span class="token plain"> ENDS </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2026-01-01 00:10:00&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DO</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INTO</span><span class="token plain"> db1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">tbl1 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> db2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">tbl2 create_time </span><span class="token operator">&gt;=</span><span class="token plain">  days_add</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token function" style="color:rgb(80, 250, 123)">now</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Asynchronous execution</strong>: Because jobs are executed in an asynchronous manner in Doris. Tasks that require asynchronous execution, such as <code>insert into select</code>, can be implemented by a job. </p><p>For example, to asynchronously execute data loading from <code>db2.tbl2</code> to <code>db1.tbl1</code>, simply create a one-time job for it and schedule it at <code>current_timestamp</code>.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE </span><span class="token environment constant" style="color:rgb(189, 147, 249)">JOB</span><span class="token plain"> my_job ON SCHEDULE AT current_timestamp DO INSERT INTO db1.tbl1 SELECT * FROM db2.tbl2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="auto-data-synchronization">Auto data synchronization<a href="#auto-data-synchronization" class="hash-link" aria-label="Direct link to Auto data synchronization" title="Direct link to Auto data synchronization">‚Äã</a></h2><p>The combination of the Job Scheduler and the <a href="https://doris.apache.org/docs/lakehouse/lakehouse-overview#multi-catalog" target="_blank" rel="noopener noreferrer">Multi-Catalog</a> feature of Apache Doris is an efficient way to implement regular data synchronization across data sources.</p><p>This is useful in many cases, such as for an e-commerce user who regularly needs to load business data from MySQL to Doris for analysis.</p><p><strong>Example</strong>: To filter consumers by total consumption amount, last visit time, sex, and city in the table below, and import the query results to Doris regularly.</p><p><img loading="lazy" alt="Auto data synchronization" src="https://cdnd.selectdb.com/assets/images/auto-data-synchronization-e697db722413038ee542074082391276.png" width="1280" height="463" class="img_ev3q"></p><p><strong>Step 1</strong>: Create a table in Doris</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">IF</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">EXISTS</span><span class="token plain"> user_activity</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> LARGEINT </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;User ID&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">date</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DATE</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Time of data import&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">city</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;User city&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">age</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SMALLINT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;User age&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">sex</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TINYINT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;User sex&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">last_visit_date</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DATETIME</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">REPLACE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;1970-01-01 00:00:00&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Time of user&#x27;s last visit&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">cost</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain"> SUM </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;User&#x27;s total consumption amount&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">max_dwell_time</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INT</span><span class="token plain"> MAX </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Maximum dwell time of user&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">min_dwell_time</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INT</span><span class="token plain"> MIN </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;99999&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Minimum dwell time of user&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">AGGREGATE </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">date</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">city</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">age</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">sex</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">&quot;replication_allocation&quot;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;tag.location.default: 1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Step 2</strong>: Create a catalog in Doris to map to the data in MySQL</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE CATALOG activity PROPERTIES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;type&quot;</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;jdbc&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;user&quot;</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;root&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;jdbc_url&quot;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;jdbc:mysql://127.0.0.1:9734/user?useSSL=false&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;driver_url&quot;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;mysql-connector-java-5.1.49.jar&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;driver_class&quot;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;com.mysql.jdbc.Driver&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Step 3</strong>: Ingest data from MySQL to Doris. Leverage the catalog mechanism and the Insert Into method for full data ingestion. (We recommend that such operations be executed during low-traffic hours to minimize potential service disruptions.)</p><ul><li><p><strong>One-time job</strong>: Schedule a one-time full-scale data loading that starts at 2024-8-10 03:00:00.</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> JOB one_time_load_job</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ON</span><span class="token plain"> SCHEDULE </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">AT </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2024-8-10 03:00:00&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INTO</span><span class="token plain"> user_activity </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> activity</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">user</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">activity </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><strong>Regular job</strong>: Create a regular job to update data periodically.</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> JOB schedule_load</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ON</span><span class="token plain"> SCHEDULE EVERY </span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DAY</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INTO</span><span class="token plain"> user_activity </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> activity</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">user</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">activity </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> create_time </span><span class="token operator">&gt;=</span><span class="token plain">  days_add</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token function" style="color:rgb(80, 250, 123)">now</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="technical-design--implementation">Technical design &amp; implementation<a href="#technical-design--implementation" class="hash-link" aria-label="Direct link to Technical design &amp; implementation" title="Direct link to Technical design &amp; implementation">‚Äã</a></h2><p>Efficient scheduling often comes at the cost of significant resource consumption, and high-precision scheduling is even more resource-intensive. To implement job scheduling, some people rely on the built-in scheduling capabilities of Java, while others employ job scheduling libraries. But what if we want higher precision and lower memory usage than these solutions can reach? For that, the Doris makers combine the TimingWheel algorithm with the Disruptor framework to achieve second-level job scheduling.</p><p><img loading="lazy" alt="Technical design &amp;amp; implementation" src="https://cdnd.selectdb.com/assets/images/technical-design-and-implementation-86d5f8b242e698232e33c6c1f6e25c1e.png" width="1280" height="1000" class="img_ev3q"></p><p>To implement the TimingWheel algorithm, we leverage the HashedWheelTimer in Netty. The Job Manager puts tasks every 10 minutes (by default) in the TimeWheel for scheduling. In order to ensure efficient task triggering and avoid high resource usage, we adopt a Disruptor-based single-producer, multi-consumer model. The TimeWheel only triggers tasks but does not execute jobs directly. Tasks that need to be triggered upon expiration will be put into a Dispatch thread and distributed to an appropriate execution thread pool. Tasks that need to be executed immediately will be directly submitted to the corresponding execution thread pool.</p><p>This is how we improve processing efficiency by reducing unnecessary traversal: For one-time tasks, their definition will be removed after execution. For recurring tasks, the system events in the TimeWheel will periodically fetch the next round of execution tasks. This helps to avoid the accumulation of tasks in a single bucket.</p><p>In addition, for transactional tasks, the Job Scheduler can ensure data consistency and integrity by the transaction association and transaction callback mechanisms. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="applicable-scenarios">Applicable scenarios<a href="#applicable-scenarios" class="hash-link" aria-label="Direct link to Applicable scenarios" title="Direct link to Applicable scenarios">‚Äã</a></h2><p>The Doris Job Scheduler is a Swiss Army Knife. It is not only useful in ETL and data lake analytics as we mentioned, but also critical for the implementation of <a href="https://doris.apache.org/docs/query/view-materialized-view/async-materialized-view" target="_blank" rel="noopener noreferrer">asynchronous materialized views</a>. An asynchronous materialized view is a pre-computed result set. Unlike normal materialized views, it can be built on multiple tables. Thus, as you can imagine, changes in any of the source tables will lead to the need for updates in the asynchronous materialized view. That&#x27;s why we apply the job scheduling mechanism for periodic data refreshing in asynchronous materialized views, which is low-maintenance and also ensures data consistency.</p><p>Where are we going with the Doris Job Scheduler? The <a href="https://join.slack.com/t/apachedoriscommunity/shared_invite/zt-2gmq5o30h-455W226d79zP3L96ZhXIoQ" target="_blank" rel="noopener noreferrer">Apache Doris developer community</a> is looking at:</p><ul><li><p>Displaying the distribution of tasks executed in different time slots on the WebUI.</p></li><li><p>DAG jobs. This will allow data warehouse task orchestration within Apache Doris, which will unlock many possibilities when it is combined with the Multi-Catalog feature. </p></li><li><p>Support for more operations such as UPDATE and DELETE.</p></li></ul></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><div class="text-center mb-4"><a class="text-[#8592A6] cursor-pointer hover:no-underline" href="/blog">Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class="s-tags"><span class="s-tag">Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:text-[2.5rem] text-center" itemprop="headline"><a itemprop="url" href="/blog/multi-tenant-workload-isolation-in-apache-doris">Multi-tenant workload isolation: a better balance between isolation and utilization</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class="authors"><span class="s-author text-black">Apache Doris</span></span><time datetime="2024-05-14T00:00:00.000Z" itemprop="datePublished" class="text-black ml-4">May 14, 2024</time></div></header><div class="markdown" itemprop="articleBody"><p>This is an in-depth introduction to the workload isolation capabilities of <a href="https://doris.apache.org" target="_blank" rel="noopener noreferrer">Apache Doris</a>. But first of all, why and when do you need workload isolation? If you relate to any of the following situations, read on and you will end up with a solution:</p><ul><li><p>You have different business departments or tenants sharing the same cluster and you want to prevent the interference of workloads among them.</p></li><li><p>You have query tasks of varying priority levels and you want to give priority to your critical tasks (such as real-time data analytics and online transactions) in terms of resources and execution. </p></li><li><p>You need workload isolation but also want high cost-effectiveness and resource utilization rates.</p></li></ul><p>Apache Doris supports workload isolation based on Resource Tag and Workload Group. Resource Tag isolates the CPU and memory resources for different workloads at the level of backend nodes, while the Workload Group mechanism can further divide the resources within a backend node for higher resource utilization.  </p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p><a href="https://www.youtube.com/watch?v=Wd3l5C4k8Ok&amp;t=1s" target="_blank" rel="noopener noreferrer">Demo</a> of using the Workload Manager in Apache Doris to set a CPU soft/hard limit for Workload Groups.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="resource-isolation-based-on-resource-tag">Resource isolation based on Resource Tag<a href="#resource-isolation-based-on-resource-tag" class="hash-link" aria-label="Direct link to Resource isolation based on Resource Tag" title="Direct link to Resource isolation based on Resource Tag">‚Äã</a></h2><p>Let&#x27;s begin with the architecture of Apache Doris. Doris has two <a href="https://doris.apache.org/docs/gettingStarted/what-is-apache-doris" target="_blank" rel="noopener noreferrer">types of nodes</a>: frontends (FEs) and backends (BEs). FE nodes store metadata, manage clusters, process user requests, and parse query plans, while BE nodes are responsible for computation and data storage. Thus, BE nodes are the major resource consumers. </p><p>The main idea of a Resource Tag-based isolation solution is to divide computing resources into groups by assigning tags to BE nodes in a cluster, where BE nodes of the same tag constitute a Resource Group. A Resource Group can be deemed as a unit for data storage and computation. For data ingested into Doris, the system will write data replicas into different Resource Groups according to the configurations. Queries will also be assigned to their corresponding <a href="https://doris.apache.org/docs/admin-manual/resource-admin/multi-tenant#tag-division-and-cpu-limitation-are-new-features-in-version-015-in-order-to-ensure-a-smooth-upgrade-from-the-old-version-doris-has-made-the-following-forward-compatibility" target="_blank" rel="noopener noreferrer">Resource Groups</a> for execution. </p><p>For example, if you want to separate read and write workloads in a 3-BE cluster, you can follow these steps:</p><ol><li><p><strong>Assign Resource Tags to BE nodes</strong>: Bind 2 BEs to the &quot;Read&quot; tag and 1 BE to the &quot;Write&quot; tag. </p></li><li><p><strong>Assign Resource Tags to data replicas</strong>: Assuming that Table 1 has 3 replicas, bind 2 of them to the &quot;Read&quot; tag and 1 to the &quot;Write&quot; tag. Data written into Replica 3 will be synchronized to Replica 1 and Replica 2 and the data synchronization process consumes few resources of BE 1 and BE2.</p></li><li><p><strong>Assign workload groups to Resource Tags</strong>: Queries that include the &quot;Read&quot; tag in their SQLs will be automatically routed to the nodes tagged with &quot;Read&quot; (in this case, BE 1 and BE 2). For data writing tasks, you also need to assign them with the &quot;Write&quot; tag, so they can be routed to the corresponding node (BE 3). In this way, there will be no resource contention between read and write workloads except the data synchronization overheads from replica 3 to replicate 1 and 2.</p></li></ol><p><img loading="lazy" alt="Resource isolation based on Resource Tag" src="https://cdnd.selectdb.com/assets/images/resource-isolation-based-on-resource-tag-af8fea20b39cee40b735034a21e723d6.PNG" width="1280" height="719" class="img_ev3q"></p><p>Resource Tag also enables <strong>multi-tenancy</strong> in Apache Doris. For example, computing and storage resources tagged with &quot;User A&quot; are for User A only, while those tagged with &quot;User B&quot; are exclusive to User B. This is how Doris implements multi-tenant resource isolation with Resource Tags at the BE side.</p><p><img loading="lazy" alt="Resource isolation based on Resource Tag" src="https://cdnd.selectdb.com/assets/images/resource-isolation-based-on-resource-tag-2-30b41e82f10cf3f14ee9363bdcea06b1.PNG" width="1280" height="609" class="img_ev3q"></p><p>Dividing the BE nodes into groups ensures <strong>a high level of isolation</strong>:</p><ul><li><p>CPU, memory, and I/O of different tenants are physically isolated.</p></li><li><p>One tenant will never be affected by the failures (such as process crashes) of another tenant.</p></li></ul><p>But it has a few downsides:</p><ul><li><p>In read-write separation, when the data writing stops, the BE nodes tagged with &quot;Write&quot; become idle. This reduces overall cluster utilization.</p></li><li><p>Under multi-tenancy, if you want to further isolate different workloads of the same tenant by assigning separate BE nodes to each of them, you will need to endure significant costs and low resource utilization.</p></li><li><p>The number of tenants is tied to the number of data replicas. So if you have 5 tenants, you will need 5 data replicas. That&#x27;s huge storage redundancy.</p></li></ul><p><strong>To improve on this,we provide a workload isolation solution based on Workload Group in Apache Doris 2.0.0, and enhanced it in <a href="https://doris.apache.org/blog/release-note-2.1.0" target="_blank" rel="noopener noreferrer">Apache Doris 2.1.0</a></strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="workload-isolation-based-on-workload-group">Workload isolation based on Workload Group<a href="#workload-isolation-based-on-workload-group" class="hash-link" aria-label="Direct link to Workload isolation based on Workload Group" title="Direct link to Workload isolation based on Workload Group">‚Äã</a></h2><p>The <a href="https://doris.apache.org/docs/admin-manual/resource-admin/workload-group" target="_blank" rel="noopener noreferrer">Workload Group</a>-based solution realizes a more granular division of resources. It further divides CPU and memory resources within processes on BE nodes, meaning that the queries in one BE node can be isolated from each other to some extent. This avoids resource competition within BE processes and optimizes resource utilization.</p><p>Users can relate queries to Workload Groups, and thus limit the percentage of CPU and memory resources that a query can use. Under high cluster loads, Doris can automatically kill the most resource-consuming queries in a Workload Group. Under low cluster loads, Doris can allow multiple Workload Groups to share idle resources. </p><p>Doris supports both CPU soft limit and CPU hard limit. The soft limit allows Workload Groups to break the limit and utilize idle resources, enabling more efficient utilization. The hard limit is a hard guarantee of stable performance because it prevents the mutual impact of Workload Groups. </p><p><em>(CPU soft limit and CPU hard limit are contradictory to each other. You can choose between them based on your own use case.)</em></p><p><img loading="lazy" alt="Workload isolation based on Workload Group" src="https://cdnd.selectdb.com/assets/images/workload-isolation-based-on-workload-group-432d800f87b879c1ed7412a4f31e81ca.png" width="1280" height="710" class="img_ev3q"></p><p>Its differences from the Resource Tag-based solution include: </p><ul><li><p>Workload Groups are formed within processes. Multiple Workload Groups compete for resources within the same BE node.</p></li><li><p>The consideration of data replica distribution is out of the picture because Workload Group is only a way of resource management.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cpu-soft-limit">CPU soft limit<a href="#cpu-soft-limit" class="hash-link" aria-label="Direct link to CPU soft limit" title="Direct link to CPU soft limit">‚Äã</a></h3><p>CPU soft limit is implemented by the <code>cpu_share</code> parameter, which is similar to weights conceptually. Workload Groups with higher <code>cpu_share</code> will be allocated more CPU time during a time slot. </p><p>For example, if Group A is configured with a <code>cpu_share</code> of 1, and Group B, 9. In a time slot of 10 seconds, when both Group A and Group B are fully loaded, Group A and Group B will be able to consume 1s and 9s of CPU time, respectively.  </p><p>What happens in real-world cases is that, not all workloads in the cluster run at full capacity. Under the soft limit, if Group B has low or zero workload, then Group A will be able to use all 10s of CPU time, thus increasing the overall CPU utilization in the cluster.</p><p><img loading="lazy" alt="CPU soft limit" src="https://cdnd.selectdb.com/assets/images/CPU-soft-limit-c549d1cefbc8648c861695b19e405b6a.png" width="1280" height="732" class="img_ev3q"></p><p>A soft limit brings flexibility and a higher resource utilization rate. On the flip side, it might cause performance fluctuations.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cpu-hard-limit">CPU hard limit<a href="#cpu-hard-limit" class="hash-link" aria-label="Direct link to CPU hard limit" title="Direct link to CPU hard limit">‚Äã</a></h3><p>CPU hard limit in Apache Doris 2.1.0 is designed for users who require stable performance. In simple terms, the CPU hard limit defines that a Workload Group cannot use more CPU resources than its limit whether there are idle CPU resources or not.</p><p>This is how it works: </p><p>Suppose that Group A is set with <code>cpu_hard_limit=10%</code> and Group B with <code>cpu_hard_limit=90%</code>. If both Group A and Group B run at full load, Group A and Group B will respectively use 10% and 90% of the overall CPU time. The difference lies in when the workload of Group B decreases. In such cases, regardless of how high the query load of Group A is, it should not use more than the 10% CPU resources allocated to it. </p><p><img loading="lazy" alt="CPU hard limit" src="https://cdnd.selectdb.com/assets/images/CPU-hard-limit-cff5be57e984d26b7df9039ce69e5018.png" width="1280" height="746" class="img_ev3q"></p><p>As opposed to soft limit, a hard limit guarantees stable system performance at the cost of flexibility and the possibility of a higher resource utilization rate. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="memory-resource-limit">Memory resource limit<a href="#memory-resource-limit" class="hash-link" aria-label="Direct link to Memory resource limit" title="Direct link to Memory resource limit">‚Äã</a></h3><blockquote><p>The memory of a BE node comprises the following parts:</p><ul><li><p>Reserved memory for the operating system.</p></li><li><p>Memory consumed by non-queries, which is not considered in the Workload Group&#x27;s memory statistics.</p></li><li><p>Memory consumed by queries, including data writing. This can be tracked and controlled by Workload Group.</p></li></ul></blockquote><p>The <code>memory_limit</code> parameter defines the maximum (%) memory available to a Workload Group within the BE process. It also affects the priority of Resource Groups.</p><p>Under initial status, a high-priority Resource Group will be allocated more memory. By setting <code>enable_memory_overcommit</code>, you can allow Resource Groups to occupy more memory than the limits when there is idle space. When memory is tight, Doris will cancel tasks to reclaim the memory resources that they commit.  In this case, the system will retain memory resources for high-priority resource groups as much as possible.</p><div style="text-align:center"><img loading="lazy" src="/images/memory-resource-limit.png" alt="Memory resource limit" style="display:inline-block;width:300px" class="img_ev3q"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="query-queue">Query queue<a href="#query-queue" class="hash-link" aria-label="Direct link to Query queue" title="Direct link to Query queue">‚Äã</a></h3><p>It happens that the cluster is undertaking more loads than it can handle. In this case, submitting new query requests will not only be fruitless but also interruptive to the queries in progress.</p><p>To improve on this, Apache Doris provides the <a href="https://doris.apache.org/docs/admin-manual/resource-admin/workload-group#query-queue" target="_blank" rel="noopener noreferrer">query queue</a> mechanism. Users can put a limit on the number of queries that can run concurrently in the cluster. A query will be rejected when the query queue is full or after a waiting timeout, thus ensuring system stability under high loads.</p><p><img loading="lazy" alt="Query queue" src="https://cdnd.selectdb.com/assets/images/query-queue-863a0ad9b10c79e223d84abe16783f3c.png" width="1280" height="682" class="img_ev3q"></p><p>The query queue mechanism involves three parameters: <code>max_concurrency</code>, <code>max_queue_size</code>, and <code>queue_timeout</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tests">Tests<a href="#tests" class="hash-link" aria-label="Direct link to Tests" title="Direct link to Tests">‚Äã</a></h2><p>To demonstrate the effectiveness of the CPU soft limit and hard limit, we did a few tests.</p><ul><li><p>Environment: single machine, 16 cores, 64GB </p></li><li><p>Deployment: 1 FE + 1 BE</p></li><li><p>Dataset: ClickBench, TPC-H</p></li><li><p>Load testing tool: Apache JMeter</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cpu-soft-limit-test">CPU soft limit test<a href="#cpu-soft-limit-test" class="hash-link" aria-label="Direct link to CPU soft limit test" title="Direct link to CPU soft limit test">‚Äã</a></h3><p>Start two clients and continuously submit queries (ClickBench Q23) with and without using Workload Groups, respectively. Note that Page Cache should be disabled to prevent it from affecting the test results.</p><p><img loading="lazy" alt="CPU soft limit test" src="https://cdnd.selectdb.com/assets/images/CPU-soft-limit-test-6398c8f7b4a0be54817a4443c05343a6.png" width="1280" height="374" class="img_ev3q"></p><p>Comparing the throughputs of the two clients in both tests, it can be concluded that:</p><ul><li><p><strong>Without configuring Workload Groups</strong>, the two clients consume the CPU resources on an equal basis.</p></li><li><p><strong>Configuring Workload Groups</strong> and setting the <code>cpu_share</code> to 2:1, the throughput ratio of the two clients is 2:1. With a higher <code>cpu_share</code>, Client 1 is provided with a higher portion of CPU resources, and it delivers a higher throughput. </p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cpu-hard-limit-test">CPU hard limit test<a href="#cpu-hard-limit-test" class="hash-link" aria-label="Direct link to CPU hard limit test" title="Direct link to CPU hard limit test">‚Äã</a></h3><p>Start a client, set <code>cpu_hard_limit=50%</code> for the Workload Group, and execute ClickBench Q23 for 5 minutes under a concurrency level of 1, 2, and 4, respectively. </p><p><img loading="lazy" alt="CPU hard limit test" src="https://cdnd.selectdb.com/assets/images/CPU-hard-limit-test-55edf1e86571dd5256567852fecefa08.png" width="1280" height="838" class="img_ev3q"></p><p>As the query concurrency increases, the CPU utilization rate remains at around 800%, meaning that 8 cores are used. On a 16-core machine, that&#x27;s <strong>50% utilization</strong>, which is as expected. In addition, since CPU hard limits are imposed, the increase in TP99 latency as concurrency rises is also an expected outcome.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="test-in-simulated-production-environment">Test in simulated production environment<a href="#test-in-simulated-production-environment" class="hash-link" aria-label="Direct link to Test in simulated production environment" title="Direct link to Test in simulated production environment">‚Äã</a></h2><p>In real-world usage, users are particularly concerned about query latency rather than just query throughput, since latency is more easily perceptible in user experience. That&#x27;s why we decided to validate the effectiveness of Workload Group in a simulated production environment.</p><p>We picked out a SQL set consisting of queries that should be finished within 1s (ClickBench Q15, Q17, Q23 and TPC-H Q3, Q7, Q19), including single-table aggregations and join queries. The size of the TPC-H dataset is 100GB.</p><p>Similarly, we conduct tests with and without configuring Workload Groups.</p><p><img loading="lazy" alt="Test in simulated production environment" src="https://cdnd.selectdb.com/assets/images/test-in-simulated-production-environment-a97b3764ec737366e55558d2ffb5f89e.png" width="1280" height="619" class="img_ev3q"></p><p>As the results show:</p><ul><li><p><strong>Without Workload Group</strong> (comparing Test 1 &amp; 2): When dialing up the concurrency of Client 2, both clients experience a 2~3-time increase in query latency.</p></li><li><p><strong>Configuring Workload Group</strong> (comparing Test 3 &amp; 4): As the concurrency of Client 2 goes up, the performance fluctuation in Client 1 is much smaller, which is proof of how it is effectively protected by workload isolation.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="recommendations--plans">Recommendations &amp; plans<a href="#recommendations--plans" class="hash-link" aria-label="Direct link to Recommendations &amp; plans" title="Direct link to Recommendations &amp; plans">‚Äã</a></h2><p>The Resource Tag-based solution is a thorough workload isolation plan. The Workload Group-based solution realizes a better balance between resource isolation and utilization, and it is complemented by the query queue mechanism for stability guarantee.</p><p>So which one to choose for your use case? Here is our recommendation:</p><ul><li><p><strong>Resource Tag</strong>: for use cases where different business lines of departments share the same cluster, so the resources and data are physically isolated for different tenants.</p></li><li><p><strong>Workload Group</strong>: for use cases where one cluster undertakes various query workloads for flexible resource allocation.</p></li></ul><p>In future releases, we will keep improving user experience of the Workload Group and query queue features:</p><ul><li><p>Freeing up memory space by canceling queries is a brutal method. We plan to implement that by disk spilling, which will bring higher stability in query performance.</p></li><li><p>Since memory consumed by non-queries in the BE is not included in Workload Group&#x27;s memory statistics, users might observe a disparity between the BE process memory usage and Workload Group memory usage. We will address this issue to avoid confusion.</p></li><li><p>In the query queue mechanism,  cluster load is controlled by setting the maximum query concurrency. We plan to enable dynamic maximum query concurrency based on resource availability at the BE. This is to create backpressure on the client side and thus improve the availability of Doris when clients keep submitting high loads.</p></li><li><p>The main idea of Resource Tag is to group the BE nodes, while that of Workload Group is to further divide the resources of a single BE node. For users to grasp these ideas, they need to learn about the concept of BE nodes in Doris first. However, from an operational perspective, users only need to understand the resource consumption percentage of each of their workloads and what priority they should have when cluster load is saturated. Thus, we will try and figure out a way to flatten the learning curve for users, such as keeping the concept of BE nodes in the black box. </p></li></ul><p>For further assistance on workload isolation in Apache Doris, join the <a href="https://join.slack.com/t/apachedoriscommunity/shared_invite/zt-2kl08hzc0-SPJe4VWmL_qzrFd2u2XYQA" target="_blank" rel="noopener noreferrer">Apache Doris community</a>.</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><div class="text-center mb-4"><a class="text-[#8592A6] cursor-pointer hover:no-underline" href="/blog">Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class="s-tags"><span class="s-tag">Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:text-[2.5rem] text-center" itemprop="headline"><a itemprop="url" href="/blog/from-presto-trino-clickhouse-and-hive-to-apache-doris-sql-convertor-for-easy-migration">From Presto, Trino, ClickHouse, and Hive to Apache Doris: SQL convertor for easy migration</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class="authors"><span class="s-author text-black">Apache Doris</span></span><time datetime="2024-05-06T00:00:00.000Z" itemprop="datePublished" class="text-black ml-4">May 6, 2024</time></div></header><div class="markdown" itemprop="articleBody"><p><a href="https://doris.apache.org/" target="_blank" rel="noopener noreferrer">Apache Doris</a> is an all-in-one data platform that is capable of real-time reporting, ad-hoc queries, data lakehousing, log management and analysis, and batch data processing. As more and more companies have been replacing their component-heavy data architecture with Apache Doris, there is an increasing need for a more convenient data migration solution. <strong>That&#x27;s why the Doris SQL Convertor is made.</strong></p><p>Most database systems run their own SQL dialects. Thus, migration between systems often entails modifications of SQL syntaxes. Since SQLs work closely with a company&#x27;s business logic, in many cases, users have to modify their business logic, too. To reduce the transition pain for users, Apache Doris 2.1 provides the Doris SQL Convertor. It supports the SQL syntaxes of Presto, Trino, Hive, ClickHouse, and PostgreSQL. With it, users can execute queries with their old SQL syntaxes directly in Doris or batch convert their existing SQL statements on the visual interface.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="doris-sql-convertor">Doris SQL Convertor<a href="#doris-sql-convertor" class="hash-link" aria-label="Direct link to Doris SQL Convertor" title="Direct link to Doris SQL Convertor">‚Äã</a></h2><p>The Doris SQL Convertor requires <strong>zero rewriting</strong> of SQL. Simply <code>set sql_dialect = &quot;trino&quot;</code> in the session variable, then you can execute queries in Doris using Trino SQLs. </p><p>The SQL compatibility of it has been proven by extensive tests. For example, a user tested the Doris SQL Convertor with over 30,000 SQL queries from their production environment. Turned out that the Convertor successfully converted 99.6% of the Trino SQLs and 98% of the ClickHouse SQLs.</p><p>Currently, Presto, Trino, Hive, ClickHouse, and PostgreSQL dialects are supported. We are working to add Teradata, SQL Server, and Snowflake to the list, and consistently increase the compatibility level of each SQL dialect.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="installation--usage">Installation &amp; usage<a href="#installation--usage" class="hash-link" aria-label="Direct link to Installation &amp; usage" title="Direct link to Installation &amp; usage">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sql-conversion-service">SQL conversion service<a href="#sql-conversion-service" class="hash-link" aria-label="Direct link to SQL conversion service" title="Direct link to SQL conversion service">‚Äã</a></h3><ol><li><p><strong>Download</strong> <strong><a href="https://selectdb-doris-1308700295.cos.ap-beijing.myqcloud.com/doris-sql-convertor/doris-sql-convertor-1.0.3-bin-x86.tar.gz" target="_blank" rel="noopener noreferrer">Doris SQL Convertor</a></strong></p></li><li><p>On any frontend (FE) node, start the service using the following command.</p></li></ol><ul><li><p>The SQL conversion service is stateless and can be started or stopped at any time.</p></li><li><p><code>port=5001</code> in the command specifies the service port. (You can use any available port.)</p></li><li><p>It is advisable to start a service individually for each FE node.</p></li></ul><div class="language-Shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">nohup ./doris-sql-convertor-1.0.1-bin-x86 run --host=0.0.0.0 --port=5001 &amp;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li><p>Start a Doris cluster <strong>(Use Doris 2.1.0 or newer)</strong>.</p></li><li><p>Set the URL for SQL conversion service in Doris. <code>127.0.0.1:5001</code> in the command represents the IP and port number of the node where the service is deployed.</p></li></ol><div class="language-Shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">MySQL&gt; set global sql_converter_service_url = &quot;http://127.0.0.1:5001/api/v1/convert&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After deployment, you can execute SQL directly in the command line. You can start the service by <code>set sql_dialect = XXX</code>. The following examples are based on ClickHouse SQL dialects.</p><ul><li>Presto</li></ul><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> sql_dialect</span><span class="token operator">=</span><span class="token plain">presto</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">                                                                                                                                                                                                             </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Query OK</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.00</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> cast</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">start_time </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                                                                                     </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            array_distinct</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">arr_int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                                                                                             </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            FILTER</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">arr_str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> x </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> x </span><span class="token operator">LIKE</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;%World%&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                                                                              </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            to_date</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;%Y-%m-%d&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                                                                                           </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">start_time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                                                                                                    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            date_add</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;month&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> start_time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col6</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                                                                                    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            REGEXP_EXTRACT_ALL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;-.&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col7</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                                                                                     </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            JSON_EXTRACT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;{&quot;id&quot;: &quot;33&quot;}&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;$.id&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                                                                                 </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            element_at</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">arr_int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col9</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                                                                                              </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            date_trunc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;day&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">start_time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col10                                                                                                                                                                                        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> test_sqlconvert                                                                                                                                                                                                            </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> date_trunc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;day&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">start_time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DATE</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2024-05-20&#x27;</span><span class="token plain">                                                                                                                                                                            </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">                                                                                                                                                                                                                        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------------------+-----------+-----------+------------+------+---------------------+-------------+------+------+---------------------+                                                                                                </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> col1                </span><span class="token operator">|</span><span class="token plain"> col2      </span><span class="token operator">|</span><span class="token plain"> col3      </span><span class="token operator">|</span><span class="token plain"> col4       </span><span class="token operator">|</span><span class="token plain"> col5 </span><span class="token operator">|</span><span class="token plain"> col6                </span><span class="token operator">|</span><span class="token plain"> col7        </span><span class="token operator">|</span><span class="token plain"> col8 </span><span class="token operator">|</span><span class="token plain"> col9 </span><span class="token operator">|</span><span class="token plain"> col10               </span><span class="token operator">|</span><span class="token plain">                                                                                                </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------------------+-----------+-----------+------------+------+---------------------+-------------+------+------+---------------------+                                                                                                </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">20</span><span class="token plain"> </span><span class="token number">13</span><span class="token plain">:</span><span class="token number">14</span><span class="token plain">:</span><span class="token number">52</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;World&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">14</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">20</span><span class="token plain"> </span><span class="token number">13</span><span class="token plain">:</span><span class="token number">14</span><span class="token plain">:</span><span class="token number">52</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;-0&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;-1&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;33&quot;</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">20</span><span class="token plain"> </span><span class="token number">00</span><span class="token plain">:</span><span class="token number">00</span><span class="token plain">:</span><span class="token number">00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">                                                                                                </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------------------+-----------+-----------+------------+------+---------------------+-------------+------+------+---------------------+                                                                                                </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">row</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.03</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">    </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>ClickHouse</li></ul><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> sql_dialect</span><span class="token operator">=</span><span class="token plain">clickhouse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">                                                                                                                                             </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Query OK</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.00</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">                                                                                                                                           </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                                                                                                                                                               </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain">  toString</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">start_time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                                   </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             arrayCompact</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">arr_int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                                  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             arrayFilter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">x </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> x </span><span class="token operator">like</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;%World%&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">arr_str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                              </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             toDate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                                          </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             toYear</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">start_time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                                      </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             addMonths</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">start_time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col6</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                                </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             extractAll</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;-.&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col7</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                                 </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             JSONExtractString</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;{&quot;id&quot;: &quot;33&quot;}&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;id&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             arrayElement</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">arr_int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col9</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                               </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             date_trunc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;day&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">start_time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col10                                                                                                                           </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> test_sqlconvert                                                                                                                                               </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> date_trunc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;day&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">start_time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2024-05-20 00:00:00&#x27;</span><span class="token plain">                                                                                                          </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">                                                                                                                                                   </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------------------+-----------+-----------+------------+------+---------------------+-------------+------+------+---------------------+                                    </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> col1                </span><span class="token operator">|</span><span class="token plain"> col2      </span><span class="token operator">|</span><span class="token plain"> col3      </span><span class="token operator">|</span><span class="token plain"> col4       </span><span class="token operator">|</span><span class="token plain"> col5 </span><span class="token operator">|</span><span class="token plain"> col6                </span><span class="token operator">|</span><span class="token plain"> col7        </span><span class="token operator">|</span><span class="token plain"> col8 </span><span class="token operator">|</span><span class="token plain"> col9 </span><span class="token operator">|</span><span class="token plain"> col10               </span><span class="token operator">|</span><span class="token plain">                                    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------------------+-----------+-----------+------------+------+---------------------+-------------+------+------+---------------------+                                    </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">20</span><span class="token plain"> </span><span class="token number">13</span><span class="token plain">:</span><span class="token number">14</span><span class="token plain">:</span><span class="token number">52</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;World&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">14</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">20</span><span class="token plain"> </span><span class="token number">13</span><span class="token plain">:</span><span class="token number">14</span><span class="token plain">:</span><span class="token number">52</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;-0&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;-1&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;33&quot;</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">20</span><span class="token plain"> </span><span class="token number">00</span><span class="token plain">:</span><span class="token number">00</span><span class="token plain">:</span><span class="token number">00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">                                    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------------------+-----------+-----------+------------+------+---------------------+-------------+------+------+---------------------+                                    </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">row</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.02</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="visual-interface">Visual interface<a href="#visual-interface" class="hash-link" aria-label="Direct link to Visual interface" title="Direct link to Visual interface">‚Äã</a></h3><p>For large-scale conversion, it is recommended to use the visual interface, on which you can batch upload the files for dialect conversion.</p><p>Follow these steps to deploy the visual conversion interface:</p><ol><li><p>Environment: Docker, Docker-Compose</p></li><li><p>Get Doris-SQL-Convertor Docker image</p></li><li><p>Create a network for the image</p></li></ol><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> network create app_network</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>Decompress the package</li></ol><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">tar</span><span class="token plain"> xzvf doris-sql-convertor-1.0.1.tar.gz</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> doris-sql-convertor</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="5"><li>Edit the environment variables</li></ol><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">FLASK_APP</span><span class="token operator">=</span><span class="token plain">server/app.py</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">FLASK_DEBUG</span><span class="token operator">=</span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">API_HOST</span><span class="token operator">=</span><span class="token plain">http://doris-sql-convertor-api:5000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># DOCKER TAG</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">API_TAG</span><span class="token operator">=</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">WEB_TAG</span><span class="token operator">=</span><span class="token plain">latest</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="6"><li>Start it up</li></ol><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sh</span><span class="token plain"> start.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After deployment, you can access the service by <code>ip:8080</code> via your local browser. <code>8080</code> is the default port. You can change the mapping port. On the visual interface, you can select the source dialect type and target dialect type, and then click &quot;Convert&quot;.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Note</div><div class="admonitionContent_S0QG"><ol><li><p>For batch conversion, each SQL statement should end with <code>; </code>.</p></li><li><p>The Doris SQL Convertor supports 239 UNION ALL conversions at most.</p></li></ol></div></div><p>Join the <a href="https://join.slack.com/t/apachedoriscommunity/shared_invite/zt-2kl08hzc0-SPJe4VWmL_qzrFd2u2XYQA" target="_blank" rel="noopener noreferrer">Apache Doris community</a> to seek guidance from the Doris makers or provide your feedback!</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><div class="text-center mb-4"><a class="text-[#8592A6] cursor-pointer hover:no-underline" href="/blog">Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class="s-tags"><span class="s-tag">Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:text-[2.5rem] text-center" itemprop="headline"><a itemprop="url" href="/blog/arrow-flight-sql-in-apache-doris-for-10x-faster-data-transfer">Arrow Flight SQL for 10X faster data transfer</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class="authors"><span class="s-author text-black">Apache Doris</span></span><time datetime="2024-04-16T00:00:00.000Z" itemprop="datePublished" class="text-black ml-4">April 16, 2024</time></div></header><div class="markdown" itemprop="articleBody"><p>For years, JDBC and ODBC have been commonly adopted norms for database interaction. Now, as we gaze upon the vast expanse of the data realm, the rise of data science and data lake analytics brings bigger and bigger datasets. Correspondingly, we need faster and faster data reading and transmission, so we start to look for better answers than JDBC and ODBC. Thus, we include <strong>Arrow Flight SQL protocol</strong> into <a href="https://doris.apache.org" target="_blank" rel="noopener noreferrer">Apache Doris 2.1</a>, which provides <strong>tens-fold speedups for data transfer</strong>. </p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Tip</div><div class="admonitionContent_S0QG"><p>A <a href="https://www.youtube.com/watch?v=zIqy24gI8DE" target="_blank" rel="noopener noreferrer">demo</a> of loading data from Apache Doris to Python using Arrow Flight SQL.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="high-speed-data-transfer-based-on-arrow-flight-sql">High-speed data transfer based on Arrow Flight SQL<a href="#high-speed-data-transfer-based-on-arrow-flight-sql" class="hash-link" aria-label="Direct link to High-speed data transfer based on Arrow Flight SQL" title="Direct link to High-speed data transfer based on Arrow Flight SQL">‚Äã</a></h2><p>As a column-oriented data warehouse, Apache Doris arranges its query results in the form of data Blocks in a columnar format. Before version 2.1, the Blocks must be serialized into bytes in row-oriented formats before they can be transferred to a target client via a MySQL client or JDBC/ODBC driver. Moreover, if the target client is a columnar database or a column-oriented data science component like Pandas, the data should then be de-serialized. The serialization-deserialization process is a speed bump for data transmission.</p><p>Apache Doris 2.1 has a data transmission channel built on <a href="https://arrow.apache.org/docs/format/FlightSql.html" target="_blank" rel="noopener noreferrer">Arrow Flight SQL</a>. (<a href="https://arrow.apache.org/" target="_blank" rel="noopener noreferrer">Apache Arrow</a> is a software development platform designed for high data movement efficiency across systems and languages, and the Arrow format aims for high-performance, lossless data exchange.) It allows <strong>high-speed, large-scale data reading from Doris via SQL in various mainstream programming languages</strong>. For target clients that also support the Arrow format, the whole process will be free of serialization/deserialization, thus no performance loss. Another upside is, Arrow Flight can make full use of multi-node and multi-core architecture and implement parallel data transfer, which is another enabler of high data throughput.</p><p>For example, if a Python client reads data from Apache Doris, Doris will first convert the column-oriented Blocks to Arrow RecordBatch. Then in the Python client, Arrow RecordBatch will be converted to Pandas DataFrame. Both conversions are fast because the Doris Blocks, Arrow RecordBatch, and Pandas DataFrame are all column-oriented. </p><p><img loading="lazy" alt="img" src="https://cdnd.selectdb.com/assets/images/high-speed-data-transfer-based-on-doris-arrow-flight-sql-c51538bca23f1062d141adab8fe055cb.png" width="1280" height="647" class="img_ev3q"></p><p>In addition, Arrow Flight SQL provides a general JDBC driver to facilitate seamless communication between databases that supports the Arrow Flight SQL protocol. This unlocks the the potential of Doris to be connected to a wider ecosystem and to be used in more cases. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="performance-test">Performance test<a href="#performance-test" class="hash-link" aria-label="Direct link to Performance test" title="Direct link to Performance test">‚Äã</a></h2><p>The &quot;tens-fold speedups&quot; conclusion is based on our benchmark tests. We tried reading data from Doris using PyMySQL, Pandas, and Arrow Flight SQL, and jotted down the durations, respectively. The test data is the ClickBench dataset.</p><p><img loading="lazy" alt="Performance test" src="https://cdnd.selectdb.com/assets/images/doris-performance-test-a0ccb1f783b2f85210c63d8aa961f649.png" width="1980" height="1062" class="img_ev3q"></p><p>Results on various data types are as follows: </p><p><img loading="lazy" alt="Performance test results" src="https://cdnd.selectdb.com/assets/images/doris-performance-test-2-8c60cb82710df9d37e6707593830da6c.png" width="1280" height="481" class="img_ev3q"></p><p><strong>As shown, Arrow Flight SQL outperforms PyMySQL and Pandas in all data types by a factor ranging from 20 to several hundreds</strong>. </p><p><img loading="lazy" alt="Arrow Flight SQL outperforms PyMySQL and Pandas" src="https://cdnd.selectdb.com/assets/images/doris-performance-test-3-b48f9e4bdec4a27877fcddbb33e6375a.png" width="1280" height="502" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="usage">Usage<a href="#usage" class="hash-link" aria-label="Direct link to Usage" title="Direct link to Usage">‚Äã</a></h2><p>With support for Arrow Flight SQL, Apache Doris can leverage the Python ADBC Driver for fast data reading. I will showcase a few frequently executed database operations using the Python ADBC Driver (version 3.9 or later), including DDL, DML, session variable setting, and <code>show</code> statements.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="01--install-library">01  Install library<a href="#01--install-library" class="hash-link" aria-label="Direct link to 01  Install library" title="Direct link to 01  Install library">‚Äã</a></h3><p>The relevant library is already published on PyPI. It can be installed simply as follows: </p><div class="language-C++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-C++ codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">pip install adbc_driver_manager</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pip install adbc_driver_flightsql</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Import the following module/library to interact with the installed library: </p><div class="language-Python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">import adbc_driver_manager</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import adbc_driver_flightsql.dbapi as flight_sql</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&gt;&gt;&gt; print(adbc_driver_manager.__version__)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.1.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&gt;&gt;&gt; print(adbc_driver_flightsql.__version__)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.1.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="02--connect-to-doris">02  Connect to Doris<a href="#02--connect-to-doris" class="hash-link" aria-label="Direct link to 02  Connect to Doris" title="Direct link to 02  Connect to Doris">‚Äã</a></h3><p>Create a client for interacting with the Doris Arrow Flight SQL service. Prerequisites include: Doris frontend (FE) host, Arrow Flight port, and login username/password.</p><p>Configure parameters for Doris frontend (FE) and backend (BE):</p><ul><li><p>In <code>fe/conf/fe.conf</code>, set <code>arrow_flight_sql_port </code> to an available port, such as 9090.</p></li><li><p>In <code>be/conf/be.conf</code>, set <code>arrow_flight_sql_port </code> to an available port, such as 9091.</p></li></ul><p>Suppose that the Arrow Flight SQL services for the Doris instance will run on ports 9090 and 9091 for FE and BE respectively, and the Doris username/password is &quot;user&quot; and &quot;pass&quot;, the connection process would be:</p><div class="language-C++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-C++ codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">conn = flight_sql.connect(uri=&quot;grpc://{FE_HOST}:{fe.conf:arrow_flight_sql_port}&quot;, db_kwargs={</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            adbc_driver_manager.DatabaseOptions.USERNAME.value: &quot;user&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            adbc_driver_manager.DatabaseOptions.PASSWORD.value: &quot;pass&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        })</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cursor = conn.cursor()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once the connection is established, you can interact with Doris using SQL statements through the returned cursor object. This allows you to perform various operations such as table creation, metadata retrieval, data import, and query execution.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="03--create-table-and-retrieve-metadata">03  Create table and retrieve metadata<a href="#03--create-table-and-retrieve-metadata" class="hash-link" aria-label="Direct link to 03  Create table and retrieve metadata" title="Direct link to 03  Create table and retrieve metadata">‚Äã</a></h3><p>Pass the query to the <code>cursor.execute()</code> function, which creates tables and retrieves metadata.</p><div class="language-C++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-C++ codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cursor.execute(&quot;DROP DATABASE IF EXISTS arrow_flight_sql FORCE;&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">print(cursor.fetchallarrow().to_pandas())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cursor.execute(&quot;create database arrow_flight_sql;&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">print(cursor.fetchallarrow().to_pandas())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cursor.execute(&quot;show databases;&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">print(cursor.fetchallarrow().to_pandas())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cursor.execute(&quot;use arrow_flight_sql;&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">print(cursor.fetchallarrow().to_pandas())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cursor.execute(&quot;&quot;&quot;CREATE TABLE arrow_flight_sql_test</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         k0 INT,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         k1 DOUBLE,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         K2 varchar(32) NULL DEFAULT &quot;&quot; COMMENT &quot;&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         k3 DECIMAL(27,9) DEFAULT &quot;0&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         k4 BIGINT NULL DEFAULT &#x27;10&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         k5 DATE,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    DISTRIBUTED BY HASH(k5) BUCKETS 5</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    PROPERTIES(&quot;replication_num&quot; = &quot;1&quot;);&quot;&quot;&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">print(cursor.fetchallarrow().to_pandas())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cursor.execute(&quot;show create table arrow_flight_sql_test;&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">print(cursor.fetchallarrow().to_pandas())</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If the returned <code>StatusResult</code> is 0, that means the query is executed successfully. (Such design is to ensure compatibility with JDBC.)</p><div class="language-C++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-C++ codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">  StatusResult</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0            0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  StatusResult</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0            0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                   Database</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0         __internal_schema</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1          arrow_flight_sql</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">..                      ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">507             udf_auth_db</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[508 rows x 1 columns]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  StatusResult</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0            0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  StatusResult</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0            0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                   Table                                       Create Table</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0  arrow_flight_sql_test  CREATE TABLE `arrow_flight_sql_test` (\n  `k0`...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="04--ingest-data">04  Ingest data<a href="#04--ingest-data" class="hash-link" aria-label="Direct link to 04  Ingest data" title="Direct link to 04  Ingest data">‚Äã</a></h3><p>Execute an INSERT INTO statement to load test data into the table created:</p><div class="language-C++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-C++ codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cursor.execute(&quot;&quot;&quot;INSERT INTO arrow_flight_sql_test VALUES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        (&#x27;0&#x27;, 0.1, &quot;ID&quot;, 0.0001, 9999999999, &#x27;2023-10-21&#x27;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        (&#x27;1&#x27;, 0.20, &quot;ID_1&quot;, 1.00000001, 0, &#x27;2023-10-21&#x27;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        (&#x27;2&#x27;, 3.4, &quot;ID_1&quot;, 3.1, 123456, &#x27;2023-10-22&#x27;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        (&#x27;3&#x27;, 4, &quot;ID&quot;, 4, 4, &#x27;2023-10-22&#x27;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        (&#x27;4&#x27;, 122345.54321, &quot;ID&quot;, 122345.54321, 5, &#x27;2023-10-22&#x27;);&quot;&quot;&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">print(cursor.fetchallarrow().to_pandas())</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you see the following returned result, the data ingestion is successful.</p><div class="language-C++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-C++ codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">  StatusResult</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0            0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If the data size to ingest is huge, you can apply the Stream Load method using <a href="https://pypi.org/project/pydoris/" target="_blank" rel="noopener noreferrer">pydoris</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="05--execute-queries">05  Execute queries<a href="#05--execute-queries" class="hash-link" aria-label="Direct link to 05  Execute queries" title="Direct link to 05  Execute queries">‚Äã</a></h3><p>Perform queries on the above table, such as aggregation, sorting, and session variable setting.</p><div class="language-C++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-C++ codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cursor.execute(&quot;select * from arrow_flight_sql_test order by k0;&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">print(cursor.fetchallarrow().to_pandas())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cursor.execute(&quot;set exec_mem_limit=2000;&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">print(cursor.fetchallarrow().to_pandas())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cursor.execute(&quot;show variables like \&quot;%exec_mem_limit%\&quot;;&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">print(cursor.fetchallarrow().to_pandas())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cursor.execute(&quot;select k5, sum(k1), count(1), avg(k3) from arrow_flight_sql_test group by k5;&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">print(cursor.fetchallarrow().to_pandas())</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The results are as follows:</p><div class="language-C++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-C++ codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">   k0            k1    K2                k3          k4          k5</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0   0       0.10000    ID       0.000100000  9999999999  2023-10-21</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1   1       0.20000  ID_1       1.000000010           0  2023-10-21</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2   2       3.40000  ID_1       3.100000000      123456  2023-10-22</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3   3       4.00000    ID       4.000000000           4  2023-10-22</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">4   4  122345.54321    ID  122345.543210000           5  2023-10-22</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[5 rows x 6 columns]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  StatusResult</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0            0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Variable_name Value Default_Value Changed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0  exec_mem_limit  2000    2147483648       1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           k5  Nullable(Float64)_1  Int64_2 Nullable(Decimal(38, 9))_3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0  2023-10-22         122352.94321        3            40784.214403333</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1  2023-10-21              0.30000        2                0.500050005</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[2 rows x 5 columns]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="06--complete-code">06  Complete code<a href="#06--complete-code" class="hash-link" aria-label="Direct link to 06  Complete code" title="Direct link to 06  Complete code">‚Äã</a></h3><div class="language-Python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Doris Arrow Flight SQL Test</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># step 1, library is released on PyPI and can be easily installed.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># pip install adbc_driver_manager</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># pip install adbc_driver_flightsql</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import adbc_driver_manager</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import adbc_driver_flightsql.dbapi as flight_sql</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># step 2, create a client that interacts with the Doris Arrow Flight SQL service.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Modify arrow_flight_sql_port in fe/conf/fe.conf to an available port, such as 9090.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Modify arrow_flight_sql_port in be/conf/be.conf to an available port, such as 9091.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">conn = flight_sql.connect(uri=&quot;grpc://{FE_HOST}:{fe.conf:arrow_flight_sql_port}&quot;, db_kwargs={</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            adbc_driver_manager.DatabaseOptions.USERNAME.value: &quot;root&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            adbc_driver_manager.DatabaseOptions.PASSWORD.value: &quot;&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        })</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cursor = conn.cursor()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># interacting with Doris via SQL using Cursor</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">def execute(sql):</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    print(&quot;\n### execute query: ###\n &quot; + sql)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cursor.execute(sql)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    print(&quot;### result: ###&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    print(cursor.fetchallarrow().to_pandas())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># step3, execute DDL statements, create database/table, show stmt.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">execute(&quot;DROP DATABASE IF EXISTS arrow_flight_sql FORCE;&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">execute(&quot;show databases;&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">execute(&quot;create database arrow_flight_sql;&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">execute(&quot;show databases;&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">execute(&quot;use arrow_flight_sql;&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">execute(&quot;&quot;&quot;CREATE TABLE arrow_flight_sql_test</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         k0 INT,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         k1 DOUBLE,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         K2 varchar(32) NULL DEFAULT &quot;&quot; COMMENT &quot;&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         k3 DECIMAL(27,9) DEFAULT &quot;0&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         k4 BIGINT NULL DEFAULT &#x27;10&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         k5 DATE,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    DISTRIBUTED BY HASH(k5) BUCKETS 5</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    PROPERTIES(&quot;replication_num&quot; = &quot;1&quot;);&quot;&quot;&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">execute(&quot;show create table arrow_flight_sql_test;&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># step4, insert into</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">execute(&quot;&quot;&quot;INSERT INTO arrow_flight_sql_test VALUES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        (&#x27;0&#x27;, 0.1, &quot;ID&quot;, 0.0001, 9999999999, &#x27;2023-10-21&#x27;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        (&#x27;1&#x27;, 0.20, &quot;ID_1&quot;, 1.00000001, 0, &#x27;2023-10-21&#x27;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        (&#x27;2&#x27;, 3.4, &quot;ID_1&quot;, 3.1, 123456, &#x27;2023-10-22&#x27;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        (&#x27;3&#x27;, 4, &quot;ID&quot;, 4, 4, &#x27;2023-10-22&#x27;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        (&#x27;4&#x27;, 122345.54321, &quot;ID&quot;, 122345.54321, 5, &#x27;2023-10-22&#x27;);&quot;&quot;&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># step5, execute queries, aggregation, sort, set session variable</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">execute(&quot;select * from arrow_flight_sql_test order by k0;&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">execute(&quot;set exec_mem_limit=2000;&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">execute(&quot;show variables like \&quot;%exec_mem_limit%\&quot;;&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">execute(&quot;select k5, sum(k1), count(1), avg(k3) from arrow_flight_sql_test group by k5;&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># step6, close cursor </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cursor.close()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="examples-of-data-transmission-at-scale">Examples of data transmission at scale<a href="#examples-of-data-transmission-at-scale" class="hash-link" aria-label="Direct link to Examples of data transmission at scale" title="Direct link to Examples of data transmission at scale">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="01--python">01  Python<a href="#01--python" class="hash-link" aria-label="Direct link to 01  Python" title="Direct link to 01  Python">‚Äã</a></h3><p>In Python, after connecting to Doris using the ADBC Driver, you can use various ADBC APIs to load the Clickbench dataset from Doris into Python. Here&#x27;s how:</p><div class="language-Python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">#!/usr/bin/env python</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># -*- coding: utf-8 -*-</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import adbc_driver_manager</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import adbc_driver_flightsql.dbapi as flight_sql</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import pandas</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from datetime import datetime</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">my_uri = &quot;grpc://0.0.0.0:`fe.conf_arrow_flight_sql_port`&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">my_db_kwargs = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    adbc_driver_manager.DatabaseOptions.USERNAME.value: &quot;root&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    adbc_driver_manager.DatabaseOptions.PASSWORD.value: &quot;&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sql = &quot;select * from clickbench.hits limit 1000000;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># PEP 249 (DB-API 2.0) API wrapper for the ADBC Driver Manager.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">def dbapi_adbc_execute_fetchallarrow():</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    conn = flight_sql.connect(uri=my_uri, db_kwargs=my_db_kwargs)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cursor = conn.cursor()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    start_time = datetime.now()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cursor.execute(sql)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    arrow_data = cursor.fetchallarrow()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    dataframe = arrow_data.to_pandas()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    print(&quot;\n##################\n dbapi_adbc_execute_fetchallarrow&quot; + &quot;, cost:&quot; + str(datetime.now() - start_time) + &quot;, bytes:&quot; + str(arrow_data.nbytes) + &quot;, len(arrow_data):&quot; + str(len(arrow_data)))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    print(dataframe.info(memory_usage=&#x27;deep&#x27;))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    print(dataframe)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># ADBC reads data into pandas dataframe, which is faster than fetchallarrow first and then to_pandas.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">def dbapi_adbc_execute_fetch_df():</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    conn = flight_sql.connect(uri=my_uri, db_kwargs=my_db_kwargs)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cursor = conn.cursor()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    start_time = datetime.now()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cursor.execute(sql)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    dataframe = cursor.fetch_df()    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    print(&quot;\n##################\n dbapi_adbc_execute_fetch_df&quot; + &quot;, cost:&quot; + str(datetime.now() - start_time))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    print(dataframe.info(memory_usage=&#x27;deep&#x27;))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    print(dataframe)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Can read multiple partitions in parallel.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">def dbapi_adbc_execute_partitions():</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    conn = flight_sql.connect(uri=my_uri, db_kwargs=my_db_kwargs)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cursor = conn.cursor()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    start_time = datetime.now()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    partitions, schema = cursor.adbc_execute_partitions(sql)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cursor.adbc_read_partition(partitions[0])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    arrow_data = cursor.fetchallarrow()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    dataframe = arrow_data.to_pandas()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    print(&quot;\n##################\n dbapi_adbc_execute_partitions&quot; + &quot;, cost:&quot; + str(datetime.now() - start_time) + &quot;, len(partitions):&quot; + str(len(partitions)))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    print(dataframe.info(memory_usage=&#x27;deep&#x27;))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    print(dataframe)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">dbapi_adbc_execute_fetchallarrow()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">dbapi_adbc_execute_fetch_df()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">dbapi_adbc_execute_partitions()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Results are as follows (omitting the repeated outputs). <strong>It only takes 3s</strong> to load a Clickbench dataset containing 1 million rows and 105 columns. </p><div class="language-Python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">##################</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> dbapi_adbc_execute_fetchallarrow, cost:0:00:03.548080, bytes:784372793, len(arrow_data):1000000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RangeIndex: 1000000 entries, 0 to 999999</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Columns: 105 entries, CounterID to CLID</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">dtypes: int16(48), int32(19), int64(6), object(32)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">memory usage: 2.4 GB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">None</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        CounterID   EventDate               UserID            EventTime              WatchID  JavaEnable                                              Title  GoodEvent  ...  UTMCampaign  UTMContent  UTMTerm  FromTag  HasGCLID          RefererHash              URLHash  CLID</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0          245620  2013-07-09  2178958239546411410  2013-07-09 19:30:27  8302242799508478680           1  OWAProfessionov ‚Äî –ú–æ–π –ö—Ä—É–≥ (–°–í–ê–û –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω          1  ...                                                    0 -7861356476484644683 -2933046165847566158     0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">999999       1095  2013-07-03  4224919145474070397  2013-07-03 14:36:17  6301487284302774604           0  @–¥–Ω–µ–≤–Ω–∏–∫–∏ Sinatra (–õ–ê–î–ê, —Ü–µ–Ω–∞ –¥–ª—è –¥–µ—Ç–∞–ª–ª–∏ –∫—Ç–æ ...          1  ...                                                    0  -296158784638538920  1335027772388499430     0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[1000000 rows x 105 columns]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">##################</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> dbapi_adbc_execute_fetch_df, cost:0:00:03.611664</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">##################</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> dbapi_adbc_execute_partitions, cost:0:00:03.483436, len(partitions):1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">##################</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> low_level_api_execute_query, cost:0:00:03.523598, stream.address:139992182177600, rows:-1, bytes:784322926, len(arrow_data):1000000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">##################</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> low_level_api_execute_partitions, cost:0:00:03.738128streams.size:3, 1, -1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="02--jdbc">02  JDBC<a href="#02--jdbc" class="hash-link" aria-label="Direct link to 02  JDBC" title="Direct link to 02  JDBC">‚Äã</a></h3><p>The open-source JDBC driver for the Arrow Flight SQL protocol provides compatibility with the standard JDBC API. It allows most BI tools to access Doris via JDBC and supports high-speed transfer of Apache Arrow data. </p><p>Usage of this driver is similar to using that for the MySQL protocol. You just need to replace <code>jdbc:mysql</code> in the connection URL with <code>jdbc:arrow-flight-sql</code>. The returned result will be in the JDBC ResultSet data structure. </p><div class="language-Java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">import java.sql.Connection;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import java.sql.DriverManager;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import java.sql.ResultSet;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import java.sql.Statement;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Class.forName(&quot;org.apache.arrow.driver.jdbc.ArrowFlightJdbcDriver&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">String DB_URL = &quot;jdbc:arrow-flight-sql://{FE_HOST}:{fe.conf:arrow_flight_sql_port}?useServerPrepStmts=false&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        + &quot;&amp;cachePrepStmts=true&amp;useSSL=false&amp;useEncryption=false&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">String USER = &quot;root&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">String PASS = &quot;&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Connection conn = DriverManager.getConnection(DB_URL, USER, PASS);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Statement stmt = conn.createStatement();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ResultSet resultSet = stmt.executeQuery(&quot;show tables;&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">while (resultSet.next()) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    String col1 = resultSet.getString(1);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    System.out.println(col1);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">resultSet.close();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">stmt.close();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">conn.close();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="03--java">03  JAVA<a href="#03--java" class="hash-link" aria-label="Direct link to 03  JAVA" title="Direct link to 03  JAVA">‚Äã</a></h3><p>Similar to that with Python, you can directly create an ADBC client with JAVA to read data from Doris. Firstly, you need to obtain the FlightInfo. Then, you connect to each endpoint to pull the data.</p><div class="language-Java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// method one</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">AdbcStatement stmt = connection.createStatement()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">stmt.setSqlQuery(&quot;SELECT * FROM &quot; + tableName)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// executeQuery, two steps:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// 1. Execute Query and get returned FlightInfo;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// 2. Create FlightInfoReader to sequentially traverse each Endpoint;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">QueryResult queryResult = stmt.executeQuery()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// method two</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">AdbcStatement stmt = connection.createStatement()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">stmt.setSqlQuery(&quot;SELECT * FROM &quot; + tableName)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Execute Query and parse each Endpoint in FlightInfo, and use the Location and Ticket to construct a PartitionDescriptor</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">partitionResult = stmt.executePartitioned();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">partitionResult.getPartitionDescriptors()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">//Create ArrowReader for each PartitionDescriptor to read data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ArrowReader reader = connection2.readPartition(partitionResult.getPartitionDescriptors().get(0).getDescriptor()))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="04--spark">04  Spark<a href="#04--spark" class="hash-link" aria-label="Direct link to 04  Spark" title="Direct link to 04  Spark">‚Äã</a></h3><p>For Spark users, apart from connecting to Flight SQL Server using JDBC and JAVA, you can apply the <a href="https://github.com/qwshen/spark-flight-connector" target="_blank" rel="noopener noreferrer">Spark-Flight-Connector</a>, which enables Spark to act as a client for reading and writing data from/to a Flight SQL Server. This is made possible by the fast data conversion between the Arrow format and the Block in Apache Doris, which is <strong>10 times faster than the conversion between CSV and Block</strong>. Moreover, the Arrow data format provides more comprehensive and robust support for complex data types such as Map and Array.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="hop-on-the-trend-train">Hop on the trend train<a href="#hop-on-the-trend-train" class="hash-link" aria-label="Direct link to Hop on the trend train" title="Direct link to Hop on the trend train">‚Äã</a></h2><p>A number of enterprise users of Doris has tried loading data from Doris to Python, Spark, and Flink using Arrow Flight SQL and enjoyed much faster data reading speed. In the future, we plan to include the support for Arrow Flight SQL in data writing, too. By then, most systems built with mainstream programming languages will be able to read and write data from/to Apache Doris by an ADBC client. That&#x27;s high-speed data interaction which opens up numerous possibilities. On our to-do list, we also envision leveraging Arrow Flight to implement parallel data reading by multiple backends and facilitate federated queries across Doris and Spark. </p><p>Download <a href="https://doris.apache.org/download/" target="_blank" rel="noopener noreferrer">Apache Doris 2.1</a> and get a taste of 100 times faster data transfer powered by Arrow Flight SQL. If you need assistance, come find us in the <a href="https://join.slack.com/t/apachedoriscommunity/shared_invite/zt-2kl08hzc0-SPJe4VWmL_qzrFd2u2XYQA" target="_blank" rel="noopener noreferrer">Apache Doris developer and user community</a>.</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><div class="text-center mb-4"><a class="text-[#8592A6] cursor-pointer hover:no-underline" href="/blog">Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class="s-tags"><span class="s-tag">Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:text-[2.5rem] text-center" itemprop="headline"><a itemprop="url" href="/blog/auto-increment-columns-in-databases">Auto-increment columns in databases: a simple magic that makes a big difference</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class="authors"><span class="s-author text-black">Apache Doris</span></span><time datetime="2024-04-08T00:00:00.000Z" itemprop="datePublished" class="text-black ml-4">April 8, 2024</time></div></header><div class="markdown" itemprop="articleBody"><p>Auto-increment column is a bread-and-butter feature of single-node transactional databases. It assigns a unique identifier for each row in a way that requires the least manual effort from users. With an auto-increment column in the table, whenever a new row is inserted into the table, the new row will be assigned with the next available value from the auto-increment sequence. This is an automated mechanism that makes database maintenance easy and reliable.</p><p>Auto-increment column is the bedrock of many features in databases:</p><ul><li><p><strong>Dictionary encoding</strong>: User IDs and Order IDs are often stored as strings. However, strings are not friendly to precise deduplication query execution. So for optimal performance, a common practice is to perform dictionary encoding on the strings and then construct a bitmap for aggregation operations. The role of an auto-increment column in this process is that <strong>it speeds up dictionary encoding and thus accelerates string deduplication</strong>.</p></li><li><p><strong>Primary key generation</strong>: An auto-increment column is the perfect candidate for the primary key of a table. Primary keys must be unique and not empty, while auto-increment columns guarantee a unique identifier for each row. </p></li><li><p><strong>Detailed data updates</strong>: Updating detail tables is tricky, but it can be easy if you add a auto-increment table to it. It gives each data record in the database a unique ID, which can work as the primary key, and then data updates can be done based on the primary key.</p></li><li><p><strong>Efficient pagination</strong>: Pagination is often required in data display. It is typically implemented by the <code>limit</code> or <code>offset</code> + <code>order by</code> statement in SQL queries. However, such implementation involves full data reading and sorting, which doesn&#x27;t make so much sense in deep pagination queries (those with large offsets). This is when auto-increment columns come to the rescue. Like I said, it gives a unique identifier to each row, so the maximum identifier of the last page can be used as the filtering condition for the next page. Thus, it can avoid a lot of unnecessary data scanning and increase pagination efficiency.</p></li></ul><p>The idea of auto-increment columns is intuitive, but when it comes to distributed databases, it becomes a different game, because it has to consider global transactions. As a distributed DBMS, Apache Doris provides an innovative and efficient auto-increment solution that does no harm to data writing performance.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>To give AUTO_INCREMENT column a spin, follow this quick <a href="https://www.youtube.com/watch?v=FGVp2RQvGBo" target="_blank" rel="noopener noreferrer">demo</a>.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="syntax--usage">Syntax &amp; usage<a href="#syntax--usage" class="hash-link" aria-label="Direct link to Syntax &amp; usage" title="Direct link to Syntax &amp; usage">‚Äã</a></h2><p>To enable an auto-increment column in Doris, add <code>AUTO_INCREMENT</code> property to the column in the table creation statement (<a href="https://doris.apache.org/zh-CN/docs/sql-manual/sql-statements/Data-Definition-Statements/Create/CREATE-TABLE" target="_blank" rel="noopener noreferrer">CREAT-TABLE</a>). You can specify a starting value for the auto-increment column via <code>AUTO_INCREMENT(start_value)</code>; if not, the default starting value is 1.</p><p>For example, you can create a table in the <a href="https://doris.apache.org/docs/data-table/data-model#duplicate-model" target="_blank" rel="noopener noreferrer">Duplicate Key model</a>, with one of the key columns being an auto-increment column. </p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">demo</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">tbl</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AUTO_INCREMENT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">value</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ENGINE</span><span class="token operator">=</span><span class="token plain">OLAP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DUPLICATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">&quot;replication_allocation&quot;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;tag.location.default: 3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Apart from a key column, you can also specify a value column as an auto-increment column (example below):</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">demo</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">tbl</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">uid</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">name</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AUTO_INCREMENT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">value</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ENGINE</span><span class="token operator">=</span><span class="token plain">OLAP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DUPLICATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">uid</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">name</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">uid</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">&quot;replication_allocation&quot;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;tag.location.default: 3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>AUTO_INCREMENT is supported in both the Duplicate Key model and the <a href="https://doris.apache.org/docs/data-table/data-model/#unique-model" target="_blank" rel="noopener noreferrer">Unique Key model</a>. Usage in the latter is similar.</p><p>I will walk you down the rest of the road with the table below as an example: </p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">demo</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">tbl</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AUTO_INCREMENT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">name</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">65533</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">value</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">11</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ENGINE</span><span class="token operator">=</span><span class="token plain">OLAP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">UNIQUE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">&quot;replication_allocation&quot;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;tag.location.default: 3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When you ingest data into this table using an <code>insert into</code> statement, if the <code>id</code> column has no specified value in the original data file, it will be auto-filled with auto-increment values.</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">into</span><span class="token plain"> tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">values</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Bob&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Alice&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Jack&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">30</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Query OK</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.09</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;label&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;label_183babcb84ad4023_a2d6266ab73fb5aa&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;status&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;VISIBLE&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;txnId&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;7&#x27;</span><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> tbl </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------+-------+-------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> id   </span><span class="token operator">|</span><span class="token plain"> name  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">value</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------+-------+-------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Bob   </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">10</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Alice </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">20</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">3</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Jack  </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">30</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------+-------+-------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">3</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.05</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Similarly, when you ingest a data file <code>test.csv</code> by Stream Load, the <code>id</code> column will be auto-filled with auto-increment values, too.</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">test</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">csv:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Tom</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">40</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">John</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">50</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">curl </span><span class="token comment" style="color:rgb(98, 114, 164)">--location-trusted -u user:passwd -H &quot;columns:name,value&quot; -H &quot;column_separator:,&quot; -T ./test.csv http://{host}:{port}/api/{db}/tbl/_stream_load</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> tbl </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------+-------+-------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> id   </span><span class="token operator">|</span><span class="token plain"> name  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">value</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------+-------+-------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Bob   </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">10</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Alice </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">20</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">3</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Jack  </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">30</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">4</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Tom   </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">40</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">5</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> John  </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">50</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------+-------+-------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">5</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.04</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="applicable-scenarios">Applicable scenarios<a href="#applicable-scenarios" class="hash-link" aria-label="Direct link to Applicable scenarios" title="Direct link to Applicable scenarios">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="01-dictionary-encoding">01 Dictionary encoding<a href="#01-dictionary-encoding" class="hash-link" aria-label="Direct link to 01 Dictionary encoding" title="Direct link to 01 Dictionary encoding">‚Äã</a></h3><p>In Apache Doris, the bitmap data type and the bitmap-related aggregations are implemented with RoaringBitmap, which can deliver high performance especially when dictionary encoding produces dense values. </p><p>As is mentioned, auto-increment columns enable fast dictionary encoding. I will put you into the context of user profiling to show you how that works.</p><p>For analysis of offline page views (PV) and unique visitors (UV), store the details in a user behavior table: </p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">demo</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dwd_dup_tbl</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">50</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dim1</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">50</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dim2</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">50</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dim3</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">50</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dim4</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">50</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dim5</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">50</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">visit_time</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DATE</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ENGINE</span><span class="token operator">=</span><span class="token plain">OLAP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DUPLICATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">32</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">&quot;replication_allocation&quot;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;tag.location.default: 3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Create a dictionary table as follows leveraging AUTO_INCREMENT:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">demo</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dictionary_tbl</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">50</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">aid</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AUTO_INCREMENT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ENGINE</span><span class="token operator">=</span><span class="token plain">OLAP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">UNIQUE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">32</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">&quot;replication_allocation&quot;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;tag.location.default: 3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Load the existing <code>user_id</code> into the dictionary table, and create mappings from <code>user_id</code> to integer values.</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">into</span><span class="token plain"> dictionary_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> user_id </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> dwd_dup_tbl </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">group</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"> user_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you only need to load the incremental <code>user_id</code> into the dictionary table, you can use the following command. In practice, you can also use the <a href="https://doris.apache.org/docs/ecosystem/flink-doris-connector/" target="_blank" rel="noopener noreferrer">Flink Doris Connector</a> for data writing. </p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">into</span><span class="token plain"> dictionary_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> dwd_dup_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">user_id </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> dwd_dup_tbl </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">left</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">join</span><span class="token plain"> dictionary_tbl</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">on</span><span class="token plain"> dwd_dup_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">user_id </span><span class="token operator">=</span><span class="token plain"> dictionary_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">user_id </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> dwd_dup_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">visit_time  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2023-12-10&#x27;</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> dictionary_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">user_id </span><span class="token operator">is</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Suppose you have your analytic dimensions as <code>dim1</code>,  <code>dim3</code>,  <code>dim5</code>, create a table in the <a href="https://doris.apache.org/docs/data-table/data-model#aggregate-model" target="_blank" rel="noopener noreferrer">Aggregate Key model</a> to accommodate the results of data aggregation:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">demo</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dws_agg_tbl</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dim1</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">50</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dim3</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">50</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dim5</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">50</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id_bitmap</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> BITMAP BITMAP_UNION </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">pv</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain"> SUM </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ENGINE</span><span class="token operator">=</span><span class="token plain">OLAP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">AGGREGATE </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dim1</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dim3</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dim5</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dim1</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">32</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">&quot;replication_allocation&quot;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;tag.location.default: 3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Load the aggregated results into the table:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">into</span><span class="token plain"> dws_agg_tbl</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> dwd_dup_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dim1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> dwd_dup_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dim3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> dwd_dup_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dim5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> BITMAP_UNION</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">TO_BITMAP</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">dictionary_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">aid</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">COUNT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> dwd_dup_tbl </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INNER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">JOIN</span><span class="token plain"> dictionary_tbl </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">on</span><span class="token plain"> dwd_dup_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">user_id </span><span class="token operator">=</span><span class="token plain"> dictionary_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">user_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">group</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"> dwd_dup_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dim1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> dwd_dup_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dim3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> dwd_dup_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dim5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then you query PV/UV using the following statement:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> dim1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> dim3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> dim5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> bitmap_count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">user_id_bitmap</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> uv</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> pv </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> dws_agg_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="02-detailed-data-updates">02 Detailed data updates<a href="#02-detailed-data-updates" class="hash-link" aria-label="Direct link to 02 Detailed data updates" title="Direct link to 02 Detailed data updates">‚Äã</a></h3><p>In Doris, the Unique Key model is applicable to use cases with frequent data updates, while the Duplicate Key model is designed for detailed data storage with no data updating requirements.</p><p>However, in real life, users might need to update their detailed data sometimes, which can be hard to implement because the data tables don&#x27;t come with unique key columns.</p><p>In this case, you can <strong>use an auto-increment column as the primary key for the detailed data</strong>.</p><p>For example, a financial institution keeps record of customer loans and writes it into a Duplicate Key table, in which one single user might have multiple borrowing records. </p><div class="language-Python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE TABLE loan_records (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `user_id` VARCHAR(20) DEFAULT NULL COMMENT &#x27;Customer ID&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `loan_amount` DECIMAL(10, 2) DEFAULT NULL COMMENT &#x27;Amount of loan&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `interest_rate` DECIMAL(10, 2) DEFAULT NULL COMMENT &#x27;Interest rate&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `loan_start_date` DATE DEFAULT NULL COMMENT &#x27;Start date of the loan&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `loan_end_date` DATE DEFAULT NULL COMMENT &#x27;End date of the loan&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `total_debt` DECIMAL(10, 2) DEFAULT NULL COMMENT &#x27;Amount of debt&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">) DUPLICATE KEY(`user_id`)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DISTRIBUTED BY HASH(`user_id`) BUCKETS 10</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;replication_allocation&quot; = &quot;tag.location.default: 3&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Suppose that in a promotional campaign, the institution offers a 10% discount on interest rates to its existing customers. Correspondingly, there is a need to update the <code>interest_rate</code> and <code>total_debt</code> in the table.</p><p>For that sake, you can create a Unique Key table for the same data, but add an <code>auto_id</code> field and set it as the primary key. </p><div class="language-Python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE TABLE loan_records (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `auto_id` BIGINT NOT NULL AUTO_INCREMENT,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `user_id` VARCHAR(20) DEFAULT NULL COMMENT &#x27;Customer ID&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `loan_amount` DECIMAL(10, 2) DEFAULT NULL COMMENT &#x27;Amount of loan&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `interest_rate` DECIMAL(10, 2) DEFAULT NULL COMMENT &#x27;Interest rate&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `loan_start_date` DATE DEFAULT NULL COMMENT &#x27;Start date of the loan&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `loan_end_date` DATE DEFAULT NULL COMMENT &#x27;End date of the loan&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `total_debt` DECIMAL(10, 2) DEFAULT NULL COMMENT &#x27;Amount of debt&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">) UNIQUE KEY(`auto_id`)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DISTRIBUTED BY HASH(`auto_id`) BUCKETS 10</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;replication_allocation&quot; = &quot;tag.location.default: 3&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now, write a few new records into the table and see what happens. (Note that you don&#x27;t have to write in the <code>auto_id</code> field.)</p><div class="language-Python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">INSERT INTO loan_records (user_id, loan_amount, interest_rate, loan_start_date, loan_end_date, total_debt) VALUES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(&#x27;10001&#x27;, 5000.00, 5.00, &#x27;2024-03-01&#x27;, &#x27;2024-03-31&#x27;, 5020.55),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(&#x27;10002&#x27;, 10000.00, 5.00, &#x27;2024-03-01&#x27;, &#x27;2024-05-01&#x27;, 10082.56),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(&#x27;10003&#x27;, 2000.00, 5.00, &#x27;2024-03-01&#x27;, &#x27;2024-03-15&#x27;, 2003.84),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(&#x27;10004&#x27;, 7500.00, 5.00, &#x27;2024-03-01&#x27;, &#x27;2024-04-15&#x27;, 7546.23),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(&#x27;10005&#x27;, 3000.00, 5.00, &#x27;2024-03-01&#x27;, &#x27;2024-03-21&#x27;, 3008.22),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(&#x27;10002&#x27;, 8000.00, 5.00, &#x27;2024-03-01&#x27;, &#x27;2024-06-01&#x27;, 8100.82),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(&#x27;10007&#x27;, 6000.00, 5.00, &#x27;2024-03-01&#x27;, &#x27;2024-04-10&#x27;, 6032.88),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(&#x27;10008&#x27;, 4000.00, 5.00, &#x27;2024-03-01&#x27;, &#x27;2024-03-26&#x27;, 4013.70),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(&#x27;10001&#x27;, 5500.00, 5.00, &#x27;2024-03-01&#x27;, &#x27;2024-04-05&#x27;, 5526.37),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(&#x27;10010&#x27;, 9000.00, 5.00, &#x27;2024-03-01&#x27;, &#x27;2024-05-10&#x27;, 9086.30);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Check with the <code>select * from loan_records</code> statement, and you can see a unique ID is already in place for each newly-ingested record:</p><div class="language-Python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; select * from loan_records;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------+---------+-------------+---------------+-----------------+---------------+------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| auto_id | user_id | loan_amount | interest_rate | loan_start_date | loan_end_date | total_debt |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------+---------+-------------+---------------+-----------------+---------------+------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|       1 | 10001   |     5000.00 |          5.00 | 2024-03-01      | 2024-03-31    |    5020.55 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|       4 | 10004   |     7500.00 |          5.00 | 2024-03-01      | 2024-04-15    |    7546.23 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|       2 | 10002   |    10000.00 |          5.00 | 2024-03-01      | 2024-05-01    |   10082.56 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|       3 | 10003   |     2000.00 |          5.00 | 2024-03-01      | 2024-03-15    |    2003.84 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|       6 | 10002   |     8000.00 |          5.00 | 2024-03-01      | 2024-06-01    |    8100.82 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|       8 | 10008   |     4000.00 |          5.00 | 2024-03-01      | 2024-03-26    |    4013.70 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|       7 | 10007   |     6000.00 |          5.00 | 2024-03-01      | 2024-04-10    |    6032.88 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|       9 | 10001   |     5500.00 |          5.00 | 2024-03-01      | 2024-04-05    |    5526.37 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|       5 | 10005   |     3000.00 |          5.00 | 2024-03-01      | 2024-03-21    |    3008.22 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|      10 | 10010   |     9000.00 |          5.00 | 2024-03-01      | 2024-05-10    |    9086.30 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------+---------+-------------+---------------+-----------------+---------------+------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">10 rows in set (0.01 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Execute these two SQL statements to update <code>interest_rate</code> and <code>total_debt</code>, respectively:</p><div class="language-Python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">update loan_records set interest_rate = interest_rate * 0.9 where user_id &lt;= 10005;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">update loan_records set total_debt = loan_amount + (loan_amount * (interest_rate / 100) * DATEDIFF(loan_end_date, loan_start_date) / 365);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Check again to see if the old records have been replaced by the new ones:</p><div class="language-Python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; select * from loan_records order by auto_id;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------+---------+-------------+---------------+-----------------+---------------+------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| auto_id | user_id | loan_amount | interest_rate | loan_start_date | loan_end_date | total_debt |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------+---------+-------------+---------------+-----------------+---------------+------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|       1 | 10001   |     5000.00 |          4.50 | 2024-03-01      | 2024-03-31    |    5018.49 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|       2 | 10002   |    10000.00 |          4.50 | 2024-03-01      | 2024-05-01    |   10075.21 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|       3 | 10003   |     2000.00 |          4.50 | 2024-03-01      | 2024-03-15    |    2003.45 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|       4 | 10004   |     7500.00 |          4.50 | 2024-03-01      | 2024-04-15    |    7541.61 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|       5 | 10005   |     3000.00 |          4.50 | 2024-03-01      | 2024-03-21    |    3007.40 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|       6 | 10002   |     8000.00 |          4.50 | 2024-03-01      | 2024-06-01    |    8090.74 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|       7 | 10007   |     6000.00 |          5.00 | 2024-03-01      | 2024-04-10    |    6032.88 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|       8 | 10008   |     4000.00 |          5.00 | 2024-03-01      | 2024-03-26    |    4013.70 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|       9 | 10001   |     5500.00 |          4.50 | 2024-03-01      | 2024-04-05    |    5523.73 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|      10 | 10010   |     9000.00 |          5.00 | 2024-03-01      | 2024-05-10    |    9086.30 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------+---------+-------------+---------------+-----------------+---------------+------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">10 rows in set (0.01 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="03-efficient-pagination">03 Efficient pagination<a href="#03-efficient-pagination" class="hash-link" aria-label="Direct link to 03 Efficient pagination" title="Direct link to 03 Efficient pagination">‚Äã</a></h3><p>Imagine that you need to sort the data in a specific order and then retrieve record No. 90,001 to record No. 90,010. This means you have a large offset of 90,000. This is what we call a deep pagination query. Even though you only require a result set of 10 rows, the database system still has to read the entire dataset into memory and perform a full sorting.</p><p><strong>For higher execution efficiency in deep pagination queries, you can harness the power of auto-increment columns</strong>. The main idea is to record the <code>max_value</code> from the <code>unique_value</code> column of the previous page, and push down predicates by <code>where unique_value &gt; max_value limit rows_per_page</code>.</p><p>For example, during table creation, you enable an auto-increment column: <code>unique_value</code>, which gives each row an identifier.</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">demo</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">records_tbl</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">11</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">name</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">26</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">address</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">41</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">city</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">11</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">nation</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">16</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">region</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">13</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">phone</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">16</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">mktsegment</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">11</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">unique_value</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AUTO_INCREMENT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DUPLICATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">name</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;replication_allocation&quot;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;tag.location.default: 3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In pagination queries, suppose that each page displays 100 results, this is how you retrieve the first page of the result set. </p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> records_tbl </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"> unique_value </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">limit</span><span class="token plain"> </span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Use programs to record the maximum <code>unique_value</code> in the returned result. Suppose that the maximum is 99, you can query data from the second page using the following statement:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> records_tbl </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> unique_value </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token number">99</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"> unique_value </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">limit</span><span class="token plain"> </span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you need to query data from a deeper page, for example, page 101, which means it&#x27;s hard to get the maximum <code>unique_value</code> from the previous page directly, then you can use the statement as follows:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> user_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> city</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> nation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> region</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> phone</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> mktsegment</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> records_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> unique_value </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> max_value </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> records_tbl </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"> unique_value </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">limit</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">offset</span><span class="token plain"> </span><span class="token number">9999</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> previous_data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> records_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">unique_value </span><span class="token operator">&gt;</span><span class="token plain"> previous_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">max_value</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"> unique_value </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">limit</span><span class="token plain"> </span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="implementation">Implementation<a href="#implementation" class="hash-link" aria-label="Direct link to Implementation" title="Direct link to Implementation">‚Äã</a></h2><p>Typical OLTP databases perform incremental ID matching by their transaction mechanisms. However, in an MPP-based distributed database system like Apache Doris, such an approach can easily suffocate data writing performance. </p><p>That&#x27;s why Apache Doris 2.1 innovates the implementation of auto-increment IDs. In a data ingestion task, one of the backend (BE) nodes will work as the coordinator, which is responsible for the allocation of auto-increment IDs. The coordinator BE requests a range of IDs in bulk from the frontend (FE). The FE makes sure that the ID ranges allocated to each BE do not overlap, thus guaranteeing the uniqueness of IDs.</p><p>I illustrate the process with the figure below. StreamLoad1 has BE1 as the coordinator. BE1 requests a batch of IDs (range: 1-1000) from the FE and caches the IDs locally. Once all 1000 IDs are allocated, BE1 will request a new batch from the FE. At the same time, StreamLoad 2 selects BE3 as the coordinator, and BE3 also requests IDs from the FE. Since IDs 1-1000 have already been allocated to BE1, the FE assigns IDs 1001-2000 to BE3.</p><p><img loading="lazy" alt="the implementation of auto-increment IDs" src="https://cdnd.selectdb.com/assets/images/the-implementation-of-auto-increment-IDs-d48d7814da087bde1ef5fe3fbf0db7b5.png" width="1280" height="1100" class="img_ev3q"></p><p>Suppose that StreamLoad1 and StreamLoad2 each write in 50 new data records, the auto-increment IDs assigned to them will be 1-50 and 1001-1050. </p><p>Suppose that StreamLoad3 arises later and selects BE1 as the coordinator, BE1 will assign IDs starting from 51 to the data written by StreamLoad3. From the user&#x27;s side, they will see that rows written by StreamLoad3 get smaller ID numbers than those by StreamLoad2, even though StreamLoad2 precedes StreamLoad3 in time.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="note">Note<a href="#note" class="hash-link" aria-label="Direct link to Note" title="Direct link to Note">‚Äã</a></h2><p>Attention is required regarding: </p><ul><li><p><strong>Scope of uniqueness guarantee</strong>: Doris ensures that the values generated on an auto-increment column are unique within the table, but this only applies to values auto-filled by Doris. If a user explicitly inserts values into the auto-increment column, Doris cannot guarantee the uniqueness of those values.</p></li><li><p><strong>Density and continuity of values</strong>: Doris ensures that the values generated by the auto-increment column are dense. However, for performance reasons, it cannot guarantee that the auto-filled values are continuous. This means there may be occurrences of value jumps in the auto-increment column. Additionally, since the auto-increment values are pre-allocated and cached in BE, the magnitude of the auto-increment values cannot reflect the order of data import.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">‚Äã</a></h2><p>AUTO_INCREMENT brings higher stability and reliability for Doris in large-scale data processing. If it sounds like something you need, download <a href="https://doris.apache.org/download/" target="_blank" rel="noopener noreferrer">Apache Doris</a> and try it out. For issues you come across along the way, join us in the <a href="https://join.slack.com/t/apachedoriscommunity/shared_invite/zt-2kl08hzc0-SPJe4VWmL_qzrFd2u2XYQA" target="_blank" rel="noopener noreferrer">Apache Doris developer and user community</a> and we are happy to help.</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><div class="text-center mb-4"><a class="text-[#8592A6] cursor-pointer hover:no-underline" href="/blog">Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class="s-tags"><span class="s-tag">Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:text-[2.5rem] text-center" itemprop="headline"><a itemprop="url" href="/blog/variant-in-apache-doris-2.1">Variant in Apache Doris 2.1.0: a new data type 8 times faster than JSON for semi-structured data analysis</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class="authors"><span class="s-author text-black">Apache Doris</span></span><time datetime="2024-03-26T00:00:00.000Z" itemprop="datePublished" class="text-black ml-4">March 26, 2024</time></div></header><div class="markdown" itemprop="articleBody"><p>Semi-structured data is data arranged in flexible formats. Unlike structured data, it does not require data users to pre-define the table schema for it, so it provides convenience for data storage and analysis. Common forms of semi-structured data include XML, JSON, and log files. They are widely seen in the following industry scenarios:</p><ul><li><p><strong>E-commerce</strong> platforms store user reviews of products as semi-structured data for sentiment analysis and user behavior pattern mining.</p></li><li><p><strong>Telecommunication</strong> use cases often require schemaless support for their network data and complicated nested JSON data.</p></li><li><p><strong>Mobile applications</strong> keep records of user behavior in the form of semi-structured data, because after new features are introduced, the user behavior attributes can change. A non-fixed schema can adapt to these changes easily and save the trouble of frequent manual modification. </p></li><li><p><strong>Internet of Vehicles</strong> (IoV) and <strong>Internet of Things</strong> (IoT) platforms receive real-time data from vehicle sensors, such as speed, location, and fuel consumption, based on which they perform real-time monitoring, fault alerting, and route planning. Such data is also stored as semi-structured data.</p></li></ul><p>As an open-source real-time data warehouse, <a href="https://doris.apache.org" target="_blank" rel="noopener noreferrer">Apache Doris</a> provides semi-structured data processing capabilities, and the newly-released <a href="https://doris.apache.org/blog/release-note-2.1.0" target="_blank" rel="noopener noreferrer">version 2.1.0</a> makes a stride in this direction. Before V2.1, Apache Doris stores semi-structured data as JSON files. However, during query execution, the real-time parsing of JSON data leads to high CPU and I/O consumption in addition to high query latency, especially when the dataset is huge and complicated. Moreover, the lack of a pre-defined schema means there is no handle for query optimization. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="a-newly-added-data-type-variant">A newly-added data type: Variant<a href="#a-newly-added-data-type-variant" class="hash-link" aria-label="Direct link to A newly-added data type: Variant" title="Direct link to A newly-added data type: Variant">‚Äã</a></h2><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>To help you quickly learn and use Variant data type, we provide <strong><a href="https://www.youtube.com/watch?v=FVfsnkZUBsU" target="_blank" rel="noopener noreferrer">a hands-on demo</a> </strong></p></div></div><p>In Apache Doris 2.1.0, we have introduced a new data type: <a href="https://doris.apache.org/docs/sql-manual/sql-reference/Data-Types/VARIANT" target="_blank" rel="noopener noreferrer">Variant</a>. Fields of the Variant data type can accommodate integers, strings, boolean values, and any combination of them. With Variant, you don&#x27;t have to define the specific columns in the table schema in advance.</p><p>The Variant data type is well-suited to handle nested structures, which tend to change dynamically. Upon data writing, the Variant type automatically infers column information based on the data and its structure in the columns, and then merges it into the existing table schema. It stores the JSON keys and their corresponding values as dynamic sub-columns. </p><p>Meanwhile, you can include both Variant columns and static columns of pre-defined data types in the same table. This Schema-on-Write method provides greater flexibility in storage and queries. Powered by the columnar storage, vectorized execution engine, and query optimizer of Doris, the Variant type delivers high efficiency in queries and storage. </p><p>Compared to the JSON type, storage data in the Variant type can save up to 65% of disk space, and increase query speed by 8 times. (See details later in this post)</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="usage-guide">Usage guide<a href="#usage-guide" class="hash-link" aria-label="Direct link to Usage guide" title="Direct link to Usage guide">‚Äã</a></h2><p>Create table: syntax keyword <code>variant</code></p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">-- No index</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">IF</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">EXISTS</span><span class="token plain"> ${table_name} </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    k </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    v VARIANT</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">table_properties</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">-- Create index for the v column, specify the parser</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">IF</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">EXISTS</span><span class="token plain"> ${table_name} </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    k </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    v VARIANT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INDEX</span><span class="token plain"> idx_var</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">v</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">USING</span><span class="token plain"> INVERTED </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">PROPERTIES</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;parser&quot;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;english|unicode|chinese&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;your comment&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">table_properties</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">-- Create Bloom Filter for the v column</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">IF</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">EXISTS</span><span class="token plain"> ${table_name} </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    k </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    v VARIANT</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">properties</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;replication_num&quot;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;1&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;bloom_filter_columns&quot;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;v&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Query: access sub-column via <code>[]</code>. The sub-columns are also of the Variant type.</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> v</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;properties&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;title&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> ${table_name}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now, let&#x27;s show you how to create a table containing the Variant data type and conduct data ingestion and queries to it. The dataset is Github Events records. This is one of the formatted records:</p><div class="language-JSON codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-JSON codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;id&quot;: &quot;14186154924&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;type&quot;: &quot;PushEvent&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;actor&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;id&quot;: 282080,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;login&quot;: &quot;brianchandotcom&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;display_login&quot;: &quot;brianchandotcom&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;gravatar_id&quot;: &quot;&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;url&quot;: &quot;https://api.github.com/users/brianchandotcom&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;avatar_url&quot;: &quot;https://avatars.githubusercontent.com/u/282080?&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;repo&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;id&quot;: 1920851,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;name&quot;: &quot;brianchandotcom/liferay-portal&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;url&quot;: &quot;https://api.github.com/repos/brianchandotcom/liferay-portal&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;payload&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;push_id&quot;: 6027092734,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;size&quot;: 4,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;distinct_size&quot;: 4,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;ref&quot;: &quot;refs/heads/master&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;head&quot;: &quot;91edd3c8c98c214155191feb852831ec535580ba&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;before&quot;: &quot;abb58cc0db673a0bd5190000d2ff9c53bb51d04d&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;commits&quot;: [&quot;&quot;]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;public&quot;: true,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;created_at&quot;: &quot;2020-11-13T18:00:00Z&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="01--create-table">01  Create table<a href="#01--create-table" class="hash-link" aria-label="Direct link to 01  Create table" title="Direct link to 01  Create table">‚Äã</a></h3><ul><li><p>Create 3 columns of the Variant type: <code>actor</code>, <code>repo</code> and <code>payload</code></p></li><li><p>Meanwhile, create inverted index for the <code>payload</code> column: <code>idx_payload</code></p></li><li><p><code>USING INVERTED</code> specifies the index as inverted index, which accelerates conditional filtering on sub-columns</p></li></ul><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DATABASE</span><span class="token plain"> test_variant</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">USE</span><span class="token plain"> test_variant</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">IF</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">EXISTS</span><span class="token plain"> github_events </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    id </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">type</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">30</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    actor VARIANT </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    repo VARIANT </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    payload VARIANT </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BOOLEAN</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    created_at </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DATETIME</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INDEX</span><span class="token plain"> idx_payload </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">payload</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">USING</span><span class="token plain"> INVERTED PROPERTIES</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;parser&quot;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;english&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;inverted index for payload&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DUPLICATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">properties</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;replication_num&quot;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;1&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>Note: If the <code>Payload</code> column has too many sub-columns, creating indexes on it may lead to an excessive number of index columns and decrease data writing performance. If the data analysis only involves equivalence queries, it is advisable to build Bloom Filter index on the Variant columns. This can bring better performance than inverted index. For a single Variant column, if the parsing properties are the same but you have multiple parsing requirements, you can replicate the column and specify various indexes for each of them.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="02--ingest-data-by-stream-load">02  Ingest data by Stream Load<a href="#02--ingest-data-by-stream-load" class="hash-link" aria-label="Direct link to 02  Ingest data by Stream Load" title="Direct link to 02  Ingest data by Stream Load">‚Äã</a></h3><p>Load the <code>gh_2022-11-07-3.json</code> file, which is Github Events records of an hour. One formatted row of it looks like this: </p><div class="language-JSON codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-JSON codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">wget https://qa-build.oss-cn-beijing.aliyuncs.com/regression/variant/gh_2022-11-07-3.json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">curl --location-trusted -u root:  -T gh_2022-11-07-3.json -H &quot;read_json_by_line:true&quot; -H &quot;format:json&quot;  http://127.0.0.1:18148/api/test_variant/github_events/_strea</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">m_load</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;TxnId&quot;: 2,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;Label&quot;: &quot;086fd46a-20e6-4487-becc-9b6ca80281bf&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;Comment&quot;: &quot;&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;TwoPhaseCommit&quot;: &quot;false&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;Status&quot;: &quot;Success&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;Message&quot;: &quot;OK&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;NumberTotalRows&quot;: 139325,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;NumberLoadedRows&quot;: 139325,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;NumberFilteredRows&quot;: 0,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;NumberUnselectedRows&quot;: 0,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;LoadBytes&quot;: 633782875,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;LoadTimeMs&quot;: 7870,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;BeginTxnTimeMs&quot;: 19,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;StreamLoadPutTimeMs&quot;: 162,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;ReadDataTimeMs&quot;: 2416,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;WriteDataTimeMs&quot;: 7634,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;CommitAndPublishTimeMs&quot;: 55</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Check if the data loading succeeds:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">-- Check the number of rows</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> github_events</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">----------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">----------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain">   </span><span class="token number">139325</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">----------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">row</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.25</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">-- View a random row</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> github_events </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">limit</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------------+-----------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------+---------------------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> id          </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">type</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> actor                                                                                                                                                                                                                       </span><span class="token operator">|</span><span class="token plain"> repo                                                                                                                                                     </span><span class="token operator">|</span><span class="token plain"> payload                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> created_at          </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------------+-----------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------+---------------------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">25061821748</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> PushEvent </span><span class="token operator">|</span><span class="token plain"> {</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;gravatar_id&quot;</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;display_login&quot;</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;jfrog-pipelie-intg&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;url&quot;</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;https://api.github.com/users/jfrog-pipelie-intg&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;id&quot;</span><span class="token plain">:</span><span class="token number">98024358</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;login&quot;</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;jfrog-pipelie-intg&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;avatar_url&quot;</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;https://avatars.githubusercontent.com/u/98024358?&quot;</span><span class="token plain">} </span><span class="token operator">|</span><span class="token plain"> {</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;url&quot;</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;https://api.github.com/repos/jfrog-pipelie-intg/jfinte2e_1667789956723_16&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;id&quot;</span><span class="token plain">:</span><span class="token number">562683829</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;name&quot;</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;jfrog-pipelie-intg/jfinte2e_1667789956723_16&quot;</span><span class="token plain">} </span><span class="token operator">|</span><span class="token plain"> {</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;commits&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">{</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;sha&quot;</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;334433de436baa198024ef9f55f0647721bcd750&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;author&quot;</span><span class="token plain">:{</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;email&quot;</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;98024358+jfrog-pipelie-intg@users.noreply.github.com&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;name&quot;</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;jfrog-pipelie-intg&quot;</span><span class="token plain">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;message&quot;</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;commit message 10238493157623136117&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;distinct&quot;</span><span class="token plain">:</span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;url&quot;</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;https://api.github.com/repos/jfrog-pipelie-intg/jfinte2e_1667789956723_16/commits/334433de436baa198024ef9f55f0647721bcd750&quot;</span><span class="token plain">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;before&quot;</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;f84a26792f44d54305ddd41b7e3a79d25b1a9568&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;head&quot;</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;334433de436baa198024ef9f55f0647721bcd750&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;size&quot;</span><span class="token plain">:</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;push_id&quot;</span><span class="token plain">:</span><span class="token number">11572649828</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;ref&quot;</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;refs/heads/test-notification-sent-branch-10238493157623136113&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;distinct_size&quot;</span><span class="token plain">:</span><span class="token number">1</span><span class="token plain">} </span><span class="token operator">|</span><span class="token plain">      </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">07</span><span class="token plain"> </span><span class="token number">11</span><span class="token plain">:</span><span class="token number">00</span><span class="token plain">:</span><span class="token number">00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------------+-----------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------+---------------------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">row</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.23</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>View schema information via <code>desc</code>. The sub-columns will be automatically extended in the storage layer, and the data types of the sub-columns are automatically inferred.</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">-- No display of extended columns</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">desc</span><span class="token plain"> github_events</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------------+-------------+------+-------+---------+-------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> Field      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Type</span><span class="token plain">        </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">Null</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Key</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Default</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Extra </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------------+-------------+------+-------+---------+-------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> id         </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">No</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">type</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">30</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> actor      </span><span class="token operator">|</span><span class="token plain"> VARIANT     </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> repo       </span><span class="token operator">|</span><span class="token plain"> VARIANT     </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> payload    </span><span class="token operator">|</span><span class="token plain"> VARIANT     </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain">     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BOOLEAN</span><span class="token plain">     </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> created_at </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DATETIME</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------------+-------------+------+-------+---------+-------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">7</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.01</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">-- Displaying extended columns of Variant columns</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> describe_extend_variant_column </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Query OK</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.01</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">desc</span><span class="token plain"> github_events</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------------------------------------------------------------+------------+------+-------+---------+-------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> Field                                                      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Type</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">Null</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Key</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Default</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Extra </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------------------------------------------------------------+------------+------+-------+---------+-------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> id                                                         </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain">     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">No</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">type</span><span class="token plain">                                                       </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> actor                                                      </span><span class="token operator">|</span><span class="token plain"> VARIANT    </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> actor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">avatar_url                                           </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TEXT</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> actor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">display_login                                        </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TEXT</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> actor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">id                                                   </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INT</span><span class="token plain">        </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> actor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">login                                                </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TEXT</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> actor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">url                                                  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TEXT</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> created_at                                                 </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DATETIME</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> payload                                                    </span><span class="token operator">|</span><span class="token plain"> VARIANT    </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> payload</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">action</span><span class="token plain">                                             </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TEXT</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> payload</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">before                                             </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TEXT</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> payload</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">comment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">author_association                         </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TEXT</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> payload</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">comment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">body                                       </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TEXT</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------------------------------------------------------------+------------+------+-------+---------+-------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">406</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.07</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>With the <code>desc</code> statement, you can specify which partition you want to check the schema of: </p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DESCRIBE</span><span class="token plain"> ${table_name} </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">$partition_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="03--query">03  Query<a href="#03--query" class="hash-link" aria-label="Direct link to 03  Query" title="Direct link to 03  Query">‚Äã</a></h3><blockquote><p>Note: When filtering and aggregating sub-columns, an additional CAST operation is required to ensure data type consistency. This is because the storage types may not be fixed, and the <code>CAST</code> expression in SQL can unify the data types. For example, <code>SELECT * FROM tbl WHERE CAST(var[&#x27;title&#x27;] AS TEXT) MATCH &#x27;hello world&#x27;</code>.</p></blockquote><p><strong>The following are simple examples of queries on Variant columns</strong></p><ol><li>Retrieve the Top 5 repositories with the most Stars from <code>github_events</code>.</li></ol><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain">     cast</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">repo</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;name&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">text</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> repo_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> stars</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> github_events</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">type</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;WatchEvent&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> repo_name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> stars </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DESC</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">LIMIT</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">--------------------------+-------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> repo_name                </span><span class="token operator">|</span><span class="token plain"> stars </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">--------------------------+-------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> aplus</span><span class="token operator">-</span><span class="token plain">framework</span><span class="token operator">/</span><span class="token plain">app      </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">78</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> lensterxyz</span><span class="token operator">/</span><span class="token plain">lenster       </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">77</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> aplus</span><span class="token operator">-</span><span class="token plain">framework</span><span class="token operator">/</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">database</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">46</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> stashapp</span><span class="token operator">/</span><span class="token plain">stash           </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">42</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> aplus</span><span class="token operator">-</span><span class="token plain">framework</span><span class="token operator">/</span><span class="token plain">image    </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">34</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">--------------------------+-------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">5</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.03</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Count the number of events containing the keyword <code>doris</code>.</li></ol><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">-- implicit cast `payload[&#x27;comment&#x27;][&#x27;body&#x27;]` to string type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain">     </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> github_events</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain">     </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> payload</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;comment&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;body&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">MATCH</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;doris&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">3</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">row</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.04</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Check the ID of the issue that has the most comments and the repository it belongs to.</li></ol><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain">   cast</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">repo</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;name&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> repo_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain">   cast</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;issue&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;number&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> issue_number</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain">   </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> comments</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain">   </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain">     </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">distinct</span><span class="token plain"> cast</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">actor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;login&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain">   </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> authors </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain">  github_events </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">type</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;IssueCommentEvent&#x27;</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">cast</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;action&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;created&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">cast</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;issue&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;number&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> repo_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> issue_number </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HAVING</span><span class="token plain"> authors </span><span class="token operator">&gt;=</span><span class="token plain"> </span><span class="token number">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> comments </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DESC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> repo_name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">LIMIT</span><span class="token plain"> </span><span class="token number">50</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">--------------------------------------+--------------+----------+---------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> repo_name                            </span><span class="token operator">|</span><span class="token plain"> issue_number </span><span class="token operator">|</span><span class="token plain"> comments </span><span class="token operator">|</span><span class="token plain"> authors </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">--------------------------------------+--------------+----------+---------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> facebook</span><span class="token operator">/</span><span class="token plain">react</span><span class="token operator">-</span><span class="token plain">native                </span><span class="token operator">|</span><span class="token plain">        </span><span class="token number">35228</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">        </span><span class="token number">5</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">4</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> swsnu</span><span class="token operator">/</span><span class="token plain">swppfall2022</span><span class="token operator">-</span><span class="token plain">team4             </span><span class="token operator">|</span><span class="token plain">           </span><span class="token number">27</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">        </span><span class="token number">5</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">4</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> belgattitude</span><span class="token operator">/</span><span class="token plain">nextjs</span><span class="token operator">-</span><span class="token plain">monorepo</span><span class="token operator">-</span><span class="token plain">example </span><span class="token operator">|</span><span class="token plain">         </span><span class="token number">2865</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">        </span><span class="token number">4</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">4</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">--------------------------------------+--------------+----------+---------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">3</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.03</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="04--notes">04  Notes<a href="#04--notes" class="hash-link" aria-label="Direct link to 04  Notes" title="Direct link to 04  Notes">‚Äã</a></h3><p>Based on our test results, it is safe to say that there is no efficiency disparity between Variant dynamic columns and pre-defined static columns. However, in log data processing, when users need to add fields to the table, such as container labels in Kubernetes, JSON parsing and type inference during data writing incur additional overhead.</p><p>To strike a balance between flexibility and efficiency for the Variant data type, we recommend keeping the number of columns below 1000. A small number of columns will reduce overheads caused by data parsing and type inference and thus increase data writing performance.</p><p>It is also advisable to ensure field type consistency whenever possible. This is because Doris automatically performs compatible type conversions to unify fields of different data types. If it cannot find a compatible type, it will convert the data to the JSONB type, which may result in degraded performance compared to the int or text type.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="variant-vs-json">Variant VS JSON<a href="#variant-vs-json" class="hash-link" aria-label="Direct link to Variant VS JSON" title="Direct link to Variant VS JSON">‚Äã</a></h2><p>To see how the newly added Variant type impacts data storage and queries, we did comparison tests on pre-defined static columns, Variant columns, and JSON columns with ClickBench.</p><p><strong>Test environment</strong>: 16 core, 64GB, AWS EC2 instance, 1TB ESSD</p><p><strong>Test result</strong>:</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="01-storage-space">01 Storage space<a href="#01-storage-space" class="hash-link" aria-label="Direct link to 01 Storage space" title="Direct link to 01 Storage space">‚Äã</a></h3><p>As the results show, storing data as Variant columns takes up a similar storage space to storing it as pre-defined static columns. Compared with the JSON type, the Variant type requires 65% less space. <strong>In other words, the Variant type only takes up one-third of the storage space that JSON does. The difference will be even more notable with low-cardinality data because of columnar storage.</strong></p><p><img loading="lazy" alt="Storage space" src="https://cdnd.selectdb.com/assets/images/storage-space-1a7ce7030524f8ce1553d8872503825a.png" width="1280" height="476" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="02-query-performance">02 Query performance<a href="#02-query-performance" class="hash-link" aria-label="Direct link to 02 Query performance" title="Direct link to 02 Query performance">‚Äã</a></h3><p>We tested with 43<a href="https://github.com/ClickHouse/ClickBench/blob/main/selectdb/queries.sql" target="_blank" rel="noopener noreferrer"> Clickbench</a> SQL queries. Queries on the Variant columns are about 10% slower than those on pre-defined static columns, and <strong>8 times faster than those on</strong> <strong>JSON</strong> <strong>columns</strong>. (For I/O reasons, most cold runs on JSONB data failed with OOM.) </p><p><img loading="lazy" alt="Query Performance" src="https://cdnd.selectdb.com/assets/images/query-performance-9442542741fd22019a68e5807dc1c2fb.png" width="1280" height="394" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="design--implementation-of-variant">Design &amp; implementation of Variant<a href="#design--implementation-of-variant" class="hash-link" aria-label="Direct link to Design &amp; implementation of Variant" title="Direct link to Design &amp; implementation of Variant">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="01--data-writing--type-inference">01  Data writing &amp; type inference<a href="#01--data-writing--type-inference" class="hash-link" aria-label="Direct link to 01  Data writing &amp; type inference" title="Direct link to 01  Data writing &amp; type inference">‚Äã</a></h3><p>In Apache Doris, this is a normal writing process: data sorting, merging, and Segment file generation in the Memtable. Variant writing works similarly. It involves type inference and data merging of the same JSON keys within the Memtable, resulting in the creation of a prefix tree. The tree keeps the type and column information of every JSON field, and merges all type information of the same column into the least common type, generates columns, encodes them into the Doris storage formats, and appends them to the segment.</p><p>Each Segment file not only contains data after type encoding and compaction, but also includes the metadata of dynamically generated columns. Such design ensures data integrity and queryability while also improving storage efficiency. <strong>By type inference and merging in the memory, the Variant type largely reduces disk space usage compared to traditional raw text storage</strong>. </p><p><img loading="lazy" alt="Data Writing &amp;amp; Type inferece" src="https://cdnd.selectdb.com/assets/images/data-writing-and-type-inference-ef3da2624eff730ddec2ebceaecfccfb.png" width="1280" height="364" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="02-column-change-column-adding-or-column-type-changes">02 Column change (column adding or column type changes)<a href="#02-column-change-column-adding-or-column-type-changes" class="hash-link" aria-label="Direct link to 02 Column change (column adding or column type changes)" title="Direct link to 02 Column change (column adding or column type changes)">‚Äã</a></h3><p>During the writing process, all metadata and data of the leaf nodes in the prefix tree will be appended to the Segment file, and the metadata of the Rowsets will be merged. Here is an example of the merging process:</p><p><img loading="lazy" alt="Column change (column adding or column type changes)" src="https://cdnd.selectdb.com/assets/images/column-change-c7807e83ad624ebb11654d5ebdcdcc70.png" width="1280" height="245" class="img_ev3q"></p><p>In the end, the Rowset will use the <code>Least Common Column Schema</code> as the metadata after data merging. (Least common column schema is a schema with the most sub-columns and the sub-column type being the least common type.) This allows for dynamic column extension and type changes. </p><p>Based on this mechanism, the stored schema for Variant can be considered data-driven. It offers greater flexibility compared to the Schema Change process in Doris. The diagram below illustrates the directions for type changes (type changes can only be performed in the direction indicated by the arrows, with JSONB being the common type for all types):</p><p><img loading="lazy" alt="Column change (column adding or column type changes)" src="https://cdnd.selectdb.com/assets/images/column-change2-4ae8a9d1a6389b9ca9bc49e5c84b3164.png" width="1248" height="474" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="03-index--query-acceleration">03 Index &amp; query acceleration<a href="#03-index--query-acceleration" class="hash-link" aria-label="Direct link to 03 Index &amp; query acceleration" title="Direct link to 03 Index &amp; query acceleration">‚Äã</a></h3><p>In Variant, the leaf nodes are stored in a columnar format in the Segment file, which is exactly the same as the storage format for static pre-defined columns. Thus, queries on Variant columns can also be accelerated by dictionary encoding, vectorization, and indexes (ZoneMap, inverted index, BloomFilter, etc.). Since the same column might be of different types in different files, users need to specify a type as the hint during query execution. Here is an example query: </p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">-- var[&#x27;title&#x27;] is to access the &#x27;title&#x27; sub-column of var, which is a Variant column. If there is inverted index for var, the queries will be accelerated by inverted index.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> tbl </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> CAST</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">var</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;titile&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">text</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">MATCH</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;hello world&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">-- If there is Bloom Filter for var, equivalence queries will be accelerated by Bloom Filter.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> tbl </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> CAST</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">var</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;id&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">bigint</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1010101</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Predicates will be pushed down to the storage layer (Segment), where the storage type is checked against the target type of the CAST operation. If the types match, a more efficient predicate filtering mechanism will be utilized. This approach reduces unnecessary data reading and conversion, thus improving query performance.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="04--storage-optimization-for-sparse-columns">04  Storage optimization for sparse columns<a href="#04--storage-optimization-for-sparse-columns" class="hash-link" aria-label="Direct link to 04  Storage optimization for sparse columns" title="Direct link to 04  Storage optimization for sparse columns">‚Äã</a></h3><p>Examples of sparse JSON columns: </p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;a&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;b&quot;</span><span class="token plain">:</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;c&quot;</span><span class="token plain">:</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;x_1&quot;</span><span class="token plain"> : </span><span class="token number">1</span><span class="token plain">Ôºå</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;x_2&quot;</span><span class="token plain">: </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;3&quot;</span><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;a&quot;</span><span class="token plain">:</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;b&quot;</span><span class="token plain">:</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;c&quot;</span><span class="token plain">:</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;x_1&quot;</span><span class="token plain"> : </span><span class="token number">1</span><span class="token plain">Ôºå</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;x_2&quot;</span><span class="token plain">: </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;3&quot;</span><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;a&quot;</span><span class="token plain">:</span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;b&quot;</span><span class="token plain">:</span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;c&quot;</span><span class="token plain">:</span><span class="token number">6</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;x_3&quot;</span><span class="token plain"> : </span><span class="token number">1</span><span class="token plain">Ôºå</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;x_4&quot;</span><span class="token plain">: </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;3&quot;</span><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;a&quot;</span><span class="token plain">:</span><span class="token number">7</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;b&quot;</span><span class="token plain">:</span><span class="token number">8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;c&quot;</span><span class="token plain">:</span><span class="token number">9</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;x_5&quot;</span><span class="token plain"> : </span><span class="token number">1</span><span class="token plain">Ôºå</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;x_6&quot;</span><span class="token plain">: </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;3&quot;</span><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>a, b, c</code> columns are dense. They are included in almost every row. While the <code> x_Ôºü</code> columns are sparse. Only a few of them are not null. If the system stores every column in a columnar way, it will suffer huge storage pressure and exploding meta. </p><p>To solve this, Doris detects the sparsity of columns based on the percentage of null values upon data ingestion. The highly sparse columns (with a high proportion of null values) will be packed into JSONB encoding and stored in a separate column. </p><p><img loading="lazy" alt=" Storage optimization for sparse columns" src="https://cdnd.selectdb.com/assets/images/storage-optimization-for-sparse-columns-4ece65d5d623312590b94532dc8c0237.png" width="1280" height="684" class="img_ev3q"></p><p>Such optimization for storing sparse columns will relieve pressure on meta and data compaction and increase flexibility. </p><p>Queries on the sparse columns are implemented in exactly the same way as those on other columns.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="use-case">Use case<a href="#use-case" class="hash-link" aria-label="Direct link to Use case" title="Direct link to Use case">‚Äã</a></h2><p>GuanceDB, an observability platform, used an Elasticsearch-based solution for storing logs and user behavior data. However, Elasticsearch has inadequate schemaless support, so it is inefficient in processing large amounts of user-defined fields. Under the Dynamic Mapping mechanism in Elasticsearch, frequent field type conflicts led to data losses and required lots of human intervention. Meanwhile, the writing process in Elasticsearch was resource-intensive and the performance in massive data aggregation was less than ideal.</p><p>For a data architectural upgrade, GuanceDB works with <a href="https://www.velodb.io/" target="_blank" rel="noopener noreferrer">VeloDB</a> and builds an Apache Doris-based observability solution. They utilize the Variant data type to realize partition-based schema change, which is more flexible and efficient. In addition, Doris imposes no upper limit on the number of columns, meaning that it can better accommodate schema-free data. </p><p>The Doris-based solution also delivers lower CPU usage in data writing and higher speed in complicated data aggregation (accelerated by inverted index and query optimization techniques). After the upgrade, GuanceDB <strong>decreased their machine costs by 70% and doubled their overall query speed</strong>, with an over 4-time performance increase in simple queries. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">‚Äã</a></h2><p>The Variant data type has stood the test of many users before the official release of Apache Doris 2.1.0. It is production-available now. In the future, we plan to realize more lightweight changes for Variant to facilitate data modeling. </p><p>For more information about Variant and guides on how to build a semi-structured data analytics solution for your case, come talk to the <a href="https://join.slack.com/t/apachedoriscommunity/shared_invite/zt-2kl08hzc0-SPJe4VWmL_qzrFd2u2XYQA" target="_blank" rel="noopener noreferrer">Apache Doris developer team</a>.</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><div class="text-center mb-4"><a class="text-[#8592A6] cursor-pointer hover:no-underline" href="/blog">Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class="s-tags"><span class="s-tag">Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:text-[2.5rem] text-center" itemprop="headline"><a itemprop="url" href="/blog/inverted-index-accelerates-text-searches-by-40-time-apache-doris">A deep dive into inverted index: how it speeds up text searches by 40 times</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class="authors"><span class="s-author text-black">Apache Doris</span></span><time datetime="2024-02-01T00:00:00.000Z" itemprop="datePublished" class="text-black ml-4">February 1, 2024</time></div></header><div class="markdown" itemprop="articleBody"><p>As an open-source real-time data warehouse, <a href="https://doris.apache.org" target="_blank" rel="noopener noreferrer">Apache Doris</a> provides a rich choice of indexes to speed up data scanning and filtering. Based on user involvement, they can be divided into built-in smart indexes and user-created indexes. The former is automatically generated by Apache Doris on data ingestion, such as ZoneMap index and prefix index, while the latter is the index users choose for various use cases, including inverted index and NGram BloomFilter index.</p><p>This post is a deep dive into inverted index and NGram BloomFilter index, providing a hands-on guide to applying them for various queries.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sample-dataset">Sample dataset<a href="#sample-dataset" class="hash-link" aria-label="Direct link to Sample dataset" title="Direct link to Sample dataset">‚Äã</a></h2><p>The test dataset comprises about 130 million Amazon customer reviews. It is a few Snappy-compressed Parquet files with a total size of 37GB. These are a few samples:</p><p><img loading="lazy" alt="img" src="https://cdnd.selectdb.com/assets/images/sample-dataset-0a343d2a31f6f2afd8617577cf9e8823.png" width="4733" height="557" class="img_ev3q"></p><p>Each row includes 15 columns including <code>customer_id</code>, <code>review_id</code>, <code>product_id</code>, <code>product_category</code>, <code>star_rating</code>, <code>review_headline</code>, and <code>review_body</code>. </p><p>A lot of these columns can be accelerated by indexes based on their structures. For example, <code>customer_id</code> is a high-cardinality numerical field while <code>product_id</code> is a low-cardinality fixed-length text field, and <code>product_title</code> and <code>review_body</code> are short and long text fields, respectively.</p><p>Queries on these columns can be roughly divided into two types:</p><ul><li><strong>Text searches</strong>: searches for certain contents in the <code>review_body</code> field.</li><li><strong>Non-primary key column queries</strong>: query reviews about certain <code>product_id</code> or from certain <code>customer_id</code>.</li></ul><p>These are also the main threads of this article. I will present to you how indexes can speed up these queries.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">‚Äã</a></h2><p>For a quick run, here we use a single-node cluster (1 frontend, 1 backend).</p><ol><li>Deploy Apache Doris: refer to <a href="https://doris.apache.org/docs/get-starting/quick-start/" target="_blank" rel="noopener noreferrer">Quick Start</a></li><li>Create a table using the following statements: </li></ol><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE TABLE `amazon_reviews` (  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `review_date` int(11) NULL,  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `marketplace` varchar(20) NULL,  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `customer_id` bigint(20) NULL,  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `review_id` varchar(40) NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `product_id` varchar(10) NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `product_parent` bigint(20) NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `product_title` varchar(500) NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `product_category` varchar(50) NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `star_rating` smallint(6) NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `helpful_votes` int(11) NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `total_votes` int(11) NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `vine` boolean NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `verified_purchase` boolean NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `review_headline` varchar(500) NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `review_body` string NULL</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">) ENGINE=OLAP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DUPLICATE KEY(`review_date`)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">COMMENT &#x27;OLAP&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DISTRIBUTED BY HASH(`review_date`) BUCKETS 16</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;replication_allocation&quot; = &quot;tag.location.default: 1&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;compression&quot; = &quot;ZSTD&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Download datasets: Snappy-compressed Parquet files with a total size of 37GB</li></ol><ul><li><a href="https://datasets-documentation.s3.eu-west-3.amazonaws.com/amazon_reviews/amazon_reviews_2010.snappy.parquet" target="_blank" rel="noopener noreferrer">amazon_reviews_2010</a></li><li><a href="https://datasets-documentation.s3.eu-west-3.amazonaws.com/amazon_reviews/amazon_reviews_2011.snappy.parquet" target="_blank" rel="noopener noreferrer">amazon_reviews_2011</a></li><li><a href="https://datasets-documentation.s3.eu-west-3.amazonaws.com/amazon_reviews/amazon_reviews_2012.snappy.parquet" target="_blank" rel="noopener noreferrer">amazon_reviews_2012</a></li><li><a href="https://datasets-documentation.s3.eu-west-3.amazonaws.com/amazon_reviews/amazon_reviews_2013.snappy.parquet" target="_blank" rel="noopener noreferrer">amazon_reviews_2013</a></li><li><a href="https://datasets-documentation.s3.eu-west-3.amazonaws.com/amazon_reviews/amazon_reviews_2014.snappy.parquet" target="_blank" rel="noopener noreferrer">amazon_reviews_2014</a> </li><li><a href="https://datasets-documentation.s3.eu-west-3.amazonaws.com/amazon_reviews/amazon_reviews_2015.snappy.parquet" target="_blank" rel="noopener noreferrer">amazon_reviews_2015</a></li></ul><ol start="4"><li>Execute the following commands to load the datasets</li></ol><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> --location-trusted -u root: -T amazon_reviews_2010.snappy.parquet -H </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;format:parquet&quot;</span><span class="token plain"> http://</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${BE_IP}</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${BE_PORT}</span><span class="token plain">/api/</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${DB}</span><span class="token plain">/amazon_reviews/_stream_load</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> --location-trusted -u root: -T amazon_reviews_2011.snappy.parquet -H </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;format:parquet&quot;</span><span class="token plain"> http://</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${BE_IP}</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${BE_PORT}</span><span class="token plain">/api/</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${DB}</span><span class="token plain">/amazon_reviews/_stream_load</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> --location-trusted -u root: -T amazon_reviews_2012.snappy.parquet -H </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;format:parquet&quot;</span><span class="token plain"> http://</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${BE_IP}</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${BE_PORT}</span><span class="token plain">/api/</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${DB}</span><span class="token plain">/amazon_reviews/_stream_load</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> --location-trusted -u root: -T amazon_reviews_2013.snappy.parquet -H </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;format:parquet&quot;</span><span class="token plain"> http://</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${BE_IP}</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${BE_PORT}</span><span class="token plain">/api/</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${DB}</span><span class="token plain">/amazon_reviews/_stream_load</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> --location-trusted -u root: -T amazon_reviews_2014.snappy.parquet -H </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;format:parquet&quot;</span><span class="token plain"> http://</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${BE_IP}</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${BE_PORT}</span><span class="token plain">/api/</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${DB}</span><span class="token plain">/amazon_reviews/_stream_load</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> --location-trusted -u root: -T amazon_reviews_2015.snappy.parquet -H </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;format:parquet&quot;</span><span class="token plain"> http://</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${BE_IP}</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${BE_PORT}</span><span class="token plain">/api/</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${DB}</span><span class="token plain">/amazon_reviews/_stream_load</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="5"><li>Check and verify: After the above steps, execute the following statements in the MySQL client to check and see the size of the dataset. It can be seen from below that 135589433 rows are loaded and they take up 25.873GB in Apache Doris, which is 30% smaller than the original Parquet files. </li></ol><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; SELECT COUNT() FROM amazon_reviews;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| count(*)  |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| 135589433 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1 row in set (0.02 sec)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; SHOW DATA FROM amazon_reviews;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+----------------+----------------+-----------+--------------+-----------+------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| TableName      | IndexName      | Size      | ReplicaCount | RowCount  | RemoteSize |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+----------------+----------------+-----------+--------------+-----------+------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| amazon_reviews | amazon_reviews | 25.873 GB | 16           | 135589433 | 0.000      |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|                | Total          | 25.873 GB | 16           |           | 0.000      |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+----------------+----------------+-----------+--------------+-----------+------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2 rows in set (0.00 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="accelerate-text-searches">Accelerate text searches<a href="#accelerate-text-searches" class="hash-link" aria-label="Direct link to Accelerate text searches" title="Direct link to Accelerate text searches">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="no-index">No index<a href="#no-index" class="hash-link" aria-label="Direct link to No index" title="Direct link to No index">‚Äã</a></h3><p>Now let&#x27;s try running text searches on the <code>review_body</code> field. Specifically, we&#x27;re trying to retrieve the top 5 products whose reviews include the keywords &quot;is super awesome&quot;. The results should be sorted in descending order based on the number of reviews. Each result should include the product ID, a randomly selected product title, the average star rating, and the total number of reviews. </p><p>This is the query statement:</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">SELECT</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    product_id,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    any(product_title),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AVG(star_rating) AS rating,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    COUNT() AS count</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    amazon_reviews</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WHERE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    review_body LIKE &#x27;%is super awesome%&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">GROUP BY</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    product_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ORDER BY</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    count DESC,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    rating DESC,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    product_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">LIMIT 5;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Since the <code>review_body</code> field contains lengthy reviews, such text searches can be time-consuming. Without enabling any indexes, it took <strong>7.6 seconds</strong> to return the results: </p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">+------------+------------------------------------------+--------------------+-------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| product_id | any_value(product_title)                 | rating             | count |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+------------+------------------------------------------+--------------------+-------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| B00992CF6W | Minecraft                                | 4.8235294117647056 |    17 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| B009UX2YAC | Subway Surfers                           | 4.7777777777777777 |     9 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| B00DJFIMW6 | Minion Rush: Despicable Me Official Game |              4.875 |     8 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| B0086700CM | Temple Run                               |                  5 |     6 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| B00KWVZ750 | Angry Birds Epic RPG                     |                  5 |     6 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+------------+------------------------------------------+--------------------+-------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">5 rows in set (7.60 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ngram-bloomfilter-index">Ngram BloomFilter index<a href="#ngram-bloomfilter-index" class="hash-link" aria-label="Direct link to Ngram BloomFilter index" title="Direct link to Ngram BloomFilter index">‚Äã</a></h3><p>Now, let&#x27;s try accelerating such text searches using the Ngram BloomFilter index.</p><ul><li><code>gram_size</code>: the value of &quot;N&quot; in &quot;Ngram&quot;, representing the length of consecutive characters. In the snippet below, <code>&quot;gram_size&quot;=&quot;10&quot;</code> means that the texts will be divided into a number of 10-character strings, which are the basis of the Ngram BloomFilter index.</li><li><code>bf_size</code>: the size of the BloomFilter in bytes. <code>&quot;bf_size&quot;=&quot;10240&quot;</code> indicates that the BloomFilter occupies 10240 bytes of space.</li></ul><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ALTER TABLE amazon_reviews ADD INDEX review_body_ngram_idx(review_body) USING NGRAM_BF PROPERTIES(&quot;gram_size&quot;=&quot;10&quot;, &quot;bf_size&quot;=&quot;10240&quot;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This time, the query is finished within <strong>0.93 seconds</strong>. That means Ngram BloomFilter brings a speedup of <strong>8 times</strong>.</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">+------------+------------------------------------------+--------------------+-------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| product_id | any_value(product_title)                 | rating             | count |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+------------+------------------------------------------+--------------------+-------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| B00992CF6W | Minecraft                                | 4.8235294117647056 |    17 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| B009UX2YAC | Subway Surfers                           | 4.7777777777777777 |     9 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| B00DJFIMW6 | Minion Rush: Despicable Me Official Game |              4.875 |     8 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| B0086700CM | Temple Run                               |                  5 |     6 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| B00KWVZ750 | Angry Birds Epic RPG                     |                  5 |     6 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+------------+------------------------------------------+--------------------+-------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">5 rows in set (0.93 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>So how does Ngram BloomFilter do the magic?</strong> The way it works can be explained in two parts.</p><ul><li><strong>Ngram tokenization</strong>: When <code>gram_size=5</code>, the phrase &quot;hello world&quot; is split into <!-- -->[&quot;hello&quot;, &quot;ello &quot;, &quot;llo w&quot;, &quot;lo wo&quot;, &quot;o wor&quot;, &quot; worl&quot;, &quot;world&quot;]<!-- -->. These sub-strings are then hashed and added to a BloomFilter of the <code>bf_size</code>. Since data in Apache Doris is stored by page, the BloomFilters are generated also by page. </li><li><strong>Query acceleration</strong>: For example, to query the word &quot;hello&quot; in the texts, &quot;hello&quot; is tokenized and compared with the BloomFilters of each page. If the BloomFilter detects a potential match (there might be false positives) in a page, that page is loaded for further matching. Otherwise, that page is skipped. </li></ul><p>By skipping the irrelevant pages, the BloomFilter index reduces unnecessary data scanning and thus greatly reduces query latency.</p><p><img loading="lazy" alt="img" src="https://cdnd.selectdb.com/assets/images/data-storage-structure-in-apache-doris-da2f97a4dbdbfbe800121484566d7d25.png" width="1280" height="644" class="img_ev3q"></p><div style="text-align:center"> Data storage structure in Apache Doris </div><p><img loading="lazy" alt="img" src="https://cdnd.selectdb.com/assets/images/illustration-of-ngram-bloomfilter-d0db39fe1aee6af22cf7ad2949396c3b.png" width="1280" height="697" class="img_ev3q"></p><div style="text-align:center"> Illustration of Ngram BloomFilter </div><p><strong>How to find the optimal parameter configurations for Ngram BloomFilter?</strong></p><p><code>gram_size</code> determines the matching efficiency, while <code>bf_size</code> impacts the false positive rate. Typically, a large <code>bf_size</code> reduces the false positive rate but also requires more storage space. Thus, we suggest that you configure these two parameters based on these two factors: </p><ol><li><p>Text length:</p><ul><li>For short texts (words or phrases), a small <code>gram_size</code> (2~4) and a small <code>bf_size</code> are recommended.</li><li>For long texts (sentences or paragraphs), a large <code>gram_size</code> (5~10) and a large <code>bf_size</code> work better.</li></ul></li><li><p>Query pattern: </p><ul><li>If the queries often involve phrases or complete words, a large <code>gram_size</code> will be more efficient.</li><li>For fuzzy matching or diverse queries, a small <code>gram_size</code> allows more flexible matching.</li></ul></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="inverted-index">Inverted index<a href="#inverted-index" class="hash-link" aria-label="Direct link to Inverted index" title="Direct link to Inverted index">‚Äã</a></h3><p><a href="https://doris.apache.org/blog/Building-A-Log-Analytics-Solution-10-Times-More-Cost-Effective-Than-Elasticsearch" target="_blank" rel="noopener noreferrer">Inverted index</a> is another way to accelerate text searches. Creating inverted index is simple:</p><ol><li><p><strong>Add inverted index</strong>: Refer to the snippet below to create inverted index for the <code>review_body</code> column of the <code>amazon_reviews</code> table. Inverted index supports phrase searching, in which the order of the tokenized words will affect the search results.</p></li><li><p><strong>Add inverted index for historical data</strong>: You can also create inverted index for historical data.</p></li></ol><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ALTER TABLE amazon_reviews ADD INDEX review_body_inverted_idx(`review_body`) </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    USING INVERTED PROPERTIES(&quot;parser&quot; = &quot;english&quot;,&quot;support_phrase&quot; = &quot;true&quot;); </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">BUILD INDEX review_body_inverted_idx ON amazon_reviews;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li><strong>Check and verify</strong>: You can check and see the created indexes using the following statement:</li></ol><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; show BUILD INDEX WHERE TableName=&quot;amazon_reviews&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+-------+----------------+----------------+-----------------------------------------------------------------------------------------------------------------------------------+-------------------------+-------------------------+---------------+----------+------+----------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| JobId | TableName      | PartitionName  | AlterInvertedIndexes                                                                                                              | CreateTime              | FinishTime              | TransactionId | State    | Msg  | Progress |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+-------+----------------+----------------+-----------------------------------------------------------------------------------------------------------------------------------+-------------------------+-------------------------+---------------+----------+------+----------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| 10152 | amazon_reviews | amazon_reviews | [ADD INDEX review_body_inverted_idx (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">review_body</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">) USING INVERTED PROPERTIES(&quot;parser&quot; = &quot;english&quot;, &quot;support_phrase&quot; = &quot;true&quot;)],  | 2024-01-23 15:42:28.658 | 2024-01-23 15:48:42.990 | 11            | FINISHED |      | NULL     |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+-------+----------------+----------------+-----------------------------------------------------------------------------------------------------------------------------------+-------------------------+-------------------------+---------------+----------+------+----------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1 row in set (0.00 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you want to see how tokenization works, you can test with the <code>TOKENIZE</code> function. Just input the text that needs to be tokenized and the parameters: </p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; SELECT TOKENIZE(&#x27;I can honestly give the shipment and package 100%, it came in time that it was supposed to with no hasels, and the book was in PERFECT condition.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">super awesome buy, and excellent for my college classs&#x27;, &#x27;&quot;parser&quot; = &quot;english&quot;,&quot;support_phrase&quot; = &quot;true&quot;&#x27;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| tokenize(&#x27;I can honestly give the shipment and package 100%, it came in time that it was supposed to with no hasels, and the book was in PERFECT condition. super awesome buy, and excellent for my college classs&#x27;, &#x27;&quot;parser&quot; = &quot;english&quot;,&quot;support_phrase&quot; = &quot;true&quot;&#x27;)                                              |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| [&quot;i&quot;, &quot;can&quot;, &quot;honestly&quot;, &quot;give&quot;, &quot;the&quot;, &quot;shipment&quot;, &quot;and&quot;, &quot;package&quot;, &quot;100&quot;, &quot;it&quot;, &quot;came&quot;, &quot;in&quot;, &quot;time&quot;, &quot;that&quot;, &quot;it&quot;, &quot;was&quot;, &quot;supposed&quot;, &quot;to&quot;, &quot;with&quot;, &quot;no&quot;, &quot;hasels&quot;, &quot;and&quot;, &quot;the&quot;, &quot;book&quot;, &quot;was&quot;, &quot;in&quot;, &quot;perfect&quot;, &quot;condition&quot;, &quot;super&quot;, &quot;awesome&quot;, &quot;buy&quot;, &quot;and&quot;, &quot;excellent&quot;, &quot;for&quot;, &quot;my&quot;, &quot;college&quot;, &quot;classs&quot;] |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1 row in set (0.05 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>With inverted index, now we retrieve customer reviews containing &quot;is super awesome&quot; using <code>MATCH_PHRASE</code>. </p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">SELECT</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    product_id,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    any(product_title),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AVG(star_rating) AS rating,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    COUNT() AS count</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    amazon_reviews</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WHERE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    review_body MATCH_PHRASE &#x27;is super awesome&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">GROUP BY</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    product_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ORDER BY</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    count DESC,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    rating DESC,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    product_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">LIMIT 5;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The clause <code>review_body MATCH_PHRASE &#x27;is super awesome&#x27;</code> searches for text fragments in the <code>review_body</code> column that contains all three keywords &quot;is&quot;, &quot;super&quot;, and &quot;awesome&quot; in that exact order, with no other words in between. </p><p>The <code>MATCH</code> query is case-insensitive, which is also what sets it apart from the <code>LIKE</code> query. The <code>MATCH</code> query is more efficient in large datasets.</p><p>Results show that inverted index has decreased the query latency to <strong>0.19 seconds</strong>, bringing a <strong>4-time performance increase</strong> compared to the Ngram BloomFilter index, and <strong>a nearly 40-time increase</strong> compared to having no indexes at all.</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">+------------+------------------------------------------+-------------------+-------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| product_id | any_value(product_title)                 | rating            | count |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+------------+------------------------------------------+-------------------+-------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| B00992CF6W | Minecraft                                | 4.833333333333333 |    18 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| B009UX2YAC | Subway Surfers                           |               4.7 |    10 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| B00DJFIMW6 | Minion Rush: Despicable Me Official Game |                 5 |     7 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| B0086700CM | Temple Run                               |                 5 |     6 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| B00KWVZ750 | Angry Birds Epic RPG                     |                 5 |     6 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+------------+------------------------------------------+-------------------+-------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">5 rows in set (0.19 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>How does inverted index make it possible?</strong></p><p>Inverted index splits the texts into words and maps each word to a row number. Then the tokenized words are sorted alphabetically and and a skip list index is created. When executing queries of specific words, the system locates the row numbers in this orderly mapping using the skip list index and binary search methods. Based on the row numbers, the system retrieves the entire data record. </p><p>This approach avoids line-by-line matching and reduces computational complexity from O(n) to O(logn). That&#x27;s how inverted index speeds up queries on large datasets. </p><p><img loading="lazy" alt="img" src="https://cdnd.selectdb.com/assets/images/illustration-of-inverted-index-460ac7b75f89211aeba6c32af670cccd.png" width="1280" height="744" class="img_ev3q"></p><div style="text-align:center"> Illustration of Inverted Index </div><p>To provide a deeper understanding of inverted index, I will start from its read/write logic. In Doris, logically, inverted index is applied at the column level of a table. However, from a physical storage and implementation perspective, it is actually built on data files. </p><ul><li><strong>Writing</strong>: When data is written to a data file, it is also synchronously written to the inverted index file, and the row numbers are matched.</li><li><strong>Query</strong>: In a query, if the <code>WHERE</code> condition involves a column for which an inverted index has been built, Doris will go directly to the index file and returns the corresponding row numbers. Then, based on the row numbers, it skips the irrelevant pages and rows and only reads the target rows. </li></ul><p>In short, inverted index enables high-speed text searches by mapping, and its implementation relies on the coordination of data files and index files.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="accelerate-non-primary-key-column-queries">Accelerate non-primary key column queries<a href="#accelerate-non-primary-key-column-queries" class="hash-link" aria-label="Direct link to Accelerate non-primary key column queries" title="Direct link to Accelerate non-primary key column queries">‚Äã</a></h2><p>To showcase the impact of inverted index on non-primary key column queries, let&#x27;s try some multi-dimensional queries.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="no-index-1">No index<a href="#no-index-1" class="hash-link" aria-label="Direct link to No index" title="Direct link to No index">‚Äã</a></h3><p>Retrieve the review from Customer ID 13916588 about Product ID B002DMK1R0. Without indexes, the system has to scan the entire table. The query is finished within <strong>1.81 seconds</strong>.</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; SELECT product_title,review_headline,review_body,star_rating </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM amazon_reviews </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WHERE product_id=&#x27;B002DMK1R0&#x27; AND customer_id=13916588;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------------------------------------------------------------+----------------------+-----------------------------------------------------------------------------------------------------------------------------+-------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| product_title                                                   | review_headline      | review_body                                                                                                                 | star_rating |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------------------------------------------------------------+----------------------+-----------------------------------------------------------------------------------------------------------------------------+-------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| Magellan Maestro 4700 4.7-Inch Bluetooth Portable GPS Navigator | Nice Features But... | This is a great GPS. Gets you where you are going. Don&#x27;t forget to buy the seperate (grr!) cord for the traffic kit though! |           4 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------------------------------------------------------------+----------------------+-----------------------------------------------------------------------------------------------------------------------------+-------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1 row in set (1.81 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="inverted-index-1">Inverted index<a href="#inverted-index-1" class="hash-link" aria-label="Direct link to Inverted index" title="Direct link to Inverted index">‚Äã</a></h3><p>This query is executed in a different way than what is said above, because the system does not have to tokenize the <code>product_id</code> and <code>customer_id</code>, but creates a Value‚ÜíRowID inverted index table. </p><p>First of all, create inverted index via the following statement: </p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ALTER TABLE amazon_reviews ADD INDEX product_id_inverted_idx(product_id) USING INVERTED ;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ALTER TABLE amazon_reviews ADD INDEX customer_id_inverted_idx(customer_id) USING INVERTED ;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">BUILD INDEX product_id_inverted_idx ON amazon_reviews;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">BUILD INDEX customer_id_inverted_idx ON amazon_reviews;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>With inverted index, the same query is finished within <strong>0.06 seconds</strong>. That represents a <strong>30-time</strong> higher speed compared to the previous 1.81 seconds.</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; SELECT product_title,review_headline,review_body,star_rating FROM amazon_reviews WHERE product_id=&#x27;B002DMK1R0&#x27; AND customer_id=&#x27;13916588&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------------------------------------------------------------+----------------------+-----------------------------------------------------------------------------------------------------------------------------+-------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| product_title                                                   | review_headline      | review_body                                                                                                                 | star_rating |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------------------------------------------------------------+----------------------+-----------------------------------------------------------------------------------------------------------------------------+-------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| Magellan Maestro 4700 4.7-Inch Bluetooth Portable GPS Navigator | Nice Features But... | This is a great GPS. Gets you where you are going. Don&#x27;t forget to buy the seperate (grr!) cord for the traffic kit though! |           4 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------------------------------------------------------------+----------------------+-----------------------------------------------------------------------------------------------------------------------------+-------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1 row in set (0.06 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="profile">Profile<a href="#profile" class="hash-link" aria-label="Direct link to Profile" title="Direct link to Profile">‚Äã</a></h3><p>This is an excerpt of the SegmentIterator Profile, from which you can tell why inverted index accelerates query execution.</p><p>(Note that if you need to check the Profile of a query, make sure you have executed <code>SET enable_profile=true;</code> in the MySQL client before you execute the query. Then you can check the Profile at <em>http://FE_IP:FE_HTTP_PORT/QueryProfile</em>)</p><div class="language-YAML codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-YAML codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">SegmentIterator:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - FirstReadSeekCount: 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - FirstReadSeekTime: 0ns</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - FirstReadTime: 13.119ms</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - IOTimer: 19.537ms</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - InvertedIndexQueryTime: 11.583ms</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - RawRowsRead: 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - RowsConditionsFiltered: 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - RowsInvertedIndexFiltered: 16.907403M (16907403)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - RowsShortCircuitPredInput: 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - RowsVectorPredFiltered: 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - RowsVectorPredInput: 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - ShortPredEvalTime: 0ns</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - TotalPagesNum: 27</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - UncompressedBytesRead: 3.71 MB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - VectorPredEvalTime: 0ns</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>RowsInvertedIndexFiltered: 16.907403M (16907403)</code> and <code>RawRowsRead: 1</code> means that the inverted index has filtered out 16907403 rows and only reads 1 row (the target row). <code>FirstReadTime: 13.119ms</code> means that it takes 13.119 ms to read the page where the target row is located, and <code>InvertedIndexQueryTime: 11.583ms</code> means that the system <strong>filters out 16907403 rows within only 11.58 ms</strong>. </p><p>For comparision, this is the SegmentIterator Profile when no index is used:</p><div class="language-YAML codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-YAML codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">SegmentIterator:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - FirstReadSeekCount: 9.374K (9374)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - FirstReadSeekTime: 400.522ms</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - FirstReadTime: 3s144ms</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - IOTimer: 2s564ms</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - InvertedIndexQueryTime: 0ns</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - RawRowsRead: 16.680706M (16680706)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - RowsConditionsFiltered: 226.698K (226698)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - RowsInvertedIndexFiltered: 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - RowsShortCircuitPredInput: 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - RowsVectorPredFiltered: 16.680705M (16680705)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - RowsVectorPredInput: 16.680706M (16680706)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - RowsZonemapFiltered: 226.698K (226698)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - ShortPredEvalTime: 2.723ms</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - TotalPagesNum: 5.421K (5421)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - UncompressedBytesRead: 277.05 MB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - VectorPredEvalTime: 8.114ms</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Without inverted index, it takes 3.14s to load 16680706 rows (<code>FirstReadTime: 3s144ms</code>). Then, the system conducts filtering by Predicate Evaluate and screens out 16680705 rows. The conditional filtering process only takes less than 10ms, making original data loading the most time-consuming task.</p><p>To sum up, inverted index increases query execution efficiency by enabling quick retrieval of the target rows and thus reducing unnecessary data loading.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="accelerate-low-cardinality-text-column-queries">Accelerate low-cardinality text column queries<a href="#accelerate-low-cardinality-text-column-queries" class="hash-link" aria-label="Direct link to Accelerate low-cardinality text column queries" title="Direct link to Accelerate low-cardinality text column queries">‚Äã</a></h2><p>So inverted index is a big accelerator for queries on high-cardinality text columns, but that might raise a concern: For low-cardinality columns, will too many indexes bring excessive overheads and undermine query performance? </p><p>The answer is: no. Let me show you why and how. The following example uses <code>product_category</code> as the predicate column for filtering. </p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; SELECT COUNT(DISTINCT product_category) FROM amazon_reviews ;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+----------------------------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| count(DISTINCT product_category) |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+----------------------------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|                               43 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+----------------------------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1 row in set (0.57 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As is shown, the <code>product_category</code> column has only 43 distinct categories, making it a typical low-cardinality text column. Now, let&#x27;s add inverted index to it.</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ALTER TABLE amazon_reviews ADD INDEX product_category_inverted_idx(`product_category`) USING INVERTED;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">BUILD INDEX product_category_inverted_idx ON amazon_reviews;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After adding inverted index, run the following SQL query to retrieve the top 3 products with the most reviews in the &quot;Mobile_Electronics&quot; product category. </p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">SELECT </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    product_id,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    product_title,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AVG(star_rating) AS rating,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    any(review_body),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    any(review_headline),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    COUNT(*) AS count </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    amazon_reviews </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WHERE </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    product_category = &#x27;Mobile_Electronics&#x27; </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">GROUP BY </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    product_title, product_id </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ORDER BY </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    count DESC </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">LIMIT 10;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>With inverted index, the query takes 1.54s to finish.</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">+------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------+-------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| product_id | product_title                                                                                                                                                                                          | rating             | any_value(review_body)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | any_value(review_headline)      | count |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------+-------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| B00J46XO9U | iXCC Lightning Cable 3ft, iPhone charger, for iPhone X, 8, 8 Plus, 7, 7 Plus, 6s, 6s Plus, 6, 6 Plus, SE 5s 5c 5, iPad Air 2 Pro, iPad mini 2 3 4, iPad 4th Gen [Apple MFi Certified](Black and White) | 4.3766233766233764 | Great cable and works well. Exact fit as Apple cable. I would recommend this to anyone who is looking to save money and for a quality cable.                                                                                                                                                                                                                                                                                                                                                             | Apple certified lightning cable |  1078 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| B004911E9M | Wall AC Charger USB Sync Data Cable for iPhone 4, 3GS, and iPod                                                                                                                                        | 2.4281805745554035 | A total waste of money for me because I needed it for a iPhone 4.  The plug will only go in upside down and thus won&#x27;t work at all.                                                                                                                                                                                                                                                                                                                                                                      | Won&#x27;t work with a iPhone 4!     |   731 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| B002D4IHYM | New Trent Easypak 7000mAh Portable Triple USB Port External Battery Charger/Power Pack for Smartphones, Tablets and more (w/built-in USB cable)                                                        | 4.5216095380029806 | I bought this product based on the reviews that i read and i am very glad that i did. I did have a problem with the product charging my itouch after i received it but i emailed the company and they corrected the problem immediately. VERY GOOD customer service, very prompt. The product itself is very good. It charges my power hungry itouch very quickly and the imax battery power lasts for a long time. All in all a very good purchase that i would recommend to anyone who owns an itouch. | Great product &amp; company         |   671 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------+-------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3 rows in set (1.54 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now let&#x27;s try again without enabling inverted index. The same query takes 1.8s to finish. (You can simply disable inverted index by executing <code>set enable_inverted_index_query=false;</code> in the MySQL client.)</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">+------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------+-------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| product_id | product_title                                                                                                                                                                                          | rating             | any_value(review_body)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | any_value(review_headline)            | count |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------+-------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| B00J46XO9U | iXCC Lightning Cable 3ft, iPhone charger, for iPhone X, 8, 8 Plus, 7, 7 Plus, 6s, 6s Plus, 6, 6 Plus, SE 5s 5c 5, iPad Air 2 Pro, iPad mini 2 3 4, iPad 4th Gen [Apple MFi Certified](Black and White) | 4.3766233766233764 | These cables are great. They feel quality, and best of all, they work as they should. I have no issues with them whatsoever and will be buying more when needed.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Just like the original from Apple     |  1078 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| B004911E9M | Wall AC Charger USB Sync Data Cable for iPhone 4, 3GS, and iPod                                                                                                                                        | 2.4281805745554035 | I ordered two of these chargers for an Iphone 4. Then I started experiencing weird behavior from the touch screen. It would select the wrong area of the screen, or it would refuse to scroll beyond a certain point and jump back up to the top of the page. This behavior occurs whenever either of the two that I bought are attached and charging. When I remove them, it works fine once again. Needless to say, these items are being returned.                                                                                                                                                                                                                                                                                                                                                                              | Beware - these chargers are defective |   731 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| B002D4IHYM | New Trent Easypak 7000mAh Portable Triple USB Port External Battery Charger/Power Pack for Smartphones, Tablets and more (w/built-in USB cable)                                                        | 4.5216095380029806 | I received this in the mail 4 days ago, and after charging it for 6 hours, I&#x27;ve been using it as the sole source for recharging my 3Gs to see how long it would work.  I use my Iphone A LOT every day and usually by the time I get home it&#x27;s down to 50% or less.  After 4 days of using the IMAX to recharge my Iphone, it finally went from 3 bars to 4 this afternoon when I plugged my iphone in.  It charges the iphone very quickly, and I&#x27;ve been topping my phone off (stopping around 95% or so) twice a day.  This is a great product and the size is very similar to a deck of cards (not like an iphone that someone else posted) and is very easy to carry in a jacket pocket or back pack.  I bought this for a 4 day music festival I&#x27;m going to, and I have no worries at all of my iphone running out of juice! | FANTASTIC product!                    |   671 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------+-------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3 rows in set (1.80 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To sum up, inverted index can bring a 15% speedup for queries on low-cardinality columns. So it is not only harmless but also beneficial to low-cardinality data filtering.</p><p>In addition, Apache Doris adopts effective dictionary encoding and compression for low-cardinality columns. It also utilizes built-in indexes like ZoneMap for filtering. Thus, it can deliver ideal query performance even without inverted indexes.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">‚Äã</a></h2><p>Inverted index in Apache Doris optimizes data filtering based on the predicate column (the <code>WHERE</code> clause in SQL queries). It reduces unnecessary data scanning and significantly increases query speed on high-cardinality columns and guarantees no negative effects on low-cardinality columns. It supports lightweight index management, including ADD/DROP INDEX and BUILD INDEX. It can be easily enabled or disabled via <code>enable_inverted_index_query=true/false</code>. </p><p>Inverted index and NGram BloomFilter index apply to different scenarios. This is how you decide which one is the optimal choice: </p><ul><li><strong>Non-primary key column queries</strong>: These cases often involve widely scattered values and a low hit rate. <strong>Inverted index</strong> can work in conjunction with the built-in smart indexes in Doris to accelerate these queries. It has well-established support for scalar data types including characters, numerics, and datetime.</li><li><strong>Text searches on short texts</strong>: If the dataset includes short texts that are highly diverse, <strong>NGram BloomFilter</strong> will be an effective choice for fuzzy matching (<code>LIKE</code>) on short texts. If the short texts are very similar (with lots of identical content), <strong>inverted index</strong> will be more efficient because it ensures a smaller dictionary and faster retrieval of the row numbers. </li><li><strong>Text searches on long texts</strong>: Inverted index is a better choice for long texts. Compared to brutal-force string matching, it largely reduces CPU resource consumption. </li></ul><p>Inverted index has been available in Apache Doris for almost a year and stood the test of many users in their production environment with massive data. In future versions of Apache Doris regarding inverted index, we plan to add support for:</p><ul><li><strong>Self-defined tokenization</strong>: provides a user-defined tokenizer to fit in different use cases.</li><li><strong>More data types</strong>: Users will be able to create inverted index for complex data types including Array and Map.</li></ul><p>If you encounter any issues while trying it out in Apache Doris or would like to know more details, join our <a href="https://join.slack.com/t/apachedoriscommunity/shared_invite/zt-2kl08hzc0-SPJe4VWmL_qzrFd2u2XYQA" target="_blank" rel="noopener noreferrer">Slack</a> community and talk to us!</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><div class="text-center mb-4"><a class="text-[#8592A6] cursor-pointer hover:no-underline" href="/blog">Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class="s-tags"><span class="s-tag">Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:text-[2.5rem] text-center" itemprop="headline"><a itemprop="url" href="/blog/introduction-to-apache-doris-a-next-generation-real-time-data-warehouse">Introduction to Apache Doris: a next-generation real-time data warehouse</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class="authors"><span class="s-author text-black">Apache Doris</span></span><time datetime="2023-10-03T00:00:00.000Z" itemprop="datePublished" class="text-black ml-4">October 3, 2023</time></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-apache-doris">What is Apache Doris?<a href="#what-is-apache-doris" class="hash-link" aria-label="Direct link to What is Apache Doris?" title="Direct link to What is Apache Doris?">‚Äã</a></h2><p><a href="https://doris.apache.org/" target="_blank" rel="noopener noreferrer">Apache Doris</a> is an open-source real-time data warehouse. It can collect data from various data sources, including relational databases (MySQL, PostgreSQL, SQL Server, Oracle, etc.), logs, and time series data from IoT devices. It is capable of reporting, ad-hoc analysis, federated queries, and log analysis, so it can be used to support dashboarding, self-service BI, A/B testing, user behavior analysis and the like.</p><p>Apache Doris supports both batch import and stream writing. It can be well integrated with Apache Spark, Apache Hive, Apache Flink, Airbyte, DBT, and Fivetran. It can also connect to data lakes such as Apache Hive, Apache Hudi, Apache Iceberg, Delta Lake, and Apache Paimon.</p><p><img loading="lazy" alt="What-Is-Apache-Doris" src="https://cdnd.selectdb.com/assets/images/introduction_1-d906db31b97b75340d9e0cf7fe267dfc.png" width="1280" height="654" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="performance">Performance<a href="#performance" class="hash-link" aria-label="Direct link to Performance" title="Direct link to Performance">‚Äã</a></h2><p>As a real-time OLAP engine, Apache Doris hasn a competitive edge in query speed. According to the TPC-H and SSB-Flat benchmarking results, Doris can deliver much faster performance than Presto, Greenplum, and ClickHouse.</p><p>As for its self-volution, it has increased its query speed by over 10 times in the past two years, both in complex queries and flat table analysis.</p><p><img loading="lazy" alt="Apache-Doris-VS-Presto-Greenplum-ClickHouse" src="https://cdnd.selectdb.com/assets/images/introduction_2-3b95346f511caf321269de6c7ea692cd.png" width="1280" height="616" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="architectural-design">Architectural Design<a href="#architectural-design" class="hash-link" aria-label="Direct link to Architectural Design" title="Direct link to Architectural Design">‚Äã</a></h2><p>Behind the fast speed of Apache Doris is the architectural design, features, and mechanisms that contribute to the performance of Doris. </p><p>First of all, Apache Doris has a cost-based optimizer (CBO) that can figure out the most efficient execution plan for complicated big queries. It has a fully vectorized execution engine so it can reduce virtual function calls and cache misses. It is MPP-based (Massively Parallel Processing) so it can give full play to the user&#x27;s machines and cores. In Doris, query execution is data-driven, which means whether a query gets executed is determined by whether its relevant data is ready, and this enables more efficient use of CPUs. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="fast-point-queries-for-a-column-oriented-database">Fast Point Queries for A Column-Oriented Database<a href="#fast-point-queries-for-a-column-oriented-database" class="hash-link" aria-label="Direct link to Fast Point Queries for A Column-Oriented Database" title="Direct link to Fast Point Queries for A Column-Oriented Database">‚Äã</a></h2><p>Apache Doris is a column-oriented database so it can make data compression and data sharding easier and faster. But this might not be suitable for cases such as customer-facing services. In these cases, a data platform will have to handle requests from a large number of users concurrently (these are called &quot;high-concurrency point queries&quot;), and having a columnar storage engine will amplify I/O operations per second, especially when data is arranged in flat tables. </p><p>To fix that, Apache Doris enables hybrid storage, which means to have row storage and columnar storage at the same time. </p><p><img loading="lazy" alt="Hybrid-Columnar-Row-Storage" src="https://cdnd.selectdb.com/assets/images/Introduction_3-1ec14fc9a98e2d4029ce949804b3e1a7.png" width="1914" height="456" class="img_ev3q"></p><p>In addition, since point queries are all simple queries, it will be unnecessary and wasteful to call out the query planner, so Doris executes a short circuit plan for them to reduce overhead. </p><p>Another big source of overheads in high-concurrency point queries is SQL parsing. For that, Doris has prepared statements. The idea is to pre-compute the SQL statement and cache them, so they can be reused for similar queries.</p><p><img loading="lazy" alt="prepared-statement-and-short-circuit-plan" src="https://cdnd.selectdb.com/assets/images/Introduction_4-5daaa3b40e9f7b62a6f30bf10a039f94.png" width="1902" height="392" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="data-ingestion">Data Ingestion<a href="#data-ingestion" class="hash-link" aria-label="Direct link to Data Ingestion" title="Direct link to Data Ingestion">‚Äã</a></h2><p>Apache Doris provides a range of methods for data ingestion.</p><p><strong>Real-Time stream writing</strong>:</p><ul><li><strong><a href="https://doris.apache.org/docs/dev/data-operate/import/import-way/stream-load-manual?_highlight=stream&amp;_highlight=loa" target="_blank" rel="noopener noreferrer">Stream Load</a></strong>: You can apply this method to write local files or data streams via HTTP. It is linearly scalable and can reach a throughput of 10 million records per second in some use cases.</li><li><strong><a href="https://doris.apache.org/docs/1.2/ecosystem/flink-doris-connector/" target="_blank" rel="noopener noreferrer">Flink-Doris-Connector</a></strong>: With built-in Flink CDC, this Connector ingests data from OLTP databases to Doris. So far, we have realized auto-synchronization of data from MySQL and Oracle to Doris.</li><li><strong><a href="https://doris.apache.org/docs/dev/data-operate/import/import-way/routine-load-manual" target="_blank" rel="noopener noreferrer">Routine Load</a></strong>: This is to subscribe data from Kafka message queues. </li><li><strong><a href="https://doris.apache.org/docs/dev/data-operate/import/import-way/insert-into-manual" target="_blank" rel="noopener noreferrer">Insert Into</a></strong>: This is especially useful when you try to do ETL in Doris internally, like writing data from one Doris table to another.</li></ul><p><strong>Batch writing</strong>:</p><ul><li><strong><a href="https://doris.apache.org/docs/dev/data-operate/import/import-way/spark-load-manual" target="_blank" rel="noopener noreferrer">Spark Load</a></strong>: With this method, you can leverage Spark resources to pre-process data from HDFS and object storage before writing to Doris.</li><li><strong><a href="https://doris.apache.org/docs/dev/data-operate/import/import-way/broker-load-manual" target="_blank" rel="noopener noreferrer">Broker Load</a></strong>: This supports HDFS and S3 protocol.</li><li><code>insert into &lt;internal table&gt; select from &lt;external table&gt;</code>: This simple statement allows you to connect Doris to various storage systems, data lakes, and databases.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="data-update">Data Update<a href="#data-update" class="hash-link" aria-label="Direct link to Data Update" title="Direct link to Data Update">‚Äã</a></h2><p>For data updates, what Apache Doris has to offer is that, it supports both Merge on Read and Merge on Write, the former for low-frequency batch updates and the latter for real-time writing. With Merge on Write, the latest data will be ready by the time you execute queries, and that&#x27;s why it can improve your query speed by 5 to 10 times compared to Merge on Read. </p><p>From an implementation perspective, these are a few common data update operations, and Doris supports them all: </p><ul><li><strong>Upsert</strong>: to replace or update a whole row</li><li><strong>Partial column update</strong>: to update just a few columns in a row</li><li><strong>Conditional updating</strong>: to filter out some data by combining a few conditions in order to replace or delete it</li><li><strong>Insert Overwrite</strong>: to rewrite a table or partition</li></ul><p>In some cases, data updates happen concurrently, which means there is numerous new data coming in and trying to modify the existing data record, so the updating order matters a lot. That&#x27;s why Doris allows you to decide the order, either by the order of transaction commit or that of the sequence column (something that you specify in the table in advance). Doris also supports data deletion based on the specified predicate, and that&#x27;s how conditional updating is done.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="service-availability--data-reliability">Service Availability &amp; Data Reliability<a href="#service-availability--data-reliability" class="hash-link" aria-label="Direct link to Service Availability &amp; Data Reliability" title="Direct link to Service Availability &amp; Data Reliability">‚Äã</a></h2><p>Apart from fast performance in queries and data ingestion, Apache Doris also provides service availability guarantee, and this is how: </p><p>Architecturally, Doris has two processes: frontend and backend. Both of them are easily scalable. The frontend nodes manage the clusters, metadata and handle user requests; the backend nodes execute the queries and are capable of auto data balancing and auto-restoration. It supports cluster upgrading and scaling to avoid interruption to services.</p><p><img loading="lazy" alt="architecture-design-of-Apache-Doris" src="https://cdnd.selectdb.com/assets/images/introduction_5-69ce643bd14fb428099a545039a4e18e.png" width="1118" height="720" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cross-cluster-replication">Cross Cluster Replication<a href="#cross-cluster-replication" class="hash-link" aria-label="Direct link to Cross Cluster Replication" title="Direct link to Cross Cluster Replication">‚Äã</a></h2><p>Enterprise users, especially those in finance or e-commerce, will need to backup their clusters or their entire data center, just in case of force majeure. So Doris 2.0 provides Cross Cluster Replication (CCR). With CCR, users can do a lot:</p><ul><li><strong>Disaster recovery</strong>: for quick restoration of data services</li><li><strong>Read-write separation</strong>: master cluster + slave cluster; one for reading, one for writing</li><li><strong>Isolated upgrade of clusters</strong>: For cluster scaling, CCR allows users to pre-create a backup cluster for a trial run so they can clear out the possible incompatibility issues and bugs.</li></ul><p>Tests show that Doris CCR can reach a data latency of minutes. In the best case, it can reach the upper speed limit of the hardware environment.</p><p><img loading="lazy" alt="Cross-Cluster-Replication-in-Apache-Doris" src="https://cdnd.selectdb.com/assets/images/introduction_6-0a799bae221f0af5ddfe41901743df98.png" width="1280" height="297" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="multi-tenant-management">Multi-Tenant Management<a href="#multi-tenant-management" class="hash-link" aria-label="Direct link to Multi-Tenant Management" title="Direct link to Multi-Tenant Management">‚Äã</a></h2><p>Apache Doris has sophisticated Role-Based Access Control, and it allows fine-grained privilege control on the level of databases, tables, rows, and columns. </p><p><img loading="lazy" alt="multi-tenant-management-in-Apache-Doris" src="https://cdnd.selectdb.com/assets/images/introduction_7-97a2ac7fbb42fff86d99e46f92e184e5.png" width="1095" height="720" class="img_ev3q"></p><p>For resource isolation, Doris used to implement a hard isolation plan, which is to divide the backend nodes into resource groups, and assign the Resource Groups to different workloads. This is a hard isolation plan. It was simple and neat. But sometimes users can make the most out of their computing resource because some Resource Groups are idle.</p><p><img loading="lazy" alt="resource-group-in-Apache-Doris" src="https://cdnd.selectdb.com/assets/images/introduction_8-c25066059694cad6e5e4015a4e4e8976.png" width="1280" height="685" class="img_ev3q"></p><p>Thus, instead of Resource Groups, Doris 2.0 introduces Workload Group. A soft limit is set for a Workload Group about how many resources it can use. When that soft limit is hit, and meanwhile there are some idle resources available. The idle resources will be shared across the workload groups. Users can also prioritize the workload groups in terms of their access to idle resources.</p><p><img loading="lazy" alt="workload-group-in-Apache-Doris" src="https://cdnd.selectdb.com/assets/images/introduction_9-aeadca64cd04fe431a0120cec1fd6b20.png" width="1166" height="362" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="easy-to-use">Easy to Use<a href="#easy-to-use" class="hash-link" aria-label="Direct link to Easy to Use" title="Direct link to Easy to Use">‚Äã</a></h2><p>As many capabilities as Apache Doris provides, it is also easy to use. It supports standard SQL and is compatible with MySQL protocol and most BI tools on the market.</p><p>Another effort that we&#x27;ve made to improve usability is a feature called Light Schema Change. This means if users need to add or delete some columns in a table, they just need to update the metadata in the frontend but don&#x27;t have to modify all the data files. Light Schema Change can be done within milliseconds. It also allows changes to indexes and data type of columns. The combination of Light Schema Change and Flink-Doris-Connector means synchronization of upstream tables within milliseconds.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="semi-structured-data-analysis">Semi-Structured Data Analysis<a href="#semi-structured-data-analysis" class="hash-link" aria-label="Direct link to Semi-Structured Data Analysis" title="Direct link to Semi-Structured Data Analysis">‚Äã</a></h2><p>Common examples of semi-structure data include logs, observability data, and time series data. These cases require schema-free support, lower cost, and capabilities in multi-dimensional analysis and full-text search.</p><p>In text analysis, mostly, people use the LIKE operator, so we put a lot of effort into improving the performance of it, including pushing down the LIKE operator down to the storage layer (to reduce data scanning), and introducing the NGram Bloomfilter, the Hyperscan regex matching library, and the Volnitsky algorithm (for sub-string matching).</p><p><img loading="lazy" alt="LIKE-operator" src="https://cdnd.selectdb.com/assets/images/introduction_10-f4a60eac6572f70e2d4cedb5046e2b60.png" width="1280" height="335" class="img_ev3q"></p><p>We have also introduced inverted index for text tokenization. It is a power tool for fuzzy keyword search, full-text search, equivalence queries, and range queries.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="data-lakehouse">Data Lakehouse<a href="#data-lakehouse" class="hash-link" aria-label="Direct link to Data Lakehouse" title="Direct link to Data Lakehouse">‚Äã</a></h2><p>For users to build a high-performing data lakehouse and a unified query gateway, Doris can map, cache, and auto-refresh the meta data from external sources. It supports Hive Metastore and almost all open data lakehouse formats. You can connect it to relational databases, Elasticsearch, and many other sources. And it allows you to reuse your own authentication systems, like Kerberos and Apache Ranger, on the external tables.</p><p>Benchmark results show that Apache Doris is 3~5 times faster than Trino in queries on Hive tables. It is the joint result of a few features: </p><ol><li>Efficient query engine</li><li>Hot data caching mechanism</li><li>Compute nodes</li><li>Views in Doris</li></ol><p>The <a href="https://doris.apache.org/docs/dev/advanced/compute-node" target="_blank" rel="noopener noreferrer">Compute Nodes</a> is a newly introduced solution in version 2.0 for data lakehousing. Unlike normal backend nodes, Compute Nodes are stateless and do not store any data. Neither are they involved in data balancing during cluster scaling. Thus, they can join the cluster flexibly and easily during computation peak times. </p><p>Also, Doris allows you to write the computation results of external tables into Doris to form a view. This is a similar thinking to Materialized Views: to trade space for speed. After a query on external tables is executed, the results can be put in Doris internally. When there are similar queries following up, the system can directly read the results of previous queries from Doris, and that speeds things up.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tiered-storage">Tiered Storage<a href="#tiered-storage" class="hash-link" aria-label="Direct link to Tiered Storage" title="Direct link to Tiered Storage">‚Äã</a></h2><p>The main purpose of tiered storage is to save money. <a href="https://doris.apache.org/docs/dev/advanced/cold-hot-separation?_highlight=cold" target="_blank" rel="noopener noreferrer">Tiered storage </a>means to separate hot data and cold data into different storage, with hot data being the data that is frequently accessed and cold data that isn&#x27;t. It allows users to put hot data in the quick but expensive disks (such as SSD and HDD), and cold data in object storage.</p><p><img loading="lazy" alt="tiered-storage-in-Apache-Doris" src="https://cdnd.selectdb.com/assets/images/introduction_11-a841a4fd892e69d61184e21b7c34246b.png" width="1150" height="622" class="img_ev3q"></p><p>Roughly speaking, for a data asset consisting of 80% cold data, tiered storage will reduce your storage cost by 70%.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-apache-doris-community">The Apache Doris Community<a href="#the-apache-doris-community" class="hash-link" aria-label="Direct link to The Apache Doris Community" title="Direct link to The Apache Doris Community">‚Äã</a></h2><p>This is an overview of Apache Doris, an open-source real-time data warehouse. It is actively evolving with an agile release schedule, and the <a href="https://join.slack.com/t/apachedoriscommunity/shared_invite/zt-2kl08hzc0-SPJe4VWmL_qzrFd2u2XYQA" target="_blank" rel="noopener noreferrer">community</a> embraces any questions, ideas, and feedback.</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><div class="text-center mb-4"><a class="text-[#8592A6] cursor-pointer hover:no-underline" href="/blog">Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class="s-tags"><span class="s-tag">Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:text-[2.5rem] text-center" itemprop="headline"><a itemprop="url" href="/blog/log-analysis-elasticsearch-vs-apache-doris">Log analysis: Elasticsearch vs Apache Doris</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class="authors"><span class="s-author text-black">Apache Doris</span></span><time datetime="2023-09-28T00:00:00.000Z" itemprop="datePublished" class="text-black ml-4">September 28, 2023</time></div></header><div class="markdown" itemprop="articleBody"><p>As a major part of a company&#x27;s data asset, logs brings values to businesses in three aspects: system observability, cyber security, and data analysis. They are your first resort for troubleshooting, your reference for improving system security, and your data mine where you can extract information that points to business growth.</p><p>Logs are the sequential records of events in the computer system. If you think about how logs are generated and used, you will know what an ideal log analysis system should look like:</p><ul><li><strong>It should have schema-free support.</strong> Raw logs are unstructured free texts and basically impossible for aggregation and calculation, so you needed to turn them into structured tables (the process is called &quot;ETL&quot;) before putting them into a database or data warehouse for analysis. If there was a schema change, lots of complicated adjustments needed to put into ETL and the structured tables. Therefore, semi-structured logs, mostly in JSON format, emerged. You can add or delete fields in these logs and the log storage system will adjust the schema accordingly. </li><li><strong>It should be low-cost.</strong> Logs are huge and they are generated continuously. A fairly big company produces 10~100 TBs of log data. For business or compliance reasons, it should keep the logs around for half a year or longer. That means to store a log size measured in PB, so the cost is considerable.</li><li><strong>It should be capable of real-time processing.</strong> Logs should be written in real time, otherwise engineers won&#x27;t be able to catch the latest events in troubleshooting and security tracking. Plus, a good log system should provide full-text searching capabilities and respond to interactive queries quickly.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-elasticsearch-based-log-analysis-solution">The Elasticsearch-Based Log Analysis Solution<a href="#the-elasticsearch-based-log-analysis-solution" class="hash-link" aria-label="Direct link to The Elasticsearch-Based Log Analysis Solution" title="Direct link to The Elasticsearch-Based Log Analysis Solution">‚Äã</a></h2><p>A popular log processing solution within the data industry is the <strong>ELK stack: Elasticsearch, Logstash, and Kibana</strong>. The pipeline can be split into five modules:</p><ul><li><strong>Log collection</strong>: Filebeat collects local log files and writes them to a Kafka message queue.</li><li><strong>Log transmission</strong>: Kafka message queue gathers and caches logs.</li><li><strong>Log transfer</strong>: Logstash filters and transfers log data in Kafka.</li><li><strong>Log storage</strong>: Logstash writes logs in JSON format into Elasticsearch for storage.</li><li><strong>Log query</strong>: Users search for logs via Kibana visualization or send a query request via Elasticsearch DSL API.</li></ul><p><img loading="lazy" alt="ELK-Stack" src="https://cdnd.selectdb.com/assets/images/LAS_1-5855470fa53156592103937c4c267847.png" width="1280" height="230" class="img_ev3q"></p><p>The ELK stack has outstanding real-time processing capabilities, but frictions exist.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="inadequate-schema-free-support">Inadequate Schema-Free Support<a href="#inadequate-schema-free-support" class="hash-link" aria-label="Direct link to Inadequate Schema-Free Support" title="Direct link to Inadequate Schema-Free Support">‚Äã</a></h3><p>The Index Mapping in Elasticsearch defines the table scheme, which includes the field names, data types, and whether to enable index creation.</p><p><img loading="lazy" alt="index-mapping-in-Elasticsearch" src="https://cdnd.selectdb.com/assets/images/LAS_2-426b7a38106af2b1b439180d5ea5be47.png" width="796" height="772" class="img_ev3q"></p><p>Elasticsearch also boasts a Dynamic Mapping mechanism that automatically adds fields to the Mapping according to the input JSON data. This provides some sort of schema-free support, but it&#x27;s not enough because:</p><ul><li>Dynamic Mapping often creates too many fields when processing dirty data, which interrupts the whole system.</li><li>The data type of fields is immutable. To ensure compatibility, users often configure &quot;text&quot; as the data type, but that results in much slower query performance than binary data types such as integer.</li><li>The index of fields is immutable, too. Users cannot add or delete indexes for a certain field, so they often create indexes for all fields to facilitate data filtering in queries. But too many indexes require extra storage space and slow down data ingestion.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="inadequate-analytic-capability">Inadequate Analytic Capability<a href="#inadequate-analytic-capability" class="hash-link" aria-label="Direct link to Inadequate Analytic Capability" title="Direct link to Inadequate Analytic Capability">‚Äã</a></h3><p>Elasticsearch has its unique Domain Specific Language (DSL), which is very different from the tech stack that most data engineers and analysts are familiar with, so there is a steep learning curve. Moreover, Elasticsearch has a relatively closed ecosystem so there might be strong resistance in integration with BI tools. Most importantly, Elastisearch only supports single-table analysis and is lagging behind the modern OLAP demands for multi-table join, sub-query, and views.</p><p><img loading="lazy" alt="Elasticsearch-DSL" src="https://cdnd.selectdb.com/assets/images/LAS_3-8dda5ac77b54b4a58682c977efcd3817.png" width="550" height="764" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="high-cost--low-stability">High Cost &amp; Low Stability<a href="#high-cost--low-stability" class="hash-link" aria-label="Direct link to High Cost &amp; Low Stability" title="Direct link to High Cost &amp; Low Stability">‚Äã</a></h3><p>Elasticsearch users have been complaining about the computation and storage costs. The root reason lies in the way Elasticsearch works.</p><ul><li><strong>Computation cost</strong>: In data writing, Elasticsearch also executes compute-intensive operations including inverted index creation, tokenization, and inverted index ranking. Under these circumstances, data is written into Elasticsearch at a speed of around 2MB/s per core. When CPU resources are tight, data writing requirements often get rejected during peak times, which further leads to higher latency. </li><li><strong>Storage cost</strong>: To speed up retrieval, Elasticsearch stores the forward indexes, inverted indexes, and docvalues of the original data, consuming a lot more storage space. The compression ratio of a single data copy is only 1.5:1, compared to the 5:1 in most log solutions.</li></ul><p>As data and cluster size grows, maintaining stability can be another issue:</p><ul><li><p><strong>During data writing peaks</strong>: Clusters are prone to overload during data writing peaks.</p></li><li><p><strong>During queries</strong>: Since all queries are processed in the memory, big queries can easily lead to JVM OOM.</p></li><li><p><strong>Slow recovery</strong>: For a cluster failure, Elasticsearch should reload indexes, which is resource-intensive, so it will take many minutes to recover. That challenges service availability guarantee.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="a-more-cost-effective-option">A More Cost-Effective Option<a href="#a-more-cost-effective-option" class="hash-link" aria-label="Direct link to A More Cost-Effective Option" title="Direct link to A More Cost-Effective Option">‚Äã</a></h2><p>Reflecting on the strengths and limitations of the Elasticsearch-based solution, the Apache Doris developers have optimized Apache Doris for log processing. </p><ul><li><strong>Increase writing throughout</strong>: The performance of Elasticsearch is bottlenecked by data parsing and inverted index creation, so we improved Apache Doris in these factors: we quickened data parsing and index creation by SIMD instructions and CPU vector instructions; then we removed those data structures unnecessary for log analysis scenarios, such as forward indexes, to simplify index creation.</li><li><strong>Reduce storage costs</strong>: We removed forward indexes, which represented 30% of index data. We adopted columnar storage and the ZSTD compression algorithm, and thus achieved a compression ratio of 5:1 to 10:1. Given that a large part of the historical logs are rarely accessed, we introduced tiered storage to separate hot and cold data. Logs that are older than a specified time period will be moved to object storage, which is much less expensive. This can reduce storage costs by around 70%. </li></ul><p>Benchmark tests with ES Rally, the official testing tool for Elasticsearch, showed that Apache Doris was around 5 times as fast as Elasticsearch in data writing, 2.3 times as fast in queries, and it consumed only 1/5 of the storage space that Elasticsearch used. On the test dataset of HTTP logs, it achieved a writing speed of 550 MB/s and a compression ratio of 10:1.</p><p><img loading="lazy" alt="Elasticsearch-VS-Apache-Doris" src="https://cdnd.selectdb.com/assets/images/LAS_4-49afc2c61d8929daeb0f51c39686e305.png" width="1280" height="725" class="img_ev3q"></p><p>The below figure show what a typical Doris-based log processing system looks like. It is more inclusive and allows for more flexible usage from data ingestion, analysis, and application:</p><ul><li><strong>Ingestion</strong>: Apache Doris supports various ingestion methods for log data. You can push logs to Doris via HTTP Output using Logstash, you can use Flink to pre-process the logs before you write them into Doris, or you can load logs from Flink or object storage to Doris via Routine Load and S3 Load. </li><li><strong>Analysis</strong>: You can put log data in Doris and conduct join queries across logs and other data in the data warehouse.</li><li><strong>Application</strong>: Apache Doris is compatible with MySQL protocol, so you can integrate a wide variety of data analytic tools and clients to Doris, such as Grafana and Tableau. You can also connect applications to Doris via JDBC and ODBC APIs. We are planning to build a Kibana-like system to visualize logs.</li></ul><p><img loading="lazy" alt="Apache-Doris-log-analysis-stack" src="https://cdnd.selectdb.com/assets/images/LAS_5-cdbff999ed0de15553dee4514a869fd4.png" width="1272" height="432" class="img_ev3q"></p><p>Moreover, Apache Doris has better scheme-free support and a more user-friendly analytic engine.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="native-support-for-semi-structured-data">Native Support for Semi-Structured Data<a href="#native-support-for-semi-structured-data" class="hash-link" aria-label="Direct link to Native Support for Semi-Structured Data" title="Direct link to Native Support for Semi-Structured Data">‚Äã</a></h3><p><strong>Firstly, we worked on the data types.</strong> We optimized the string search and regular expression matching for &quot;text&quot; through vectorization and brought a performance increase of 2~10 times. For JSON strings, Apache Doris will parse and store them as a more compacted and efficient binary format, which can speed up queries by 4 times. We also added a new data type for complicated data: Array Map. It can structuralize concatenated strings to allow for higher compression rate and faster queries.</p><p><strong>Secondly, Apache Doris supports schema evolution.</strong> This means you can adjust the schema as your business changes. You can add or delete fields and indexes, and change the data types for fields.</p><p>Apache Doris provides Light Schema Change capabilities, so you can add or delete fields within milliseconds:</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">-- Add a column. Result will be returned in milliseconds.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ALTER TABLE lineitem ADD COLUMN l_new_column INT;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can also add index only for your target fields, so you can avoid overheads from unnecessary index creation. After you add an index, by default, the system will generate the index for all incremental data, and you can specify which historical data partitions that need the index.</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">-- Add inverted index. Doris will generate inverted index for all new data afterward.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ALTER TABLE table_name ADD INDEX index_name(column_name) USING INVERTED;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-- Build index for the specified historical data partitions.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">BUILD INDEX index_name ON table_name PARTITIONS(partition_name1, partition_name2);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sql-based-analytic-engine">SQL-Based Analytic Engine<a href="#sql-based-analytic-engine" class="hash-link" aria-label="Direct link to SQL-Based Analytic Engine" title="Direct link to SQL-Based Analytic Engine">‚Äã</a></h3><p>The SQL-based analytic engine makes sure that data engineers and analysts can smoothly grasp Apache Doris in a short time and bring their experience with SQL to this OLAP engine. Building on the rich features of SQL, users can execute data retrieval, aggregation, multi-table join, sub-query, UDF, logic views, and materialized views to serve their own needs. </p><p>With MySQL compatibility, Apache Doris can be integrated with most GUI and BI tools in the big data ecosystem, so users can realize more complex and diversified data analysis.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="performance-in-use-case">Performance in Use Case<a href="#performance-in-use-case" class="hash-link" aria-label="Direct link to Performance in Use Case" title="Direct link to Performance in Use Case">‚Äã</a></h3><p>A gaming company has transitioned from the ELK stack to the Apache Doris solution. Their Doris-based log system used 1/6 of the storage space that they previously needed. </p><p>In a cybersecurity company who built their log analysis system utilizing inverted index in Apache Doris, they supported a data writing speed of 300,000 rows per second with 1/5 of the server resources that they formerly used. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="hands-on-guide">Hands-On Guide<a href="#hands-on-guide" class="hash-link" aria-label="Direct link to Hands-On Guide" title="Direct link to Hands-On Guide">‚Äã</a></h2><p>Now let&#x27;s go through the three steps of building a log analysis system with Apache Doris. </p><p>Before you start, <a href="https://doris.apache.org/download/" target="_blank" rel="noopener noreferrer">download</a> Apache Doris 2.0 or newer versions from the website and <a href="https://doris.apache.org/docs/dev/install/standard-deployment/" target="_blank" rel="noopener noreferrer">deploy</a> clusters.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-create-tables">Step 1: Create Tables<a href="#step-1-create-tables" class="hash-link" aria-label="Direct link to Step 1: Create Tables" title="Direct link to Step 1: Create Tables">‚Äã</a></h3><p>This is an example of table creation.</p><p>Explanations for the configurations:</p><ul><li>The DATETIMEV2 time field is specified as the Key in order to speed up queries for the latest N log records.</li><li>Indexes are created for the frequently accessed fields, and fields that require full-text search are specified with Parser parameters.</li><li>&quot;PARTITION BY RANGE&quot; means to partition the data by RANGE based on time fields, <a href="https://doris.apache.org/docs/dev/advanced/partition/dynamic-partition/" target="_blank" rel="noopener noreferrer">Dynamic Partition</a> is enabled for auto-management.</li><li>&quot;DISTRIBUTED BY RANDOM BUCKETS AUTO&quot; means to distribute the data into buckets randomly and the system will automatically decide the number of buckets based on the cluster size and data volume.</li><li>&quot;log_policy_1day&quot; and &quot;log_s3&quot; means to move logs older than 1 day to S3 storage.</li></ul><div class="language-Go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE DATABASE log_db;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">USE log_db;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE RESOURCE &quot;log_s3&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;type&quot; = &quot;s3&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;s3.endpoint&quot; = &quot;your_endpoint_url&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;s3.region&quot; = &quot;your_region&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;s3.bucket&quot; = &quot;your_bucket&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;s3.root.path&quot; = &quot;your_path&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;s3.access_key&quot; = &quot;your_ak&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;s3.secret_key&quot; = &quot;your_sk&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE STORAGE POLICY log_policy_1day</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;storage_resource&quot; = &quot;log_s3&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;cooldown_ttl&quot; = &quot;86400&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE TABLE log_table</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `ts` DATETIMEV2,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `clientip` VARCHAR(20),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `request` TEXT,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `status` INT,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `size` INT,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  INDEX idx_size (`size`) USING INVERTED,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  INDEX idx_status (`status`) USING INVERTED,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  INDEX idx_clientip (`clientip`) USING INVERTED,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  INDEX idx_request (`request`) USING INVERTED PROPERTIES(&quot;parser&quot; = &quot;english&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ENGINE = OLAP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DUPLICATE KEY(`ts`)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PARTITION BY RANGE(`ts`) ()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DISTRIBUTED BY RANDOM BUCKETS AUTO</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;replication_num&quot; = &quot;1&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;storage_policy&quot; = &quot;log_policy_1day&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;deprecated_dynamic_schema&quot; = &quot;true&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;dynamic_partition.enable&quot; = &quot;true&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;dynamic_partition.time_unit&quot; = &quot;DAY&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;dynamic_partition.start&quot; = &quot;-3&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;dynamic_partition.end&quot; = &quot;7&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;dynamic_partition.prefix&quot; = &quot;p&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;dynamic_partition.buckets&quot; = &quot;AUTO&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;dynamic_partition.replication_num&quot; = &quot;1&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-ingest-the-logs">Step 2: Ingest the Logs<a href="#step-2-ingest-the-logs" class="hash-link" aria-label="Direct link to Step 2: Ingest the Logs" title="Direct link to Step 2: Ingest the Logs">‚Äã</a></h3><p>Apache Doris supports various ingestion methods. For real-time logs, we recommend the following three methods:</p><ul><li>Pull logs from Kafka message queue: Routine Load </li><li>Logstash: write logs into Doris via HTTP API</li><li>Self-defined writing program: write logs into Doris via HTTP API</li></ul><p><strong>Ingest from Kafka</strong></p><p>For JSON logs that are written into Kafka message queues, create <a href="https://doris.apache.org/docs/dev/data-operate/import/import-way/routine-load-manual/" target="_blank" rel="noopener noreferrer">Routine Load</a> so Doris will pull data from Kafka. The following is an example. The <code>property.*</code> configurations are optional:</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">-- Prepare the Kafka cluster and topic (&quot;log_topic&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-- Create Routine Load, load data from Kafka log_topic to &quot;log_table&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE ROUTINE LOAD load_log_kafka ON log_db.log_table</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">COLUMNS(ts, clientip, request, status, size)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;max_batch_interval&quot; = &quot;10&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;max_batch_rows&quot; = &quot;1000000&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;max_batch_size&quot; = &quot;109715200&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;strict_mode&quot; = &quot;false&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;format&quot; = &quot;json&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM KAFKA (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;kafka_broker_list&quot; = &quot;host:port&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;kafka_topic&quot; = &quot;log_topic&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;property.group.id&quot; = &quot;your_group_id&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;property.security.protocol&quot;=&quot;SASL_PLAINTEXT&quot;,     </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;property.sasl.mechanism&quot;=&quot;GSSAPI&quot;,     </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;property.sasl.kerberos.service.name&quot;=&quot;kafka&quot;,     </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;property.sasl.kerberos.keytab&quot;=&quot;/path/to/xxx.keytab&quot;,     </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;property.sasl.kerberos.principal&quot;=&quot;xxx@yyy.com&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can check how the Routine Load runs via the <code>SHOW ROUTINE LOAD</code> command. </p><p><strong>Ingest via Logstash</strong></p><p>Configure HTTP Output for Logstash, and then data will be sent to Doris via HTTP Stream Load.</p><ol><li>Specify the batch size and batch delay in <code>logstash.yml</code> to improve data writing performance.</li></ol><div class="language-Plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">pipeline.batch.size: 100000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pipeline.batch.delay: 10000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Add HTTP Output to the log collection configuration file <code>testlog.conf</code>, URL =&gt; the Stream Load address in Doris.</li></ol><ul><li>Since Logstash does not support HTTP redirection, you should use a backend address instead of a FE address.</li><li>Authorization in the headers is <code>http basic auth</code>. It is computed with <code>echo -n &#x27;username:password&#x27; | base64</code>.</li><li>The <code>load_to_single_tablet</code> in the headers can reduce the number of small files in data ingestion.</li></ul><div class="language-Plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">output {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    http {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       follow_redirects =&gt; true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       keepalive =&gt; false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       http_method =&gt; &quot;put&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       url =&gt; &quot;http://172.21.0.5:8640/api/logdb/logtable/_stream_load&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       headers =&gt; [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           &quot;format&quot;, &quot;json&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           &quot;strip_outer_array&quot;, &quot;true&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           &quot;load_to_single_tablet&quot;, &quot;true&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           &quot;Authorization&quot;, &quot;Basic cm9vdDo=&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           &quot;Expect&quot;, &quot;100-continue&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       format =&gt; &quot;json_batch&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Ingest via self-defined program</strong></p><p>This is an example of ingesting data to Doris via HTTP Stream Load.</p><p>Notes:</p><ul><li>Use <code>basic auth</code> for HTTP authorization, use <code>echo -n &#x27;username:password&#x27; | base64</code> in computation</li><li><code>http header &quot;format:json&quot;</code>: the data type is specified as JSON</li><li><code>http header &quot;read_json_by_line:true&quot;</code>: each line is a JSON record</li><li><code>http header &quot;load_to_single_tablet:true&quot;</code>: write to one tablet each time</li><li>For the data writing clients, we recommend a batch size of 100MB~1GB. Future versions will enable Group Commit at the server end and reduce batch size from clients.</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--location-trusted </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-u username:password </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-H </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;format:json&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-H </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;read_json_by_line:true&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-H </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;load_to_single_tablet:true&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-T logfile.json </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">http://fe_host:fe_http_port/api/log_db/log_table/_stream_load</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-3-execute-queries">Step 3: Execute Queries<a href="#step-3-execute-queries" class="hash-link" aria-label="Direct link to Step 3: Execute Queries" title="Direct link to Step 3: Execute Queries">‚Äã</a></h3><p>Apache Doris supports standard SQL, so you can connect to Doris via MySQL client or JDBC and then execute SQL queries.</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql -h fe_host -P fe_mysql_port -u root -Dlog_db</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>A few common queries in log analysis:</strong></p><ul><li>Check the latest 10 records.</li></ul><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">SELECT * FROM log_table ORDER BY ts DESC LIMIT 10;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Check the latest 10 records of Client IP &quot;8.8.8.8&quot;.</li></ul><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">SELECT * FROM log_table WHERE clientip = &#x27;8.8.8.8&#x27; ORDER BY ts DESC LIMIT 10;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Retrieve the latest 10 records with &quot;error&quot; or &quot;404&quot; in the &quot;request&quot; field. <strong>MATCH_ANY</strong> is a SQL syntax keyword for full-text search in Doris. It means to find the records that include any one of the specified keywords.</li></ul><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">SELECT * FROM log_table WHERE request MATCH_ANY &#x27;error 404&#x27; ORDER BY ts DESC LIMIT 10;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Retrieve the latest 10 records with &quot;image&quot; and &quot;faq&quot; in the &quot;request&quot; field. <strong>MATCH_ALL</strong> is also a SQL syntax keyword for full-text search in Doris. It means to find the records that include all of the specified keywords.</li></ul><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">SELECT * FROM log_table WHERE request MATCH_ALL &#x27;image faq&#x27; ORDER BY ts DESC LIMIT 10;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">‚Äã</a></h2><p>If you are looking for an efficient log analytic solution, Apache Doris is friendly to anyone equipped with SQL knowledge; if you find friction with the ELK stack, try Apache Doris provides better schema-free support, enables faster data writing and queries, and brings much less storage burden.</p><p>But we won&#x27;t stop here. We are going to provide more features to facilitate log analysis. We plan to add more complicated data types to inverted index, and support BKD index to make Apache Doris a fit for geo data analysis. We also plan to expand capabilities in semi-structured data analysis, such as working on the complex data types (Array, Map, Struct, JSON) and high-performance string matching algorithm. And we welcome any <a href="https://join.slack.com/t/apachedoriscommunity/shared_invite/zt-2kl08hzc0-SPJe4VWmL_qzrFd2u2XYQA" target="_blank" rel="noopener noreferrer">user feedback and development advice</a>.</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><div class="text-center mb-4"><a class="text-[#8592A6] cursor-pointer hover:no-underline" href="/blog">Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class="s-tags"><span class="s-tag">Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:text-[2.5rem] text-center" itemprop="headline"><a itemprop="url" href="/blog/Auto-Synchronization-of-an-Entire-MySQL-Database-for-Data-Analysis">Auto synchronization of an entire MySQL database for data analysis</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class="authors"><span class="s-author text-black">Apache Doris</span></span><time datetime="2023-08-16T00:00:00.000Z" itemprop="datePublished" class="text-black ml-4">August 16, 2023</time></div></header><div class="markdown" itemprop="articleBody"><p>Flink-Doris-Connector 1.4.0 allows users to ingest a whole database (<strong>MySQL</strong> or <strong>Oracle</strong>) that contains thousands of tables into <a href="https://doris.apache.org/zh-CN/" target="_blank" rel="noopener noreferrer">Apache Doris</a>, a real-time analytic database, <strong>in one step</strong>.</p><p>With built-in Flink CDC, the Connector can directly synchronize the table schema and data from the upstream source to Apache Doris, which means users no longer have to write a DataStream program or pre-create mapping tables in Doris. </p><p>When a Flink job starts, the Connector automatically checks for data equivalence between the source database and Apache Doris. If the data source contains tables which do not exist in Doris, the Connector will automatically create those same tables in Doris, and utilizes the side outputs of Flink to facilitate the ingestion of multiple tables at once; if there is a schema change in the source, it will automatically obtain the DDL statement and make the same schema change in Doris. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="quick-start">Quick Start<a href="#quick-start" class="hash-link" aria-label="Direct link to Quick Start" title="Direct link to Quick Start">‚Äã</a></h2><p>Download Flink Doris Connector: <a href="https://doris.apache.org/download/" target="_blank" rel="noopener noreferrer">https://doris.apache.org/download/</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-use-it">How to Use It<a href="#how-to-use-it" class="hash-link" aria-label="Direct link to How to Use It" title="Direct link to How to Use It">‚Äã</a></h2><p>For example, to ingest a whole MySQL database <code>mysql_db</code> into Doris (the MySQL table names start with <code>tbl</code> or <code>test</code>), simply execute the following command (no need to create the tables in Doris in advance):</p><div class="language-Shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;FLINK_HOME&gt;/bin/flink run \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -Dexecution.checkpointing.interval=10s \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -Dparallelism.default=1 \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -c org.apache.doris.flink.tools.cdc.CdcTools \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    lib/flink-doris-connector-1.16-1.4.0.jar \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    mysql-sync-database \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --database test_db \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --mysql-conf hostname=127.0.0.1 \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --mysql-conf username=root \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --mysql-conf password=123456 \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --mysql-conf database-name=mysql_db \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --including-tables &quot;tbl|test.*&quot; \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --sink-conf fenodes=127.0.0.1:8030 \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --sink-conf username=root \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --sink-conf password=123456 \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --sink-conf jdbc-url=jdbc:mysql://127.0.0.1:9030 \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --sink-conf sink.label-prefix=label1 \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --table-conf replication_num=1 </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To ingest an Oracle database: please refer to the <a href="https://github.com/apache/doris-flink-connector/pull/156" target="_blank" rel="noopener noreferrer">example code</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-it-performs">How It Performs<a href="#how-it-performs" class="hash-link" aria-label="Direct link to How It Performs" title="Direct link to How It Performs">‚Äã</a></h2><p>When it comes to synchronizing a whole database (containing hundreds or even thousands of tables, active or inactive), most users want it to be done within seconds. So we tested the Connector to see if it came up to scratch:</p><ul><li>1000 MySQL tables, each having 100 fields. All tables were active (which meant they were continuously updated and each data writing involved over a hundred rows)</li><li>Flink job checkpoint: 10s</li></ul><p>Under pressure test, the system showed high stability, with key metrics as follows:</p><p><img loading="lazy" alt="Flink-Doris-Connector" src="https://cdnd.selectdb.com/assets/images/FDC_1-ce2b3c35d3126c743a9b9df1105dd1ce.png" width="1280" height="243" class="img_ev3q"></p><p><img loading="lazy" alt="Flink-CDC" src="https://cdnd.selectdb.com/assets/images/FDC_2-18b4e1b3346d90e6430b992d74e9a64f.png" width="1280" height="487" class="img_ev3q"></p><p><img loading="lazy" alt="Doris-Cluster-Compaction-Score" src="https://cdnd.selectdb.com/assets/images/FDC_3-5e973914e448c11df5e3e408823f2ded.png" width="1280" height="306" class="img_ev3q"></p><p>According to feedback from early adopters, the Connector has also delivered high performance and system stability in 10,000-table database synchronization in their production environment. This proves that the combination of Apache Doris and Flink CDC is capable of large-scale data synchronization with high efficiency and reliability.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-it-benefits-data-engineers">How It Benefits Data Engineers<a href="#how-it-benefits-data-engineers" class="hash-link" aria-label="Direct link to How It Benefits Data Engineers" title="Direct link to How It Benefits Data Engineers">‚Äã</a></h2><p>Engineers no longer have to worry about table creation or table schema maintenance, saving them days of tedious and error-prone work. Previously in Flink CDC, you need to create a Flink job for each table and build a log parsing link at the source end, but now with whole-database ingestion, resouce consumption in the source database is largely reduced. It is also a unified solution for incremental update and full update.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="other-features">Other Features<a href="#other-features" class="hash-link" aria-label="Direct link to Other Features" title="Direct link to Other Features">‚Äã</a></h2><p><strong>1. Joining dimension table and fact table</strong></p><p>The common practice is to put dimension tables in Doris and run join queries via the real-time stream of Flink. Based on the <a href="https://nightlies.apache.org/flink/flink-docs-release-1.14/docs/dev/datastream/operators/asyncio/" target="_blank" rel="noopener noreferrer">Async I/O of Flink</a>, Flink-Doris-Connector 1.4.0 implements asynchronous Lookup Join, so the Flink real-time stream won&#x27;t be blocked due to queries. Also, the Connector allows you to combine mulitple queries into one big query, and send it to Doris at once for processing. This improves the efficiency and throughput of such join queries.</p><p><strong>2. Thrift</strong> <strong>SDK</strong></p><p>We introduced Thrift-Service SDK into the Connector so users no longer have to use Thrift plug-ins or configure a Thrift environment in compilation. This makes the compilation process much simpler.</p><p><strong>3. On-Demand Stream Load</strong></p><p>During data synchronization, when there is no new data ingestion, no Stream Load requests will be issued. This avoids unnecessary consumption of cluster resources.</p><p><strong>4. Polling of Backend Nodes</strong></p><p>For data ingestion, Doris calls a frontend node to obtain a list of the backend nodes, and randomly chooses one to launch an ingestion request. That backend node will be the Coordinator. Flink-Doris-Connector 1.4.0 allows users to enable the polling mechanism, which is to have a different backend node to be the Coordinator at each Flink checkpoint to avoid too much pressure on a single backend node for a long time.</p><p><strong>5. Support for More Data Types</strong></p><p>In addition to the common data types, Flink-Doris-Connector 1.4.0 supports DecimalV3/DateV2/DateTimev2/Array/JSON in Doris.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="example-usage">Example Usage<a href="#example-usage" class="hash-link" aria-label="Direct link to Example Usage" title="Direct link to Example Usage">‚Äã</a></h2><p><strong>Read from Apache Doris:</strong> </p><p>You can read data from Doris via DataStream or FlinkSQL (bounded stream). Predicate pushdown is supported.</p><div class="language-Java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE TABLE flink_doris_source (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    name STRING,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    age INT,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    score DECIMAL(5,2)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ) </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    WITH (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &#x27;connector&#x27; = &#x27;doris&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &#x27;fenodes&#x27; = &#x27;127.0.0.1:8030&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &#x27;table.identifier&#x27; = &#x27;database.table&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &#x27;username&#x27; = &#x27;root&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &#x27;password&#x27; = &#x27;password&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &#x27;doris.filter.query&#x27; = &#x27;age=18&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SELECT * FROM flink_doris_source;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Join dimension table and fact table</strong>:</p><div class="language-Java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE TABLE fact_table (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `id` BIGINT,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `name` STRING,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `city` STRING,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `process_time` as proctime()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">) WITH (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &#x27;connector&#x27; = &#x27;kafka&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">create table dim_city(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `city` STRING,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `level` INT ,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `province` STRING,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `country` STRING</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">) WITH (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &#x27;connector&#x27; = &#x27;doris&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &#x27;fenodes&#x27; = &#x27;127.0.0.1:8030&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &#x27;jdbc-url&#x27; = &#x27;jdbc:mysql://127.0.0.1:9030&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &#x27;lookup.jdbc.async&#x27; = &#x27;true&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &#x27;table.identifier&#x27; = &#x27;dim.dim_city&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &#x27;username&#x27; = &#x27;root&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &#x27;password&#x27; = &#x27;&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SELECT a.id, a.name, a.city, c.province, c.country,c.level </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM fact_table a</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">LEFT JOIN dim_city FOR SYSTEM_TIME AS OF a.process_time AS c</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ON a.city = c.city</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Write to Apache Doris</strong>: </p><div class="language-Java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE TABLE doris_sink (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    name STRING,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    age INT,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    score DECIMAL(5,2)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ) </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    WITH (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &#x27;connector&#x27; = &#x27;doris&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &#x27;fenodes&#x27; = &#x27;127.0.0.1:8030&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &#x27;table.identifier&#x27; = &#x27;database.table&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &#x27;username&#x27; = &#x27;root&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &#x27;password&#x27; = &#x27;&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &#x27;sink.label-prefix&#x27; = &#x27;doris_label&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      //json write in</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &#x27;sink.properties.format&#x27; = &#x27;json&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &#x27;sink.properties.read_json_by_line&#x27; = &#x27;true&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you&#x27;ve got any questions, find Apache Doris developers on <a href="https://join.slack.com/t/apachedoriscommunity/shared_invite/zt-2kl08hzc0-SPJe4VWmL_qzrFd2u2XYQA" target="_blank" rel="noopener noreferrer">Slack</a>.</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><div class="text-center mb-4"><a class="text-[#8592A6] cursor-pointer hover:no-underline" href="/blog">Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class="s-tags"><span class="s-tag">Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:text-[2.5rem] text-center" itemprop="headline"><a itemprop="url" href="/blog/Is-Your-Latest-Data-Really-the-Latest-Check-the-Data-Update-Mechanism-of-Your-Database">Is your latest data really the latest? check the data update mechanism of your database</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class="authors"><span class="s-author text-black">Apache Doris</span></span><time datetime="2023-07-24T00:00:00.000Z" itemprop="datePublished" class="text-black ml-4">July 24, 2023</time></div></header><div class="markdown" itemprop="articleBody"><p>In databases, data update is to add, delete, or modify data. Timely data update is an important part of high quality data services.</p><p>Technically speaking, there are two types of data updates: you either update a whole row (<strong>Row Update</strong>) or just update part of the columns (<strong>Partial Column Update</strong>). Many databases supports both of them, but in different ways. This post is about one of them, which is simple in execution and efficient in data quality guarantee. </p><p>As an open source analytic database, Apache Doris supports both Row Update and Partial Column Update with one data model: the <a href="https://doris.apache.org/docs/dev/data-table/data-model#unique-model" target="_blank" rel="noopener noreferrer"><strong>Unique Key Model</strong></a>. It is where you put data that doesn&#x27;t need to be aggregated. In the Unique Key Model, you can specify one column or the combination of several columns as the Unique Key (a.k.a. Primary Key). For one Unique Key, there will always be one row of data: the newly ingested data record replaces the old. That&#x27;s how data updates work.</p><p>The idea is straightforward, but in real-life implementation, it happens that the latest data does not arrive the last or doesn&#x27;t even get written at all, so I&#x27;m going to show you how Apache Doris implements data update and avoids messups with its Unique Key Model. </p><p><img loading="lazy" alt="data-update" src="https://cdnd.selectdb.com/assets/images/Dataupdate_1-f213a24dcaaac700ff9f45906687c4a9.png" width="1280" height="705" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="row-update">Row Update<a href="#row-update" class="hash-link" aria-label="Direct link to Row Update" title="Direct link to Row Update">‚Äã</a></h2><p>For data writing to the Unique Key Model, Apache Doris adopts the <strong>Upsert</strong> semantics, which means <strong>Update or Insert</strong>. If the new data record includes a Unique Key that already exists in the table, the new record will replace the old record; if it includes a brand new Unique Key, the new record will be inserted into the table as a whole. The Upsert operation can provide high throughput and guarantee data reliability.</p><p><strong>Example</strong>:</p><p>In the following table, the Unique Key is the combination of three columns: <code>user_id, date, group_id</code>.</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; desc test_table;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+-------------+--------------+------+-------+---------+-------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| Field       | Type         | Null | Key   | Default | Extra |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+-------------+--------------+------+-------+---------+-------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| user_id     | BIGINT       | Yes  | true  | NULL    |       |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| date        | DATE         | Yes  | true  | NULL    |       |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| group_id    | BIGINT       | Yes  | true  | NULL    |       |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| modify_date | DATE         | Yes  | false | NULL    | NONE  |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| keyword     | VARCHAR(128) | Yes  | false | NULL    | NONE  |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+-------------+--------------+------+-------+---------+-------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Execute <code>insert into</code> to write in a data record. Since the table was empty, by the Upsert semantics, it means to add a new row to the table.</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; insert into test_table values (1, &quot;2023-04-28&quot;, 2, &quot;2023-04-28&quot;, &quot;foo&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Query OK, 1 row affected (0.05 sec)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{&#x27;label&#x27;:&#x27;insert_2fb45d1833db4348_b612b8791c97b467&#x27;, &#x27;status&#x27;:&#x27;VISIBLE&#x27;, &#x27;txnId&#x27;:&#x27;343&#x27;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; select * from test_table;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------+------------+----------+-------------+---------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| user_id | date       | group_id | modify_date | keyword |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------+------------+----------+-------------+---------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|       1 | 2023-04-28 |        2 | 2023-04-28  | foo     |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------+------------+----------+-------------+---------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then insert two more data records, one of which has the same Unique Key with the previously inserted row. Now, by the Upsert semantics, it means to replace the old row with the new one of the same Unique Key, and insert the record of the new Unique Key.</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; insert into test_table values (1, &quot;2023-04-28&quot;, 2, &quot;2023-04-29&quot;, &quot;foo&quot;), (2, &quot;2023-04-29&quot;, 2, &quot;2023-04-29&quot;, &quot;bar&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Query OK, 2 rows affected (0.04 sec)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{&#x27;label&#x27;:&#x27;insert_7dd3954468aa4ac1_a63a3852e3573b4c&#x27;, &#x27;status&#x27;:&#x27;VISIBLE&#x27;, &#x27;txnId&#x27;:&#x27;344&#x27;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; select * from test_table;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------+------------+----------+-------------+---------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| user_id | date       | group_id | modify_date | keyword |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------+------------+----------+-------------+---------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|       2 | 2023-04-29 |        2 | 2023-04-29  | bar     |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|       1 | 2023-04-28 |        2 | 2023-04-29  | foo     |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------+------------+----------+-------------+---------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="partial-column-update">Partial Column Update<a href="#partial-column-update" class="hash-link" aria-label="Direct link to Partial Column Update" title="Direct link to Partial Column Update">‚Äã</a></h2><p>Besides row update, under many circumstances, data analysts require the convenience of partial column update. For example, in user portraits, they would like to update certain dimensions of their users in real time. Or, if they need to maintain a flat table that is made of data from various source tables, they will prefer partial columm update than complicated join operations as a way of data update. </p><p>Apache Doris supports partial column update with the UPDATE statement. It filters the rows that need to be modified, read them, changes a few values, and write the rows back to the table. </p><p><strong>Example</strong>:</p><p>Suppose that there is an order table, in which the Order ID is the Unique Key.</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">+----------+--------------+-----------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| order_id | order_amount | order_status    |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+----------+--------------+-----------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| 1        |          100 | Payment Pending |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+----------+--------------+-----------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1 row in set (0.01 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When the buyer completes the payment, Apache Doris should change the order status of Order ID 1 from &quot;Payment Pending&quot; to &quot;Delivery Pending&quot;. This is when the Update command comes into play.</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; UPDATE test_order SET order_status = &#x27;Delivery Pending&#x27; WHERE order_id = 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Query OK, 1 row affected (0.11 sec)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{&#x27;label&#x27;:&#x27;update_20ae22daf0354fe0-b5aceeaaddc666c5&#x27;, &#x27;status&#x27;:&#x27;VISIBLE&#x27;, &#x27;txnId&#x27;:&#x27;33&#x27;, &#x27;queryId&#x27;:&#x27;20ae22daf0354fe0-b5aceeaaddc666c5&#x27;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is the table after updating.</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">+----------+--------------+------------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| order_id | order_amount | order_status     |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+----------+--------------+------------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| 1        |          100 | Delivery Pending |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+----------+--------------+------------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1 row in set (0.01 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The execution of the Update command consists of three steps in the system:</p><ul><li>Step One: Read the row where Order ID = 1 (1, 100, &#x27;Payment Pending&#x27;)</li><li>Step Two: Modify the order status from &quot;Payment Pending&quot; to &quot;Delivery Pending&quot; (1, 100, &#x27;Delivery Pending&#x27;)</li><li>Step Three: Insert the new row into the table</li></ul><p><img loading="lazy" alt="partial-column-update-1" src="https://cdnd.selectdb.com/assets/images/Dataupdate_2-9a653bfdd528301c5b147351f157da3a.png" width="1484" height="296" class="img_ev3q"></p><p>The table is in the Unique Key Model, which means for rows of the same Unique Key, only the last inserted one will be reserved, so this is what the table will finally look like:</p><p><img loading="lazy" alt="partial-column-update-2" src="https://cdnd.selectdb.com/assets/images/Dataupdate_3-0af75c350522fdc2c1074db4b2235711.png" width="1500" height="260" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="order-of-data-updates">Order of Data Updates<a href="#order-of-data-updates" class="hash-link" aria-label="Direct link to Order of Data Updates" title="Direct link to Order of Data Updates">‚Äã</a></h2><p>So far this sounds simple, but in the actual world, data update might fail due to reasons such as data format errors, and thus mess up the data writing order. The order of data update matters more than you imagine. For example, in financial transactions, messed-up data writing order might lead to transaction data losses, errors, or duplication, which further leads to bigger problems.</p><p>Apache Doris provides two options for users to guarantee that their data is updated in the correct order:</p><p><strong>1. Update by the order of transaction commit</strong> </p><p>In Apache Doris, each data ingestion task is a transaction. Each successfully ingested task will be given a data version and the number of data versions is strictly increasing. If the ingestion fails, the transaction will be rolled back, and no new data version will be generated.</p><p> By default, the Upsert semantics follows the order of the transaction commits. If there are two data ingestion tasks involving the same Unique Key, the first task generating data version 2 and the second, data version 3, then according to transaction commit order, data version 3 will replace data version 2.</p><p><strong>2. Update by the user-defined order</strong></p><p>In real-time data analytics, data updates often happen in high concurrency. It is possible that there are multiple data ingestion tasks updating the same row, but these tasks are committed in unknown order, so the last saved update remains unknown, too.</p><p>For example, these are two data updates, with &quot;2023-04-30&quot; and &quot;2023-05-01&quot; as the <code>modify_data</code>, respectively. If they are written into the system concurrently, but the &quot;2023-05-01&quot; one is successully committed first and the other later, then the &quot;2023-04-30&quot; record will be saved due to its higher data version number, but we know it is not the latest one.</p><div class="language-Plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; insert into test_table values (2, &quot;2023-04-29&quot;, 2, &quot;2023-05-01&quot;, &quot;bbb&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Query OK, 1 row affected (0.04 sec)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{&#x27;label&#x27;:&#x27;insert_e2daf8cea5524ee1_94e5c87e7bb74d67&#x27;, &#x27;status&#x27;:&#x27;VISIBLE&#x27;, &#x27;txnId&#x27;:&#x27;345&#x27;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; insert into test_table values (2, &quot;2023-04-29&quot;, 2, &quot;2023-04-30&quot;, &quot;aaa&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Query OK, 1 row affected (0.03 sec)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{&#x27;label&#x27;:&#x27;insert_ef906f685a7049d0_b135b6cfee49fb98&#x27;, &#x27;status&#x27;:&#x27;VISIBLE&#x27;, &#x27;txnId&#x27;:&#x27;346&#x27;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; select * from test_table;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------+------------+----------+-------------+---------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| user_id | date       | group_id | modify_date | keyword |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------+------------+----------+-------------+---------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|       2 | 2023-04-29 |        2 | 2023-04-30 | aaa     |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|       1 | 2023-04-28 |        2 | 2023-04-29  | foo     |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------+------------+----------+-------------+---------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>That&#x27;s why in high-concurrency scenarios, Apache Doris allows data update in user-defined order. Users can designate a column to the Sequence Column. In this way, the system will identity save the latest data version based on value in the Sequence Column.</p><p><strong>Example:</strong></p><p>You can designate a Sequence Column by specifying the <code>function_column.sequence_col</code> property upon table creation.</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE TABLE test.test_table</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    user_id bigint,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    date date,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    group_id bigint,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    modify_date date,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    keyword VARCHAR(128)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">UNIQUE KEY(user_id, date, group_id)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DISTRIBUTED BY HASH (user_id) BUCKETS 32</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;function_column.sequence_col&quot; = &#x27;modify_date&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;replication_num&quot; = &quot;1&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;in_memory&quot; = &quot;false&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then check and see, the data record with the highest value in the Sequence Column will be saved:</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; insert into test_table values (2, &quot;2023-04-29&quot;, 2, &quot;2023-05-01&quot;, &quot;bbb&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Query OK, 1 row affected (0.03 sec)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{&#x27;label&#x27;:&#x27;insert_3aac37ae95bc4b5d_b3839b49a4d1ad6f&#x27;, &#x27;status&#x27;:&#x27;VISIBLE&#x27;, &#x27;txnId&#x27;:&#x27;349&#x27;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; insert into test_table values (2, &quot;2023-04-29&quot;, 2, &quot;2023-04-30&quot;, &quot;aaa&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Query OK, 1 row affected (0.03 sec)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{&#x27;label&#x27;:&#x27;insert_419d4008768d45f3_a6912e584cf1b500&#x27;, &#x27;status&#x27;:&#x27;VISIBLE&#x27;, &#x27;txnId&#x27;:&#x27;350&#x27;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; select * from test_table;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------+------------+----------+-------------+---------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| user_id | date       | group_id | modify_date | keyword |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------+------------+----------+-------------+---------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|       2 | 2023-04-29 |        2 | 2023-05-01  | bbb     |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|       1 | 2023-04-28 |        2 | 2023-04-29  | foo     |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------+------------+----------+-------------+---------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">‚Äã</a></h2><p>Congratulations. Now you&#x27;ve gained an overview of how data updates are implemented in Apache Doris. With this knowledge, you can basically guarantee efficiency and accuracy of data updating. But wait, there is so much more about that. As Apache Doris 2.0 is going to provide more powerful Partial Column Update capabilities, with improved execution of the Update statement and the support for more complicated multi-table Join queries, I will show you how to take advantage of them in details in my follow-up writings. <a href="https://join.slack.com/t/apachedoriscommunity/shared_invite/zt-2kl08hzc0-SPJe4VWmL_qzrFd2u2XYQA" target="_blank" rel="noopener noreferrer">We</a> are constantly updating our data updates!</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><div class="text-center mb-4"><a class="text-[#8592A6] cursor-pointer hover:no-underline" href="/blog">Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class="s-tags"><span class="s-tag">Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:text-[2.5rem] text-center" itemprop="headline"><a itemprop="url" href="/blog/Tiered-Storage-for-Hot-and-Cold-Data-What-Why-and-How">Tiered storage for hot and cold data: what, why, and how?</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class="authors"><span class="s-author text-black">Apache Doris</span></span><time datetime="2023-06-23T00:00:00.000Z" itemprop="datePublished" class="text-black ml-4">June 23, 2023</time></div></header><div class="markdown" itemprop="articleBody"><p>Apparently tiered storage is hot now. But first of all:</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-hotcold-data">What is Hot/Cold Data?<a href="#what-is-hotcold-data" class="hash-link" aria-label="Direct link to What is Hot/Cold Data?" title="Direct link to What is Hot/Cold Data?">‚Äã</a></h2><p>In simple terms, hot data is the frequently accessed data, while cold data is the one you seldom visit but still need. Normally in data analytics, data is &quot;hot&quot; when it is new, and gets &quot;colder&quot; and &quot;colder&quot; as time goes by. </p><p>For example, orders of the past six months are &quot;hot&quot; and logs from years ago are &quot;cold&quot;. But no matter how cold the logs are, you still need them to be somewhere you can find.  </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-separate-hot-and-cold-data">Why Separate Hot and Cold Data?<a href="#why-separate-hot-and-cold-data" class="hash-link" aria-label="Direct link to Why Separate Hot and Cold Data?" title="Direct link to Why Separate Hot and Cold Data?">‚Äã</a></h2><p>Tiered storage is an idea often seen in real life: You put your favorite book on your bedside table, your Christmas ornament in the attic, and your childhood art project in the garage or a cheap self-storage space on the other side of town. The purpose is a tidy and efficient life.</p><p>Similarly, companies separate hot and cold data for more efficient computation and more cost-effective storage, because storage that allows quick read/write is always expensive, like SSD. On the other hand, HDD is cheaper but slower. So it is more sensible to put hot data on SSD and cold data on HDD. If you are looking for an even lower-cost option, you can go for object storage.</p><p>In data analytics, tiered storage is implemented by a tiered storage mechanism in the database. For example, Apache Doris supports three-tiered storage: SSD, HDD, and object storage. For newly ingested data, after a specified cooldown period, it will turn from hot data into cold data and be moved to object storage. In addition, object storage only preserves one copy of data, which further cuts down storage costs and the relevant computation/network overheads.</p><p><img loading="lazy" alt="tiered-storage" src="https://cdnd.selectdb.com/assets/images/HCDS_1-4bae127a675df686b358d72a242fc193.png" width="1528" height="722" class="img_ev3q"></p><p>How much can you save by tiered storage? Here is some math.</p><p>In public cloud services, cloud disks generally cost 5~10 times as much as object storage. If 80% of your data asset is cold data and you put it in object storage instead of cloud disks, you can expect a cost reduction of around 70%.</p><p>Let the percentage of cold data be &quot;rate&quot;, the price of object storage be &quot;OS&quot;, and the price of cloud disk be &quot;CloudDisk&quot;, this is how much you can save by tiered storage instead of putting all your data on cloud disks: </p><p><img loading="lazy" alt="cost-calculation-of-tiered-storage" src="https://cdnd.selectdb.com/assets/images/HCDS_2-c03620863295956acc180ad3a590bcf6.png" width="1532" height="226" class="img_ev3q"></p><p>Now let&#x27;s put real-world numbers in this formula: </p><p>AWS pricing, US East (Ohio):</p><ul><li><strong>S3 Standard Storage</strong>: 23 USD per TB per month</li><li><strong>Throughput Optimized HDD (st 1)</strong>: 102 USD per TB per month</li><li><strong>General Purpose SSD (gp2)</strong>: 158 USD per TB per month</li></ul><p><img loading="lazy" alt="cost-reduction-by-tiered-storage" src="https://cdnd.selectdb.com/assets/images/HCDS_3-631232bc5ad459445ffd5c51313a23d2.png" width="1280" height="590" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-is-tiered-storage-implemented">How Is Tiered Storage Implemented?<a href="#how-is-tiered-storage-implemented" class="hash-link" aria-label="Direct link to How Is Tiered Storage Implemented?" title="Direct link to How Is Tiered Storage Implemented?">‚Äã</a></h2><p>Till now, hot-cold separation sounds nice, but the biggest concern is: how can we implement it without compromising query performance? This can be broken down to three questions:</p><ul><li>How to enable quick reading of cold data?</li><li>How to ensure high availability of data?</li><li>How to reduce I/O and CPU overheads?</li></ul><p>In what follows, I will show you how Apache Doris addresses them one by one.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="quick-reading-of-cold-data">Quick Reading of Cold Data<a href="#quick-reading-of-cold-data" class="hash-link" aria-label="Direct link to Quick Reading of Cold Data" title="Direct link to Quick Reading of Cold Data">‚Äã</a></h3><p>Accessing cold data from object storage will indeed be slow. One solution is to cache cold data in local disks for use in queries. In Apache Doris 2.0, when a query requests cold data, only the first-time access will entail a full network I/O operation from object storage. Subsequent queries will be able to read data directly from local cache.</p><p>The granularity of caching matters, too. A coarse granularity might lead to a waste of cache space, but a fine granularity could be the reason for low I/O efficiency. Apache Doris bases its caching on data blocks. It downloads cold data blocks from object storage onto local Block Cache. This is the &quot;pre-heating&quot; process. With cold data fully pre-heated, queries on tables with tiered storage will be basically as fast as those on tablets without. We drew this conclusion from test results on Apache Doris:</p><p><img loading="lazy" alt="query-performance-with-tiered-storage" src="https://cdnd.selectdb.com/assets/images/HCDS_4-87151098d2bd6aa0e665ba9766dc8e19.png" width="1280" height="854" class="img_ev3q"></p><ul><li><strong>*Test Data**</strong>: SSB SF100 dataset*</li><li><strong>*Configuration**</strong>: 3 √ó 16C 64G, a cluster of 1 frontend and 3 backends* </li></ul><p>P.S. Block Cache adopts the LRU algorithm, so the more frequently accessed data will stay in Block Cache for longer.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="high-availability-of-data">High Availability of Data<a href="#high-availability-of-data" class="hash-link" aria-label="Direct link to High Availability of Data" title="Direct link to High Availability of Data">‚Äã</a></h3><p>In object storage, only one copy of cold data is preserved. Within Apache Doris, hot data and metadata are put in the backend nodes, and there are multiple replicas of them across different backend nodes in order to ensure high data availability. These replicas are called &quot;local replicas&quot;. The metadata of cold data is synchronized to all local replicas, so that Doris can ensure high availability of cold data without using too much storage space.</p><p>Implementation-wise, the Doris frontend picks a local replica as the Leader. Updates to the Leader will be synchronized to all other local replicas via a regular report mechanism. Also, as the Leader uploads data to object storage, the relevant metadata will be updated to other local replicas, too.</p><p><img loading="lazy" alt="data-availability-with-tiered-storage" src="https://cdnd.selectdb.com/assets/images/HCDS_5-91d506621f633b43cc8fdc41fb7c9aaa.png" width="1280" height="1041" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="reduced-io-and-cpu-overhead">Reduced I/O and CPU Overhead<a href="#reduced-io-and-cpu-overhead" class="hash-link" aria-label="Direct link to Reduced I/O and CPU Overhead" title="Direct link to Reduced I/O and CPU Overhead">‚Äã</a></h3><p>This is realized by cold data <a href="https://medium.com/gitconnected/understanding-data-compaction-in-3-minutes-d2b5a1f7446f" target="_blank" rel="noopener noreferrer">compaction</a>. Some scenarios require large-scale update of historical data. In this case, part of the cold data in object storage should be deleted. Apache Doris 2.0 supports cold data compaction, which ensures that the updated cold data will be reorganized and compacted, so that it will take up storage space.</p><p>A thread in Doris backend will regularly pick N tablets from the cold data and start compaction. Every tablet has a CooldownReplica and only the CooldownReplica will execute cold data compaction for the tablet. Every time 5MB of data is compacted, it will be uploaded to object storage to clear up space locally. Once the compaction is done, the CooldownReplica will update the new metadata to object storage. Other replicas only need to synchronize the metadata from object storage. This is how I/O and CPU overheads are reduced.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tutorial">Tutorial<a href="#tutorial" class="hash-link" aria-label="Direct link to Tutorial" title="Direct link to Tutorial">‚Äã</a></h2><p>Separating tiered storage in storage is a huge cost saver and there have been ways to ensure the same fast query performance. Executing hot-cold data separation is a simple 6-step process, so you can find out how it works yourself:</p><p>To begin with, you need <strong>an object storage bucket</strong> and the relevant <strong>Access Key (AK)</strong> and <strong>Secret Access Key (SK)</strong>.</p><p>Then you can start cold/hot data separation by following these six steps.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-create-resource">1. Create Resource<a href="#1-create-resource" class="hash-link" aria-label="Direct link to 1. Create Resource" title="Direct link to 1. Create Resource">‚Äã</a></h3><p>You can create a resource using the object storage bucket with the AK and  SK. Apache Doris supports object storage on various cloud service  providers including AWS, Azure, and Alibaba Cloud.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE RESOURCE IF NOT EXISTS &quot;${resource_name}&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        PROPERTIES(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;type&quot;=&quot;s3&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;s3.endpoint&quot; = &quot;${S3Endpoint}&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;s3.region&quot; = &quot;${S3Region}&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;s3.root.path&quot; = &quot;path/to/root&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;s3.access_key&quot; = &quot;${S3AK}&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;s3.secret_key&quot; = &quot;${S3SK}&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;s3.connection.maximum&quot; = &quot;50&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;s3.connection.request.timeout&quot; = &quot;3000&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;s3.connection.timeout&quot; = &quot;1000&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;s3.bucket&quot; = &quot;${S3BucketName}&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        );</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-create-storage-policy">2. Create Storage Policy<a href="#2-create-storage-policy" class="hash-link" aria-label="Direct link to 2. Create Storage Policy" title="Direct link to 2. Create Storage Policy">‚Äã</a></h3><p>With the Storage Policy, you can specify the cooling-down period of data  (including absolute cooling-down period and relative cooling-down  period).</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE STORAGE POLICY testPolicy</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;storage_resource&quot; = &quot;remote_s3&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;cooldown_ttl&quot; = &quot;1d&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the above snippet, the Storage Policy is named <code>testPolicy</code>, and data will start to cool down one day after it is ingested. The cold data will be moved under the <code>root path</code> of the object storage <code>remote_s3</code>. Apart from setting the TTL, you can also specify the timepoint when the cooling down starts.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE STORAGE POLICY testPolicyForTTlDatatime</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;storage_resource&quot; = &quot;remote_s3&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;cooldown_datetime&quot; = &quot;2023-06-07 21:00:00&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-specify-storage-policy-for-a-tablepartition">3. Specify Storage Policy for a Table/Partition<a href="#3-specify-storage-policy-for-a-tablepartition" class="hash-link" aria-label="Direct link to 3. Specify Storage Policy for a Table/Partition" title="Direct link to 3. Specify Storage Policy for a Table/Partition">‚Äã</a></h3><p>With an established Resource and a Storage Policy, you can set a Storage Policy for a data table or a specific data partition.</p><p>The following snippet uses the lineitem table in the TPC-H dataset as an  example. To set a Storage Policy for the whole table, specify the  PROPERTIES as follows:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE TABLE IF NOT EXISTS lineitem1 (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_ORDERKEY    INTEGER NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_PARTKEY     INTEGER NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_SUPPKEY     INTEGER NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_LINENUMBER  INTEGER NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_QUANTITY    DECIMAL(15,2) NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_EXTENDEDPRICE  DECIMAL(15,2) NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_DISCOUNT    DECIMAL(15,2) NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_TAX         DECIMAL(15,2) NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_RETURNFLAG  CHAR(1) NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_LINESTATUS  CHAR(1) NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_SHIPDATE    DATEV2 NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_COMMITDATE  DATEV2 NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_RECEIPTDATE DATEV2 NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_SHIPINSTRUCT CHAR(25) NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_SHIPMODE     CHAR(10) NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_COMMENT      VARCHAR(44) NOT NULL</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            DUPLICATE KEY(L_ORDERKEY, L_PARTKEY, L_SUPPKEY, L_LINENUMBER)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            PARTITION BY RANGE(`L_SHIPDATE`)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                PARTITION `p202301` VALUES LESS THAN (&quot;2017-02-01&quot;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                PARTITION `p202302` VALUES LESS THAN (&quot;2017-03-01&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            DISTRIBUTED BY HASH(L_ORDERKEY) BUCKETS 3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            PROPERTIES (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;replication_num&quot; = &quot;3&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;storage_policy&quot; = &quot;${policy_name}&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can check the Storage Policy of a tablet via the <code>show tablets</code> command. If the <code>CooldownReplicaId</code> is anything rather than <code>-1</code> and the <code>CooldownMetaId</code> is not null, that means the current tablet has been specified with a Storage Policy.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">               TabletId: 3674797</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              ReplicaId: 3674799</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              BackendId: 10162</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             SchemaHash: 513232100</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                Version: 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      LstSuccessVersion: 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       LstFailedVersion: -1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          LstFailedTime: NULL</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          LocalDataSize: 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         RemoteDataSize: 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">               RowCount: 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  State: NORMAL</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">LstConsistencyCheckTime: NULL</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           CheckVersion: -1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           VersionCount: 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              QueryHits: 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">               PathHash: 8030511811695924097</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                MetaUrl: http://172.16.0.16:6781/api/meta/header/3674797</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       CompactionStatus: http://172.16.0.16:6781/api/compaction/show?tablet_id=3674797</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      CooldownReplicaId: 3674799</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         CooldownMetaId: TUniqueId(hi:-8987737979209762207, lo:-2847426088899160152)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To set a Storage Policy for a specific partition, add the policy name to the partition PROPERTIES as follows:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE TABLE IF NOT EXISTS lineitem1 (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_ORDERKEY    INTEGER NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_PARTKEY     INTEGER NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_SUPPKEY     INTEGER NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_LINENUMBER  INTEGER NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_QUANTITY    DECIMAL(15,2) NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_EXTENDEDPRICE  DECIMAL(15,2) NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_DISCOUNT    DECIMAL(15,2) NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_TAX         DECIMAL(15,2) NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_RETURNFLAG  CHAR(1) NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_LINESTATUS  CHAR(1) NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_SHIPDATE    DATEV2 NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_COMMITDATE  DATEV2 NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_RECEIPTDATE DATEV2 NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_SHIPINSTRUCT CHAR(25) NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_SHIPMODE     CHAR(10) NOT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            L_COMMENT      VARCHAR(44) NOT NULL</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            DUPLICATE KEY(L_ORDERKEY, L_PARTKEY, L_SUPPKEY, L_LINENUMBER)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            PARTITION BY RANGE(`L_SHIPDATE`)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                PARTITION `p202301` VALUES LESS THAN (&quot;2017-02-01&quot;) (&quot;storage_policy&quot; = &quot;${policy_name}&quot;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                PARTITION `p202302` VALUES LESS THAN (&quot;2017-03-01&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            DISTRIBUTED BY HASH(L_ORDERKEY) BUCKETS 3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            PROPERTIES (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;replication_num&quot; = &quot;3&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>This is how you can confirm that only the target partition is set with a Storage Policy:</strong></p><p>In the above example, Table Lineitem1 has 2 partitions, each partition has 3 buckets, and <code>replication_num</code> is set to &quot;3&quot;. That means there are 2<em>3 = 6 tablets and 6</em>3 = 18 replicas in total.</p><p>Now, if you check the replica information of all tablets via the <code>show tablets</code> command, you will see that only the replicas of tablets of the target  partion have a CooldownReplicaId and a CooldownMetaId. (For a clear  comparison, you can check replica information of a specific partition  via the <code>ADMIN SHOW REPLICA STATUS FROM TABLE PARTITION(PARTITION)</code> command.)</p><p>For instance, Tablet 3691990 belongs to Partition p202301, which is the  target partition, so the 3 replicas of this tablet have a  CooldownReplicaId and a CooldownMetaId:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">*****************************************************************</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">               TabletId: 3691990</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              ReplicaId: 3691991</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      CooldownReplicaId: 3691993</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         CooldownMetaId: TUniqueId(hi:-7401335798601697108, lo:3253711199097733258)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">*****************************************************************</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">               TabletId: 3691990</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              ReplicaId: 3691992</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      CooldownReplicaId: 3691993</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         CooldownMetaId: TUniqueId(hi:-7401335798601697108, lo:3253711199097733258)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">*****************************************************************</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">               TabletId: 3691990</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              ReplicaId: 3691993</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      CooldownReplicaId: 3691993</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         CooldownMetaId: TUniqueId(hi:-7401335798601697108, lo:3253711199097733258)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Also, the above snippet means that all these 3 replicas have been specified  with the same CooldownReplica: 3691993, so only the data in Replica  3691993 will be stored in the Resource.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-view-tablet-details">4. View Tablet Details<a href="#4-view-tablet-details" class="hash-link" aria-label="Direct link to 4. View Tablet Details" title="Direct link to 4. View Tablet Details">‚Äã</a></h3><p>You can view the detailed information of Table Lineitem1 via a <code>show tablets from lineitem1</code> command. Among all the properties, <code>LocalDataSize</code> represents the size of locally stored data and <code>RemoteDataSize</code> represents the size of cold data in object storage.</p><p>For example, when the data is newly ingested into the Doris backends, you can see that all data is stored locally.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">*************************** 1. row ***************************</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">               TabletId: 2749703</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              ReplicaId: 2749704</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              BackendId: 10090</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             SchemaHash: 1159194262</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                Version: 3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      LstSuccessVersion: 3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       LstFailedVersion: -1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          LstFailedTime: NULL</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          LocalDataSize: 73001235</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         RemoteDataSize: 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">               RowCount: 1996567</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  State: NORMAL</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">LstConsistencyCheckTime: NULL</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           CheckVersion: -1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           VersionCount: 3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              QueryHits: 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">               PathHash: -8567514893400420464</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                MetaUrl: http://172.16.0.8:6781/api/meta/header/2749703</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       CompactionStatus: http://172.16.0.8:6781/api/compaction/show?tablet_id=2749703</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      CooldownReplicaId: 2749704</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         CooldownMetaId:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When the data has cooled down, you will see that the data has been moved to remote object storage.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">*************************** 1. row ***************************</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">               TabletId: 2749703</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              ReplicaId: 2749704</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              BackendId: 10090</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             SchemaHash: 1159194262</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                Version: 3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      LstSuccessVersion: 3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       LstFailedVersion: -1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          LstFailedTime: NULL</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          LocalDataSize: 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         RemoteDataSize: 73001235</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">               RowCount: 1996567</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  State: NORMAL</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">LstConsistencyCheckTime: NULL</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           CheckVersion: -1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           VersionCount: 3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              QueryHits: 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">               PathHash: -8567514893400420464</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                MetaUrl: http://172.16.0.8:6781/api/meta/header/2749703</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       CompactionStatus: http://172.16.0.8:6781/api/compaction/show?tablet_id=2749703</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      CooldownReplicaId: 2749704</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         CooldownMetaId: TUniqueId(hi:-8697097432131255833, lo:9213158865768502666)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can also check your cold data from the object storage side by finding  the data files under the path specified in the Storage Policy.</p><p>Data in object storage only has a single copy.</p><p><img loading="lazy" src="https://miro.medium.com/v2/resize:fit:1400/1*jao2TrbhDI2h6S04W0x95Q.png" alt="img" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-execute-queries">5. Execute Queries<a href="#5-execute-queries" class="hash-link" aria-label="Direct link to 5. Execute Queries" title="Direct link to 5. Execute Queries">‚Äã</a></h3><p>When all data in Table Lineitem1 has been moved to object storage and a  query requests data from Table Lineitem1, Apache Doris will follow the  root path specified in the Storage Policy of the relevant data  partition, and download the requested data for local computation.</p><p>Apache Doris 2.0 has been optimized for cold data queries. Only the first-time access to the cold data will entail a full network I/O operation from  object storage. After that, the downloaded data will be put in cache to  be available for subsequent queries, so as to improve query speed.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-update-cold-data">6. Update Cold Data<a href="#6-update-cold-data" class="hash-link" aria-label="Direct link to 6. Update Cold Data" title="Direct link to 6. Update Cold Data">‚Äã</a></h3><p>In Apache Doris, each data ingestion leads to the generation of a new  Rowset, so the update of historical data will be put in a Rowset that is separated from those of newly loaded data. That‚Äôs how it makes sure the updating of cold data does not interfere with the ingestion of hot  data. Once the rowsets cool down, they will be moved to S3 and deleted  locally, and the updated historical data will go to the partition where  it belongs.</p><p>If you any questions, come find Apache Doris developers on <a href="https://join.slack.com/t/apachedoriscommunity/shared_invite/zt-2kl08hzc0-SPJe4VWmL_qzrFd2u2XYQA" target="_blank" rel="noopener noreferrer">Slack</a>. We will be happy to provide targeted support.</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><div class="text-center mb-4"><a class="text-[#8592A6] cursor-pointer hover:no-underline" href="/blog">Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class="s-tags"><span class="s-tag">Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:text-[2.5rem] text-center" itemprop="headline"><a itemprop="url" href="/blog/Say-Goodbye-to-OOM-Crashes">Say goodbye to OOM crashes</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class="authors"><span class="s-author text-black">Apache Doris</span></span><time datetime="2023-06-16T00:00:00.000Z" itemprop="datePublished" class="text-black ml-4">June 16, 2023</time></div></header><div class="markdown" itemprop="articleBody"><p>What guarantees system stability in large data query tasks? It is an effective memory allocation and monitoring mechanism. It is how you speed up computation, avoid memory hotspots, promptly respond to insufficient memory, and minimize OOM errors. </p><p><img loading="lazy" alt="memory-allocator" src="https://cdnd.selectdb.com/assets/images/OOM_1-cbcc6d864b892831d6e8e3acf37a356f.png" width="1226" height="214" class="img_ev3q"></p><p>From a database user&#x27;s perspective, how do they suffer from bad memory management? This is a list of things that used to bother our users:</p><ul><li>OOM errors cause backend processes to crash. To quote one of our community members: Hi, Apache Doris, it&#x27;s okay to slow things down or fail a few tasks when you are short of memory, but throwing a downtime is just not cool.</li><li>Backend processes consume too much memory space, but there is no way to find the exact task to blame or limit the memory usage for a single query.</li><li>It is hard to set a proper memory size for each query, so chances are that a query gets canceled even when there is plenty of memory space.</li><li>High-concurrency queries are disproportionately slow, and memory hotspots are hard to locate.</li><li>Intermediate data during HashTable creation cannot be flushed to disks, so join queries between two large tables often fail due to OOM. </li></ul><p>Luckily, those dark days are behind us, because we have improved our memory management mechanism from the bottom up. Now get ready, things are going to be intensive.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="memory-allocation">Memory Allocation<a href="#memory-allocation" class="hash-link" aria-label="Direct link to Memory Allocation" title="Direct link to Memory Allocation">‚Äã</a></h2><p>In Apache Doris, we have a one-and-only interface for memory allocation: <strong>Allocator</strong>. It will make adjustments as it sees appropriate to keep memory usage efficient and under control. Also, MemTrackers are in place to track the allocated or released memory size, and three different data structures are responsible for large memory allocation in operator execution (we will get to them immediately).   </p><p><img loading="lazy" alt="memory-tracker" src="https://cdnd.selectdb.com/assets/images/OOM_2-2804f7f38fc4bfec4b20bb6f1ce2416e.png" width="1228" height="568" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-structures-in-memory">Data Structures in Memory<a href="#data-structures-in-memory" class="hash-link" aria-label="Direct link to Data Structures in Memory" title="Direct link to Data Structures in Memory">‚Äã</a></h3><p>As different queries have different memory hotspot patterns in execution, Apache Doris provides three different in-memory data structures: <strong>Arena</strong>, <strong>HashTable</strong>, and <strong>PODArray</strong>. They are all under the reign of the Allocator.</p><p><img loading="lazy" alt="data-structures" src="https://cdnd.selectdb.com/assets/images/OOM_3-9450598001ffa0bb838abad7bc62efb6.png" width="1222" height="758" class="img_ev3q"></p><p><strong>1. Arena</strong></p><p>The Arena is a memory pool that maintains a list of chunks, which are to be allocated upon request from the Allocator. The chunks support memory alignment. They exist throughout the lifespan of the Arena, and will be freed up upon destruction (usually when the query is completed). Chunks are mainly used to store the serialized or deserialized data during Shuffle, or the serialized Keys in HashTables.</p><p>The initial size of a chunk is 4096 bytes. If the current chunk is smaller than the requested memory, a new chunk will be added to the list. If the current chunk is smaller than 128M, the new chunk will double its size; if it is larger than 128M, the new chunk will, at most, be 128M larger than what is required. The old small chunk will not be allocated for new requests. There is a cursor to mark the dividing line of chunks allocated and those unallocated.</p><p><strong>2. HashTable</strong></p><p>HashTables are applicable for Hash Joins, aggregations, set operations, and window functions. The PartitionedHashTable structure supports no more than 16 sub-HashTables. It also supports the parallel merging of HashTables and each sub-Hash Join can be scaled independently. These can reduce overall memory usage and the latency caused by scaling.</p><p>If the current HashTable is smaller than 8M, it will be scaled by a factor of 4; </p><p>If it is larger than 8M, it will be scaled by a factor of 2; </p><p>If it is smaller than 2G, it will be scaled when it is 50% full;</p><p>And if it is larger than 2G, it will be scaled when it is 75% full. </p><p>The newly created HashTables will be pre-scaled based on how much data it is going to have. We also provide different types of HashTables for different scenarios. For example, for aggregations, you can apply PHmap.</p><p><strong>3. PODArray</strong></p><p>PODArray, as the name suggests, is a dynamic array of POD. The difference between it and <code>std::vector</code> is that PODArray does not initialize elements. It supports memory alignment and some interfaces of <code>std::vector</code>. It is scaled by a factor of 2. In destruction, instead of calling the destructor function for each element, it releases memory of the whole PODArray. PODArray is mainly used to save strings in columns and is applicable in many function computation and expression filtering.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="memory-interface">Memory Interface<a href="#memory-interface" class="hash-link" aria-label="Direct link to Memory Interface" title="Direct link to Memory Interface">‚Äã</a></h3><p>As the only interface that coordinates Arena, PODArray, and HashTable, the Allocator executes memory mapping (MMAP) allocation for requests larger than 64M. Those smaller than 4K will be directly allocated from the system via malloc/free; and those in between will be accelerated by a general-purpose caching ChunkAllocator, which brings a 10% performance increase according to our benchmarking results. The ChunkAllocator will try and retrieve a chunk of the specified size from the FreeList of the current core in a lock-free manner; if such a chunk doesn&#x27;t exist, it will try from other cores in a lock-based manner; if that still fails, it will request the specified memory size from the system and encapsulate it into a chunk.</p><p>We chose Jemalloc over TCMalloc after experience with both of them. We tried TCMalloc in our high-concurrency tests and noticed that Spin Lock in CentralFreeList took up 40% of the total query time. Disabling &quot;aggressive memory decommit&quot; made things better, but that brought much more memory usage, so we had to use an individual thread to regularly recycle cache. Jemalloc, on the other hand, was more performant and stable in high-concurrency queries. After fine-tuning for other scenarios, it delivered the same performance as TCMalloc but consumed less memory.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="memory-reuse">Memory Reuse<a href="#memory-reuse" class="hash-link" aria-label="Direct link to Memory Reuse" title="Direct link to Memory Reuse">‚Äã</a></h3><p>Memory reuse is widely executed on the execution layer of Apache Doris. For example, data blocks will be reused throughout the execution of a query. During Shuffle, there will be two blocks at the Sender end and they work alternately, one receiving data and the other in RPC transport. When reading a tablet, Doris will reuse the predicate column, implement cyclic reading, filter, copy filtered data to the upper block, and then clear. When ingesting data into an Aggregate Key table, once the MemTable that caches data reaches a certain size, it will be pre-aggregated and then more data will be written in. </p><p>Memory reuse is executed in data scanning, too. Before the scanning starts, a number of free blocks (depending on the number of scanners and threads) will be allocated to the scanning task. During each scanner scheduling, one of the free blocks will be passed to the storage layer for data reading. After data reading, the block will be put into the producer queue for consumption of the upper operators in subsequent computation. Once an upper operator has copied the computation data from the block, the block will go back in the free blocks for next scanner scheduling. The thread the preallocates the free blocks will also be responsible for freeing them up after data scanning, so there won&#x27;t be extra overheads. The number of free blocks somehow determines the concurrency of data scanning.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="memory-tracking">Memory Tracking<a href="#memory-tracking" class="hash-link" aria-label="Direct link to Memory Tracking" title="Direct link to Memory Tracking">‚Äã</a></h2><p> Apache Doris uses MemTrackers to follow up on the allocation and releasing of memory while analyzing memory hotspots. The MemTrackers keep records of each data query, data ingestion, data compaction task, and the memory size of each global object, such as Cache and TabletMeta. It supports both manual counting and MemHook auto-tracking. Users can view the real-time memory usage in Doris backend on a Web page. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="structure-of-memtrackers">Structure of MemTrackers<a href="#structure-of-memtrackers" class="hash-link" aria-label="Direct link to Structure of MemTrackers" title="Direct link to Structure of MemTrackers">‚Äã</a></h3><p>The MemTracker system before Apache Doris 1.2.0 was in a hierarchical tree structure, consisting of process_mem_tracker, query_pool_mem_tracker, query_mem_tracker, instance_mem_tracker, ExecNode_mem_tracker and so on. MemTrackers of two neighbouring layers are of parent-child relationship. Hence, any calculation mistakes in a child MemTracker will be accumulated all the way up and result in a larger scale of incredibility. </p><p><img loading="lazy" alt="MemTrackers" src="https://cdnd.selectdb.com/assets/images/OOM_4-90b44adf02bc4653708948cf5e65d50e.png" width="1280" height="419" class="img_ev3q"></p><p>In Apache Doris 1.2.0 and newer, we made the structure of MemTrackers much simpler. MemTrackers are only divided into two types based on their roles: <strong>MemTracker Limiter</strong> and the others. MemTracker Limiter, monitoring memory usage, is unique in every query/ingestion/compaction task and global object; while the other MemTrackers traces the memory hotspots in query execution, such as HashTables in Join/Aggregation/Sort/Window functions and intermediate data in serialization, to give a picture of how memory is used in different operators or provide reference for memory control in data flushing.</p><p>The parent-child relationship between MemTracker Limiter and other MemTrackers is only manifested in snapshot printing. You can think of such a relationship as a symbolic link. They are not consumed at the same time, and the lifecycle of one does not affect that of the other. This makes it much easier for developers to understand and use them. </p><p>MemTrackers (including MemTracker Limiter and the others) are put into a group of Maps. They allow users to print overall MemTracker type snapshot, Query/Load/Compaction task snapshot, and find out the Query/Load with the most memory usage or the most memory overusage. </p><p><img loading="lazy" alt="Structure-of-MemTrackers" src="https://cdnd.selectdb.com/assets/images/OOM_5-beba9f4c16d66d0df644f9e69a3b7db3.png" width="1280" height="1063" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-memtracker-works">How MemTracker Works<a href="#how-memtracker-works" class="hash-link" aria-label="Direct link to How MemTracker Works" title="Direct link to How MemTracker Works">‚Äã</a></h3><p>To calculate memory usage of a certain execution, a MemTracker is added to a stack in Thread Local of the current thread. By reloading the malloc/free/realloc in Jemalloc or TCMalloc, MemHook obtains the actual size of the memory allocated or released, and records it in Thread Local of the current thread. When an execution is done, the relevant MemTracker will be removed from the stack. At the bottom of the stack is the MemTracker that records memory usage during the whole query/load execution process.</p><p>Now let me explain with a simplified query execution process.</p><ul><li>After a Doris backend node starts, the memory usage of all threads will be recorded in the Process MemTracker.</li><li>When a query is submitted, a <strong>Query MemTracker</strong> will be added to the Thread Local Storage(TLS) Stack in the fragment execution thread.</li><li>Once a ScanNode is scheduled, a <strong>ScanNode MemTracker</strong> will be added to Thread Local Storage(TLS) Stack in the fragment execution thread. Then, any memory allocated or released in this thread will be recorded into both the Query MemTracker and the ScanNode MemTracker.</li><li>After a Scanner is scheduled, a Query MemTracker and a <strong>Scanner MemTracker</strong> will be added to the TLS Stack of the Scanner thread.</li><li>When the scanning is done, all MemTrackers in the Scanner Thread TLS Stack will be removed. When the ScanNode scheduling is done, the ScanNode MemTracker will be removed from the fragment execution thread. Then, similarly, when an aggregation node is scheduled, an <strong>AggregationNode MemTracker</strong> will be added to the fragment execution thread TLS Stack, and get removed after the scheduling is done.</li><li>If the query is completed, the Query MemTracker will be removed from the fragment execution thread TLS Stack. At this point, this stack should be empty. Then, from the QueryProfile, you can view the peak memory usage during the whole query execution as well as each phase (scanning, aggregation, etc.).</li></ul><p><img loading="lazy" alt="How-MemTrackers-Works" src="https://cdnd.selectdb.com/assets/images/OOM_6-cf0ef627ae1b9d5448b54ab92f9c3180.png" width="1280" height="424" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-use-memtracker">How to Use MemTracker<a href="#how-to-use-memtracker" class="hash-link" aria-label="Direct link to How to Use MemTracker" title="Direct link to How to Use MemTracker">‚Äã</a></h3><p>The Doris backend Web page demonstrates real-time memory usage, which is divided into types: Query/Load/Compaction/Global. Current memory consumption and peak consumption are shown. </p><p><img loading="lazy" alt="How-to-use-MemTrackers" src="https://cdnd.selectdb.com/assets/images/OOM_7-4fef601c6c9f9a5fcc53b785485057d3.png" width="1280" height="562" class="img_ev3q"></p><p>The Global types include MemTrackers of Cache and TabletMeta.</p><p><img loading="lazy" alt="memory-usage-by-subsystem-1" src="https://cdnd.selectdb.com/assets/images/OOM_8-a007e2d4fa06263628f5d603471a3f79.png" width="1280" height="489" class="img_ev3q"></p><p>From the Query types, you can see the current memory consumption and peak consumption of the current query and the operators it involves (you can tell how they are related from the labels). For memory statistics of historical queries, you can check the Doris FE audit logs or BE INFO logs.</p><p><img loading="lazy" alt="memory-usage-by-subsystem-2" src="https://cdnd.selectdb.com/assets/images/OOM_9-32f7ad3c6b10088f0735cfd1ff0e1e39.png" width="1280" height="762" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="memory-limit">Memory Limit<a href="#memory-limit" class="hash-link" aria-label="Direct link to Memory Limit" title="Direct link to Memory Limit">‚Äã</a></h2><p>With widely implemented memory tracking in Doris backends, we are one step closer to eliminating OOM, the cause of backend downtime and large-scale query failures. The next step is to optimize the memory limit on queries and processes to keep memory usage under control.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="memory-limit-on-query">Memory Limit on Query<a href="#memory-limit-on-query" class="hash-link" aria-label="Direct link to Memory Limit on Query" title="Direct link to Memory Limit on Query">‚Äã</a></h3><p>Users can put a memory limit on every query. If that limit is exceeded during execution, the query will be canceled. But since version 1.2, we have allowed Memory Overcommit, which is a more flexible memory limit control. If there are sufficient memory resources, a query can consume more memory than the limit without being canceled, so users don&#x27;t have to pay extra attention to memory usage; if there are not, the query will wait until new memory space is allocated; only when the newly freed up memory is not enough for the query will the query be canceled.</p><p>While in Apache Doris 2.0, we have realized exception safety for queries. That means any insufficient memory allocation will immediately cause the query to be canceled, which saves the trouble of checking &quot;Cancel&quot; status in subsequent steps.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="memory-limit-on-process">Memory Limit on Process<a href="#memory-limit-on-process" class="hash-link" aria-label="Direct link to Memory Limit on Process" title="Direct link to Memory Limit on Process">‚Äã</a></h3><p>On a regular basis, Doris backend retrieves the physical memory of processes and the currently available memory size from the system. Meanwhile, it collects MemTracker snapshots of all Query/Load/Compaction tasks. If a backend process exceeds its memory limit or there is insufficient memory, Doris will free up some memory space by clearing Cache and cancelling a number of queries or data ingestion tasks. These will be executed by an individual GC thread regularly.</p><p><img loading="lazy" alt="memory-limit-on-process" src="https://cdnd.selectdb.com/assets/images/OOM_10-4926bcb7439768952d6d973697de2468.png" width="1280" height="610" class="img_ev3q"></p><p>If the process memory consumed is over the SoftMemLimit (81% of total system memory, by default), or the available system memory drops below the Warning Water Mark (less than 3.2GB), <strong>Minor GC</strong> will be triggered. At this moment, query execution will be paused at the memory allocation step, the cached data in data ingestion tasks will be force flushed, and part of the Data Page Cache and the outdated Segment Cache will be released. If the newly released memory does not cover 10% of the process memory, with Memory Overcommit enabled, Doris will start cancelling the queries which are the biggest &quot;overcommitters&quot; until the 10% target is met or all queries are canceled. Then, Doris will shorten the system memory checking interval and the GC interval. The queries will be continued after more memory is available.</p><p>If the process memory consumed is beyond the MemLimit (90% of total system memory, by default), or the available system memory drops below the Low Water Mark (less than 1.6GB), <strong>Full GC</strong> will be triggered. At this time, data ingestion tasks will be stopped, and all Data Page Cache and most other Cache will be released. If, after all these steps, the newly released memory does not cover 20% of the process memory, Doris will look into all MemTrackers and find the most memory-consuming queries and ingestion tasks, and cancel them one by one. Only after the 20% target is met will the system memory checking interval and the GC interval be extended, and the queries and ingestion tasks be continued. (One garbage collection operation usually takes hundreds of Œºs to dozens of ms.)</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="influences-and-outcomes">Influences and Outcomes<a href="#influences-and-outcomes" class="hash-link" aria-label="Direct link to Influences and Outcomes" title="Direct link to Influences and Outcomes">‚Äã</a></h2><p>After optimizations in memory allocation, memory tracking, and memory limit, we have substantially increased the stability and high-concurrency performance of Apache Doris as a real-time analytic data warehouse platform. OOM crash in the backend is a rare scene now. Even if there is an OOM, users can locate the problem root based on the logs and then fix it. In addition, with more flexible memory limits on queries and data ingestion, users don&#x27;t have to spend extra effort taking care of memory when memory space is adequate. </p><p>In the next phase, we plan to ensure completion of queries in memory overcommitment, which means less queries will have to be canceled due to memory shortage. We have broken this objective into specific directions of work: exception safety, memory isolation between resource groups, and the flushing mechanism of intermediate data. If you want to meet our developers, <a href="https://join.slack.com/t/apachedoriscommunity/shared_invite/zt-2kl08hzc0-SPJe4VWmL_qzrFd2u2XYQA" target="_blank" rel="noopener noreferrer">this is where you find us</a>.</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><div class="text-center mb-4"><a class="text-[#8592A6] cursor-pointer hover:no-underline" href="/blog">Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class="s-tags"><span class="s-tag">Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:text-[2.5rem] text-center" itemprop="headline"><a itemprop="url" href="/blog/Understanding-Data-Compaction-in-3-Minutes">Understanding data compaction in 3 minutes</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class="authors"><span class="s-author text-black">Apache Doris</span></span><time datetime="2023-06-09T00:00:00.000Z" itemprop="datePublished" class="text-black ml-4">June 9, 2023</time></div></header><div class="markdown" itemprop="articleBody"><p>What is compaction in database? Think of your disks as a warehouse: The compaction mechanism is like a team of storekeepers (with genius organizing skills like Marie Kondo) who help put away the incoming data. </p><p>In particular, the data (which is the inflowing cargo in this metaphor) comes in on a &quot;conveyor belt&quot;, which does not allow cutting in line. This is how the <strong>LSM-Tree</strong> (Log Structured-Merge Tree) works: In data storage, data is written into <strong>MemTables</strong> in an append-only manner, and then the MemTables are flushed to disks to form files. (These files go by different names in different databases. In my community, we call them <strong>Rowsets</strong>). Just like putting small boxes of cargo into a large container, compaction means merging multiple small rowset files into a big one, but it does much more than that. Like I said, the compaction mechanism is an organizing magician: </p><ul><li>Although the items (data) in each box (rowset) are orderly arranged, the boxes themselves are not. Hence, one thing that the &quot;storekeepers&quot; do is to sort the boxes (rowsets) in a certain order so they can be quickly found once needed (quickening data reading).</li><li>If an item needs to be discarded or replaced, since no line-jump is allowed on the conveyor belt (append-only), you can only put a &quot;note&quot; (together with the substitution item) at the end of the queue on the belt to remind the &quot;storekeepers&quot;, who will later perform replacing or discarding for you.</li><li>If needed, the &quot;storekeepers&quot; are even kind enough to pre-process the cargo for you (pre-aggregating data to reduce computation burden during data reading). </li></ul><p><img loading="lazy" alt="MemTable-rowset" src="https://cdnd.selectdb.com/assets/images/Compaction_1-ee87990e8968b1976f60ae8c76c1f224.png" width="1279" height="670" class="img_ev3q"></p><p>As helpful as the &quot;storekeepers&quot; are, they can be troublemakers at times ‚Äî that&#x27;s why &quot;team management&quot; matters. For the compaction mechanism to work efficiently, you need wise planning and scheduling, or else you might need to deal with high memory and CPU usage, if not OOM in the backend or write error.</p><p>Specifically, efficient compaction is added up by quick triggering of compaction tasks, controllable memory and CPU overheads, and easy parameter adjustment from the engineer&#x27;s side. That begs the question: <strong>How</strong>? In this post, I will show you our way, including how we trigger, execute, and fine-tune compaction for faster and less resource-hungry execution.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="trigger-strategies">Trigger Strategies<a href="#trigger-strategies" class="hash-link" aria-label="Direct link to Trigger Strategies" title="Direct link to Trigger Strategies">‚Äã</a></h2><p>The overall objective here is to trigger compaction tasks timely with the least resource consumption possible.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="active-trigger">Active Trigger<a href="#active-trigger" class="hash-link" aria-label="Direct link to Active Trigger" title="Direct link to Active Trigger">‚Äã</a></h3><p>The most intuitive way to ensure timely compaction is to scan for potential compaction tasks upon data ingestion. Every time a new data tablet version is generated, a compaction task is triggered immediately, so you will never have to worry about version buildup. But this only works for newly ingested data. This is called <strong>Cumulative Compaction</strong>, as opposed to <strong>Base Compaction</strong>, which is the compaction of existing data.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="passive-scan">Passive Scan<a href="#passive-scan" class="hash-link" aria-label="Direct link to Passive Scan" title="Direct link to Passive Scan">‚Äã</a></h3><p>Base compaction is triggered by passive scan. Passive scan is a much heavier job than active trigger, because it scans all metadata in all data tablets in the node. After identifying all potential compaction tasks, the system starts compaction for the most urgent data tablet.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tablet-dormancy">Tablet Dormancy<a href="#tablet-dormancy" class="hash-link" aria-label="Direct link to Tablet Dormancy" title="Direct link to Tablet Dormancy">‚Äã</a></h3><p>Frequent metadata scanning is a waste of CPU resources, so it is better to introduce domancy: For tablets that have been producing no compaction tasks for long, the system just stops looking at them for a while. If there is a sudden data-write on a dormant tablet, that will trigger cumulative compaction as mentioned above, so no worries, you won&#x27;t miss anything.</p><p>The combination of these three strategies is an example of cost-effective planning.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="execution">Execution<a href="#execution" class="hash-link" aria-label="Direct link to Execution" title="Direct link to Execution">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="vertical-compaction-for-columnar-storage">Vertical Compaction for Columnar Storage<a href="#vertical-compaction-for-columnar-storage" class="hash-link" aria-label="Direct link to Vertical Compaction for Columnar Storage" title="Direct link to Vertical Compaction for Columnar Storage">‚Äã</a></h3><p>As columnar storage is the future for analytic databases, the execution of compaction should adapt to that. We call it vertical compaction. I illustrate this mechanism with the figure below:</p><p><img loading="lazy" alt="vertical-compaction" src="https://cdnd.selectdb.com/assets/images/Compaction_2-a6a4e08e1d33d0c489208d8fb607abb9.png" width="1536" height="826" class="img_ev3q"></p><p>Hope all these tiny blocks and numbers don&#x27;t make you dizzy. Actually, vertical compaction can be broken down into four simple steps:</p><ol><li><strong>Separate key columns and value columns</strong>. Split out all key columns from the input rowsets and put them into one group, and all value columns into N groups.</li><li><strong>Merge the key columns</strong>. Heap sort is used in this step. The product here is a merged and ordered key column as well as a global sequence marker (<strong>RowSources</strong>).</li><li><strong>Merge the value columns</strong>. The value columns are merged and organized based on the sequence in <strong>RowSources</strong>. </li><li><strong>Write the data</strong>. All columns are assembled together and form one big rowset.</li></ol><p>As a supporting technique for columnar storage, vertical compaction avoids the need to load all columns in every merging operation. That means it can vastly reduce memory usage compared to traditional row-oriented compaction.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="segment-compaction-to-avoid-jams">Segment Compaction to Avoid &quot;Jams&quot;<a href="#segment-compaction-to-avoid-jams" class="hash-link" aria-label="Direct link to Segment Compaction to Avoid &quot;Jams&quot;" title="Direct link to Segment Compaction to Avoid &quot;Jams&quot;">‚Äã</a></h3><p>As described in the beginning, in data ingestion, data will first be piled in the memory until it reaches a certain size, and then flushed to disks and stored in the form of files. Therefore, if you have ingested one huge batch of data at a time, you will have a large number of newly generated files on the disks. That adds to the scanning burden during data reading, and thus slows down data queries. (Imagine that suddenly you have to look into 50 boxes instead of 5, to find the item you need. That&#x27;s overwhelming.) In some databases, such explosion of files could even trigger a protection mechanism that suspends data ingestion.</p><p>Segment compaction is the way to avoid that. It allows you to compact data at the same time you ingest it, so that the system can ingest a larger data size quickly without generating too many files. </p><p>This is a flow chart that explains how segment compaction works:</p><p><img loading="lazy" alt="segment-compaction" src="https://cdnd.selectdb.com/assets/images/Compaction_3-6558067933ac6eb62900cd50b18f09fa.png" width="1030" height="950" class="img_ev3q"></p><p>Segment compaction will be triggered once the number of newly generated files exceeds a certain limit (let&#x27;s say, 10). It is executed asynchronously by a specialized merging thread. Every 10 files will be merged into one, and the original 10 files will be deleted. Segment compaction does not prolong the data ingestion process by much, but it can largely accelerate data queries.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ordered-data-compaction">Ordered Data Compaction<a href="#ordered-data-compaction" class="hash-link" aria-label="Direct link to Ordered Data Compaction" title="Direct link to Ordered Data Compaction">‚Äã</a></h3><p>Time series data analysis is an increasingly common analytic scenario. </p><p>Time series data is &quot;born orderly&quot;. It is already arranged chronologically, it is written at a regular pace, and every batch of it is of similar size. It is like the least-worried-about child in the family. Correspondingly, we have a tailored compaction method for it: ordered data compaction.</p><p><img loading="lazy" alt="ordered-data-compaction" src="https://cdnd.selectdb.com/assets/images/Compaction_4-e2cea4ec600d74073084b6ecbd1e600f.png" width="653" height="443" class="img_ev3q"></p><p>Ordered data compaction is even simpler:</p><ol><li><strong>Upload</strong>: Jot down the Min/Max Keys of the input rowset files.</li><li><strong>Check</strong>: Check if the rowset files are organized correctly based on the Min/Max Keys and the file size.</li><li><strong>Merge</strong>: Hard link the input rowsets to the new rowset, and create metadata for the new rowset (including number of rows, file size, Min/Max Key, etc.)</li></ol><p>See? It is a super neat and lightweight workload, involving only file linking and metadata creation. Statistically, <strong>it just takes milliseconds to compact huge amounts of time series data but consumes nearly zero memory</strong>.</p><p>So far, these are strategic and algorithmic optimizations for compaction, implemented by <a href="https://github.com/apache/doris/issues/19231" target="_blank" rel="noopener noreferrer">Apache Doris 2.0.0</a>, a unified analytic database. Apart from these, we, as developers for the open source project, have fine-tuned it from an engineering perspective.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="engineering-optimizations">Engineering Optimizations<a href="#engineering-optimizations" class="hash-link" aria-label="Direct link to Engineering Optimizations" title="Direct link to Engineering Optimizations">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="zero-copy">Zero-Copy<a href="#zero-copy" class="hash-link" aria-label="Direct link to Zero-Copy" title="Direct link to Zero-Copy">‚Äã</a></h3><p>In the backend nodes of Apache Doris, data goes through a few layers: Tablet -&gt; Rowset -&gt; Segment -&gt; Column -&gt; Page. The compaction process involves data transferring that consumes a lot of CPU resources. So we designed zero-copy compaction logic, which is realized by a data structure named BlockView. This brings another 5% increase in compaction efficiency.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="load-on-demand">Load-on-Demand<a href="#load-on-demand" class="hash-link" aria-label="Direct link to Load-on-Demand" title="Direct link to Load-on-Demand">‚Äã</a></h3><p>In most cases, the rowsets are not 100% orderless, so we can take advantage of such partial orderliness. For a group of ordered rowsets, Apache Doris only loads the first one and then starts merging. As the merging goes on, it gradually loads the rowset files it needs. This is how it decreases memory usage. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="idle-schedule"><strong>Idle Schedule</strong><a href="#idle-schedule" class="hash-link" aria-label="Direct link to idle-schedule" title="Direct link to idle-schedule">‚Äã</a></h3><p>According to our experience, base compaction tasks are often resource-intensive and time-consuming, so they can easily stand in the way of data queries. Doris 2.0.0 enables Idle Schedule, deprioritizing those base compaction tasks with huge data, long execution, and low compaction rate. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="parameter-optimizations">Parameter Optimizations<a href="#parameter-optimizations" class="hash-link" aria-label="Direct link to Parameter Optimizations" title="Direct link to Parameter Optimizations">‚Äã</a></h2><p>Every data engineer has somehow been harassed by complicated parameters and configurations. To protect our users from this nightmare, we have provided a streamlined set of parameters with the best-performing default configurations in the general environment.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">‚Äã</a></h2><p>This is how we keep our &quot;storekeepers&quot; working efficiently and cost-effectively. If you wonder how these strategies and optimization work in real practice, we tested Apache Doris with ClickBench. It reaches a <strong>compaction speed of 300,000 row/s</strong>; in high-concurrency scenarios, it maintains <strong>a stable compaction score of around 50</strong>. Also, we are planning to implement auto-tuning and increase observability for the compaction mechanism. If you are interested in the <a href="https://github.com/apache/doris" target="_blank" rel="noopener noreferrer">Apache Doris</a> project and what we do, this is a group of visionary and passionate <a href="https://join.slack.com/t/apachedoriscommunity/shared_invite/zt-2kl08hzc0-SPJe4VWmL_qzrFd2u2XYQA" target="_blank" rel="noopener noreferrer">developers</a> that you can talk to.</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><div class="text-center mb-4"><a class="text-[#8592A6] cursor-pointer hover:no-underline" href="/blog">Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class="s-tags"><span class="s-tag">Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:text-[2.5rem] text-center" itemprop="headline"><a itemprop="url" href="/blog/Building-A-Log-Analytics-Solution-10-Times-More-Cost-Effective-Than-Elasticsearch">Building a log analytics solution 10 times more cost-effective than Elasticsearch</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class="authors"><span class="s-author text-black">Apache Doris</span></span><time datetime="2023-05-26T00:00:00.000Z" itemprop="datePublished" class="text-black ml-4">May 26, 2023</time></div></header><div class="markdown" itemprop="articleBody"><p>Logs often take up the majority of a company&#x27;s data assets. Examples of logs include business logs (such as user activity logs), and Operation &amp; Maintenance logs of servers, databases, and network or IoT devices.</p><p>Logs are the guardian angel of business. On the one hand, they provide system risk alerts and help engineers in troubleshooting. On the other hand, if you zoom them out by time range, you might identify some helpful trends and patterns, not to mention that business logs are the cornerstone of user insights.</p><p>However, logs can be a handful, because:</p><ul><li><strong>They flow in like crazy.</strong> Every system event or click from user generates a log. A company often produces tens of billions of new logs per day.</li><li><strong>They are bulky.</strong> Logs are supposed to stay. They might not be useful until they are. So a company can accumulate up to PBs of log data, many of which are seldom visited but take up huge storage space. </li><li><strong>They must be quick to load and find.</strong> Locating the target log for troubleshooting is literally like looking for a needle in a haystack. People long for real-time log writing and real-time responses to log queries. </li></ul><p>Now you can see a clear picture of what an ideal log processing system is like. It should support:</p><ul><li><strong>High-throughput real-time data ingestion:</strong> It should be able to write blogs in bulk, and make them visible immediately.</li><li><strong>Low-cost storage:</strong> It should be able to store substantial amounts of logs without costing too many resources.</li><li><strong>Real-time text search:</strong> It should be capable of quick text search.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="common-solutions-elasticsearch--grafana-loki">Common Solutions: Elasticsearch &amp; Grafana Loki<a href="#common-solutions-elasticsearch--grafana-loki" class="hash-link" aria-label="Direct link to Common Solutions: Elasticsearch &amp; Grafana Loki" title="Direct link to Common Solutions: Elasticsearch &amp; Grafana Loki">‚Äã</a></h2><p>There exist two common log processing solutions within the industry, exemplified by Elasticsearch and Grafana Loki, respectively. </p><ul><li><strong>Inverted index (Elasticsearch)</strong>: It is well-embraced due to its support for full-text search and high performance. The downside is the low throughput in real-time writing and the huge resource consumption in index creation.</li><li><strong>Lightweight index / no index (Grafana Loki)</strong>: It is the opposite of inverted index because it boasts high real-time write throughput and low storage cost but delivers slow queries.</li></ul><p><img loading="lazy" alt="Elasticsearch-and-Grafana-Loki" src="https://cdnd.selectdb.com/assets/images/Inverted_1-976368c1a98899c128fdb268e00261c5.png" width="1412" height="748" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction-to-inverted-index">Introduction to Inverted Index<a href="#introduction-to-inverted-index" class="hash-link" aria-label="Direct link to Introduction to Inverted Index" title="Direct link to Introduction to Inverted Index">‚Äã</a></h2><p>A prominent strength of Elasticsearch in log processing is quick keyword search among a sea of logs. This is enabled by inverted indexes.</p><p>Inverted indexing was originally used to retrieve words or phrases in texts. The figure below illustrates how it works: </p><p>Upon data writing, the system tokenizes texts into <strong>terms</strong>, and stores these terms in a <strong>posting list</strong> which maps terms to the ID of the row where they exist. In text queries, the database finds the corresponding <strong>row ID</strong> of the keyword (term) in the posting list, and fetches the target row based on the row ID. By doing so, the system won&#x27;t have to traverse the whole dataset and thus improves query speeds by orders of magnitudes. </p><p><img loading="lazy" alt="inverted-index" src="https://cdnd.selectdb.com/assets/images/Inverted_2-20f3d1267475f3074304b15f8a901db3.png" width="961" height="720" class="img_ev3q"></p><p>In inverted indexing of Elasticsearch, quick retrieval comes at the cost of writing speed, writing throughput, and storage space. Why? Firstly, tokenization, dictionary sorting, and inverted index creation are all CPU- and memory-intensive operations. Secondly, Elasticssearch has to store the original data, the inverted index, and an extra copy of data stored in columns for query acceleration. That&#x27;s triple redundancy. </p><p>But without inverted index, Grafana Loki, for example, is hurting user experience with its slow queries, which is the biggest pain point for engineers in log analysis.</p><p>Simply put, Elasticsearch and Grafana Loki represent different tradeoffs between high writing throughput, low storage cost, and fast query performance. What if I tell you there is a way to have them all? We have introduced inverted indexes in <a href="https://github.com/apache/doris/issues/19231" target="_blank" rel="noopener noreferrer">Apache Doris 2.0.0</a> and further optimized it to realize <strong>two times faster log query performance than Elasticsearch with 1/5 of the storage space it uses. Both factors combined, it is a 10 times better solution.</strong> </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="inverted-index-in-apache-doris">Inverted Index in Apache Doris<a href="#inverted-index-in-apache-doris" class="hash-link" aria-label="Direct link to Inverted Index in Apache Doris" title="Direct link to Inverted Index in Apache Doris">‚Äã</a></h2><p>Generally, there are two ways to implement indexes: <strong>external indexing system</strong> or <strong>built-in indexes</strong>.</p><p><strong>External indexing system:</strong> You connect an external indexing system to your database. In data ingestion, data is imported to both systems. After the indexing system creates indexes, it deletes the original data within itself. When data users input a query, the indexing system provides the IDs of the relevant data, and then the database looks up the target data based on the IDs. </p><p>Building an external indexing system is easier and less intrusive to the database, but it comes with some annoying flaws:</p><ul><li>The need to write data into two systems can result in data inconsistency and storage redundancy.</li><li>Interaction between the database and the indexing system brings overheads, so when the target data is huge, the query across the two systems can be slow.</li><li>It is exhausting to maintain two systems.</li></ul><p>In <a href="https://github.com/apache/doris" target="_blank" rel="noopener noreferrer">Apache Doris</a>, we opt for the other way. Built-in inverted indexes are more difficult to make, but once it is done, it is faster, more user-friendly, and trouble-free to maintain.</p><p>In Apache Doris, data is arranged in the following format. Indexes are stored in the Index Region:</p><p><img loading="lazy" alt="index-region-in-Apache-Doris" src="https://cdnd.selectdb.com/assets/images/Inverted_3-10be120b343f5721d2c3adb666ab16b2.png" width="1054" height="324" class="img_ev3q"></p><p>We implement inverted indexes in a non-intrusive manner:</p><ol><li><strong>Data ingestion &amp; compaction</strong>: As a segment file is written into Doris, an inverted index file will be written, too. The index file path is determined by the segment ID and the index ID. Rows in segments correspond to the docs in indexes, so are the RowID and the DocID.</li><li><strong>Query</strong>: If the <code>where</code> clause includes a column with inverted index, the system will look up in the index file, return a DocID list, and convert the DocID list into a RowID Bitmap. Under the RowID filtering mechanism of Apache Doris, only the target rows will be read. This is how queries are accelerated.</li></ol><p><img loading="lazy" alt="non-intrusive-inverted-index" src="https://cdnd.selectdb.com/assets/images/Inverted_4-9de8707a87ec78e61f52142b043b512b.png" width="1174" height="1126" class="img_ev3q"></p><p>Such non-intrusive method separates the index file from the data files, so you can make any changes to the inverted indexes without worrying about affecting the data files themselves or other indexes. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="optimizations-for-inverted-index">Optimizations for Inverted Index<a href="#optimizations-for-inverted-index" class="hash-link" aria-label="Direct link to Optimizations for Inverted Index" title="Direct link to Optimizations for Inverted Index">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="general-optimizations">General Optimizations<a href="#general-optimizations" class="hash-link" aria-label="Direct link to General Optimizations" title="Direct link to General Optimizations">‚Äã</a></h3><p><strong>C++ Implementation and Vectorization</strong></p><p>Different from Elasticsearch, which uses Java, Apache Doris implements C++ in its storage modules, query execution engine, and inverted indexes. Compared to Java, C++ provides better performance, allows easier vectorization, and produces no JVM GC overheads. We have vectorized every step of inverted indexing in Apache Doris, such as tokenization, index creation, and queries. To provide you with a perspective, <strong>in inverted indexing, Apache Doris writes data at a speed of 20MB/s per core, which is four times that of Elasticsearch (5MB/s).</strong></p><p><strong>Columnar Storage &amp; Compression</strong></p><p>Apache Lucene lays the foundation for inverted indexes in Elasticsearch. As Lucene itself is built to support file storage, it stores data in a row-oriented format. </p><p>In Apache Doris, inverted indexes for different columns are isolated from each other, and the inverted index files adopt columnar storage to facilitate vectorization and data compression.</p><p>By utilizing Zstandard compression, Apache Doris realizes a compression ratio ranging from <strong>5:1</strong> to <strong>10:1</strong>, faster compression speeds, and 50% less space usage than GZIP compression.</p><p><strong>BKD Trees for Numeric / Datetime Columns</strong></p><p>Apache Doris implements BKD trees for numeric and datetime columns. This not only increases performance of range queries, but is a more space-saving method than converting those columns to fixed-length strings. Other benefits of it include:</p><ol><li><strong>Efficient range queries</strong>: It is able to quickly locate the target data range in numeric and datetime columns.</li><li><strong>Less storage space</strong>: It aggregates and compresses adjacent data blocks to reduce storage costs.</li><li><strong>Support for multi-dimensional data</strong>: BKD trees are scalable and adaptive to multi-dimensional data types, such as GEO points and ranges.</li></ol><p>In addition to BKD trees, we have further optimized the queries on numeric and datetime columns.</p><ol><li><strong>Optimization for low-cardinality scenarios</strong>: We have fine-tuned the compression algorithm for low-cardinality scenarios, so decompressing and de-serializing large amounts of inverted lists will consume less CPU resources.</li><li><strong>Pre-fetching</strong>: For high-hit-rate scenarios, we adopt pre-fetching. If the hit rate exceeds a certain threshold, Doris will skip the indexing process and start data filtering.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tailored-optimizations-to-olap">Tailored Optimizations to OLAP<a href="#tailored-optimizations-to-olap" class="hash-link" aria-label="Direct link to Tailored Optimizations to OLAP" title="Direct link to Tailored Optimizations to OLAP">‚Äã</a></h3><p>Log analysis is a simple kind of query with no need for advanced features (e.g. relevance scoring in Apache Lucene). The bread and butter capability of a log processing tool is quick queries and low storage cost. Therefore, in Apache Doris, we have streamlined the inverted index structure to meet the needs of an OLAP database.</p><ul><li>In data ingestion, we prevent multiple threads from writing data into the same index, and thus avoid overheads brought by lock contention.</li><li>We discard forward index files and Norm files to clear storage space and reduce I/O overheads.</li><li>We simplify the computation logic of relevance scoring and ranking to further reduce overheads and increase performance.</li></ul><p>In light of the fact that logs are partitioned by time range and historical logs are visited less frequently. We plan to provide more granular and flexible index management in future versions of Apache Doris:</p><ul><li><strong>Create inverted index for a specified data partition</strong>: create index for logs of the past seven days, etc.</li><li><strong>Delete</strong> <strong>inverted index for a specified data partition</strong>: delete index for logs from over one month ago, etc. (so as to clear out index space).</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="benchmarking">Benchmarking<a href="#benchmarking" class="hash-link" aria-label="Direct link to Benchmarking" title="Direct link to Benchmarking">‚Äã</a></h2><p>We tested Apache Doris on publicly available datasets against Elasticsearch and ClickHouse.</p><p>For a fair comparison, we ensure uniformity of testing conditions, including benchmarking tool, dataset, and hardware.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="apache-doris-vs-elasticsearch">Apache Doris VS Elasticsearch<a href="#apache-doris-vs-elasticsearch" class="hash-link" aria-label="Direct link to Apache Doris VS Elasticsearch" title="Direct link to Apache Doris VS Elasticsearch">‚Äã</a></h3><p><strong>Benchmarking tool</strong>: ES Rally, the official testing tool for Elasticsearch</p><p><strong>Dataset</strong>: 1998 World Cup HTTP Server Logs (self-contained dataset in ES Rally)</p><p><strong>Data Size (Before Compression)</strong>: 32G, 247 million rows, 134 bytes per row (on average)</p><p><strong>Query</strong>:  11 queries including keyword search, range query, aggregation, and ranking; Each query is serially executed 100 times.</p><p><strong>Environment</strong>: 3 √ó 16C 64G cloud virtual machines</p><ul><li><p><strong>Results of Apache Doris</strong>:</p><ul><li>Writing Speed: 550 MB/s, <strong>4.2 times that of Elasticsearch</strong></li><li>Compression Ratio: 10:1</li><li>Storage Usage: <strong>20% that of Elasticsearch</strong></li><li>Response Time: <strong>43% that of Elasticsearch</strong></li></ul></li></ul><p><img loading="lazy" alt="Apache-Doris-VS-Elasticsearch" src="https://cdnd.selectdb.com/assets/images/Inverted_5-d5600afe9c83f8ade57180eaa1104e8e.png" width="1592" height="680" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="apache-doris-vs-clickhouse">Apache Doris VS ClickHouse<a href="#apache-doris-vs-clickhouse" class="hash-link" aria-label="Direct link to Apache Doris VS ClickHouse" title="Direct link to Apache Doris VS ClickHouse">‚Äã</a></h3><p>As ClickHouse launched inverted index as an experimental feature in v23.1, we tested Apache Doris with the same dataset and SQL as described in the ClickHouse <a href="https://clickhouse.com/blog/clickhouse-search-with-inverted-indices" target="_blank" rel="noopener noreferrer">blog</a>, and compared performance of the two under the same testing resource, case, and tool.</p><p><strong>Data</strong>: 6.7G, 28.73 million rows, the Hacker News dataset, Parquet format</p><p><strong>Query</strong>:  3 keyword searches, counting the number of occurrence of the keywords &quot;ClickHouse&quot;, &quot;OLAP&quot; OR &quot;OLTP&quot;, and &quot;avx&quot; AND &quot;sve&quot;.</p><p><strong>Environment</strong>: 1 √ó 16C 64G cloud virtual machine</p><p><strong>Result</strong>: Apache Doris was <strong>4.7 times, 12 times, 18.5 times</strong> faster than ClickHouse in the three queries, respectively.</p><p><img loading="lazy" alt="Apache-Doris-VS-ClickHouse" src="https://cdnd.selectdb.com/assets/images/Inverted_6-a3e009f32ae1d0a25a40f257c04b8878.png" width="1546" height="626" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="usage--example">Usage &amp; Example<a href="#usage--example" class="hash-link" aria-label="Direct link to Usage &amp; Example" title="Direct link to Usage &amp; Example">‚Äã</a></h2><p><strong>Dataset</strong>: one million comment records from Hacker News</p><ul><li><p><strong>Step 1</strong>: Specify inverted index to the data table upon table creation.</p></li><li><p><strong>Parameters</strong>:</p></li><li><ul><li>INDEX idx_comment (<code>comment</code>): create an index named &quot;idx_comment&quot; comment for the &quot;comment&quot; column</li><li>USING INVERTED: specify inverted index for the table</li><li>PROPERTIES(&quot;parser&quot; = &quot;english&quot;): specify the tokenization language to English</li></ul></li></ul><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE TABLE hackernews_1m</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `id` BIGINT,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `deleted` TINYINT,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `type` String,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `author` String,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `timestamp` DateTimeV2,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `comment` String,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `dead` TINYINT,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `parent` BIGINT,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `poll` BIGINT,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `children` Array&lt;BIGINT&gt;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `url` String,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `score` INT,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `title` String,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `parts` Array&lt;INT&gt;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    `descendants` INT,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    INDEX idx_comment (`comment`) USING INVERTED PROPERTIES(&quot;parser&quot; = &quot;english&quot;) COMMENT &#x27;inverted index for comment&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DUPLICATE KEY(`id`)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DISTRIBUTED BY HASH(`id`) BUCKETS 10</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES (&quot;replication_num&quot; = &quot;1&quot;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note: You can add index to an existing table via <code>ADD INDEX idx_comment ON hackernews_1m(</code>comment<code>) USING INVERTED PROPERTIES(&quot;parser&quot; = &quot;english&quot;) </code>. Different from that of smart index and secondary index, the creation of inverted index only involves the reading of the comment column, so it can be much faster.</p><p><strong>Step 2</strong>: Retrieve the words&quot;OLAP&quot; and &quot;OLTP&quot; in the comment column with <code>MATCH_ALL</code>. The response time here was 1/10 of that in hard matching with <code>like</code>. (The performance gap widens as data volume increases.)</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; SELECT count() FROM hackernews_1m WHERE comment LIKE &#x27;%OLAP%&#x27; AND comment LIKE &#x27;%OLTP%&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| count() |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|      15 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1 row in set (0.13 sec)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; SELECT count() FROM hackernews_1m WHERE comment MATCH_ALL &#x27;OLAP OLTP&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| count() |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|      15 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1 row in set (0.01 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For more feature introduction and usage guide, see documentation: <a href="https://doris.apache.org/docs/dev/data-table/index/inverted-index/" target="_blank" rel="noopener noreferrer">Inverted Index</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="wrap-up">Wrap-up<a href="#wrap-up" class="hash-link" aria-label="Direct link to Wrap-up" title="Direct link to Wrap-up">‚Äã</a></h2><p>In a word, what contributes to Apache Doris&#x27; 10-time higher cost-effectiveness than Elasticsearch is its OLAP-tailored optimizations for inverted indexing, supported by the columnar storage engine, massively parallel processing framework, vectorized query engine, and cost-based optimizer of Apache Doris. </p><p>As proud as we are about our own inverted indexing solution, we understand that self-published benchmarks can be controversial, so we are open to <a href="https://join.slack.com/t/apachedoriscommunity/shared_invite/zt-2kl08hzc0-SPJe4VWmL_qzrFd2u2XYQA" target="_blank" rel="noopener noreferrer">feedback</a> from any third-party users and see how <a href="https://github.com/apache/doris" target="_blank" rel="noopener noreferrer">Apache Doris</a> works in real-world cases.</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><div class="text-center mb-4"><a class="text-[#8592A6] cursor-pointer hover:no-underline" href="/blog">Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class="s-tags"><span class="s-tag">Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:text-[2.5rem] text-center" itemprop="headline"><a itemprop="url" href="/blog/How-We-Increased-Database-Query-Concurrency-by-20-Times">How We increased database query concurrency by 20 times</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class="authors"><span class="s-author text-black">Apache Doris</span></span><time datetime="2023-04-14T00:00:00.000Z" itemprop="datePublished" class="text-black ml-4">April 14, 2023</time></div></header><div class="markdown" itemprop="articleBody"><p>A unified analytic database is the holy grail for data engineers, but what does it look like specifically? It should evolve with the needs of data users.</p><p>Vertically, companies now have an ever enlarging pool of data and expect a higher level of concurrency in data processing. Horizontally, they require a wider range of data analytics services. Besides traditional OLAP scenarios such as statistical reporting and ad-hoc queries, they are also leveraging data analysis in recommender systems, risk control, customer tagging and profiling, and IoT.</p><p>Among all these data services, point queries are the most frequent operations conducted by data users. Point query means to retrieve one or several rows from the database based on the Key. A point query only returns a small piece of data, such as the details of a shopping order, a transaction, a consumer profile, a product description, logistics status, and so on. Sounds easy, right? But the tricky part is, <strong>a database often needs to handle tens of thousands of point queries at a time and respond to all of them in milliseconds</strong>.</p><p>Most current OLAP databases are built with a columnar storage engine to process huge data volumes. They take pride in their high throughput, but often underperform in high-concurrency scenarios. As a complement, many data engineers invite Key-Value stores like Apache HBase for point queries, and Redis as a cache layer to ease the burden. The downside is redundant storage and high maintenance costs.</p><p>Since Apache Doris was born, we have been striving to make it a unified database for data queries of all sizes, including ad-hoc queries and point queries. Till now, we have already taken down the monster of high-throughput OLAP scenarios. In the upcoming Apache Doris 2.0, we have optimized it for high-concurrency point queries. Long story short, it can achieve over 30,000 QPS for a single node. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="five-ways-to-accelerate-high-concurrency-queries">Five Ways to Accelerate High-Concurrency Queries<a href="#five-ways-to-accelerate-high-concurrency-queries" class="hash-link" aria-label="Direct link to Five Ways to Accelerate High-Concurrency Queries" title="Direct link to Five Ways to Accelerate High-Concurrency Queries">‚Äã</a></h2><p>High-concurrency queries are thorny because you need to handle high loads with limited system resources. That means you have to reduce the CPU, memory and I/O overheads of a single SQL as much as possible. The key is to minimize the scanning of underlying data and follow-up computing. </p><p>Apache Doris uses five methods to achieve higher QPS.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="partioning-and-bucketing">Partioning and Bucketing<a href="#partioning-and-bucketing" class="hash-link" aria-label="Direct link to Partioning and Bucketing" title="Direct link to Partioning and Bucketing">‚Äã</a></h3><p>Apache Doris shards data into a two-tiered structure: Partition and Bucket. You can use time information as the Partition Key. As for bucketing, you distribute the data into various nodes after data hashing. A wise bucketing plan can largely increase concurrency and throughput in data reading. </p><p>This is an example:</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">select * from user_table where id = 5122 and create_date = &#x27;2022-01-01&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this case, the user has set 10 buckets. <code>create_date</code> is the Partition Key and <code>id</code> is the Bucket Key. After dividing the data into partitions and buckets, the system only needs to scan one bucket in one partition before it can locate the needed data. This is a huge time saver.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="index">Index<a href="#index" class="hash-link" aria-label="Direct link to Index" title="Direct link to Index">‚Äã</a></h3><p>Apache Doris uses various data indexes to speed up data reading and filtering, including smart indexes and secondary indexes. Smart indexes are auto-generated by Doris upon data ingestion, which requires no action from the user&#x27;s side. </p><p>There are two types of smart indexes:</p><ul><li><strong>Sorted Index</strong>: Apache Doris stores data in an orderly way. It creates a sorted index for every 1024 rows of data. The Key in the index is the value of the sorted column in the first row of the current 1024 rows. If the query involves the sorted column, the system will locate the first row of the relevant 1024 row group and start scanning there.</li><li><strong>ZoneMap Index</strong>: These are indexes on the Segment and Page level. The maximum and minimum values of each column within a Page will be recorded, so are those within a Segment. Hence, in equivalence queries and range queries, the system can narrow down the filter range with the help of the MinMax indexes.</li></ul><p>Secondary indexes are created by users. These include Bloom Filter indexes, Bitmap indexes, <a href="https://doris.apache.org/docs/dev/data-table/index/inverted-index/" target="_blank" rel="noopener noreferrer">Inverted indexes</a>, and <a href="https://doris.apache.org/docs/dev/data-table/index/ngram-bloomfilter-index/" target="_blank" rel="noopener noreferrer">NGram Bloom Filter indexes</a>. (If you are interested, I will go into details about them in future articles.)</p><p>Example:</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">select * from user_table where id &gt; 10 and id &lt; 1024</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Suppose that the user has designated <code>id</code> as the Key during table creation, the data will be sorted by <code>id</code> on Memtable and the disks. So any queries involving <code>id</code> as a filter condition will be executed much faster with the aid of sorted indexes. Specifically, the data in storage will be put into multiple ranges based on <code>id</code>, and the system will implement binary search to locate the exact range according to the sorted indexes. But that could still be a large range since the sorted indexes are sparse. You can further narrow it down based on ZoneMap indexes, Bloom Filter indexes, and Bitmap indexes. </p><p>This is another way to reduce data scanning and improve overall concurrency of the system.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="materialized-view">Materialized View<a href="#materialized-view" class="hash-link" aria-label="Direct link to Materialized View" title="Direct link to Materialized View">‚Äã</a></h3><p>The idea of materialized view is to trade space for time: You execute pre-computation with pre-defined SQL statements, and perpetuate the results in a table that is visible to users but occupies some storage space. In this way, Apache Doris can respond much faster to queries for aggregated data and breakdown data and those involve the matching of sorted indexes once it hits a materialized view. This is a good way to lessen computation, improve query performance, and reduce resource consumption.</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// For an aggregation query, the system reads the pre-aggregated columns in the materialized view.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">create materialized view store_amt as select store_id, sum(sale_amt) from sales_records group by store_id;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SELECT store_id, sum(sale_amt) FROM sales_records GROUP BY store_id;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// For a query where k3 matches the sorted column in the materialized view, the system directly performs the query on the materialized view. </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE MATERIALIZED VIEW mv_1 as SELECT k3, k2, k1 FROM tableA ORDER BY k3;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select k1, k2, k3 from table A where k3=3;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="runtime-filter">Runtime Filter<a href="#runtime-filter" class="hash-link" aria-label="Direct link to Runtime Filter" title="Direct link to Runtime Filter">‚Äã</a></h3><p>Apart from filtering data by indexes, Apache Doris has a dynamic filtering mechanism: Runtime Filter. </p><p>In multi-table Join queries, the left table is usually called ProbeTable while the right one is called BuildTable, with the former much bigger than the latter. In query execution, firstly, the system reads the right table and creates a HashTable (Build) in the memory. Then, it starts reading the left table row by row, during which it also compares data between the left table and the HashTable and returns the matched data (Probe). </p><p>So what&#x27;s new about that in Apache Doris? During the creation of HashTable, Apache Doris generates a filter for the columns. It can be a Min/Max filter or an IN filter. Then it pushes down the filter to the left table, which can use the filter to screen out data and thus reduces the amount of data that the Probe node has to transfer and compare. </p><p>This is how the Runtime Filter works. In most Join queries, the Runtime Filter can be automatically pushed down to the most underlying scan nodes or to the distributed Shuffle Join. In other words, Runtime Filter is able to reduce data reading and shorten response time for most Join queries.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="top-n-optimization">TOP-N Optimization<a href="#top-n-optimization" class="hash-link" aria-label="Direct link to TOP-N Optimization" title="Direct link to TOP-N Optimization">‚Äã</a></h3><p>TOP-N query is a frequent scenario in data analysis. For example, users want to fetch the most recent 100 orders, or the 5 highest/lowest priced products. The performance of such queries determines the quality of real-time analysis. For them, Apache Doris implements TOP-N optimization. Here is how it goes:</p><ol><li>Apache Doris reads the sorted fields and query fields from the Scanner layer, reserves only the TOP-N pieces of data by means of Heapsort, updates the real-time TOP-N results as it continues reading, and dynamically pushes them down to the Scanner. </li><li>Combing the received TOP-N range and the indexes, the Scanner can skip a large proportion of irrelevant files and data chunks and only read a small number of rows.</li><li>Queries on flat tables usually mean the need to scan massive data, but TOP-N queries only retrieve a small amount of data. The strategy here is to divide the data reading process into two stages. In stage one, the system sorts the data based on a few columns (sorted column, or condition column) and locates the TOP-N rows. In stage two, it fetches the TOP-N rows of data after data sorting, and then it retrieves the target data according to the row numbers. </li></ol><p>To sum up, Apache Doris prunes the data that needs to be read and sorted, and thus substantially reduces consumption of I/O, CPU, and memory resources.</p><p>In addition to the foregoing five methods, Apache Doris also improves concurrency by SQL Cache, Partition Cache, and a variety of Join optimization techniques.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-we-bring-concurrency-to-the-next-level">How We Bring Concurrency to the Next Level<a href="#how-we-bring-concurrency-to-the-next-level" class="hash-link" aria-label="Direct link to How We Bring Concurrency to the Next Level" title="Direct link to How We Bring Concurrency to the Next Level">‚Äã</a></h2><p>By adopting the above methods, Apache Doris was able to achieve thousands of QPS per node. However, in scenarios requiring tens of thousands of QPS, it was still bottlenecked by several issues:</p><ul><li>With Doris&#x27; columnar storage engine, it was inconvenient to read rows. In flat table models, columnar storage could result in much larger I/O usage.</li><li>The execution engine and query optimizer of OLAP databases were sometimes too complicated for simple queries (point queries, etc.). Such queries needed to be processed with a shorter pipeline, which should be considered in query planning.</li><li>FE modules of Doris, implementing Java, were responsible for interfacing with SQL requests and parsing query plans. These processes could produce high CPU overheads in high-concurrency scenarios.</li></ul><p>We optimized Apache Doris to solve these problems. (<a href="https://github.com/apache/doris/pull/15491" target="_blank" rel="noopener noreferrer">Pull Request on Github</a>)</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="row-storage-format">Row Storage Format<a href="#row-storage-format" class="hash-link" aria-label="Direct link to Row Storage Format" title="Direct link to Row Storage Format">‚Äã</a></h3><p>As we know, row storage is much more efficient when the user only queries for a single row of data. So we introduced row storage format in Apache Doris 2.0. Users can enable row storage by specifying the following property in the table creation statement.</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;store_row_column&quot; = &quot;true&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We chose JSONB as the encoding format for row storage for three reasons:</p><ul><li><strong>Flexible schema change</strong>: If a user has added or deleted a field, or modified the type of a field, these changes must be updated in row storage in real time. So we choose to adopt the JSONB format and encode columns into JSONB fields. This makes changes in fields very easy.</li><li><strong>High performance</strong>:  Accessing rows in row-oriented storage is much faster than doing that in columnar storage, and it requires much less disk access in high-concurrency scenarios. Also, in some cases, you can map the column ID to the corresponding JSONB value so you can quickly access a certain column.</li><li><strong>Less storage space</strong>: JSONB is a compacted binary format. It consumes less space on the disk and is more cost-effective.</li></ul><p>In the storage engine, row storage will be stored as a hidden column (DORIS_ROW_STORE_COL). During Memtable Flush, the columns will be encoded into JSONB and cached into this hidden column. In data reading, the system uses the Column ID to locate the column, finds the target row based on the row number, and then deserializes the relevant columns.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="short-circuit">Short-Circuit<a href="#short-circuit" class="hash-link" aria-label="Direct link to Short-Circuit" title="Direct link to Short-Circuit">‚Äã</a></h3><p>Normally, an SQL statement is executed in three steps:</p><ol><li>SQL Parser parses the statement to generate an abstract syntax tree (AST).</li><li>The Query Optimizer produces an executable plan.</li><li>Execute the plan and return the results.</li></ol><p>For complex queries on massive data, it is better to follow the plan created by the Query Optimizer. However, for high-concurrency point queries requiring low latency, that plan is not only unnecessary but also brings extra overheads. That&#x27;s why we implement a short-circuit plan for point queries. </p><p><img loading="lazy" alt="short-circuit-plan" src="https://cdnd.selectdb.com/assets/images/high-concurrency_1-90fb6261659bb3cce5ad8076fa9dc65d.png" width="1606" height="778" class="img_ev3q"></p><p>Once the FE receives a point query request, a short-circuit plan will be produced. It is a lightweight plan that involves no equivalent transformation, logic optimization or physical optimization. Instead, it conducts some basic analysis on the AST, creates a fixed plan accordingly, and finds ways to reduce overhead of the optimizer.</p><p>For a simple point query involving primary keys, such as <code>select * from tbl where pk1 = 123 and pk2 = 456</code>, since it only involves one single Tablet, it is better to use a lightweight RPC interface for interaction with the Storage Engine. This avoids the creation of a complicated Fragment Plan and eliminates the performance overhead brought by the scheduling under the MPP query framework.</p><p>Details of the RPC interface are as follows:</p><div class="language-Java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">message PTabletKeyLookupRequest {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    required int64 tablet_id = 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    repeated KeyTuple key_tuples = 2;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    optional Descriptor desc_tbl = 4;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    optional ExprList  output_expr = 5;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">message PTabletKeyLookupResponse {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    required PStatus status = 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    optional bytes row_batch = 5;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    optional bool empty_batch = 6;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">rpc tablet_fetch_data(PTabletKeyLookupRequest) returns (PTabletKeyLookupResponse);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>tablet_id</code> is calculated based on the primary key column, while <code>key_tuples</code> is the string format of the primary key. In this example, the <code>key_tuples</code> is similar to <!-- -->[&#x27;123&#x27;, &#x27;456&#x27;]<!-- -->. As BE receives the request, <code>key_tuples</code> will be encoded into primary key storage format. Then, it will locate the corresponding row number of the Key in the Segment File with the help of the primary key index, and check if that row exists in <code>delete bitmap</code>. If it does, the row number will be returned; if not, the system returns NotFound. The returned row number will be used for point query on <code>__DORIS_ROW_STORE_COL__</code>. That means we only need to locate one row in that column, fetch the original value of the JSONB format, and deserialize it.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="prepared-statement">Prepared Statement<a href="#prepared-statement" class="hash-link" aria-label="Direct link to Prepared Statement" title="Direct link to Prepared Statement">‚Äã</a></h3><p>In high-concurrency queries, part of the CPU overhead comes from SQL analysis and parsing in FE. To reduce such overhead, in FE, we provide prepared statements that are fully compatible with MySQL protocol. With prepared statements, we can achieve a four-time performance increase for primary key point queries.</p><p><img loading="lazy" alt="prepared-statement-map" src="https://cdnd.selectdb.com/assets/images/high-concurrency_2-24db356001a7e9c6276202b59ce09d03.png" width="1280" height="775" class="img_ev3q"></p><p>The idea of prepared statements is to cache precomputed SQL and expressions in HashMap in memory, so they can be directly used in queries when applicable.</p><p>Prepared statements adopt MySQL binary protocol for transmission. The protocol is implemented in the mysql_row_buffer.<!-- -->[h|cpp]<!-- --> file, and uses MySQL binary encoding. Under this protocol, the client (for example, JDBC Client) sends a pre-compiled statement to FE via <code>PREPARE</code> MySQL Command. Next, FE will parse and analyze the statement and cache it in the HashMap as shown in the figure above. Next, the client, using <code>EXECUTE</code> MySQL Command, will replace the placeholder, encode it into binary format, and send it to FE. Then, FE will perform deserialization to obtain the value of the placeholder, and generate query conditions.</p><p><img loading="lazy" alt="prepared-statement-execution" src="https://cdnd.selectdb.com/assets/images/high-concurrency_3-78f37932ab22095589cd35e1829eba6b.png" width="1134" height="904" class="img_ev3q"></p><p>Apart from caching prepared statements in FE, we also cache reusable structures in BE. These structures include pre-allocated computation blocks, query descriptors, and output expressions. Serializing and deserializing these structures often cause a CPU hotspot, so it makes more sense to cache them. The prepared statement for each query comes with a UUID named CacheID. So when BE executes the point query, it will find the corresponding class based on the CacheID, and then reuse the structure in computation.</p><p>The following example demonstrates how to use a prepared statement in JDBC:</p><ol><li>Set a JDBC URL and enable prepared statement at the server end.</li></ol><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">url </span><span class="token operator">=</span><span class="token plain"> jdbc:mysql://127.0.0.1:9030/ycsb?useServerPrepStmts</span><span class="token operator">=</span><span class="token plain">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li>Use a prepared statement.</li></ol><div class="language-Java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Use `?` as placeholder, reuse readStatement.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PreparedStatement readStatement = conn.prepareStatement(&quot;select * from tbl_point_query where key = ?&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">readStatement.setInt(1234);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ResultSet resultSet = readStatement.executeQuery();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">readStatement.setInt(1235);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">resultSet = readStatement.executeQuery();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="row-storage-cache">Row Storage Cache<a href="#row-storage-cache" class="hash-link" aria-label="Direct link to Row Storage Cache" title="Direct link to Row Storage Cache">‚Äã</a></h3><p>Apache Doris has a Page Cache feature, where each page caches the data of one column. </p><p><img loading="lazy" alt="page-cache" src="https://cdnd.selectdb.com/assets/images/high-concurrency_4-3a2f6a6b077605a579c5b00560e0cffb.png" width="568" height="540" class="img_ev3q"></p><p>As mentioned above, we have introduced row storage in Doris. The problem with this is, one row of data consists of multiple columns, so in the case of big queries, the cached data might be erased. Thus, we also introduced row cache to increase row cache hit rate.</p><p>Row cache reuses the LRU Cache mechanism in Apache Doris. When the caching starts, the system will initialize a threshold value. If that threshold is hit, the old cached rows will be phased out. For a primary key query statement, the performance gap between cache hit and cache miss can be huge (we are talking about dozens of times less disk I/O and memory access here). So the introduction of row cache can remarkably enhance point query performance.</p><p><img loading="lazy" alt="row-cache" src="https://cdnd.selectdb.com/assets/images/high-concurrency_5-91a7b2adc421fb31c47d89f638adecf6.png" width="468" height="500" class="img_ev3q"></p><p>To enable row cache, you can specify the following configuration in BE:</p><div class="language-JSON codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-JSON codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">disable_storage_row_cache=false // This specifies whether to enable row cache; it is set to false by default.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">row_cache_mem_limit=20% // This specifies the percentage of row cache in the memory; it is set to 20% by default.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="benchmark-performance">Benchmark Performance<a href="#benchmark-performance" class="hash-link" aria-label="Direct link to Benchmark Performance" title="Direct link to Benchmark Performance">‚Äã</a></h2><p>We tested Apache Doris with YCSB (Yahoo! Cloud Serving Benchmark) to see how all these optimizations work.</p><p><strong>Configurations and data size:</strong></p><ul><li>Machines: a single 16 Core 64G cloud server with 4√ó1T hard drives</li><li>Cluster size: 1 Frontend + 2 Backends</li><li>Data volume: 100 million rows of data, with each row taking 1KB to store; preheated</li><li>Table schema and query statement:</li></ul><div class="language-JavaScript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-JavaScript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Table creation statement:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE TABLE `usertable` (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `YCSB_KEY` varchar(255) NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `FIELD0` text NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `FIELD1` text NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `FIELD2` text NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `FIELD3` text NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `FIELD4` text NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `FIELD5` text NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `FIELD6` text NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `FIELD7` text NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `FIELD8` text NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `FIELD9` text NULL</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">) ENGINE=OLAP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">UNIQUE KEY(`YCSB_KEY`)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">COMMENT &#x27;OLAP&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DISTRIBUTED BY HASH(`YCSB_KEY`) BUCKETS 16</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;replication_allocation&quot; = &quot;tag.location.default: 1&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;in_memory&quot; = &quot;false&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;persistent&quot; = &quot;false&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;storage_format&quot; = &quot;V2&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;enable_unique_key_merge_on_write&quot; = &quot;true&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;light_schema_change&quot; = &quot;true&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;store_row_column&quot; = &quot;true&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;disable_auto_compaction&quot; = &quot;false&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Query statement:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SELECT * from usertable WHERE YCSB_KEY = ?</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We run the test with the optimizations (row storage, short-circuit, and prepared statement) enabled, and then did it again with all of them disabled. Here are the results:</p><p><img loading="lazy" alt="performance-before-and-after-concurrency-optimization" src="https://cdnd.selectdb.com/assets/images/high-concurrency_6-6c3bbd4d2c6e6a54db40297c2154a9da.png" width="1280" height="653" class="img_ev3q"></p><p>With optimizations enabled, <strong>the average query latency decreased by a whopping 96%, the 99th percentile latency was only 1/28 of that without optimizations, and it has achieved a query concurrency of over 30,000 QPS.</strong> This is a huge leap in performance and an over 20-time increase in concurrency.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="best-practice">Best Practice<a href="#best-practice" class="hash-link" aria-label="Direct link to Best Practice" title="Direct link to Best Practice">‚Äã</a></h2><p>It should be noted that these optimizations for point queries are implemented in the Unique Key model of Apache Doris, and you should enable Merge-on-Write and Light Schema Change for this model.</p><p>This is a table creation statement example for point queries:</p><div class="language-undefined codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-undefined codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE TABLE `usertable` (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `USER_KEY` BIGINT NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `FIELD0` text NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `FIELD1` text NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `FIELD2` text NULL,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  `FIELD3` text NULL</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">) ENGINE=OLAP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">UNIQUE KEY(`USER_KEY`)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">COMMENT &#x27;OLAP&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DISTRIBUTED BY HASH(`USER_KEY`) BUCKETS 16</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;enable_unique_key_merge_on_write&quot; = &quot;true&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;light_schema_change&quot; = &quot;true&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;store_row_column&quot; = &quot;true&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">); </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Note:</strong></p><ul><li>Enable <code>light_schema_change</code> to support JSONB row storage for encoding ColumnID</li><li>Enable <code>store_row_column</code> to store row storage format</li></ul><p>For a primary key-based point query like the one below, after table creation, you can use row storage and short-circuit execution to improve performance to a great extent.</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">select * from usertable where USER_KEY = xxx;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To further unleash performance, you can apply prepared statement. If you have enough memory space, you can also enable row cache in the BE configuration.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">‚Äã</a></h2><p>In high-concurrency scenarios, Apache Doris realizes over 30,000 QPS per node after optimizations including row storage, short-circuit, prepared statement, and row cache. Also, Apache Doris is easily scaled out since it is built on MPP architecture, on top of which you can scale it up by upgrading the hardware and machine configuration. This is how Apache Doris manages to achieve both high throughput and high concurrency. It allows you to deal with various data analytic workloads on one single platform and experience quick data analytics for various scenarios. Thanks to the great efforts of the Apache Doris community and a group of excellent SelectDB engineers, Apache Doris 2.0 is about to be released soon.</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><div class="text-center mb-4"><a class="text-[#8592A6] cursor-pointer hover:no-underline" href="/blog">Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class="s-tags"><span class="s-tag">Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:text-[2.5rem] text-center" itemprop="headline"><a itemprop="url" href="/blog/Building-the-Next-Generation-Data-Lakehouse-10X-Performance">Building the next-generation data lakehouse: 10X performance</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class="authors"><span class="s-author text-black">Apache Doris</span></span><time datetime="2023-03-14T00:00:00.000Z" itemprop="datePublished" class="text-black ml-4">March 14, 2023</time></div></header><div class="markdown" itemprop="articleBody"><p>A data warehouse was defined by Bill Inmon as &quot;a subject-oriented, integrated, nonvolatile, and time-variant collection of data in support of management&#x27;s decisions&quot; over 30 years ago. However, the initial data warehouses unable to store massive heterogeneous data, hence the creation of data lakes. In modern times, data lakehouse emerges as a new paradigm. It is an open data management architecture featured by strong data analytics and governance capabilities, high flexibility, and open storage.</p><p>If I could only use one word to describe the next-gen data lakehouse, it would be <strong>unification:</strong></p><ul><li><strong>Unified data storage</strong> to avoid the trouble and risks brought by redundant storage and cross-system ETL.</li><li><strong>Unified governance</strong> of both data and metadata with support for ACID, Schema Evolution, and Snapshot.</li><li><strong>Unified data application</strong> that supports data access via a single interface for multiple engines and workloads.</li></ul><p>Let&#x27;s look into the architecture of a data lakehouse. We will find that it is not only supported by table formats such as Apache Iceberg, Apache Hudi, and Delta Lake, but more importantly, it is powered by a high-performance query engine to extract value from data.</p><p>Users are looking for a query engine that allows quick and smooth access to the most popular data sources. What they don&#x27;t want is for their data to be locked in a certain database and rendered unavailable for other engines or to spend extra time and computing costs on data transfer and format conversion.</p><p>To turn these visions into reality, a data query engine needs to figure out the following questions:</p><ul><li>How to access more data sources and acquire metadata more easily?</li><li>How to improve query performance on data coming from various sources?</li><li>How to enable more flexible resource scheduling and workload management?</li></ul><p><a href="https://github.com/apache/doris" target="_blank" rel="noopener noreferrer">Apache Doris</a> provides a possible answer to these questions. It is a real-time OLAP database that aspires to build itself into a unified data analysis gateway. This means it needs to be easily connected to various RDBMS, data warehouses, and data lake engines (such as Hive, Iceberg, Hudi, Delta Lake, and Flink Table Store) and allow for quick data writing from and queries on these heterogeneous data sources. The rest of this article is an in-depth explanation of Apache Doris&#x27; techniques in the above three aspects: metadata acquisition, query performance optimization, and resource scheduling.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="metadata-acquisition-and-data-access">Metadata Acquisition and Data Access<a href="#metadata-acquisition-and-data-access" class="hash-link" aria-label="Direct link to Metadata Acquisition and Data Access" title="Direct link to Metadata Acquisition and Data Access">‚Äã</a></h2><p>Apache Doris 1.2.2 supports a wide variety of data lake formats and data access from various external data sources. Besides, via the Table Value Function, users can analyze files in object storage or HDFS directly.</p><p><img loading="lazy" alt="data-sources-supported-in-data-lakehouse" src="https://cdnd.selectdb.com/assets/images/Lakehouse_1-3be8649464d93663ca4b474a8ce1d669.png" width="1598" height="882" class="img_ev3q"></p><p>To support multiple data sources, Apache Doris puts efforts into metadata acquisition and data access.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="metadata-acquisition">Metadata Acquisition<a href="#metadata-acquisition" class="hash-link" aria-label="Direct link to Metadata Acquisition" title="Direct link to Metadata Acquisition">‚Äã</a></h3><p>Metadata consists of information about the databases, tables, partitions, indexes, and files from the data source. Thus, metadata of various data sources come in different formats and patterns, adding to the difficulty of metadata connection. An ideal metadata acquisition service should include the following:</p><ol><li>A <strong>metadata structure</strong> that can accommodate heterogeneous metadata.</li><li>An <strong>extensible metadata connection framework</strong> that enables quick and low-cost data connection.</li><li>Reliable and <strong>efficient</strong> <strong>metadata access</strong> that supports real-time metadata capture.</li><li><strong>Custom authentication</strong> services to interface with external privilege management systems and thus reduce migration costs. </li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="metadata-structure">Metadata Structure<a href="#metadata-structure" class="hash-link" aria-label="Direct link to Metadata Structure" title="Direct link to Metadata Structure">‚Äã</a></h4><p>Older versions of Doris support a two-tiered metadata structure: database and table. As a result, users need to create mappings for external databases and tables one by one, which is heavy work. Thus, Apache Doris 1.2.0 introduced the Multi-Catalog functionality. With this, you can map to external data at the catalog level, which means:</p><ol><li>You can map to the whole external data source and ingest all metadata from it.</li><li>You can manage the properties of the specified data source at the catalog level, such as connection, privileges, and data ingestion details, and easily handle multiple data sources.</li></ol><p><img loading="lazy" alt="metadata-structure" src="https://cdnd.selectdb.com/assets/images/Lakehouse_2-c1381100fe5007d6e3ee17ef81245112.png" width="1280" height="650" class="img_ev3q"></p><p>Data in Doris falls into two types of catalogs:</p><ol><li>Internal Catalog: Existing Doris databases and tables all belong to the Internal Catalog.</li><li>External Catalog: This is used to interface with external data sources. For example, HMS External Catalog can be connected to a cluster managed by Hive Metastore, and Iceberg External Catalog can be connected to an Iceberg cluster.</li></ol><p>You can use the <code>SWITCH</code> statement to switch catalogs. You can also conduct federated queries using fully qualified names. For example:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">SELECT * FROM hive.db1.tbl1 a JOIN iceberg.db2.tbl2 b</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ON a.k1 = b.k1;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>See more details <a href="https://doris.apache.org/docs/dev/lakehouse/multi-catalog/" target="_blank" rel="noopener noreferrer">here</a>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="extensible-metadata-connection-framework"><strong>Extensible Metadata Connection Framework</strong><a href="#extensible-metadata-connection-framework" class="hash-link" aria-label="Direct link to extensible-metadata-connection-framework" title="Direct link to extensible-metadata-connection-framework">‚Äã</a></h4><p>The introduction of the catalog level also enables users to add new data sources simply by using the <code>CREATE CATALOG</code> statement:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE CATALOG hive PROPERTIES (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;type&#x27;=&#x27;hms&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;hive.metastore.uris&#x27; = &#x27;thrift://172.21.0.1:7004&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In data lake scenarios, Apache Doris currently supports the following metadata services:</p><ul><li>Hive Metastore-compatible metadata services</li><li>Alibaba Cloud Data Lake Formation</li><li>AWS Glue</li></ul><p>This also paves the way for developers who want to connect to more data sources via External Catalog. All they need is to implement the access interface.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="efficient-metadata-access"><strong>Efficient Metadata Access</strong><a href="#efficient-metadata-access" class="hash-link" aria-label="Direct link to efficient-metadata-access" title="Direct link to efficient-metadata-access">‚Äã</a></h4><p>Access to external data sources is often hindered by network conditions and data resources. This requires extra efforts of a data query engine to guarantee reliability, stability, and real-timeliness in metadata access.</p><p><img loading="lazy" alt="metadata-access-Hive-MetaStore" src="https://cdnd.selectdb.com/assets/images/Lakehouse_3-9539a868abd98e4fa92881ef8c32b38a.png" width="1280" height="472" class="img_ev3q"></p><p>Doris enables high efficiency in metadata access by <strong>Meta Cache</strong>, which includes Schema Cache, Partition Cache, and File Cache. This means that Doris can respond to metadata queries on thousands of tables in milliseconds. In addition, Doris supports manual refresh of metadata at the Catalog/Database/Table level. Meanwhile, it enables auto synchronization of metadata in Hive Metastore by monitoring Hive Metastore Event, so any changes can be updated within seconds.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="custom-authorization"><strong>Custom Authorization</strong><a href="#custom-authorization" class="hash-link" aria-label="Direct link to custom-authorization" title="Direct link to custom-authorization">‚Äã</a></h4><p>External data sources usually come with their own privilege management services. Many companies use one single tool (such as Apache Ranger) to provide authorization for their multiple data systems. Doris supports a custom authorization plugin, which can be connected to the user&#x27;s own privilege management system via the Doris Access Controller interface. As a user, you only need to specify the authorization plugin for a newly created catalog, and then you can readily perform authorization, audit, and data encryption on external data in Doris.</p><p><img loading="lazy" alt="custom-authorization" src="https://cdnd.selectdb.com/assets/images/Lakehouse_4-1f3438ed8d88966a5352a85b1b479057.png" width="1280" height="568" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-access">Data Access<a href="#data-access" class="hash-link" aria-label="Direct link to Data Access" title="Direct link to Data Access">‚Äã</a></h3><p>Doris supports data access to external storage systems, including HDFS and S3-compatible object storage:</p><p><img loading="lazy" alt="access-to-external-storage-systems" src="https://cdnd.selectdb.com/assets/images/Lakehouse_5-3407cba9da2ea30688926b5e6ade10f5.png" width="1490" height="610" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="query-performance-optimization">Query Performance Optimization<a href="#query-performance-optimization" class="hash-link" aria-label="Direct link to Query Performance Optimization" title="Direct link to Query Performance Optimization">‚Äã</a></h2><p>After clearing the way for external data access, the next step for a query engine would be to accelerate data queries. In the case of Apache Doris, efforts are made in data reading, execution engine, and optimizer.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-reading"><strong>Data Reading</strong><a href="#data-reading" class="hash-link" aria-label="Direct link to data-reading" title="Direct link to data-reading">‚Äã</a></h3><p>Reading data on remote storage systems is often bottlenecked by access latency, concurrency, and I/O bandwidth, so reducing reading frequency will be a better choice.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="native-file-format-reader"><strong>Native File Format Reader</strong><a href="#native-file-format-reader" class="hash-link" aria-label="Direct link to native-file-format-reader" title="Direct link to native-file-format-reader">‚Äã</a></h4><p>Improving data reading efficiency entails optimizing the reading of Parquet files and ORC files, which are the most commonly seen data files. Doris has refactored its File Reader, which is fine-tuned for each data format. Take the Native Parquet Reader as an example:</p><ul><li><strong>Reduce format conversion</strong>: It can directly convert files to the Doris storage format or to a format of higher performance using dictionary encoding. </li><li><strong>Smart indexing of finer granularity</strong>: It supports Page Index for Parquet files, so it can utilize Page-level smart indexing to filter Pages. </li><li><strong>Predicate pushdown and late materialization</strong>: It first reads columns with filters first and then reads the other columns of the filtered rows. This remarkably reduces file read volume since it avoids reading irrelevant data.</li><li><strong>Lower read frequency</strong>: Building on the high throughput and low concurrency of remote storage, it combines multiple data reads into one in order to improve overall data reading efficiency.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="file-cache">File Cache<a href="#file-cache" class="hash-link" aria-label="Direct link to File Cache" title="Direct link to File Cache">‚Äã</a></h4><p>Doris caches files from remote storage in local high-performance disks as a way to reduce overhead and increase performance in data reading. In addition, it has developed two new features that make queries on remote files as quick as those on local files:</p><ol><li><strong>Block cache</strong>: Doris supports the block cache of remote files and can automatically adjust the block size from 4KB to 4MB based on the read request. The block cache method reduces read/write amplification and read latency in cold caches.</li><li><strong>Consistent hashing for caching</strong>: Doris applies consistent hashing to manage cache locations and schedule data scanning. By doing so, it prevents cache failures brought about by the online and offlining of nodes. It can also increase cache hit rate and query service stability.</li></ol><p><img loading="lazy" alt="file-cache" src="https://cdnd.selectdb.com/assets/images/Lakehouse_6-ab3642f54deb4b5f57694e0814a891a7.png" width="1080" height="638" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="execution-engine">Execution Engine<a href="#execution-engine" class="hash-link" aria-label="Direct link to Execution Engine" title="Direct link to Execution Engine">‚Äã</a></h4><p>Developers surely don&#x27;t want to rebuild all the general features for every new data source. Instead, they hope to reuse the vectorized execution engine and all operators in Doris in the data lakehouse scenario. Thus, Doris has refactored the scan nodes:</p><ul><li><strong>Layer the logic</strong>: All data queries in Doris, including those on internal tables, use the same operators, such as Join, Sort, and Agg. The only difference between queries on internal and external data lies in data access. In Doris, anything above the scan nodes follows the same query logic, while below the scan nodes, the implementation classes will take care of access to different data sources.</li><li><strong>Use a general framework for scan operators</strong>: Even for the scan nodes, different data sources have a lot in common, such as task splitting logic, scheduling of sub-tasks and I/O, predicate pushdown, and Runtime Filter. Therefore, Doris uses interfaces to handle them. Then, it implements a unified scheduling logic for all sub-tasks. The scheduler is in charge of all scanning tasks in the node. With global information of the node in hand, the schedular is able to do fine-grained management. Such a general framework makes it easy to connect a new data source to Doris, which will only take a week of work for one developer.</li></ul><p><img loading="lazy" alt="execution-engine" src="https://cdnd.selectdb.com/assets/images/Lakehouse_7-8e726de5b739f4532ff1c8a45055911e.png" width="830" height="844" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="query-optimizer">Query Optimizer<a href="#query-optimizer" class="hash-link" aria-label="Direct link to Query Optimizer" title="Direct link to Query Optimizer">‚Äã</a></h4><p>Doris supports a range of statistical information from various data sources, including Hive Metastore, Iceberg Metafile, and Hudi MetaTable. It has also refined its cost model inference based on the characteristics of different data sources to enhance its query planning capability. </p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="performance">Performance<a href="#performance" class="hash-link" aria-label="Direct link to Performance" title="Direct link to Performance">‚Äã</a></h4><p>We tested Doris and Presto/Trino on HDFS in flat table scenarios (ClickBench) and multi-table scenarios (TPC-H). Here are the results:</p><p><img loading="lazy" alt="Apache-Doris-VS-Trino-Presto-ClickBench" src="https://cdnd.selectdb.com/assets/images/Lakehouse_8-3fc3c0c72557dccb1dde18e02b88d155.png" width="1925" height="345" class="img_ev3q"></p><p><img loading="lazy" alt="Apache-Doris-VS-Trino-Presto-TPCH" src="https://cdnd.selectdb.com/assets/images/Lakehouse_9-07cdca2b93201425f7d2f7647c13c163.png" width="1688" height="421" class="img_ev3q"></p><p>As is shown, with the same computing resources and on the same dataset, Apache Doris takes much less time to respond to SQL queries in both scenarios, delivering a 3~10 times higher performance than Presto/Trino.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="workload-management-and-elastic-computing">Workload Management and Elastic Computing<a href="#workload-management-and-elastic-computing" class="hash-link" aria-label="Direct link to Workload Management and Elastic Computing" title="Direct link to Workload Management and Elastic Computing">‚Äã</a></h2><p>Querying external data sources requires no internal storage of Doris. This makes elastic stateless computing nodes possible. Apache Doris 2.0 is going to implement Elastic Compute Node, which is dedicated to supporting query workloads of external data sources.</p><p><img loading="lazy" alt="stateless-compute-nodes" src="https://cdnd.selectdb.com/assets/images/Lakehouse_10-96454cb74de1a358c1b94af7e9673f24.png" width="1960" height="884" class="img_ev3q"></p><p>Stateless computing nodes are open for quick scaling so users can easily cope with query workloads during peaks and valleys and strike a balance between performance and cost. In addition, Doris has optimized itself for Kubernetes cluster management and node scheduling. Now Master nodes can automatically manage the onlining and offlining of Elastic Compute Nodes, so users can govern their cluster workloads in cloud-native and hybrid cloud scenarios without difficulty.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="use-case">Use Case<a href="#use-case" class="hash-link" aria-label="Direct link to Use Case" title="Direct link to Use Case">‚Äã</a></h2><p>Apache Doris has been adopted by a financial institution for risk management. The user&#x27;s high demands for data timeliness makes their data mart built on Greenplum and CDH, which could only process data from one day ago, no longer a great fit. In 2022, they incorporated Apache Doris in their data production and application pipeline, which allowed them to perform federated queries across Elasticsearch, Greenplum, and Hive. A few highlights from the user&#x27;s feedback include:</p><ul><li>Doris allows them to create one Hive Catalog that maps to tens of thousands of external Hive tables and conducts fast queries on them.</li><li>Doris makes it possible to perform real-time federated queries using Elasticsearch Catalog and achieve a response time of mere milliseconds.</li><li>Doris enables the decoupling of daily batch processing and statistical analysis, bringing less resource consumption and higher system stability.</li></ul><p><img loading="lazy" alt="use-case-of-data-lakehouse" src="https://cdnd.selectdb.com/assets/images/Lakehouse_11-486b5f1ff26d1d7f20c70d4c4841e6ee.png" width="1510" height="882" class="img_ev3q"></p><h1>Future Plans</h1><p>Apache Doris is going to support a wider range of data sources, improve its data reading and write-back functionality, and optimizes its resource isolation and scheduling.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="more-data-sources">More Data Sources<a href="#more-data-sources" class="hash-link" aria-label="Direct link to More Data Sources" title="Direct link to More Data Sources">‚Äã</a></h2><p>We are working closely with various open source communities to expand and improve Doris&#x27; features in data lake analytics. We plan to provide:</p><ul><li>Support for Incremental Query of Hudi Merge-on-Read tables;</li><li>Lower query latency utilizing the indexing of Iceberg/Hudi in combination with the query optimizer;</li><li>Support for more data lake formats such as Delta Lake and Flink Table Store.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="data-integration">Data Integration<a href="#data-integration" class="hash-link" aria-label="Direct link to Data Integration" title="Direct link to Data Integration">‚Äã</a></h2><p> <strong>Data reading:</strong></p><p>Apache Doris is going to:</p><ul><li>Support CDC and Incremental Materialized Views for data lakes in order to provide users with near real-time data views;</li><li>Support a Git-Like data access mode and enable easier and safer data management via the multi-version and Branch mechanisms. </li></ul><p><strong>Data Write-Back:</strong></p><p>We are going to enhance Apache Doris&#x27; data analysis gateway. In the future, users will be able to use Doris as a unified data management portal that is in charge of the write-back of processed data, export of data, and the generation of a unified data view.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="resource-isolation--scheduling">Resource Isolation &amp; Scheduling<a href="#resource-isolation--scheduling" class="hash-link" aria-label="Direct link to Resource Isolation &amp; Scheduling" title="Direct link to Resource Isolation &amp; Scheduling">‚Äã</a></h2><p>Apache Doris is undertaking a wider variety of workloads as it is interfacing with more and more data sources. For example, it needs to provide low-latency online services while batch processing T-1 data in Hive. To make it work, resource isolation within the same cluster is critical, which is where efforts will be made.</p><p>Meanwhile, we will continue optimizing the scheduling logic of elastic computing nodes in various scenarios and develop intra-node resource isolation at a finer granularity, such as CPU, I/O, and memory. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="join-us">Join us<a href="#join-us" class="hash-link" aria-label="Direct link to Join us" title="Direct link to Join us">‚Äã</a></h2><p>Contact <a href="mailto:dev@apache.doris.org" target="_blank" rel="noopener noreferrer">dev@apache.doris.org</a> to join the Lakehouse SIG(Special Interest Group) in the Apache Doris community and talk to developers from all walks of life.</p><p><strong># Links:</strong></p><p><strong>Apache Doris:</strong></p><p><a href="http://doris.apache.org" target="_blank" rel="noopener noreferrer">http://doris.apache.org</a></p><p><strong>Apache Doris Github:</strong></p><p><a href="https://github.com/apache/doris" target="_blank" rel="noopener noreferrer">https://github.com/apache/doris</a></p><p>Find Apache Doris developers on <a href="https://join.slack.com/t/apachedoriscommunity/shared_invite/zt-2kl08hzc0-SPJe4VWmL_qzrFd2u2XYQA" target="_blank" rel="noopener noreferrer">Slack</a>.</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><div class="text-center mb-4"><a class="text-[#8592A6] cursor-pointer hover:no-underline" href="/blog">Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class="s-tags"><span class="s-tag">Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:text-[2.5rem] text-center" itemprop="headline"><a itemprop="url" href="/blog/ssb">Apache Doris 1.2 star-schema-benchmark performance test report</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class="authors"><span class="s-author text-black">Apache Doris</span></span><time datetime="2022-11-22T00:00:00.000Z" itemprop="datePublished" class="text-black ml-4">November 22, 2022</time></div></header><div class="markdown" itemprop="articleBody"><h1>Star Schema Benchmark</h1><p><a href="https://www.cs.umb.edu/~poneil/StarSchemaB.PDF" target="_blank" rel="noopener noreferrer">Star Schema Benchmark(SSB)</a> is a lightweight performance test set in the data warehouse scenario. SSB provides a simplified star schema data based on <a href="http://www.tpc.org/tpch/" target="_blank" rel="noopener noreferrer">TPC-H</a>, which is mainly used to test the performance of multi-table JOIN query under star schema.  In addition, the industry usually flattens SSB into a wide table model (Referred as: SSB flat) to test the performance of the query engine, refer to <a href="https://clickhouse.com/docs/zh/getting-started" target="_blank" rel="noopener noreferrer">Clickhouse</a>.</p><p>This document mainly introduces the performance of Doris on the SSB 100G test set.</p><blockquote><p>Note 1: The standard test set including SSB usually has a large gap with the actual business scenario, and some tests will perform parameter tuning for the test set. Therefore, the test results of the standard test set can only reflect the performance of the database in a specific scenario. It is recommended that users use actual business data for further testing.</p><p>Note 2: The operations involved in this document are all performed in the Ubuntu Server 20.04 environment, and CentOS 7 as well.</p></blockquote><p>With 13 queries on the SSB standard test data set, we conducted a comparison test based on Apache Doris 1.2.0-rc01, Apache Doris 1.1.3 and Apache Doris 0.15.0 RC04 versions.</p><p>On the SSB flat wide table, the overall performance of Apache Doris 1.2.0-rc01 has been improved by nearly 4 times compared with Apache Doris 1.1.3, and nearly 10 times compared with Apache Doris 0.15.0 RC04.</p><p>On the SQL test with standard SSB, the overall performance of Apache Doris 1.2.0-rc01 has been improved by nearly 2 times compared with Apache Doris 1.1.3, and nearly 31 times compared with Apache Doris 0.15.0 RC04.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-hardware-environment">1. Hardware Environment<a href="#1-hardware-environment" class="hash-link" aria-label="Direct link to 1. Hardware Environment" title="Direct link to 1. Hardware Environment">‚Äã</a></h2><table><thead><tr><th>Number of machines</th><th>4 Tencent Cloud Hosts (1 FE, 3 BEs)</th></tr></thead><tbody><tr><td>CPU</td><td>AMD EPYC‚Ñ¢ Milan (2.55GHz/3.5GHz) 16 Cores</td></tr><tr><td>Memory</td><td>64G</td></tr><tr><td>Network Bandwidth</td><td>7Gbps</td></tr><tr><td>Disk</td><td>High-performance Cloud Disk</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-software-environment">2. Software Environment<a href="#2-software-environment" class="hash-link" aria-label="Direct link to 2. Software Environment" title="Direct link to 2. Software Environment">‚Äã</a></h2><ul><li>Doris deployed 3BEs and 1FE;</li><li>Kernel version: Linux version 5.4.0-96-generic (buildd@lgw01-amd64-051)</li><li>OS version: Ubuntu Server 20.04 LTS 64-bit</li><li>Doris software versions: Apache Doris 1.2.0-rc01, Apache Doris 1.1.3 and Apache Doris 0.15.0 RC04</li><li>JDK: openjdk version &quot;11.0.14&quot; 2022-01-18</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-test-data-volume">3. Test Data Volume<a href="#3-test-data-volume" class="hash-link" aria-label="Direct link to 3. Test Data Volume" title="Direct link to 3. Test Data Volume">‚Äã</a></h2><table><thead><tr><th align="left">SSB Table Name</th><th align="left">Rows</th><th align="left">Annotation</th></tr></thead><tbody><tr><td align="left">lineorder</td><td align="left">600,037,902</td><td align="left">Commodity Order Details</td></tr><tr><td align="left">customer</td><td align="left">3,000,000</td><td align="left">Customer Information</td></tr><tr><td align="left">part</td><td align="left">1,400,000</td><td align="left">Parts Information</td></tr><tr><td align="left">supplier</td><td align="left">200,000</td><td align="left">Supplier Information</td></tr><tr><td align="left">date</td><td align="left">2,556</td><td align="left">Date</td></tr><tr><td align="left">lineorder_flat</td><td align="left">600,037,902</td><td align="left">Wide Table after Data Flattening</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-test-results">4. Test Results<a href="#4-test-results" class="hash-link" aria-label="Direct link to 4. Test Results" title="Direct link to 4. Test Results">‚Äã</a></h2><p>We use Apache Doris 1.2.0-rc01, Apache Doris 1.1.3 and Apache Doris 0.15.0 RC04 for comparative testing. The test results are as follows:</p><table><thead><tr><th>Query</th><th>Apache Doris 1.2.0-rc01(ms)</th><th>Apache Doris 1.1.3 (ms)</th><th>Doris 0.15.0 RC04 (ms)</th></tr></thead><tbody><tr><td>Q1.1</td><td>20</td><td>90</td><td>250</td></tr><tr><td>Q1.2</td><td>10</td><td>10</td><td>30</td></tr><tr><td>Q1.3</td><td>30</td><td>70</td><td>120</td></tr><tr><td>Q2.1</td><td>90</td><td>360</td><td>900</td></tr><tr><td>Q2.2</td><td>90</td><td>340</td><td>1,020</td></tr><tr><td>Q2.3</td><td>60</td><td>260</td><td>770</td></tr><tr><td>Q3.1</td><td>160</td><td>550</td><td>1,710</td></tr><tr><td>Q3.2</td><td>80</td><td>290</td><td>670</td></tr><tr><td>Q3.3</td><td>90</td><td>240</td><td>550</td></tr><tr><td>Q3.4</td><td>20</td><td>20</td><td>30</td></tr><tr><td>Q4.1</td><td>140</td><td>480</td><td>1,250</td></tr><tr><td>Q4.2</td><td>50</td><td>240</td><td>400</td></tr><tr><td>Q4.3</td><td>30</td><td>200</td><td>330</td></tr><tr><td>Total</td><td>880</td><td>3,150</td><td>8,030</td></tr></tbody></table><p><img loading="lazy" alt="ssb_v11_v015_compare" src="https://cdnd.selectdb.com/assets/images/ssb_flat-a8cfebbc53e6f2db116876e3d53e19c7.png" width="1522" height="674" class="img_ev3q"></p><p><strong>Interpretation of Results</strong></p><ul><li>The data set corresponding to the test results is scale 100, about 600 million.</li><li>The test environment is configured as the user&#x27;s common configuration, with 4 cloud servers, 16-core 64G SSD, and 1 FE, 3 BEs deployment.</li><li>We select the user&#x27;s common configuration test to reduce the cost of user selection and evaluation, but the entire test process will not consume so many hardware resources.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-standard-ssb-test-results">5. Standard SSB Test Results<a href="#5-standard-ssb-test-results" class="hash-link" aria-label="Direct link to 5. Standard SSB Test Results" title="Direct link to 5. Standard SSB Test Results">‚Äã</a></h2><p>Here we use Apache Doris 1.2.0-rc01, Apache Doris 1.1.3 and Apache Doris 0.15.0 RC04 for comparative testing. In the test, we use Query TimeÔºàmsÔºâ as the main performance indicator. The test results are as follows:</p><table><thead><tr><th>Query</th><th>Apache Doris 1.2.0-rc01 (ms)</th><th>Apache Doris 1.1.3 (ms)</th><th>Doris 0.15.0 RC04 (ms)</th></tr></thead><tbody><tr><td>Q1.1</td><td>40</td><td>18</td><td>350</td></tr><tr><td>Q1.2</td><td>30</td><td>100</td><td>80</td></tr><tr><td>Q1.3</td><td>20</td><td>70</td><td>80</td></tr><tr><td>Q2.1</td><td>350</td><td>940</td><td>20,680</td></tr><tr><td>Q2.2</td><td>320</td><td>750</td><td>18,250</td></tr><tr><td>Q2.3</td><td>300</td><td>720</td><td>14,760</td></tr><tr><td>Q3.1</td><td>650</td><td>2,150</td><td>22,190</td></tr><tr><td>Q3.2</td><td>260</td><td>510</td><td>8,360</td></tr><tr><td>Q3.3</td><td>220</td><td>450</td><td>6,200</td></tr><tr><td>Q3.4</td><td>60</td><td>70</td><td>160</td></tr><tr><td>Q4.1</td><td>840</td><td>1,480</td><td>24,320</td></tr><tr><td>Q4.2</td><td>460</td><td>560</td><td>6,310</td></tr><tr><td>Q4.3</td><td>610</td><td>660</td><td>10,170</td></tr><tr><td>Total</td><td>4,160</td><td>8,478</td><td>131,910</td></tr></tbody></table><p><img loading="lazy" alt="ssb_12_11_015" src="https://cdnd.selectdb.com/assets/images/ssb-6f7fc8825356019f61622f6fcb9fa1d0.png" width="1354" height="728" class="img_ev3q"></p><p><strong>Interpretation of Results</strong></p><ul><li>The data set corresponding to the test results is scale 100, about 600 million.</li><li>The test environment is configured as the user&#x27;s common configuration, with 4 cloud servers, 16-core 64G SSD, and 1 FE 3 BEs deployment.</li><li>We select the user&#x27;s common configuration test to reduce the cost of user selection and evaluation, but the entire test process will not consume so many hardware resources.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-environment-preparation">6. Environment Preparation<a href="#6-environment-preparation" class="hash-link" aria-label="Direct link to 6. Environment Preparation" title="Direct link to 6. Environment Preparation">‚Äã</a></h2><p>Please first refer to the <!-- -->[official documentation]<!-- -->(. /install/install-deploy.md) to install and deploy Apache Doris first to obtain a Doris cluster which is working well(including at least 1 FE 1 BE, 1 FE 3 BEs is recommended).</p><p>The scripts mentioned in the following documents are stored in the Apache Doris codebase: <a href="https://github.com/apache/doris/tree/master/tools/ssb-tools" target="_blank" rel="noopener noreferrer">ssb-tools</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="7-data-preparation">7. Data Preparation<a href="#7-data-preparation" class="hash-link" aria-label="Direct link to 7. Data Preparation" title="Direct link to 7. Data Preparation">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="71-download-and-install-the-ssb-data-generation-tool">7.1 Download and Install the SSB Data Generation Tool.<a href="#71-download-and-install-the-ssb-data-generation-tool" class="hash-link" aria-label="Direct link to 7.1 Download and Install the SSB Data Generation Tool." title="Direct link to 7.1 Download and Install the SSB Data Generation Tool.">‚Äã</a></h3><p>Execute the following script to download and compile the <a href="https://github.com/electrum/ssb-dbgen.git" target="_blank" rel="noopener noreferrer">ssb-dbgen</a> tool.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sh</span><span class="token plain"> build-ssb-dbgen.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After successful installation, the <code>dbgen</code> binary will be generated under the <code>ssb-dbgen/</code> directory.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="72-generate-ssb-test-set">7.2 Generate SSB Test Set<a href="#72-generate-ssb-test-set" class="hash-link" aria-label="Direct link to 7.2 Generate SSB Test Set" title="Direct link to 7.2 Generate SSB Test Set">‚Äã</a></h3><p>Execute the following script to generate the SSB dataset:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sh</span><span class="token plain"> gen-ssb-data.sh -s </span><span class="token number">100</span><span class="token plain"> -c </span><span class="token number">100</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>Note 1: Check the script help via <code>sh gen-ssb-data.sh -h</code>.</p><p>Note 2: The data will be generated under the <code>ssb-data/</code> directory with the suffix <code>.tbl</code>. The total file size is about 60GB and may need a few minutes to an hour to generate.</p><p>Note 3: <code>-s 100</code> indicates that the test set size factor is 100, <code>-c 100</code> indicates that 100 concurrent threads generate the data of the lineorder table. The <code>-c</code> parameter also determines the number of files in the final lineorder table. The larger the parameter, the larger the number of files and the smaller each file.</p></blockquote><p>With the <code>-s 100</code> parameter, the resulting dataset size is:</p><table><thead><tr><th>Table</th><th>Rows</th><th>Size</th><th>File Number</th></tr></thead><tbody><tr><td>lineorder</td><td>600,037,902</td><td>60GB</td><td>100</td></tr><tr><td>customer</td><td>3,000,000</td><td>277M</td><td>1</td></tr><tr><td>part</td><td>1,400,000</td><td>116M</td><td>1</td></tr><tr><td>supplier</td><td>200,000</td><td>17M</td><td>1</td></tr><tr><td>date</td><td>2,556</td><td>228K</td><td>1</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="73-create-table">7.3 Create Table<a href="#73-create-table" class="hash-link" aria-label="Direct link to 7.3 Create Table" title="Direct link to 7.3 Create Table">‚Äã</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="731-prepare-the-doris-clusterconf-file">7.3.1 Prepare the <code>doris-cluster.conf</code> File.<a href="#731-prepare-the-doris-clusterconf-file" class="hash-link" aria-label="Direct link to 731-prepare-the-doris-clusterconf-file" title="Direct link to 731-prepare-the-doris-clusterconf-file">‚Äã</a></h4><p>Before import the script, you need to write the FE‚Äôs ip port and other information in the <code>doris-cluster.conf</code> file.</p><p>The file location is at the same level as <code>load-ssb-dimension-data.sh</code>.</p><p>The content of the file includes FE&#x27;s ip, HTTP port, user name, password and the DB name of the data to be imported:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">FE_HOST</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;xxx&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">FE_HTTP_PORT</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;8030&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">FE_QUERY_PORT</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;9030&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:rgb(189, 147, 249);font-style:italic">USER</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;root&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">PASSWORD</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;xxx&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">DB</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;ssb&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="732-execute-the-following-script-to-generate-and-create-the-ssb-table">7.3.2 Execute the Following Script to Generate and Create the SSB Table:<a href="#732-execute-the-following-script-to-generate-and-create-the-ssb-table" class="hash-link" aria-label="Direct link to 7.3.2 Execute the Following Script to Generate and Create the SSB Table:" title="Direct link to 7.3.2 Execute the Following Script to Generate and Create the SSB Table:">‚Äã</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sh</span><span class="token plain"> create-ssb-tables.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Or copy the table creation statements in <a href="https://github.com/apache/incubator-doris/tree/master/tools/ssb-tools/ddl/create-ssb-tables.sql" target="_blank" rel="noopener noreferrer">create-ssb-tables.sql</a> and <a href="https://github.com/apache/incubator-doris/tree/master/tools/ssb-tools/ddl/create-ssb-flat-table.sql" target="_blank" rel="noopener noreferrer"> create-ssb-flat-table.sql</a> and then execute them in the MySQL client.</p><p>The following is the <code>lineorder_flat</code> table build statement. Create the <code>lineorder_flat</code> table in the above <code>create-ssb-flat-table.sh</code> script, and perform the default number of buckets (48 buckets). You can delete this table and adjust the number of buckets according to your cluster scale node configuration, so as to obtain a better test result.</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">lineorder_flat</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_ORDERDATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_ORDERKEY</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">11</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_LINENUMBER</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">tinyint</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_CUSTKEY</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">11</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_PARTKEY</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">11</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_SUPPKEY</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">11</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_ORDERPRIORITY</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_SHIPPRIORITY</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">tinyint</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_QUANTITY</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">tinyint</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_EXTENDEDPRICE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">11</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_ORDTOTALPRICE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">11</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_DISCOUNT</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">tinyint</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_REVENUE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">11</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_SUPPLYCOST</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">11</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_TAX</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">tinyint</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_COMMITDATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_SHIPMODE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">C_NAME</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">C_ADDRESS</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">C_CITY</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">C_NATION</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">C_REGION</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">C_PHONE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">C_MKTSEGMENT</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">S_NAME</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">S_ADDRESS</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">S_CITY</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">S_NATION</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">S_REGION</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">S_PHONE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">P_NAME</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">P_MFGR</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">P_CATEGORY</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">P_BRAND</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">P_COLOR</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">P_TYPE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">P_SIZE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">tinyint</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">P_CONTAINER</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ENGINE</span><span class="token operator">=</span><span class="token plain">OLAP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DUPLICATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_ORDERDATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_ORDERKEY</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;OLAP&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> RANGE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_ORDERDATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p1 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;0000-01-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;1993-01-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p2 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;1993-01-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;1994-01-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p3 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;1994-01-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;1995-01-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p4 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;1995-01-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;1996-01-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p5 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;1996-01-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;1997-01-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p6 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;1997-01-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;1998-01-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p7 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;1998-01-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;1999-01-01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_ORDERKEY</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">48</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">&quot;replication_num&quot;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;1&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">&quot;colocate_with&quot;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;groupxx1&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">&quot;in_memory&quot;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;false&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">&quot;storage_format&quot;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;DEFAULT&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="74-import-data">7.4 Import data<a href="#74-import-data" class="hash-link" aria-label="Direct link to 7.4 Import data" title="Direct link to 7.4 Import data">‚Äã</a></h3><p>We use the following command to complete all data import of SSB test set and SSB FLAT wide table data synthesis and then import into the table.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sh</span><span class="token plain"> bin/load-ssb-data.sh -c </span><span class="token number">10</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>-c 5</code> means start 10 concurrent threads to import (5 by default). In the case of a single BE node, the lineorder data generated by <code>sh gen-ssb-data.sh -s 100 -c 100</code> will also generate the data of the ssb-flat table in the end. If more threads are enabled, the import speed can be accelerated. But it will cost extra memory.</p><blockquote><p>Notes.</p><ol><li><p>To get faster import speed, you can add <code>flush_thread_num_per_store=5</code> in be.conf and then restart BE. This configuration indicates the number of disk writing threads for each data directory, 2 by default. Larger data can improve write data throughput, but may increase IO Util. (Reference value: 1 mechanical disk, with 2 by default, the IO Util during the import process is about 12%. When it is set to 5, the IO Util is about 26%. If it is an SSD disk, it is almost 0%) .</p></li><li><p>The flat table data is imported by &#x27;INSERT INTO ... SELECT ... &#x27;.</p></li></ol></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="75-checking-imported-data">7.5 Checking Imported data<a href="#75-checking-imported-data" class="hash-link" aria-label="Direct link to 7.5 Checking Imported data" title="Direct link to 7.5 Checking Imported data">‚Äã</a></h3><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> part</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> customer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> supplier</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> lineorder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> lineorder_flat</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The amount of data should be consistent with the number of rows of generated data.</p><table><thead><tr><th>Table</th><th>Rows</th><th>Origin Size</th><th>Compacted Size(1 Replica)</th></tr></thead><tbody><tr><td>lineorder_flat</td><td>600,037,902</td><td></td><td>59.709 GB</td></tr><tr><td>lineorder</td><td>600,037,902</td><td>60 GB</td><td>14.514 GB</td></tr><tr><td>customer</td><td>3,000,000</td><td>277 MB</td><td>138.247 MB</td></tr><tr><td>part</td><td>1,400,000</td><td>116 MB</td><td>12.759 MB</td></tr><tr><td>supplier</td><td>200,000</td><td>17 MB</td><td>9.143 MB</td></tr><tr><td>date</td><td>2,556</td><td>228 KB</td><td>34.276 KB</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="76-query-test">7.6 Query Test<a href="#76-query-test" class="hash-link" aria-label="Direct link to 7.6 Query Test" title="Direct link to 7.6 Query Test">‚Äã</a></h3><ul><li>SSB-Flat Query Statement: <a href="https://github.com/apache/doris/tree/master/tools/ssb-tools/ssb-flat-queries" target="_blank" rel="noopener noreferrer"> ssb-flat-queries</a></li><li>Standard SSB Queries: <a href="https://github.com/apache/doris/tree/master/tools/ssb-tools/ssb-queries" target="_blank" rel="noopener noreferrer"> ssb-queries</a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="761-ssb-flat-test-for-sql">7.6.1 SSB FLAT Test for SQL<a href="#761-ssb-flat-test-for-sql" class="hash-link" aria-label="Direct link to 7.6.1 SSB FLAT Test for SQL" title="Direct link to 7.6.1 SSB FLAT Test for SQL">‚Äã</a></h4><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">--Q1.1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_EXTENDEDPRICE </span><span class="token operator">*</span><span class="token plain"> LO_DISCOUNT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> revenue</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder_flat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain">  LO_ORDERDATE </span><span class="token operator">&gt;=</span><span class="token plain"> </span><span class="token number">19930101</span><span class="token plain">  </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">19931231</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> LO_DISCOUNT </span><span class="token operator">BETWEEN</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token number">3</span><span class="token plain">  </span><span class="token operator">AND</span><span class="token plain"> LO_QUANTITY </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">25</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q1.2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_EXTENDEDPRICE </span><span class="token operator">*</span><span class="token plain"> LO_DISCOUNT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> revenue</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder_flat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">&gt;=</span><span class="token plain"> </span><span class="token number">19940101</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">19940131</span><span class="token plain">  </span><span class="token operator">AND</span><span class="token plain"> LO_DISCOUNT </span><span class="token operator">BETWEEN</span><span class="token plain"> </span><span class="token number">4</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token number">6</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> LO_QUANTITY </span><span class="token operator">BETWEEN</span><span class="token plain"> </span><span class="token number">26</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token number">35</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q1.3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_EXTENDEDPRICE </span><span class="token operator">*</span><span class="token plain"> LO_DISCOUNT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> revenue</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder_flat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain">  weekofyear</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_ORDERDATE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">6</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">&gt;=</span><span class="token plain"> </span><span class="token number">19940101</span><span class="token plain">  </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">19941231</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> LO_DISCOUNT </span><span class="token operator">BETWEEN</span><span class="token plain"> </span><span class="token number">5</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token number">7</span><span class="token plain">  </span><span class="token operator">AND</span><span class="token plain"> LO_QUANTITY </span><span class="token operator">BETWEEN</span><span class="token plain"> </span><span class="token number">26</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token number">35</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q2.1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_REVENUE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_ORDERDATE </span><span class="token operator">DIV</span><span class="token plain"> </span><span class="token number">10000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> P_BRAND</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder_flat </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> P_CATEGORY </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;MFGR#12&#x27;</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> S_REGION </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;AMERICA&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> P_BRAND</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> P_BRAND</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q2.2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain">  </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_REVENUE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_ORDERDATE </span><span class="token operator">DIV</span><span class="token plain"> </span><span class="token number">10000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> P_BRAND</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder_flat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> P_BRAND </span><span class="token operator">&gt;=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;MFGR#2221&#x27;</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> P_BRAND </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;MFGR#2228&#x27;</span><span class="token plain">  </span><span class="token operator">AND</span><span class="token plain"> S_REGION </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;ASIA&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> P_BRAND</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> P_BRAND</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q2.3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_REVENUE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_ORDERDATE </span><span class="token operator">DIV</span><span class="token plain"> </span><span class="token number">10000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> P_BRAND</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder_flat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> P_BRAND </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;MFGR#2239&#x27;</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> S_REGION </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;EUROPE&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> P_BRAND</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> P_BRAND</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q3.1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> C_NATION</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> S_NATION</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_ORDERDATE </span><span class="token operator">DIV</span><span class="token plain"> </span><span class="token number">10000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_REVENUE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> revenue</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder_flat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> C_REGION </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;ASIA&#x27;</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> S_REGION </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;ASIA&#x27;</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">&gt;=</span><span class="token plain"> </span><span class="token number">19920101</span><span class="token plain">  </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">19971231</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> C_NATION</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> S_NATION</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ASC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> revenue </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DESC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q3.2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> C_CITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> S_CITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_ORDERDATE </span><span class="token operator">DIV</span><span class="token plain"> </span><span class="token number">10000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_REVENUE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> revenue</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder_flat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> C_NATION </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;UNITED STATES&#x27;</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> S_NATION </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;UNITED STATES&#x27;</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">&gt;=</span><span class="token plain"> </span><span class="token number">19920101</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">19971231</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> C_CITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> S_CITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ASC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> revenue </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DESC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q3.3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> C_CITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> S_CITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_ORDERDATE </span><span class="token operator">DIV</span><span class="token plain"> </span><span class="token number">10000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_REVENUE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> revenue</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder_flat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> C_CITY </span><span class="token operator">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;UNITED KI1&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;UNITED KI5&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> S_CITY </span><span class="token operator">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;UNITED KI1&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;UNITED KI5&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">&gt;=</span><span class="token plain"> </span><span class="token number">19920101</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">19971231</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> C_CITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> S_CITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ASC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> revenue </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DESC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q3.4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> C_CITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> S_CITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_ORDERDATE </span><span class="token operator">DIV</span><span class="token plain"> </span><span class="token number">10000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_REVENUE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> revenue</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder_flat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> C_CITY </span><span class="token operator">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;UNITED KI1&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;UNITED KI5&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> S_CITY </span><span class="token operator">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;UNITED KI1&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;UNITED KI5&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">&gt;=</span><span class="token plain"> </span><span class="token number">19971201</span><span class="token plain">  </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">19971231</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> C_CITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> S_CITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ASC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> revenue </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DESC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q4.1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_ORDERDATE </span><span class="token operator">DIV</span><span class="token plain"> </span><span class="token number">10000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> C_NATION</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_REVENUE </span><span class="token operator">-</span><span class="token plain"> LO_SUPPLYCOST</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> profit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder_flat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> C_REGION </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;AMERICA&#x27;</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> S_REGION </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;AMERICA&#x27;</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> P_MFGR </span><span class="token operator">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;MFGR#1&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;MFGR#2&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> C_NATION</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ASC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> C_NATION </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ASC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q4.2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_ORDERDATE </span><span class="token operator">DIV</span><span class="token plain"> </span><span class="token number">10000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">S_NATION</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> P_CATEGORY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_REVENUE </span><span class="token operator">-</span><span class="token plain"> LO_SUPPLYCOST</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> profit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder_flat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> C_REGION </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;AMERICA&#x27;</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> S_REGION </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;AMERICA&#x27;</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">&gt;=</span><span class="token plain"> </span><span class="token number">19970101</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">19981231</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> P_MFGR </span><span class="token operator">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;MFGR#1&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;MFGR#2&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> S_NATION</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> P_CATEGORY</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ASC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> S_NATION </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ASC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> P_CATEGORY </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ASC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q4.3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_ORDERDATE </span><span class="token operator">DIV</span><span class="token plain"> </span><span class="token number">10000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> S_CITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> P_BRAND</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_REVENUE </span><span class="token operator">-</span><span class="token plain"> LO_SUPPLYCOST</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> profit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder_flat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> S_NATION </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;UNITED STATES&#x27;</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">&gt;=</span><span class="token plain"> </span><span class="token number">19970101</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">19981231</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> P_CATEGORY </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;MFGR#14&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> S_CITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> P_BRAND</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ASC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> S_CITY </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ASC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> P_BRAND </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ASC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="762-ssb-standard-test-for-sql">7.6.2 SSB Standard Test for SQL<a href="#762-ssb-standard-test-for-sql" class="hash-link" aria-label="Direct link to 7.6.2 SSB Standard Test for SQL" title="Direct link to 7.6.2 SSB Standard Test for SQL">‚Äã</a></h4><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q1.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SELECT SUM(lo_extendedprice * lo_discount) AS REVENUE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM lineorder, dates</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WHERE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    lo_orderdate = d_datekey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND d_year = 1993</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND lo_discount BETWEEN 1 AND 3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND lo_quantity &lt; 25;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q1.2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SELECT SUM(lo_extendedprice * lo_discount) AS REVENUE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM lineorder, dates</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WHERE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    lo_orderdate = d_datekey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND d_yearmonth = &#x27;Jan1994&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND lo_discount BETWEEN 4 AND 6</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND lo_quantity BETWEEN 26 AND 35;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q1.3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SELECT</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    SUM(lo_extendedprice * lo_discount) AS REVENUE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM lineorder, dates</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WHERE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    lo_orderdate = d_datekey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND d_weeknuminyear = 6</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND d_year = 1994</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND lo_discount BETWEEN 5 AND 7</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND lo_quantity BETWEEN 26 AND 35;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q2.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SELECT SUM(lo_revenue), d_year, p_brand</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM lineorder, dates, part, supplier</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WHERE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    lo_orderdate = d_datekey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND lo_partkey = p_partkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND lo_suppkey = s_suppkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND p_category = &#x27;MFGR#12&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND s_region = &#x27;AMERICA&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">GROUP BY d_year, p_brand</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ORDER BY p_brand;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q2.2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SELECT SUM(lo_revenue), d_year, p_brand</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM lineorder, dates, part, supplier</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WHERE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    lo_orderdate = d_datekey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND lo_partkey = p_partkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND lo_suppkey = s_suppkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND p_brand BETWEEN &#x27;MFGR#2221&#x27; AND &#x27;MFGR#2228&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND s_region = &#x27;ASIA&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">GROUP BY d_year, p_brand</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ORDER BY d_year, p_brand;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q2.3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SELECT SUM(lo_revenue), d_year, p_brand</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM lineorder, dates, part, supplier</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WHERE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    lo_orderdate = d_datekey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND lo_partkey = p_partkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND lo_suppkey = s_suppkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND p_brand = &#x27;MFGR#2239&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND s_region = &#x27;EUROPE&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">GROUP BY d_year, p_brand</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ORDER BY d_year, p_brand;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q3.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SELECT</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    c_nation,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    s_nation,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    d_year,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    SUM(lo_revenue) AS REVENUE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM customer, lineorder, supplier, dates</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WHERE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    lo_custkey = c_custkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND lo_suppkey = s_suppkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND lo_orderdate = d_datekey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND c_region = &#x27;ASIA&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND s_region = &#x27;ASIA&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND d_year &gt;= 1992</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND d_year &lt;= 1997</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">GROUP BY c_nation, s_nation, d_year</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ORDER BY d_year ASC, REVENUE DESC;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q3.2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SELECT</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    c_city,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    s_city,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    d_year,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    SUM(lo_revenue) AS REVENUE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM customer, lineorder, supplier, dates</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WHERE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    lo_custkey = c_custkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND lo_suppkey = s_suppkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND lo_orderdate = d_datekey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND c_nation = &#x27;UNITED STATES&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND s_nation = &#x27;UNITED STATES&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND d_year &gt;= 1992</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND d_year &lt;= 1997</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">GROUP BY c_city, s_city, d_year</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ORDER BY d_year ASC, REVENUE DESC;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q3.3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SELECT</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    c_city,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    s_city,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    d_year,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    SUM(lo_revenue) AS REVENUE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM customer, lineorder, supplier, dates</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WHERE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    lo_custkey = c_custkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND lo_suppkey = s_suppkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND lo_orderdate = d_datekey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        c_city = &#x27;UNITED KI1&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        OR c_city = &#x27;UNITED KI5&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        s_city = &#x27;UNITED KI1&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        OR s_city = &#x27;UNITED KI5&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND d_year &gt;= 1992</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND d_year &lt;= 1997</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">GROUP BY c_city, s_city, d_year</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ORDER BY d_year ASC, REVENUE DESC;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q3.4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SELECT</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    c_city,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    s_city,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    d_year,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    SUM(lo_revenue) AS REVENUE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM customer, lineorder, supplier, dates</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WHERE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    lo_custkey = c_custkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND lo_suppkey = s_suppkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND lo_orderdate = d_datekey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        c_city = &#x27;UNITED KI1&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        OR c_city = &#x27;UNITED KI5&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        s_city = &#x27;UNITED KI1&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        OR s_city = &#x27;UNITED KI5&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND d_yearmonth = &#x27;Dec1997&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">GROUP BY c_city, s_city, d_year</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ORDER BY d_year ASC, REVENUE DESC;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q4.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SELECT /*+SET_VAR(parallel_fragment_exec_instance_num=4, enable_vectorized_engine=true, batch_size=4096, enable_cost_based_join_reorder=true, enable_projection=true) */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    d_year,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    c_nation,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    SUM(lo_revenue - lo_supplycost) AS PROFIT</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM dates, customer, supplier, part, lineorder</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WHERE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    lo_custkey = c_custkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND lo_suppkey = s_suppkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND lo_partkey = p_partkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND lo_orderdate = d_datekey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND c_region = &#x27;AMERICA&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND s_region = &#x27;AMERICA&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        p_mfgr = &#x27;MFGR#1&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        OR p_mfgr = &#x27;MFGR#2&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">GROUP BY d_year, c_nation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ORDER BY d_year, c_nation;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q4.2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SELECT /*+SET_VAR(parallel_fragment_exec_instance_num=2, enable_vectorized_engine=true, batch_size=4096, enable_cost_based_join_reorder=true, enable_projection=true) */  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    d_year,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    s_nation,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    p_category,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    SUM(lo_revenue - lo_supplycost) AS PROFIT</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM dates, customer, supplier, part, lineorder</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WHERE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    lo_custkey = c_custkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND lo_suppkey = s_suppkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND lo_partkey = p_partkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND lo_orderdate = d_datekey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND c_region = &#x27;AMERICA&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND s_region = &#x27;AMERICA&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        d_year = 1997</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        OR d_year = 1998</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        p_mfgr = &#x27;MFGR#1&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        OR p_mfgr = &#x27;MFGR#2&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">GROUP BY d_year, s_nation, p_category</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ORDER BY d_year, s_nation, p_category;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q4.3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SELECT /*+SET_VAR(parallel_fragment_exec_instance_num=2, enable_vectorized_engine=true, batch_size=4096, enable_cost_based_join_reorder=true, enable_projection=true) */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    d_year,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    s_city,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    p_brand,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    SUM(lo_revenue - lo_supplycost) AS PROFIT</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM dates, customer, supplier, part, lineorder</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WHERE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    lo_custkey = c_custkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND lo_suppkey = s_suppkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND lo_partkey = p_partkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND lo_orderdate = d_datekey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND s_nation = &#x27;UNITED STATES&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        d_year = 1997</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        OR d_year = 1998</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AND p_category = &#x27;MFGR#14&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">GROUP BY d_year, s_city, p_brand</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ORDER BY d_year, s_city, p_brand;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><div class="text-center mb-4"><a class="text-[#8592A6] cursor-pointer hover:no-underline" href="/blog">Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class="s-tags"><span class="s-tag">Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:text-[2.5rem] text-center" itemprop="headline"><a itemprop="url" href="/blog/tpch">Apache Doris 1.2 TPC-H performance test report</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class="authors"><span class="s-author text-black">Apache Doris</span></span><time datetime="2022-11-22T00:00:00.000Z" itemprop="datePublished" class="text-black ml-4">November 22, 2022</time></div></header><div class="markdown" itemprop="articleBody"><h1>TPC-H Benchmark</h1><p>TPC-H is a decision support benchmark (Decision Support Benchmark), which consists of a set of business-oriented special query and concurrent data modification. The data that is queried and populates the database has broad industry relevance. This benchmark demonstrates a decision support system that examines large amounts of data, executes highly complex queries, and answers key business questions. The performance index reported by TPC-H is called TPC-H composite query performance index per hour (QphH@Size), which reflects multiple aspects of the system&#x27;s ability to process queries. These aspects include the database size chosen when executing the query, the query processing capability when the query is submitted by a single stream, and the query throughput when the query is submitted by many concurrent users.</p><p>This document mainly introduces the performance of Doris on the TPC-H 100G test set.</p><blockquote><p>Note 1: The standard test set including TPC-H is usually far from the actual business scenario, and some tests will perform parameter tuning for the test set. Therefore, the test results of the standard test set can only reflect the performance of the database in a specific scenario. We suggest users use actual business data for further testing.</p><p>Note 2: The operations involved in this document are all tested on CentOS 7.x.</p></blockquote><p>On 22 queries on the TPC-H standard test data set, we conducted a comparison test based on Apache Doris 1.2.0-rc01, Apache Doris 1.1.3 and Apache Doris 0.15.0 RC04 versions. Compared with Apache Doris 1.1.3, the overall performance of Apache Doris 1.2.0-rc01 has been improved by nearly 3 times, and by nearly 11 times compared with Apache Doris 0.15.0 RC04.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-hardware-environment">1. Hardware Environment<a href="#1-hardware-environment" class="hash-link" aria-label="Direct link to 1. Hardware Environment" title="Direct link to 1. Hardware Environment">‚Äã</a></h2><table><thead><tr><th>Hardware</th><th>Configuration Instructions</th></tr></thead><tbody><tr><td>Number of mMachines</td><td>4 Tencent Cloud Virtual MachineÔºà1FEÔºå3BEsÔºâ</td></tr><tr><td>CPU</td><td>Intel Xeon(Cascade Lake) Platinum 8269CY  16C  (2.5 GHz/3.2 GHz)</td></tr><tr><td>Memory</td><td>64G</td></tr><tr><td>Network</td><td>5Gbps</td></tr><tr><td>Disk</td><td>ESSD Cloud Hard Disk</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-software-environment">2. Software Environment<a href="#2-software-environment" class="hash-link" aria-label="Direct link to 2. Software Environment" title="Direct link to 2. Software Environment">‚Äã</a></h2><ul><li>Doris Deployed 3BEs and 1FE</li><li>Kernel Version: Linux version 5.4.0-96-generic (buildd@lgw01-amd64-051)</li><li>OS version: CentOS 7.8</li><li>Doris software version: Apache Doris 1.2.0-rc01, Apache Doris 1.1.3 , Apache Doris 0.15.0 RC04</li><li>JDK: openjdk version &quot;11.0.14&quot; 2022-01-18</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-test-data-volume">3. Test Data Volume<a href="#3-test-data-volume" class="hash-link" aria-label="Direct link to 3. Test Data Volume" title="Direct link to 3. Test Data Volume">‚Äã</a></h2><p>The TPCH 100G data generated by the simulation of the entire test are respectively imported into Apache Doris 1.2.0-rc01, Apache Doris 1.1.3 and Apache Doris 0.15.0 RC04 for testing. The following is the relevant description and data volume of the table.</p><table><thead><tr><th align="left">TPC-H Table Name</th><th align="left">Rows</th><th>Size after Import</th><th align="left">Annotation</th></tr></thead><tbody><tr><td align="left">REGION</td><td align="left">5</td><td>400KB</td><td align="left">Region</td></tr><tr><td align="left">NATION</td><td align="left">25</td><td>7.714 KB</td><td align="left">Nation</td></tr><tr><td align="left">SUPPLIER</td><td align="left">1,000,000</td><td>85.528 MB</td><td align="left">Supplier</td></tr><tr><td align="left">PART</td><td align="left">20,000,000</td><td>752.330 MB</td><td align="left">Parts</td></tr><tr><td align="left">PARTSUPP</td><td align="left">20,000,000</td><td>4.375 GB</td><td align="left">Parts Supply</td></tr><tr><td align="left">CUSTOMER</td><td align="left">15,000,000</td><td>1.317 GB</td><td align="left">Customer</td></tr><tr><td align="left">ORDERS</td><td align="left">1,500,000,000</td><td>6.301 GB</td><td align="left">Orders</td></tr><tr><td align="left">LINEITEM</td><td align="left">6,000,000,000</td><td>20.882 GB</td><td align="left">Order Details</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-test-sql">4. Test SQL<a href="#4-test-sql" class="hash-link" aria-label="Direct link to 4. Test SQL" title="Direct link to 4. Test SQL">‚Äã</a></h2><p>TPCH 22 test query statements : <a href="https://github.com/apache/incubator-doris/tree/master/tools/tpch-tools/queries" target="_blank" rel="noopener noreferrer">TPCH-Query-SQL</a></p><p><strong>Notice:</strong></p><p>The following four parameters in the above SQL do not exist in Apache Doris 0.15.0 RC04. When executing, please remove:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. enable_vectorized_engine=true,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2. batch_size=4096,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3. disable_join_reorder=false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">4. enable_projection=true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-test-results">5. Test Results<a href="#5-test-results" class="hash-link" aria-label="Direct link to 5. Test Results" title="Direct link to 5. Test Results">‚Äã</a></h2><p>Here we use Apache Doris 1.2.0-rc01, Apache Doris 1.1.3 and Apache Doris 0.15.0 RC04 for comparative testing. In the test, we use Query Time(ms) as the main performance indicator. The test results are as follows:</p><table><thead><tr><th>Query</th><th>Apache Doris 1.2.0-rc01 (ms)</th><th>Apache Doris 1.1.3 (ms)</th><th>Apache Doris 0.15.0 RC04 (ms)</th></tr></thead><tbody><tr><td>Q1</td><td>2.12</td><td>3.75</td><td>28.63</td></tr><tr><td>Q2</td><td>0.20</td><td>4.22</td><td>7.88</td></tr><tr><td>Q3</td><td>0.62</td><td>2.64</td><td>9.39</td></tr><tr><td>Q4</td><td>0.61</td><td>1.5</td><td>9.3</td></tr><tr><td>Q5</td><td>1.05</td><td>2.15</td><td>4.11</td></tr><tr><td>Q6</td><td>0.08</td><td>0.19</td><td>0.43</td></tr><tr><td>Q7</td><td>0.58</td><td>1.04</td><td>1.61</td></tr><tr><td>Q8</td><td>0.72</td><td>1.75</td><td>50.35</td></tr><tr><td>Q9</td><td>3.61</td><td>7.94</td><td>16.34</td></tr><tr><td>Q10</td><td>1.26</td><td>1.41</td><td>5.21</td></tr><tr><td>Q11</td><td>0.15</td><td>0.35</td><td>1.72</td></tr><tr><td>Q12</td><td>0.21</td><td>0.57</td><td>5.39</td></tr><tr><td>Q13</td><td>2.62</td><td>8.15</td><td>20.88</td></tr><tr><td>Q14</td><td>0.16</td><td>0.3</td><td></td></tr><tr><td>Q15</td><td>0.30</td><td>0.66</td><td>1.86</td></tr><tr><td>Q16</td><td>0.38</td><td>0.79</td><td>1.32</td></tr><tr><td>Q17</td><td>0.65</td><td>1.51</td><td>26.67</td></tr><tr><td>Q18</td><td>2.28</td><td>3.364</td><td>11.77</td></tr><tr><td>Q19</td><td>0.20</td><td>0.829</td><td>1.71</td></tr><tr><td>Q20</td><td>0.21</td><td>2.77</td><td>5.2</td></tr><tr><td>Q21</td><td>1.17</td><td>4.47</td><td>10.34</td></tr><tr><td>Q22</td><td>0.46</td><td>0.9</td><td>3.22</td></tr><tr><td><strong>Total</strong></td><td><strong>19.64</strong></td><td><strong>51.253</strong></td><td><strong>223.33</strong></td></tr></tbody></table><p><img loading="lazy" alt="image-20220614114351241" src="https://cdnd.selectdb.com/assets/images/tpch-2048da37571ef8b1d4b0a49c3fba44ca.png" width="1526" height="726" class="img_ev3q"></p><ul><li><strong>Result Description</strong><ul><li>The data set corresponding to the test results is scale 100, about 600 million.</li><li>The test environment is configured as the user&#x27;s common configuration, with 4 cloud servers, 16-core 64G SSD, and 1 FE 3 BEs deployment.</li><li>Select the user&#x27;s common configuration test to reduce the cost of user selection and evaluation, but the entire test process will not consume so many hardware resources.</li><li>Apache Doris 0.15 RC04 failed to execute Q14 in the TPC-H test, unable to complete the query.</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-environmental-preparation">6. Environmental Preparation<a href="#6-environmental-preparation" class="hash-link" aria-label="Direct link to 6. Environmental Preparation" title="Direct link to 6. Environmental Preparation">‚Äã</a></h2><p>Please refer to the <a href="https://doris.apache.org/docs/install/cluster-deployment/standard-deployment/" target="_blank" rel="noopener noreferrer">official document</a> to install and deploy Doris to obtain a normal running Doris cluster (at least 1 FE 1 BE, 1 FE 3 BE is recommended).</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="7-data-preparation">7. Data Preparation<a href="#7-data-preparation" class="hash-link" aria-label="Direct link to 7. Data Preparation" title="Direct link to 7. Data Preparation">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="71-download-and-install-tpc-h-data-generation-tool">7.1 Download and Install TPC-H Data Generation Tool<a href="#71-download-and-install-tpc-h-data-generation-tool" class="hash-link" aria-label="Direct link to 7.1 Download and Install TPC-H Data Generation Tool" title="Direct link to 7.1 Download and Install TPC-H Data Generation Tool">‚Äã</a></h3><p>Execute the following script to download and compile the <a href="https://github.com/apache/incubator-doris/tree/master/tools/tpch-tools" target="_blank" rel="noopener noreferrer">tpch-tools</a> tool.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sh</span><span class="token plain"> build-tpch-dbgen.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After successful installation, the <code>dbgen</code> binary will be generated under the <code>TPC-H_Tools_v3.0.0/</code> directory.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="72-generating-the-tpc-h-test-set">7.2 Generating the TPC-H Test Set<a href="#72-generating-the-tpc-h-test-set" class="hash-link" aria-label="Direct link to 7.2 Generating the TPC-H Test Set" title="Direct link to 7.2 Generating the TPC-H Test Set">‚Äã</a></h3><p>Execute the following script to generate the TPC-H dataset:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sh</span><span class="token plain"> gen-tpch-data.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>Note 1: Check the script help via <code>sh gen-tpch-data.sh -h</code>.</p><p>Note 2: The data will be generated under the <code>tpch-data/</code> directory with the suffix <code>.tbl</code>. The total file size is about 100GB and may need a few minutes to an hour to generate.</p><p>Note 3: A standard test data set of 100G is generated by default.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="73-create-table">7.3 Create Table<a href="#73-create-table" class="hash-link" aria-label="Direct link to 7.3 Create Table" title="Direct link to 7.3 Create Table">‚Äã</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="731-prepare-the-doris-clusterconf-file">7.3.1 Prepare the <code>doris-cluster.conf</code> File<a href="#731-prepare-the-doris-clusterconf-file" class="hash-link" aria-label="Direct link to 731-prepare-the-doris-clusterconf-file" title="Direct link to 731-prepare-the-doris-clusterconf-file">‚Äã</a></h4><p>Before import the script, you need to write the FE‚Äôs ip port and other information in the <code>doris-cluster.conf</code> file.</p><p>The file location is at the same level as <code>load-tpch-data.sh</code>.</p><p>The content of the file includes FE&#x27;s ip, HTTP port, user name, password and the DB name of the data to be imported:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Any of FE host</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">FE_HOST</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;127.0.0.1&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># http_port in fe.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">FE_HTTP_PORT</span><span class="token operator">=</span><span class="token number">8030</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># query_port in fe.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">FE_QUERY_PORT</span><span class="token operator">=</span><span class="token number">9030</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Doris username</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:rgb(189, 147, 249);font-style:italic">USER</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;root&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Doris password</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">PASSWORD</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># The database where TPC-H tables located</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">DB</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;tpch1&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="execute-the-following-script-to-generate-and-create-tpc-h-table">Execute the Following Script to Generate and Create TPC-H Table<a href="#execute-the-following-script-to-generate-and-create-tpc-h-table" class="hash-link" aria-label="Direct link to Execute the Following Script to Generate and Create TPC-H Table" title="Direct link to Execute the Following Script to Generate and Create TPC-H Table">‚Äã</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sh</span><span class="token plain"> create-tpch-tables.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Or copy the table creation statement in <a href="https://github.com/apache/incubator-doris/blob/master/tools/tpch-tools/create-tpch-tables.sql" target="_blank" rel="noopener noreferrer">create-tpch-tables.sql</a> and excute it in Doris.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="74-import-data">7.4 Import Data<a href="#74-import-data" class="hash-link" aria-label="Direct link to 7.4 Import Data" title="Direct link to 7.4 Import Data">‚Äã</a></h3><p>Please perform data import with the following command:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sh</span><span class="token plain"> ./load-tpch-data.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="75-check-imported-data">7.5 Check Imported Data<a href="#75-check-imported-data" class="hash-link" aria-label="Direct link to 7.5 Check Imported Data" title="Direct link to 7.5 Check Imported Data">‚Äã</a></h3><p>Execute the following SQL statement to check that the imported data is consistent with the above data.</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain">  lineitem</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain">  orders</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain">  partsupp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain">  part</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain">  customer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain">  supplier</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain">  nation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain">  region</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain">  revenue0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="76-query-test">7.6 Query Test<a href="#76-query-test" class="hash-link" aria-label="Direct link to 7.6 Query Test" title="Direct link to 7.6 Query Test">‚Äã</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="761-executing-query-scripts">7.6.1 Executing Query Scripts<a href="#761-executing-query-scripts" class="hash-link" aria-label="Direct link to 7.6.1 Executing Query Scripts" title="Direct link to 7.6.1 Executing Query Scripts">‚Äã</a></h4><p>Execute the above test SQL or execute the following command</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">./run-tpch-queries.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>Notice:</p><ol><li><p>At present, the query optimizer and statistics functions of Doris are not so perfect, so we rewrite some queries in TPC-H to adapt to the execution framework of Doris, but it does not affect the correctness of the results</p></li><li><p>Doris&#x27; new query optimizer will be released in future versions</p></li><li><p>Set <code>set mem_exec_limit=8G</code> before executing the query</p></li></ol></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="762-single-sql-execution">7.6.2 Single SQL Execution<a href="#762-single-sql-execution" class="hash-link" aria-label="Direct link to 7.6.2 Single SQL Execution" title="Direct link to 7.6.2 Single SQL Execution">‚Äã</a></h4><p>The following is the SQL statement used in the test, you can also get the latest SQL from the code base.</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select /*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=8, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=false, enable_cost_based_join_reorder=false, enable_projection=false) */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_returnflag,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_linestatus,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sum(l_quantity) as sum_qty,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sum(l_extendedprice) as sum_base_price,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sum(l_extendedprice * (1 - l_discount)) as sum_disc_price,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sum(l_extendedprice * (1 - l_discount) * (1 + l_tax)) as sum_charge,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    avg(l_quantity) as avg_qty,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    avg(l_extendedprice) as avg_price,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    avg(l_discount) as avg_disc,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    count(*) as count_order</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    lineitem</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">where</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_shipdate &lt;= date &#x27;1998-12-01&#x27; - interval &#x27;90&#x27; day</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_returnflag,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_linestatus</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">order by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_returnflag,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_linestatus;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select /*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=1, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=true, enable_cost_based_join_reorder=false, enable_projection=true) */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    s_acctbal,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    s_name,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    n_name,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    p_partkey,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    p_mfgr,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    s_address,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    s_phone,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    s_comment</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    partsupp join</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        select</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            ps_partkey as a_partkey,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            min(ps_supplycost) as a_min</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            partsupp,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            part,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            supplier,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            nation,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            region</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        where</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            p_partkey = ps_partkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            and s_suppkey = ps_suppkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            and s_nationkey = n_nationkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            and n_regionkey = r_regionkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            and r_name = &#x27;EUROPE&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            and p_size = 15</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            and p_type like &#x27;%BRASS&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        group by a_partkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ) A on ps_partkey = a_partkey and ps_supplycost=a_min ,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    part,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    supplier,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    nation,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    region</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">where</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    p_partkey = ps_partkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and s_suppkey = ps_suppkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and p_size = 15</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and p_type like &#x27;%BRASS&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and s_nationkey = n_nationkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and n_regionkey = r_regionkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and r_name = &#x27;EUROPE&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">order by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    s_acctbal desc,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    n_name,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    s_name,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    p_partkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">limit 100;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select /*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=8, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=true, enable_cost_based_join_reorder=false, enable_projection=true, runtime_filter_wait_time_ms=10000) */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_orderkey,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sum(l_extendedprice * (1 - l_discount)) as revenue,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    o_orderdate,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    o_shippriority</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        select l_orderkey, l_extendedprice, l_discount, o_orderdate, o_shippriority, o_custkey from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        lineitem join orders</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        where l_orderkey = o_orderkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        and o_orderdate &lt; date &#x27;1995-03-15&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        and l_shipdate &gt; date &#x27;1995-03-15&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ) t1 join customer c </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    on c.c_custkey = t1.o_custkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    where c_mktsegment = &#x27;BUILDING&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_orderkey,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    o_orderdate,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    o_shippriority</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">order by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    revenue desc,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    o_orderdate</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">limit 10;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select /*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=4, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=true, enable_cost_based_join_reorder=false, enable_projection=true) */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    o_orderpriority,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    count(*) as order_count</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        select</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            lineitem</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        where l_commitdate &lt; l_receiptdate</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ) t1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    right semi join orders</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    on t1.l_orderkey = o_orderkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">where</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    o_orderdate &gt;= date &#x27;1993-07-01&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and o_orderdate &lt; date &#x27;1993-07-01&#x27; + interval &#x27;3&#x27; month</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    o_orderpriority</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">order by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    o_orderpriority;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q5</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select /*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=8, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=false, enable_cost_based_join_reorder=false, enable_projection=true) */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    n_name,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sum(l_extendedprice * (1 - l_discount)) as revenue</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    customer,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    orders,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    lineitem,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    supplier,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    nation,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    region</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">where</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    c_custkey = o_custkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and l_orderkey = o_orderkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and l_suppkey = s_suppkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and c_nationkey = s_nationkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and s_nationkey = n_nationkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and n_regionkey = r_regionkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and r_name = &#x27;ASIA&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and o_orderdate &gt;= date &#x27;1994-01-01&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and o_orderdate &lt; date &#x27;1994-01-01&#x27; + interval &#x27;1&#x27; year</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    n_name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">order by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    revenue desc;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q6</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select /*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=1, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=false, enable_cost_based_join_reorder=false, enable_projection=true) */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sum(l_extendedprice * l_discount) as revenue</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    lineitem</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">where</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_shipdate &gt;= date &#x27;1994-01-01&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and l_shipdate &lt; date &#x27;1994-01-01&#x27; + interval &#x27;1&#x27; year</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and l_discount between .06 - 0.01 and .06 + 0.01</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and l_quantity &lt; 24;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q7</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select /*+SET_VAR(exec_mem_limit=458589934592, parallel_fragment_exec_instance_num=2, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=false, enable_cost_based_join_reorder=false, enable_projection=true) */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    supp_nation,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cust_nation,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_year,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sum(volume) as revenue</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        select</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            n1.n_name as supp_nation,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            n2.n_name as cust_nation,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            extract(year from l_shipdate) as l_year,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            l_extendedprice * (1 - l_discount) as volume</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            supplier,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            lineitem,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            orders,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            customer,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            nation n1,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            nation n2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        where</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            s_suppkey = l_suppkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            and o_orderkey = l_orderkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            and c_custkey = o_custkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            and s_nationkey = n1.n_nationkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            and c_nationkey = n2.n_nationkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            and (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                (n1.n_name = &#x27;FRANCE&#x27; and n2.n_name = &#x27;GERMANY&#x27;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                or (n1.n_name = &#x27;GERMANY&#x27; and n2.n_name = &#x27;FRANCE&#x27;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            and l_shipdate between date &#x27;1995-01-01&#x27; and date &#x27;1996-12-31&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ) as shipping</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    supp_nation,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cust_nation,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_year</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">order by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    supp_nation,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cust_nation,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_year;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q8</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select /*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=8, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=true, enable_cost_based_join_reorder=false, enable_projection=true) */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    o_year,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sum(case</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        when nation = &#x27;BRAZIL&#x27; then volume</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        else 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    end) / sum(volume) as mkt_share</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        select</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            extract(year from o_orderdate) as o_year,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            l_extendedprice * (1 - l_discount) as volume,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            n2.n_name as nation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            lineitem,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            orders,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            customer,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            supplier,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            part,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            nation n1,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            nation n2,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            region</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        where</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            p_partkey = l_partkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            and s_suppkey = l_suppkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            and l_orderkey = o_orderkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            and o_custkey = c_custkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            and c_nationkey = n1.n_nationkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            and n1.n_regionkey = r_regionkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            and r_name = &#x27;AMERICA&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            and s_nationkey = n2.n_nationkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            and o_orderdate between date &#x27;1995-01-01&#x27; and date &#x27;1996-12-31&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            and p_type = &#x27;ECONOMY ANODIZED STEEL&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ) as all_nations</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    o_year</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">order by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    o_year;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q9</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select/*+SET_VAR(exec_mem_limit=37179869184, parallel_fragment_exec_instance_num=2, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=false, enable_cost_based_join_reorder=false, enable_projection=true, enable_remove_no_conjuncts_runtime_filter_policy=true, runtime_filter_wait_time_ms=100000) */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    nation,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    o_year,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sum(amount) as sum_profit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        select</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            n_name as nation,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            extract(year from o_orderdate) as o_year,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            lineitem join orders on o_orderkey = l_orderkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            join[shuffle] part on p_partkey = l_partkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            join[shuffle] partsupp on ps_partkey = l_partkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            join[shuffle] supplier on s_suppkey = l_suppkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            join[broadcast] nation on s_nationkey = n_nationkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        where</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            ps_suppkey = l_suppkey and </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            p_name like &#x27;%green%&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ) as profit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    nation,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    o_year</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">order by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    nation,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    o_year desc;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q10</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select /*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=4, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=true, enable_cost_based_join_reorder=false, enable_projection=true) */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    c_custkey,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    c_name,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sum(t1.l_extendedprice * (1 - t1.l_discount)) as revenue,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    c_acctbal,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    n_name,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    c_address,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    c_phone,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    c_comment</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    customer,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        select o_custkey,l_extendedprice,l_discount from lineitem, orders</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        where l_orderkey = o_orderkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        and o_orderdate &gt;= date &#x27;1993-10-01&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        and o_orderdate &lt; date &#x27;1993-10-01&#x27; + interval &#x27;3&#x27; month</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        and l_returnflag = &#x27;R&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ) t1,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    nation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">where</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    c_custkey = t1.o_custkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and c_nationkey = n_nationkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    c_custkey,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    c_name,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    c_acctbal,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    c_phone,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    n_name,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    c_address,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    c_comment</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">order by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    revenue desc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">limit 20;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q11</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select /*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=2, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=false, enable_cost_based_join_reorder=true, enable_projection=true) */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ps_partkey,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sum(ps_supplycost * ps_availqty) as value</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    partsupp,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    select s_suppkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    from supplier, nation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    where s_nationkey = n_nationkey and n_name = &#x27;GERMANY&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ) B</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">where</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ps_suppkey = B.s_suppkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ps_partkey having</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        sum(ps_supplycost * ps_availqty) &gt; (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            select</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                sum(ps_supplycost * ps_availqty) * 0.000002</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                partsupp,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                (select s_suppkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                 from supplier, nation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                 where s_nationkey = n_nationkey and n_name = &#x27;GERMANY&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                ) A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            where</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                ps_suppkey = A.s_suppkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">order by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    value desc;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q12</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select /*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=2, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=false, enable_cost_based_join_reorder=true, enable_projection=true) */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_shipmode,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sum(case</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        when o_orderpriority = &#x27;1-URGENT&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            or o_orderpriority = &#x27;2-HIGH&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            then 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        else 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    end) as high_line_count,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sum(case</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        when o_orderpriority &lt;&gt; &#x27;1-URGENT&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            and o_orderpriority &lt;&gt; &#x27;2-HIGH&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            then 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        else 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    end) as low_line_count</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    orders,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    lineitem</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">where</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    o_orderkey = l_orderkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and l_shipmode in (&#x27;MAIL&#x27;, &#x27;SHIP&#x27;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and l_commitdate &lt; l_receiptdate</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and l_shipdate &lt; l_commitdate</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and l_receiptdate &gt;= date &#x27;1994-01-01&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and l_receiptdate &lt; date &#x27;1994-01-01&#x27; + interval &#x27;1&#x27; year</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_shipmode</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">order by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_shipmode;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q13</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select /*+SET_VAR(exec_mem_limit=45899345920, parallel_fragment_exec_instance_num=16, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=true, enable_cost_based_join_reorder=true, enable_projection=true) */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    c_count,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    count(*) as custdist</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        select</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            c_custkey,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            count(o_orderkey) as c_count</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            orders right outer join customer on</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                c_custkey = o_custkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                and o_comment not like &#x27;%special%requests%&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        group by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            c_custkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ) as c_orders</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    c_count</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">order by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    custdist desc,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    c_count desc;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q14</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select /*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=8, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=true, enable_cost_based_join_reorder=true, enable_projection=true, runtime_filter_mode=OFF) */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    100.00 * sum(case</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        when p_type like &#x27;PROMO%&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            then l_extendedprice * (1 - l_discount)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        else 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    end) / sum(l_extendedprice * (1 - l_discount)) as promo_revenue</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    part,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    lineitem</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">where</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    l_partkey = p_partkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and l_shipdate &gt;= date &#x27;1995-09-01&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and l_shipdate &lt; date &#x27;1995-09-01&#x27; + interval &#x27;1&#x27; month;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q15</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select /*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=8, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=false, enable_cost_based_join_reorder=true, enable_projection=true) */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    s_suppkey,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    s_name,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    s_address,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    s_phone,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    total_revenue</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    supplier,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    revenue0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">where</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    s_suppkey = supplier_no</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and total_revenue = (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        select</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            max(total_revenue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            revenue0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">order by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    s_suppkey;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q16</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select /*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=8, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=false, enable_cost_based_join_reorder=true, enable_projection=true) */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    p_brand,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    p_type,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    p_size,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    count(distinct ps_suppkey) as supplier_cnt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    partsupp,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    part</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">where</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    p_partkey = ps_partkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and p_brand &lt;&gt; &#x27;Brand#45&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and p_type not like &#x27;MEDIUM POLISHED%&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and p_size in (49, 14, 23, 45, 19, 3, 36, 9)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and ps_suppkey not in (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        select</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            s_suppkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            supplier</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        where</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            s_comment like &#x27;%Customer%Complaints%&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    p_brand,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    p_type,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    p_size</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">order by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    supplier_cnt desc,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    p_brand,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    p_type,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    p_size;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q17</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select /*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=1, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=false, enable_cost_based_join_reorder=true, enable_projection=true) */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sum(l_extendedprice) / 7.0 as avg_yearly</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    lineitem join [broadcast]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    part p1 on p1.p_partkey = l_partkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">where</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    p1.p_brand = &#x27;Brand#23&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and p1.p_container = &#x27;MED BOX&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and l_quantity &lt; (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        select</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            0.2 * avg(l_quantity)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            lineitem join [broadcast]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            part p2 on p2.p_partkey = l_partkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        where</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            l_partkey = p1.p_partkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            and p2.p_brand = &#x27;Brand#23&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            and p2.p_container = &#x27;MED BOX&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    );</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q18</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select /*+SET_VAR(exec_mem_limit=45899345920, parallel_fragment_exec_instance_num=4, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=true, enable_cost_based_join_reorder=true, enable_projection=true) */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    c_name,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    c_custkey,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    t3.o_orderkey,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    t3.o_orderdate,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    t3.o_totalprice,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sum(t3.l_quantity)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">customer join</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  select * from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  lineitem join</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    select * from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    orders left semi join</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      select</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          l_orderkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          lineitem</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      group by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          l_orderkey having sum(l_quantity) &gt; 300</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ) t1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    on o_orderkey = t1.l_orderkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ) t2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  on t2.o_orderkey = l_orderkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">) t3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">on c_custkey = t3.o_custkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    c_name,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    c_custkey,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    t3.o_orderkey,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    t3.o_orderdate,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    t3.o_totalprice</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">order by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    t3.o_totalprice desc,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    t3.o_orderdate</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">limit 100;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q19</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select /*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=2, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=false, enable_cost_based_join_reorder=false, enable_projection=true) */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sum(l_extendedprice* (1 - l_discount)) as revenue</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    lineitem,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    part</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">where</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        p_partkey = l_partkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        and p_brand = &#x27;Brand#12&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        and p_container in (&#x27;SM CASE&#x27;, &#x27;SM BOX&#x27;, &#x27;SM PACK&#x27;, &#x27;SM PKG&#x27;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        and l_quantity &gt;= 1 and l_quantity &lt;= 1 + 10</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        and p_size between 1 and 5</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        and l_shipmode in (&#x27;AIR&#x27;, &#x27;AIR REG&#x27;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        and l_shipinstruct = &#x27;DELIVER IN PERSON&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    or</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        p_partkey = l_partkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        and p_brand = &#x27;Brand#23&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        and p_container in (&#x27;MED BAG&#x27;, &#x27;MED BOX&#x27;, &#x27;MED PKG&#x27;, &#x27;MED PACK&#x27;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        and l_quantity &gt;= 10 and l_quantity &lt;= 10 + 10</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        and p_size between 1 and 10</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        and l_shipmode in (&#x27;AIR&#x27;, &#x27;AIR REG&#x27;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        and l_shipinstruct = &#x27;DELIVER IN PERSON&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    or</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        p_partkey = l_partkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        and p_brand = &#x27;Brand#34&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        and p_container in (&#x27;LG CASE&#x27;, &#x27;LG BOX&#x27;, &#x27;LG PACK&#x27;, &#x27;LG PKG&#x27;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        and l_quantity &gt;= 20 and l_quantity &lt;= 20 + 10</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        and p_size between 1 and 15</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        and l_shipmode in (&#x27;AIR&#x27;, &#x27;AIR REG&#x27;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        and l_shipinstruct = &#x27;DELIVER IN PERSON&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    );</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q20</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select /*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=2, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=true, enable_cost_based_join_reorder=true, enable_projection=true, runtime_bloom_filter_size=551943) */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">s_name, s_address from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">supplier left semi join</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    select * from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        select l_partkey,l_suppkey, 0.5 * sum(l_quantity) as l_q</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        from lineitem</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        where l_shipdate &gt;= date &#x27;1994-01-01&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            and l_shipdate &lt; date &#x27;1994-01-01&#x27; + interval &#x27;1&#x27; year</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        group by l_partkey,l_suppkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ) t2 join</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        select ps_partkey, ps_suppkey, ps_availqty</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        from partsupp left semi join part</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        on ps_partkey = p_partkey and p_name like &#x27;forest%&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ) t1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    on t2.l_partkey = t1.ps_partkey and t2.l_suppkey = t1.ps_suppkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and t1.ps_availqty &gt; t2.l_q</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">) t3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">on s_suppkey = t3.ps_suppkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">join nation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">where s_nationkey = n_nationkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    and n_name = &#x27;CANADA&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">order by s_name;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q21</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select /*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=4, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=true, enable_cost_based_join_reorder=true, enable_projection=true) */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">s_name, count(*) as numwait</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  lineitem l2 right semi join</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    select * from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    lineitem l3 right anti join</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      select * from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      orders join lineitem l1 on l1.l_orderkey = o_orderkey and o_orderstatus = &#x27;F&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      join</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        select * from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        supplier join nation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        where s_nationkey = n_nationkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          and n_name = &#x27;SAUDI ARABIA&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ) t1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      where t1.s_suppkey = l1.l_suppkey and l1.l_receiptdate &gt; l1.l_commitdate</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ) t2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    on l3.l_orderkey = t2.l_orderkey and l3.l_suppkey &lt;&gt; t2.l_suppkey  and l3.l_receiptdate &gt; l3.l_commitdate</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ) t3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  on l2.l_orderkey = t3.l_orderkey and l2.l_suppkey &lt;&gt; t3.l_suppkey </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    t3.s_name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">order by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    numwait desc,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    t3.s_name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">limit 100;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--Q22</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">with tmp as (select</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    avg(c_acctbal) as av</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    customer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                where</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    c_acctbal &gt; 0.00</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    and substring(c_phone, 1, 2) in</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        (&#x27;13&#x27;, &#x27;31&#x27;, &#x27;23&#x27;, &#x27;29&#x27;, &#x27;30&#x27;, &#x27;18&#x27;, &#x27;17&#x27;))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select /*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=4,runtime_bloom_filter_size=4194304) */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cntrycode,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    count(*) as numcust,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sum(c_acctbal) as totacctbal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    select</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            substring(c_phone, 1, 2) as cntrycode,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            c_acctbal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             orders right anti join customer c on  o_custkey = c.c_custkey join tmp on c.c_acctbal &gt; tmp.av</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        where</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            substring(c_phone, 1, 2) in</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                (&#x27;13&#x27;, &#x27;31&#x27;, &#x27;23&#x27;, &#x27;29&#x27;, &#x27;30&#x27;, &#x27;18&#x27;, &#x27;17&#x27;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ) as custsale</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cntrycode</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">order by</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cntrycode;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><div class="text-center mb-4"><a class="text-[#8592A6] cursor-pointer hover:no-underline" href="/blog">Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class="s-tags"><span class="s-tag">Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:text-[2.5rem] text-center" itemprop="headline"><a itemprop="url" href="/blog/principle-of-Doris-Stream-Load">Doris stream load principle analysis</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class="authors"><span class="s-author text-black">Apache Doris</span></span><time datetime="2022-09-08T00:00:00.000Z" itemprop="datePublished" class="text-black ml-4">September 8, 2022</time></div></header><div class="markdown" itemprop="articleBody"><p><strong>LeadÔºö</strong></p><p>Stream Load, one of the most commonly used data import methods for Doris users, is a synchronous import method. It allows users to import data into Doris in batch through HTTP access and returns the results of data import. The user can not only directly judge whether the data import is successful through the return body of the HTTP request, but also query the results of historical tasks by executing query SQL on the client.</p><h1><strong>Introduction to Stream Load</strong></h1><p>The Doris import (Load) function is to import the user&#x27;s original data into the Doris table. And Doris realizes a unified streaming import framework at the bottom. On this basis, Doris provides a very rich import mode to adapt to different data sources and data import requirements. Stream Load is one of the most commonly used data import methods for Doris users. It is a synchronous import method that allows users to import data in CSV format or JSON format into Doris in batch through HTTP access and return the results of data import. User can directly judge whether the data import is successful through the return body of the HTTP request, and can query the results of historical tasks by executing query SQL on the client. In addition, Doris also provides the operation audit function for Stream Load, which can audit the historical Stream Load task information through the audit log. The implementation principle of Stream Load will be deeply analyzed from the aspects of execution process, transaction management, implementation of import plan, data writing and operation audit of Stream Load.</p><h1>1 Implementation Process</h1><p>The user submits the HTTP request of Stream Load to the FE, and the FE will forward the data import request to a BE node through HTTP Redirect, which will be the Coordinator of this Stream Load task. In this process, the FE node receiving the request only provides forwarding service. The BE node as the Coordinator is actually responsible for the entire import job, such as sending transaction requests to the Master FE, obtaining import execution plans from the FE, receiving real-time data, distributing data to other Executor BE nodes, and returning results to the user after data import. The user can also submit the HTTP request of Stream Load directly to a specified BE node, and the node will act as the Coordinator of this Stream Load task. During the Stream Load process, the Executor BE node is responsible for writing data to the storage layer.</p><p>In the Coordinator BE, all HTTP requests, including Stream Load requests, are processed through a thread pool. A Stream Load task is uniquely identified by the imported Label. The principle block diagram of Stream Load is shown in Figure 1.</p><p><img loading="lazy" src="https://cdnd.selectdb.com/assets/images/Figure_1_en-b2fe685555585338cf6207b8d24a878e.png" width="1080" height="1044" class="img_ev3q"></p><p>The complete execution process of Stream Load is shown in Figure 2:</p><p>(1)The user submits the HTTP request of Stream Load to the FE (the user can also directly submit the HTTP request of Stream Load to the Coordinator BE).</p><p>(2)FE, after receiving the Stream Load request submitted by the user, will perform HTTP Header parsing (including the library, table, Label and other information imported by parsing data), and then perform user authentication. If the HTTP Header is successfully resolved and the user authentication passes, the FE will forward the HTTP request of Stream Load to a BE node, which will be the Coordinator of this Stream Load. Otherwise, the FE will directly return the failure information of Stream Load to the user.</p><p>(3)After receiving the HTTP request from Stream Load, the Coordinator BE will first perform HTTP Header parsing and data verification, including the file format of the parsed data, the size of the data body, the HTTP timeout, and user authentication. If the Header data verification fails, the Stream Load failure information will be directly returned to the user.</p><p>(4)After the HTTP Header data verification is passed, the Coordinator BE will send a Begin Transaction request to the FE through Thrift RPC.</p><p>(5)After the FE receives the Begin Transaction request sent by the Coordinator BE, it will start a transaction and return the Transaction ID to the Coordinator BE.</p><p>(6)After the Coordinator BE receives the Begin Transaction success information, it will send a request to get the import plan to the FE through Thrift RPC.</p><p>(7)After receiving the request for obtaining the import plan sent by the Coordinator BE, the FE will generate the import plan for the Stream Load task and return it to the Coordinator BE.</p><p>(8)After receiving the import plan, the Coordinator BE starts to execute the import plan, including receiving the real-time data from HTTP and distributing the real-time data to other Executor BE through BRPC.</p><p>(9)After receiving the real-time data distributed by the Coordinator BE, the Executor BE is responsible for writing the data to the storage layer.</p><p>(10)After the Executor BE completes data writing, the Coordinator BE sends a Commit Transaction request to the FE through Thrift RPC.</p><p>(11)After receiving the Commit Transaction request sent by the Coordinator BE, the FE will commit transaction, send the Publish Version task to the Executor BE, and wait for the Executor BE to execute the Publish Version.</p><p>(12)The Executor BE asynchronously executes the Publish Version to change the Rowset generated by data import into a visible data version.</p><p>(13)After the Publish Version completes normally or the execution timeout, the FE returns the results of the Commit Transaction and the Publish Version to the Coordinator BE.</p><p>(14)The Coordinator BE returns the final result of Stream Load to the user.</p><p><img loading="lazy" src="https://cdnd.selectdb.com/assets/images/Figure_2_en-c2ea39e56fb64fa30ef649c281ee5e67.png" width="1068" height="1461" class="img_ev3q"></p><h1>2 Transaction Management</h1><p>Doris ensures the atomicity of data import through Transaction. One Stream Load task corresponds to one transaction. The FE is responsible for the transaction management of Stream Load. The FE receives the Thrift RPC transaction request sent by the Coordinator BE node through the FrontendService. Transaction request types include Begin Transaction, Commit Transaction and Rollback Transaction. The transaction states of Doris include PREPARE, COMMITTED, VISIBLE, and ABORTED. The status flow process of the Stream Load transaction is shown in Figure 3.</p><p><img loading="lazy" src="https://cdnd.selectdb.com/assets/images/Figure_3_en-afe100ea9995f8032cf312bb75825028.png" width="1080" height="165" class="img_ev3q"></p><p>The Coordinator BE node will send a Begin Transaction request to the FE before data import. The FE will check whether the label requested by the Begin Transaction already exists. If the label does not exist in the system, it will open a new transaction for the current label, assign a Transaction ID to the transaction, and set the transaction status to PREPARE, then returns the Transaction ID and the success information of the Begin Transaction to the Coordinator BE. Otherwise, this transaction may be a repeated data import. The FE returns the Begin Transaction failure message to the Coordinator BE, and the Stream Load task exits.</p><p>After the data is written in all Executor BE nodes, the Coordinator BE node will send a Commit Transaction request to the FE. After receiving the Commit Transaction request, the FE will execute the Commit Transaction and Publish Version operations. First, the FE will judge whether the number of replicas of data successfully written by each Tablet exceeds half of the total number of replicas of the tablet. If the number of replicas of data successfully written by each Tablet exceeds half of the total number of replicas of the Tablet (most of them are successful), the Commit Transaction is successful and the transaction status is set to COMMITTED; Otherwise, the Commit Transaction failure information is returned to the Coordinator BE. The COMMITTED status indicates that the data has been written successfully, but the data is not visible. You need to continue to execute the Publish Version task. After that, the transaction cannot be rolled back.</p><p>The FE will have a separate thread to execute the Publish Version on the Transaction with successful Commit. When the Publish Version is executed, the FE will send the Publish Version request to all Executor BE nodes related to the Transaction through Thrift RPC. The Publish Version task is executed asynchronously on each Executor BE node, and the Rowset generated by data import is changed into a visible data version. When all the Publish Version tasks on the Executor BE are successfully executed, the FE will set the transaction status to VISIBLE, and return the Commit Transaction and Publish Version success information to the Coordinator BE. When some Publish Version tasks fail, the FE will repeatedly issue a Publish Version request to the Executor BE node until the previously failed Publish Version task succeeds. If the transaction status has not been set to VISIBLE after a certain timeout period, the FE will return to the Coordinator BE the information that the Commit Transaction was successful but the Publish Version timed out (note that at this time, the data is still written successfully, but it is still invisible, and the user needs to wait for the transaction status to finally become VISIBLE).</p><p>When obtaining the import plan from the FE fails, executing data import fails, or Commit Transaction fails, the Coordinator BE node will send a Rollback Transaction request to the FE to execute transaction rollback. After receiving the transaction rollback request, the FE will set the transaction status to ABORTED, and send a Clear Transaction request to the Executor BE through Thrift RPC. The Clear Transaction task is asynchronously executed at the BE node, marking the Rowset generated by data import as unavailable. These Rowset will be deleted from the BE later. Transactions with COMMITTED status (transactions with Commit Transaction succeeded but Publish Version timed out) cannot be rolled back.</p><h1>3 Execution of the import plan</h1><p>In Doris BE, all execution plans are managed by FragmentMgr, and the execution of each import plan is managed by PlanFragmentExecutor. After the BE obtains the import execution plan from the FE, it will submit the import plan to the thread pool of FragmentMgr for execution. The import execution plan of Stream Load has only one Fragment, including one BrokerScanNode and one OlapTableSink. BrokerScanNode is responsible for reading streaming data in real time and converting the data lines in CSV format or JSON format to the Tuple format of Doris. OlapTableSink is responsible for sending real-time data to the corresponding Executor BE node. The Executor BE node corresponding to each data row is determined by which BE the Tablet where the data row is stored. The Partition and Tablet where the data row is stored can be determined according to the PartitionKey and DistributionKey of the data row. The BE node on which each Tablet and its replica are stored has been determined when the Table or Partition is created.</p><p>After importing the execution plan and submitting it to the thread pool of FragmentMgr, the Stream Load thread will receive the real-time data transmitted through HTTP in chunks and write it to the StreamLoadPipe. The BrokerScanNode will read the real-time data in batches from the StreamLoadPipe. OlapTableSink will send the batch data read by the BrokerScanNode to the Executor BE through BRPC for data writing. After all real-time data is written to the StreamLoadPipe, the Stream Load thread will wait for the import plan to finish.</p><p>The PlanFragmentExecutor executes a specific import plan process, which consists of three stages: Prepare, Open, and Close. In the Prepare stage, the import execution plan from the FE is mainly analyzed; In the Open stage, BrokerScanNode and OlapTableSink will be opened. BrokerScanNode is responsible for reading the real-time data of one Batch at a time, and OlapTableSink is responsible for calling BRPC to send the data of each Batch to other Executor BE nodes; In the Close stage, it is responsible for waiting for the data import to end and closing the BrokerScanNode and OlapTableSink. The import execution plan of Stream Load is shown in Figure 4.</p><p><img loading="lazy" src="https://cdnd.selectdb.com/assets/images/Figure_4_en-6bf14a31ea5acff82e83e5745a3603aa.png" width="1080" height="888" class="img_ev3q"></p><p>OlapTableSink is responsible for the data distribution of the Stream Load task. Tables in Doris may have Rollup or Materialized view. Each Table and its Rollup and Materialized view are called an Index. In the process of data distribution, the IndexChannel will maintain a data distribution channel of the Index. The Tablet under the Index may have multiple replicas and are distributed on different BE nodes. The NodeChannel will maintain the data distribution channel of an Executor BE node under the IndexChannel. Therefore, the OlapTableSink contains multiple IndexChannel, and each NodeChannel contains multiple NodeChannel, as shown in Figure 5.</p><p><img loading="lazy" src="https://cdnd.selectdb.com/assets/images/Figure_5_en-f040fee94a651a88a2a3ef68de235532.png" width="1080" height="471" class="img_ev3q"></p><p>When OlapTableSink distributes data, it will read the data Batch obtained by BrokerScanNode row by row, and add the data row to the IndexChannel of each Index. The Partition and Tablet of the data row can be determined according to the PartitionKey and DistributionKey, and then the corresponding Tablet of the data row in other Index can be calculated according to the order of the Tablet in the Partition. Each Tablet may have multiple replicas distributed on different BE nodes. Therefore, in the IndexChannel, each data row will be added to the NodeChannel corresponding to each replica of its Tablet. Each NodeChannel has a send queue. When the new data rows in NodeChannel accumulate to a certain size, they will be added to the send queue as a data Batch. There will be a fixed thread in OlapTableSink to train each NodeChannel under each IndexChannel in turn, and call BRPC to send a data Batch in the sending queue to the corresponding Executor BE. The data distribution process of the Stream Load task is shown in Figure 6.</p><p><img loading="lazy" src="https://cdnd.selectdb.com/assets/images/Figure_6_en-20cfadfbbb14b377e4a0debd6ef0bb1b.png" width="1080" height="850" class="img_ev3q"></p><h1>4 <strong>Data Write</strong></h1><p>After receiving the data Batch sent by the Coordinator BE, the BRPC server of the Executor BE will submit the data writing task to the thread pool for asynchronous execution. In Doris BE, data is written to the storage layer in a hierarchical manner. Each Stream Load task corresponds to a LoadChannel on each Executor BE. The LoadChannel maintains the data writing channel of a Stream Load task and is responsible for the data writing of a Stream Load task on the current Executor BE node, LoadChannel can write the data of a Stream Load task in the current BE node to the storage layer in batches until the Stream Load task is completed. Each LoadChannel is uniquely identified by the load ID, and all LoadChannel on the BE node are managed by LoadChannelMgr. The Table corresponding to a Stream Load task may have multiple Index. Each Index corresponds to a TabletsChannel, which is uniquely identified by the Index ID. Therefore, there will be multiple TabletsChannel under each LoadChannel. The TabletsChannel maintains an Index data writing channel, which is responsible for managing the data writing of all the Tablet under the Index. The TabletsChannel will read the data Batch row by row and write it to the corresponding Tablet through the DeltaWriter. The DeltaWriter maintains a data writing channel of a Tablet, which is uniquely identified by the Tablet ID. it is responsible for receiving the data import of a single Tablet and writing the data into the MemTable corresponding to the tablet. When the MemTable is full, the data in the MemTable will be flushed to the disk and Segment files will be generated. MemTable adopts the data structure of SkipList to temporarily store the data in memory. SkipList will sort the data rows according to the Key of Schema. In addition, if the data model is Aggregate or Unique, MemTable will aggregate data rows with the same Key. The data write channel of the Stream Load task is shown in Figure 7.</p><p><img loading="lazy" src="https://cdnd.selectdb.com/assets/images/Figure_7_en-757ccfec5d94537f5e85cc8026cc0d4a.png" width="1080" height="656" class="img_ev3q"></p><p>The Flush operation of MemTable is performed asynchronously by MemtableFlushExecutor. After the MemTable Flush task is submitted to the thread pool, a new MemTable will be generated to receive the subsequent data writing of the current Tablet. When the MemtableFlushExecutor performs data Flush, the RowsetWriter will read out all the data in the MemTable and write out multiple Segment files through the SegmentWriter. The size of each Segment file is no more than 256MB. For a Tablet, each Stream Load task will generate a newRowset. The generated Rowset can contain multiple Segment files. The data writing process of the Stream Load task is shown in Figure 8.</p><p><img loading="lazy" src="https://cdnd.selectdb.com/assets/images/Figure_8_en-11db5419d6ebd287d1abcb254fd174f0.png" width="1073" height="1280" class="img_ev3q"></p><p>The TxnManager on the Executor BE node is responsible for transaction management of Tablet level data import. When the Delta Writer is initialized, the PrepareTransaction will be executed to add the data write transaction of the corresponding Tablet in the current Stream Load task to the TxnManager for management. When the data write Tablet is completed and the DeltaWriter is closed, the Commit Transaction will be executed to add the new Rowset generated by the data import to the TxnManager for management. Note that the TxnManager here is only responsible for the transactions on a single BE, while the transaction management in the FE is responsible for the overall import of transactions.</p><p>After the data import is completed, when the Executor BE executes the Publish Version task issued by the FE, it will execute the Publish Transaction to change the new Rowset generated by the data import into a visible version, and delete the data writing task of the corresponding Tablet in the current Stream Load task from the TxnManager. This means that the data writing transaction of the Tablet in the current Stream Load task ends.</p><h1>5 <strong>Stream Load Operation Audit</strong></h1><p>Doris adds the operation audit function to Stream Load. After each Stream Load task is completed and the results are returned to the user, the Coordinator BE will persistently store the detailed information of this Stream Load task on the local RocksDB. The Master FE periodically pulls the information of the completed Stream Load task from each BE node of the cluster through Thrift RPC, pulls a batch of Stream Load operation records from one BE node at a time, and writes the pulled Stream Load task information into the audit log (fe.audit.log). Each Stream Load task information stored on the BE will be set with an expiration time (TTL), and the expired Stream Load task information will be deleted when RocksDB executes the Compaction. The user can audit the historical Stream Load task information through the FE audit log.</p><p>When the FE writes the pulled Stream Load task information into the Audit log, it will keep a copy in the memory. In order to prevent memory expansion, a fixed number of Stream Load task information will be kept in the memory. As the subsequent data pulling continues, the early Stream Load task information will be gradually eliminated from the FE memory. The user can query the latest Stream Load task information by executing the SHOW STREAM LOAD command at the client.</p><h1><strong>Summary</strong></h1><p>In this paper, the implementation principle of Stream Load is deeply analyzed from the aspects of execution process, transaction management, implementation of import plan, data writing and operation audit of Stream Load. Stream Load is one of the most commonly used data import methods for Doris users. It is a synchronous import method that allows users to import data into Doris in batch through HTTP access and return the results of data import. The user can not only directly judge whether the data import is successful through the return body of the HTTP request, but also query the results of historical tasks by executing query SQL on the client. Otherwise, Doris also provides the result audit function for Stream Load, which can audit the historical Stream Load task information through the audit log.</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><div class="text-center mb-4"><a class="text-[#8592A6] cursor-pointer hover:no-underline" href="/blog">Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class="s-tags"><span class="s-tag">Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:text-[2.5rem] text-center" itemprop="headline"><a itemprop="url" href="/blog/principle-of-Doris-SQL-parsing">Doris analysis: Doris SQL principle analysis</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class="authors"><span class="s-author text-black">Apache Doris</span></span><time datetime="2022-08-25T00:00:00.000Z" itemprop="datePublished" class="text-black ml-4">August 25, 2022</time></div></header><div class="markdown" itemprop="articleBody"><p><strong>LeadÔºö</strong>
This article mainly introduces the principle of Doris SQL parsing.</p><p>It focuses on generating a single-machine logical plan, developing a distributed logical plan, and generating a distributed physical plan. Analyze, SinglePlan, DistributedPlan, and Schedule four parts correspond to the code implementation.</p><p>First, AST will be processed preliminary by Analyze and then optimized by SinglePlan to generate a single-machine query plan. Third, DistributedPlan will split the single-machine query plan into distributed query plans. In the end, the query plan will be sent to machines and executed orderly, which decide by Schedule.</p><p>Since there are many types of SQL, this article focuses on the analysis of query SQL. Doris&#x27;s SQL analysis will be explained deeply in the algorithm principle and code implementation.</p><h1>1. Introduction to Doris</h1><p>Doris is an interactive SQL database based on MPP architecture, mainly used to solve near real-time reports and multi-dimensional analysis. The Doris architecture is straightforward, with only two types of processes.</p><ul><li><p>FrontendÔºàFEÔºâ: It is mainly responsible for user request access, query parsing and planning, storage and management of metadata, and node management-related work.</p></li><li><p>BackendÔºàBEÔºâ: It is mainly responsible for data storage and query plan execution.</p></li></ul><p>In Doris&#x27; storage engine, data will be horizontally divided into several data shards (Tablet, also called data bucket). Each tablet contains several rows of data. Multiple Tablets belong to different partitions logically. A Tablet only belongs to one Partition. And a Partition contains several Tablets. Tablet is the smallest physical storage unit for operations such as data movement, copying, etc.</p><h1>2. SQL parsing In Apache Doris</h1><p>SQL parsing in this article refers to <strong>the process of generating a complete physical execution plan after a series of parsing of an SQL statement</strong>.</p><p>This process includes the following four steps: lexical analysis, syntax analysis, generating a logical plan, and generating a physical plan.</p><p><img loading="lazy" src="https://cdnd.selectdb.com/assets/images/Figure_1_en-0c09f140305ed3879a5bdd86428f0f1c.png" width="1080" height="446" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="21-lexical-analysis">2.1 Lexical analysis<a href="#21-lexical-analysis" class="hash-link" aria-label="Direct link to 2.1 Lexical analysis" title="Direct link to 2.1 Lexical analysis">‚Äã</a></h2><p>The lexical analysis will identify the SQL in the form of a string into tokens, in preparation for the grammatical analysis.</p><div class="language-undefined codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-undefined codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">select ......  from ...... where ....... group by ..... order by ......</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SQL Tokens could be divided into the following categories:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ÔøÆ Keywords (select, from, where)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ÔøÆ operator (+, -, &gt;=)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ÔøÆ Open/close flag ((, CASE)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ÔøÆ placeholder (?)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ÔøÆ Comments</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ÔøÆ space</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">......</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="22-syntax-analysis">2.2 Syntax analysis<a href="#22-syntax-analysis" class="hash-link" aria-label="Direct link to 2.2 Syntax analysis" title="Direct link to 2.2 Syntax analysis">‚Äã</a></h2><p>The syntax analysis will convert the token generated by the lexical analysis into an abstract syntax tree based on the syntax rules, as shown in Figure 2.</p><p><img loading="lazy" src="https://cdnd.selectdb.com/assets/images/Figure_2_en-3288af3435350e506b2d1f6314172e64.png" width="1080" height="473" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="23-logical-plan">2.3 Logical plan<a href="#23-logical-plan" class="hash-link" aria-label="Direct link to 2.3 Logical plan" title="Direct link to 2.3 Logical plan">‚Äã</a></h2><p>The logical plan converts the abstract syntax tree into an algebraic relation, which is an operator tree, and each node represents a calculation method for data. The entire tree represents the calculation method and flows direction of data, as shown in Figure 3.</p><p> <img loading="lazy" src="https://cdnd.selectdb.com/assets/images/Figure_3_en-7a6ac1b525922fce20195f2224d176ad.png" width="573" height="893" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="24-physical-plan">2.4 Physical plan<a href="#24-physical-plan" class="hash-link" aria-label="Direct link to 2.4 Physical plan" title="Direct link to 2.4 Physical plan">‚Äã</a></h2><p>The physical plan is the plan that determines which computing operations are performed on which machines. It will be generated based on the logical plan, the distribution of machines, and the distribution of data.</p><p>The SQL parsing of the Doris system also adopts these steps, but it is refined and optimized according to the characteristics of the Doris system structure and the storage method of data to maximize the computing power of the machine.</p><h1>3. Design goals</h1><p>The design goals of the Doris SQL parsing architecture are:</p><ol><li><p>Maximize Computational Parallelism</p></li><li><p>Minimize network transfer of data</p></li><li><p>Minimize the amount of data that needs to be scanned</p></li></ol><h1>4. Architecture</h1><p>Doris SQL parsing includes five steps: lexical analysis, syntax analysis, generation of a stand-alone logical plan, generation of a distributed logical plan, and generation of a physical execution plan.</p><p>In terms of code implementation, it corresponds to the following five steps: Parse, Analyze, SinglePlan, DistributedPlan, and Schedule, which as shown in Figure 4.</p><p><img loading="lazy" src="https://cdnd.selectdb.com/assets/images/Figure_4_en-cd2aa449d728cd42554bbf7ddbdbaad6.png" width="1080" height="1682" class="img_ev3q"></p><p>The Parse phase will not be discussed in this article. Analyze will do some pre-processing of the AST. A stand-alone query plan will be optimized by SinglePlan based on the AST. DistributedPlan will split the stand-alone query plan into distributed query plans. Schedule phase will determine which machines the query plan will be sent to for execution.</p><p><strong>Since there are many types of SQL, this article focuses on the analysis of query SQL.</strong></p><p>Figure 5 shows a simple query SQL parsing implementation in Doris.</p><p><img loading="lazy" src="https://cdnd.selectdb.com/assets/images/Figure_5_en-cd3c8dd60e28999551acce60541797d2.png" width="1080" height="1344" class="img_ev3q"></p><h1>5. Parse Phase</h1><p>In the Parse stage, JFlex technology is used for lexical analysis, java cup parser technology is used for syntax analysis, and an ASTÔºàAbstract Syntax TreeÔºâwill finally generate. These are existing and mature technologies and will not be introduced in detail here.</p><p>AST has a tree-like structure, which represents a piece of SQL. Therefore, different types of queries -- select, insert, show, set, alter table, create table, etc. will generate additional data structures after Parse (SelectStmt, InsertStmt, ShowStmt, SetStmt, AlterStmt, AlterTableStmt, CreateTableStmt, etc.). However, they all inherit from Statements and will perform some specific processing according to their own grammar rules. For example: for select type SQL, the SelectStmt structure will be generated after Parse.</p><p>SelectStmt structure contains SelectList, FromClause, WhereClause, GroupByClause, SortInfo and other structures. These structures contain more basic data structures. For Example, WhereClause contains BetweenPredicate, BinaryPredicate, CompoundPredicate, InPredicate, and so on.</p><p>All structures in AST are composed of basic structure expressions--Expr by using various combinations, as shown in Figure 6.</p><p><img loading="lazy" src="https://cdnd.selectdb.com/assets/images/Figure_6_en-39088e65b97c95938d6cf9c1aba359e8.png" width="1080" height="718" class="img_ev3q"></p><h1>6. Analyze Phase</h1><p>Analyze will perform pre-processing and semantic analysis on the abstract syntax tree AST generated in the Parse phase, preparing for the generation of stand-alone logic plans.</p><p>The abstract class StatementBase represents the abstract syntax tree. This abstract class contains a most crucial member function--analyze(), which is used to perform what&#x27;s needed to do in Analyze phase.</p><p>Different types of queries (select, insert, show, set, alter table, create table, etc.) will generate different data structures through the Parse stage(SelectStmt, InsertStmt, ShowStmt, SetStmt, AlterStmt, AlterTableStmt, CreateTableStmt, etc.), these data structures inherit From StatementBase, and perform a specific Analysis on a specific type sof SQL by implementing the analyze() function.</p><p>For example, a query of select type will be converted into analyze() of the sub-statements SelectList, FromClause, GroupByClause, HavingClause, WhereClause, SortInfo, etc. of select SQL. Then these sub-statements further analyze() their sub-structures, and various scenarios of various types of SQL are analyzed by layer-by-layer iteration. For example, WhereClause will further explore the BetweenPredicate, BinaryPredicate, CompoundPredicate, InPredicate, etc., which it contains.</p><p><strong>For query type SQL, Analyze will performs several important steps:</strong></p><ul><li><p><strong>Metadata identification and parsing</strong>Ôºö Identify and parse metadata such as Cluster, Database, Table, Column, etc. involved in SQL, and determine which columns, tables, databases, and clusters need to be calculated.</p></li><li><p><strong>SQL correctness check</strong>Ôºösuch as the window function cannot DISTINCT, whether the projection column is ambiguous, the where statement cannot contain grouping operations, etc.</p></li><li><p><strong>Rewrite SQL simply</strong>Ôºöfor example, expand select * to select all columns, convert count distinct to bitmap or hll function, etc.</p></li><li><p><strong>Function correctness check</strong>ÔºöCheck whether the functions contained in SQL are consistent with the system-defined procedures, including parameter types, number of parameters, etc.</p></li><li><p><strong>Aliasing for Table and Column.</strong></p></li><li><p><strong>Type checking and conversion</strong>Ôºö For example, when the types on both sides of a binary expression are inconsistent, one of the types needs to be converted (with BIGINT and DECIMAL, the BIGINT type needs to be cast to DECIMAL).</p></li></ul><p>After analyzing the AST, a rewrite operation will be performed again to simplify or convert it into a unified processing method. A present rewrite algorithm is a rule-based approach. It will rewrite the AST with each rule from bottom to top, based on the tree structure of the AST. If the AST changes after rewriting, analysis and rewrite will start again until there is no change in the AST.</p><p>For example: simplification of constant expressions: 1 + 1 + 1 is rewritten as 3, 1 &gt; 2 is rewritten as Flase, etc. Convert some statements into a unified processing method, such as rewriting where in, where exists as semi join, where not in, where not exists as anti join.</p><h1>7. Generate stand-alone logical Plan phase</h1><p>At this stage, algebraic relations will be generated according to the AST abstract syntax tree, also known as the operator number. Each node on the tree is an operator, representing an operation.</p><p>As shown in Figure 7, ScanNode represents scan and read operations on a table. HashJoinNode represents the join operation. A hash table of a small table will be constructed in memory, and the large table will be traversed to find the exact value of the join key. Project means the projection operation, which represents the column that needs to be output at the end. Figure 7 shows that only citycode column will output.</p><p><img loading="lazy" src="https://cdnd.selectdb.com/assets/images/Figure_7_en-3b659a292f7c875ca9651197305c47ab.png" width="1080" height="543" class="img_ev3q"></p><p>Without optimization, the generated relational algebra is very expensive to send to storage and execute.</p><p>For query:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">siteid</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">pv </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> table1 a </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">join</span><span class="token plain"> table2 b </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">on</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">siteid </span><span class="token operator">=</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">siteid </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">citycode</span><span class="token operator">=</span><span class="token number">122216</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">username</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;test&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">pv </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">limit</span><span class="token plain"> </span><span class="token number">10</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As shown in Figure 8, for unoptimized relational algebra, all columns need to be read out for a series of calculations. In the end, siteid and pv column are selected and output. A large amount of useless column data wastes computing resources.</p><p>When Doris generates algebraic relations, a lot of optimizations are made: the projection columns and query conditions will be put into the scan operation as much as possible.</p><p><img loading="lazy" src="https://cdnd.selectdb.com/assets/images/Figure_8_en-021b337867f379cc036dfbe34f5fe9f8.png" width="500" height="1110" class="img_ev3q"></p><p><strong>Specifically, this phase mainly does the following tasks:</strong></p><ul><li><p><strong>Slot materialization</strong>ÔºöDetermine the column that needs to be scanned and calculated for the expression. Such as aggregate function expressions and Group By words of aggregate nodes need to be materialized.</p></li><li><p><strong>Projection pushdown</strong>ÔºöBE only scans the columns that must be read when Scanning.</p></li><li><p><strong>Predicate pushdown</strong>ÔºöPush down the filter conditions to the Scan node as much as possible under the premise of semantically correct.</p></li><li><p><strong>Partition, bucket cutting</strong>ÔºöAccording to the information in the filter conditions, determine which partitions and buckets of tablets need to be scanned.</p></li><li><p><strong>Join Reorder</strong>ÔºöFor Inner Join, Doris will adjust the order of the table according to the number of rows--put the large table in the front.</p></li><li><p><strong>Sort + Limit optimized to TopN</strong>ÔºöFor the order by the limit statement, it will be converted into TopN operation nodes, which is convenient for unified processing.</p></li><li><p><strong>MaterializedView selection</strong>: The best-materialized view will be selected according to the columns required by the query, the columns for filtering, sorting and Join, the number of rows, the number of columns, and other factors.</p></li></ul><p>Figure 9 shows an example of optimization. The optimization of Doris is carried out in generating relational algebra. Generating one will optimize one.¬∑ Projection pushdown: BE only scans the columns that must be read when Scanning.</p><p><img loading="lazy" src="https://cdnd.selectdb.com/assets/images/Figure_9_en-cceafd6d3dd41c1765b4dbbf3ce047e1.png" width="1080" height="290" class="img_ev3q"></p><h1>8 Generate Distributed Plan Phase</h1><p>After the single-machine PlanNode tree is generated, it needs to be split into a distributed PlanFragment tree (PlanFragment is used to represent an independent execution unit) according to the distributed environment. A table&#x27;s data is distributed across multiple hosts could allow some computations to be parallelized.</p><p>The primary purpose of this step is to maximize parallelism and data localization. The primary strategy is to split the nodes that can be executed in parallel and create a separate PlanFragment. ExchangeNodes will replace the split nodes to receive data. Finally, a DataSinkNode will be added to the split node to transmit the calculated data to the ExchangeNode for further processing.</p><p>This step adopts a recursive method, traverses the entire PlanNode tree from bottom to top, and then creates a PlanFragment for each leaf node on the tree. If the parent node is encountered, splitting the child nodes that can be executed in parallel will be considered.</p><p>For query operations, the join operation is the most common.</p><p><strong>Doris currently supports four join algorithms:</strong> broadcast join, hash partition join, colocate join, and bucket shuffle join.</p><p><strong>broadcast join</strong>ÔºöSend the small table to each machine where the large table is located and perform a hash join operation. When the amount of data scanned from a table is small, the cost of broadcast join will be calculated, and the method with the smallest cost will be selected by calculating and comparing the cost of hash partitions.</p><p><strong>hash partition join</strong>ÔºöWhen the data scanned from the two tables are both large, hash partition join is generally used. It traverses all the data in the table, calculates the hash value of the key, then modulizes the number of clusters, and whichever machine is selected, the data will be sent to this machine for hash join operation.</p><p><strong>colocate join</strong>ÔºöIf the data distribution of the two tables is specified to be consistent when they are created, the colocate join algorithm will be used when the join key of the two tables is the same as the bucket key. Since the data distribution of the two tables is the same, the hash join operation is equivalent to a local process. It does not involve data transmission, which significantly improves query performance.</p><p><strong>bucket shuffle join</strong>ÔºöWhen the join key is a bucketing key, and only one partition is involved, the bucket shuffle join algorithm is preferred. Since bucketing itself represents a way of dividing data, it only needs to take the hash modulo of the number of buckets from the right table to the left table, so that only one copy of the data in the right table needs to be transmitted over the network, which greatly reduces the network of data transmission, as shown in Figure 10.</p><p><img loading="lazy" src="https://cdnd.selectdb.com/assets/images/Figure_10_en-e99cc952e6ef7e1500565bffbd73da18.png" width="878" height="938" class="img_ev3q"></p><p>Figure 11 shows the core process of creating a distributed logical plan with a single-machine logical plan with HashJoinNode.</p><ul><li><p>For PlanNodes, PlanFragments are created bottom-up.</p></li><li><p>If it is a ScanNode, PlanFragment will be created directly, and the RootPlanNode of the PlanFragment is this ScanNode.</p></li><li><p>If it is a HashJoinNode, the broadcastCost will be calculated at first, which could provide a reference for selecting boracast join or hash partition join.</p></li><li><p>Join algorithm will be chosen according to different conditions.</p></li><li><p>If colocate joins are used, since joins are all local, no splitting is required. Set the left child node of HashJoinNode as the RootPlanNode of leftFragment, and the right child node as the RootPlanNode of rightFragment, share a PlanFragment with leftFragment, and delete rightFragment.</p></li><li><p>If bucket shuffle join is used, data from the right table needs to be sent to the left table. So first create an ExchangeNode, set the left child node of HashJoinNode as the RootPlanNode of leftFragment, the right child node as this ExchangeNode, share a PlanFragment with leftFragment, and specify the destination of rightFragment data to be sent to this ExchangeNode.</p></li><li><p>If broadcast join is used, the data from the right table needs to be sent to the left table. So first create an ExchangeNode, set the left child node of HashJoinNode as the RootPlanNode of leftFragment, the right child node as this ExchangeNode, share a PlanFragment with leftFragment, and specify the destination of rightFragment data to be sent to this ExchangeNode.</p></li><li><p>If hash partition join is used, the data in the left table and the right table must be split, and both left and right nodes need to be split out to create left ExchangeNode and right ExchangeNode respectively. HashJoinNode specifies the left and right nodes as left ExchangeNode and right ExchangeNode. Create a PlanFragment separately and specify RootPlanNode as this HashJoinNode. Finally, specify the data sending destination of leftFragment and rightFragment as left ExchangeNode and right ExchangeNode.</p></li></ul><p><img loading="lazy" src="https://cdnd.selectdb.com/assets/images/Figure_11_en-df9efe7a2e23bc2caa676a52414ed916.png" width="1080" height="975" class="img_ev3q"></p><p>Figure 12 is an example after the join operation of two tables is converted into a PlanFragment tree, there are 3 PlanFragments generated. The final output data passes through the ResultSinkNode node.</p><p><img loading="lazy" src="https://cdnd.selectdb.com/assets/images/Figure_12_en-fc24ac9080f5429b9e7a871a34192f97.png" width="1080" height="1079" class="img_ev3q"></p><h1>9. Schedule phase</h1><p>This step is to create a distributed physical plan based on the distributed logical plan. will solve the following questions:</p><ul><li><p>Which BE executes which PlanFragment</p></li><li><p>Which replica to chooes for each Tablet to query</p></li><li><p>How to perform multi-instance concurrency</p></li></ul><p><strong>Figure 13 shows the core process for creating a distributed physical plan:</strong></p><p><strong>a. Prepare phase</strong>ÔºöCreate a FragmentExecParams structure for each PlanFragment to represent all the parameters required for PlanFragment execution; if a PlanFragment contains DataSinkNode, the destination PlanFragment for data transmission will be found, and specify the input of FragmentExecParams of the destination PlanFragment as FragmentExecParams of this PlanFragment.</p><p><strong>b. computeScanRangeAssignment phase</strong>ÔºöDifferent processing is performed for different types of joins.</p><ul><li><p>computeScanRangeAssignmentByColocate: For colocate join processing, since the data distribution in the two table buckets of the join is the same, they are based on the bucket join operation, so here is to determine which host is selected for each bucket. When allocating buckets to hosts, try to ensure that the buckets allocated to each host are even.</p></li><li><p>computeScanRangeAssignmentByBucket: Processing for bucket shuffle join, which is only based on bucket operations, so here is to determine which host is selected for each bucket. When allocating buckets to hosts, it is also necessary to try to ensure that the buckets allocated to each host are even.</p></li><li><p>computeScanRangeAssignmentByScheduler: Process for other types of joins. Determines which replica of the tablet each scanNode reads. A scanNode will read multiple tablets, and each tablet has various copies. To distribute the scan operation on various machines as much as possible, improve concurrent performance, and reduce IO pressure, Doris uses the Round-Robin algorithm to distribute tablet scans to multiple machines as much as possible. For example, 100 tablets need to be scanned, each tablet has three copies, and ten machines could be used. When allocating, each machine is guaranteed to scan ten tablets.</p></li></ul><p><strong>c.computeFragmentExecParams phase</strong>ÔºöThis stage determines which BE the PlanFragment is issued to for execution and how to handle instance concurrency. After the scan address of each tablet is determined, FragmentExecParams will generate multiple instances with the address as the dimension. If various addresses are contained in FragmentExecParams, various instances of FInstanceExecParam will be generated. If the concurrency is set, the execution instance of an address will be further split into multiple FInstanceExecParams. There will be some special processing for bucket shuffle join and colocate join, but the basic logic is the same. After FInstanceExecParam is created, a unique ID will be assigned to facilitate tracking information. If FragmentExecParams contains ExchangeNode, the number of senders will be counted to know how many senders&#x27; data needs to be accepted. Finally, FragmentExecParams determines the destinations and fills in the destination address.</p><p><strong>d. Create result receiver stage</strong>ÔºöThe resulting receiver is where the final data needs to be output after the query is completed.</p><p><strong>e. to thrift stage</strong>ÔºöCreate RPC requests based on FInstanceExecParam of all PlanFragments, then send them to the BE side for execution. A complete SQL parsing process is completed.</p><p><img loading="lazy" src="https://cdnd.selectdb.com/assets/images/Figure_13_en-11d11e8bdcacdc813f16f698e3c7cb6d.png" width="1080" height="846" class="img_ev3q"></p><p>Figure 14 is a simple example. The PlanFrament in the figure contains a ScanNode. The ScanNode scans three tablets. Each tablet has two copies, and the cluster assumes that there are two hosts.</p><p>The computeScanRangeAssignment stage determines that replicas 1, 3, 5, 8, 10, and 12 need to be scanned, where replicas 1, 3, and 5 are located on host1, and replicas 8, 10, and 12 are located on host2.</p><p>If the global concurrency is set to 1, 2 instances of FInstanceExecParam are created and sent to host1 and host2 for execution. If the global concurrency is set to 3, 3 instances of FInstanceExecParam are created on this host1, and three instances of FInstanceExecParam are created on host2. Each instance scans one replica, equivalent to initiating 6 RPC requests.</p><p><img loading="lazy" src="https://cdnd.selectdb.com/assets/images/Figure_14_en-584e7935ee2ef6eb13e0cd4dada6ac8d.png" width="1080" height="545" class="img_ev3q"></p><h1>10 Summary</h1><p>This article first briefly introduces Doris and then introduces the general process of SQL parsing: lexical analysis, syntax analysis, generating logical plans, and generating physical plans. Then, it presents the overall architecture of DorisSQL parsing. In the end, the five processes:  Parse, Analyze, SinglePlan, DistributedPlan, and Schedule are explained in detail, and an in-depth explanation is given of the algorithm principle and code implementation.</p><p>Doris complies with the standard methods of SQL parsing. Still, according to the underlying storage architecture and distributed characteristics, many optimizations have been made in SQL parsing to achieve maximum parallelism and minimize network transmission, reducing a lot of burden on the SQL execution level.</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><div class="text-center mb-4"><a class="text-[#8592A6] cursor-pointer hover:no-underline" href="/blog">Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class="s-tags"><span class="s-tag">Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:text-[2.5rem] text-center" itemprop="headline"><a itemprop="url" href="/blog/Flink-realtime-write">How Flink&#x27;s real-time writes to Apache Doris ensure both high throughput and low latency</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class="authors"><span class="s-author text-black">Apache Doris</span></span><time datetime="2022-07-29T00:00:00.000Z" itemprop="datePublished" class="text-black ml-4">July 29, 2022</time></div></header><div class="markdown" itemprop="articleBody"><p>With the increasing demand for real-time analysis, the timeliness of data is becoming more and more important to the refined operation of enterprises. With the massive data, real-time data warehouse plays an irreplaceable role in effectively digging out valuable information, quickly obtaining data feedback, helping companies make faster decisions and better product iterations.</p><p>In this situation, Apache Doris stands out as a real-time MPP analytic database, which is high performance and easy to use, and supports various data import methods. Combined with Apache Flink, users can quickly import unstructured data from Kafka and CDC(Change Data Capture) from upstream database like MySQL. Apache Doris also provides sub-second analytic query capabilities, which can effectively satisfy the needs of several real-time scenarios: multi-dimensional analysis, dashboard and data serving etc.</p><h1>Challange</h1><p>Usually, there are many challenges to ensure high end-to-end concurrency and low latency for real-time data warehouses , such as:</p><ul><li><p>How to ensure end-to-end data sync in second-level ?</p></li><li><p>How to quickly ensure data visibility ?</p></li><li><p>How to solve the problem of small files writing under high concurrency situation?</p></li><li><p>How to ensure end-to-end Exactly-Once?</p></li></ul><p>Within the challenges above , we conducted an in-depth research on the business scenarios of users using Flink and Doris to build real-time data warehouses . After grasping the pain points of users, we made targeted optimizations in Doris version 1.1 and greatly improved the user experience  and improved the stability. The resource consumption of Doris has also been greatly optimized.</p><h1>Optimization</h1><h3 class="anchor anchorWithStickyNavbar_LWe7" id="streamming-write">Streamming Write<a href="#streamming-write" class="hash-link" aria-label="Direct link to Streamming Write" title="Direct link to Streamming Write">‚Äã</a></h3><p>The initial practice of Flink Doris Connector is to cache the data into the memory batch after receiving data.The method of data writing is saving batches, and using parameters such as <code>batch.size</code> and <code>batch.interval</code> to control the timing of Stream Load writing at the same time.</p><p>It usually runs stably when the parameters are reasonable. Whatever the parameters are unreasonable, it would cause frequent Stream Load and compaction untimely, resulting in excessive version errors ( -235 ). On the other hand, when there is too much data, in order to reduce the writing frequency of Stream Load , the setting of <code>batch.size</code> too large may also cause OOM.</p><p><strong>To solve this problem, we introduce streaming write:</strong></p><p><img loading="lazy" src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/otliigutb8p9l1y6qyp6.png" alt="Image description" class="img_ev3q"></p><ul><li><p>After the Flink task starts, the Stream Load Http request will be asynchronously initiated.</p></li><li><p>When the data is received, it will be continuously transmitted to Doris through the Chunked transfer encoding of Http.</p></li><li><p>Http request will end at Checkpoint and complete the Stream Load writing . The next Stream Load request will be asynchronously initiated at the same time.</p></li><li><p>The data will continue to be received and the follow-up process is the same as above.</p></li></ul><p>The pressure on the memory of the batch is avoided since the Chunked mechanism is used to transmit data. And the timing of writing is bound to the Checkpoint, which makes the timing of Stream Load controllable, and provides a basis for the following Exactly-Once semantics.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="exactly-once">Exactly-Once<a href="#exactly-once" class="hash-link" aria-label="Direct link to Exactly-Once" title="Direct link to Exactly-Once">‚Äã</a></h3><p>Exactly-Once means that data will not be reprocessed or lost, even machine or application failure. Flink supports the End-to-End&#x27;s Exactly-Once scenario a long time ago, mainly through the two-phase commit protocol to realize the Exactly-Once semantics of the Sink operator.</p><p>On the basis of Flink&#x27;s two-stage submission, with the help of Doris 1.0&#x27;s Stream Load two-stage submission,Flink Doris Connector implements Exactly Once semantics. The specific principles are as follows:</p><ul><li>When the Flink task is started, it will initiate a Stream Load PreCommit request. At this time, a transaction will be opened first, and data will be continuously sent to Doris through the Chunked mechanism of Http.</li></ul><p><img loading="lazy" src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ole5tqi91jibzdg9vqep.png" alt="Image description" class="img_ev3q"></p><ul><li>Http request will be completed when the data writing ends at Checkpoint , and set the transaction status to preCommitted. The data has been written to BE and is invisible to the user at this time.</li></ul><p><img loading="lazy" src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/jiieu1eff6smunkr85s5.png" alt="Image description" class="img_ev3q"></p><ul><li>A Commit request will be initiated after the Checkpoint, and the transaction status will be set to Committed. The data will become visible to the user after request.</li></ul><p><img loading="lazy" src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/eaona8eslljmkpaa9324.png" alt="Image description" class="img_ev3q"></p><ul><li>After the Flink application ends unexpectedly and restarts from Checkpoint, if the last transaction was in the preCommitted state, a rollback request will be initiated and the transaction state will be set to Aborted.</li></ul><p>Based on the above , Flink Doris Connector can be used to realize real-time data storage without loss or weight.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="second--level-data-synchronization">Second- Level Data Synchronization<a href="#second--level-data-synchronization" class="hash-link" aria-label="Direct link to Second- Level Data Synchronization" title="Direct link to Second- Level Data Synchronization">‚Äã</a></h3><p>End-to-end second-level data sync and real-time visibility of data in high concurrent write scenarios require Doris to have the following capabilities:</p><ul><li><strong>Transaction Processing Capability</strong></li></ul><p>Flink real-time writing interacts with Doris in the form of Stream Load 2pc, which requires Doris to have the corresponding transaction processing capabilities to ensure the basic ACID characteristics, and support Flink&#x27;s second-level data sync in high concurrency scenarios.</p><ul><li><strong>Rapid Aggregation Capability of Data Versions</strong></li></ul><p>One import in Doris will generate one data version. In a high concurrent write scenario, an inevitable impact is that there are too many data versions, and the amount of data imported in a single time will not be too large. The continuous high-concurrency small file writing scenario extremely tests the real-time ability and Doris&#x27; data merging performance, which is not friendly to Doris, and in turn affects the performance of the query. Doris has greatly enhanced the data compaction capability in version 1.1, which can quickly complete the aggregation of new data, avoiding -235 errors and query efficiency problems which are caused by too many versions of sharded data.</p><p>First of all, in Doris 1.1 version, QuickCompaction was introduced, which can actively triggered Compaction when the data version increased. At the same time, by improving the ability to scan fragment meta information, fragments that need to be compacted can be quickly discovered and trigger Compaction. Through active triggering and passive scanning, the real-time problem of data merging is completely solved.</p><p>For high-frequency small file Cumulative Compaction, the scheduling and isolation of Compaction tasks is implemented to prevent the heavyweight Base Compaction from affecting the merging of new data.</p><p>Finally, the strategy of merging small files is optimized by adopting gradient merge method. Each time the files participating in the merging belong to the same data magnitude,which can prevent versions with large differences in size from merging, and gradually merges hierarchically, reducing the number of times a single file is involved in merging, which can greatly save the CPU consumption of the system.</p><p><img loading="lazy" src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ez5qdcpgwjw60g9aacqd.png" alt="Image description" class="img_ev3q"></p><p>Doris version 1.1 has made targeted optimizations for scenarios such as high concurrent import, second-level data sync, and real-time data visibility, which greatly increases the ease of use and stability of the Flink system and Doris system, saves the overall resources of the cluster.</p><h1>Effect</h1><h3 class="anchor anchorWithStickyNavbar_LWe7" id="general-flink-high-concurrency-scenarios">General Flink High Concurrency Scenarios<a href="#general-flink-high-concurrency-scenarios" class="hash-link" aria-label="Direct link to General Flink High Concurrency Scenarios" title="Direct link to General Flink High Concurrency Scenarios">‚Äã</a></h3><p>In the general scenario of the survey, Flink is used to synchronize unstructured data in upstream Kafka. The data is written to Doris in real time by the Flink Doris Connector after ETL.</p><p>The customer scenario is extremely strict here. The upstream maintains a high frequency of 10w per second, and the data needs to be able to complete the upstream and downstream sync within 5s to achieve second-level data visibility. Flink is configured with 20 concurrency, and the Checkpoint interval is 5s. The performance of Doris version 1.1 is quite excellent.</p><p>Specifically reflected in the following aspects:</p><ul><li><strong>Compaction Real-Time</strong></li></ul><p>Data can be merged quickly, the number of tablet data versions is kept below 50, and the compaction score is stable. Compared with the previous -235 problem in high concurrent import scenario, the compaction efficiency is improved more than 10 times.</p><p><img loading="lazy" src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/d6enyv1zj68o7myjypnl.png" alt="Image description" class="img_ev3q"></p><ul><li><strong>CPU Resource Consumption</strong></li></ul><p>Doris version 1.1 has optimized the strategy for compaction of small files. In high-concurrency import scenarios, CPU resource consumption is reduced by 25%.</p><ul><li><strong>QPS Query Delay is Stable</strong></li></ul><p>By reducing the CPU usage and the number of data versions, the overall order of data has been improved, and the delay of SQL queries will be reduced.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="second-level-data-synchronization-scenario-extreme-high-pressure">Second-Level Data Synchronization Scenario (Extreme High Pressure)<a href="#second-level-data-synchronization-scenario-extreme-high-pressure" class="hash-link" aria-label="Direct link to Second-Level Data Synchronization Scenario (Extreme High Pressure)" title="Direct link to Second-Level Data Synchronization Scenario (Extreme High Pressure)">‚Äã</a></h3><p>In single bet and single tablet with 30 concurrent limit stream load pressure test on the client side, data in real-time &lt;1s, the comparison before and after compaction score optimization as below:</p><p><img loading="lazy" src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/r01hn8hv6arzbdclknis.png" alt="Image description" class="img_ev3q"></p><h1>Recommendations</h1><h3 class="anchor anchorWithStickyNavbar_LWe7" id="real-time-data-visualization-scenario">Real-Time Data Visualization Scenario<a href="#real-time-data-visualization-scenario" class="hash-link" aria-label="Direct link to Real-Time Data Visualization Scenario" title="Direct link to Real-Time Data Visualization Scenario">‚Äã</a></h3><p>For strict latency requirements scenarios, such as second-level data synchronization, usually mean that a single import file is small, and it is recommended to reduce <code>cumulative_size_based_promotion_min_size_mbytes </code>. The default unit is 64 MB, and you can set it to 8 MB manually, which can greatly improve the compaction real-time performance. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="high-concurrency-scenario">High Concurrency Scenario<a href="#high-concurrency-scenario" class="hash-link" aria-label="Direct link to High Concurrency Scenario" title="Direct link to High Concurrency Scenario">‚Äã</a></h3><p>For high concurrent writing scenarios, you can reduce the frequency of Stream Load by increasing the checkpoint interval. For example, setting checkpoint to 5-10s can not only increase the throughput of Flink tasks, but also reduce the generation of small files and avoid causing compaction more pressure.</p><p>In addition, for scenarios that do not require high real-time data, such as minute-level data sync, the checkpoint interval can be increased, such as 5-10 minutes. And the Flink Doris connector can still ensure the integrity of data through the two-stage submission and checkpoint mechanism.</p><h1>Future planning</h1><ul><li><strong>Real-time Schema Change</strong></li></ul><p>When accessing data in real time through Flink CDC, the upstream business table will perform the schema change operation, it has to modify the schema manually in Doris and Flink tasks. In the end, the data of the new schema can be synchronized after restart the task . </p><p>This way requires human intervention, which will bring a great operation burden to users. In subsequent versions, real-time schema changes will support CDC scenarios, and the upstream schema changes will be synchronized to the downstream in real-time, which will comprehensively improve the efficiency of schema changes.</p><ul><li><strong>Doris Multi-table Writting</strong></li></ul><p>At present, the Doris Sink operator only supports synchronizing a single table, so for the entire database, it still has to divide the flow manually at the Flink level and write to multiple Doris Sinks, which will increase the difficulty of developers. In subsequent versions, we will support a single Doris Sink to synchronize multiple tables, which greatly simplifies the user&#x27;s operation.</p><ul><li><strong>Adaptive Compaction Parameter Tuning</strong></li></ul><p>At present, the compaction strategy has many parameters, which can play a good role in most general scenarios, but these strategies still can&#x27;t play an efficient role in some special scenarios. We will continue to optimize in subsequent versions, carry out adaptive compaction tuning for different scenarios, and keep improving data merging efficiency and real-time performance in various scenarios.</p><ul><li><strong>Single-Copy Compaction</strong></li></ul><p>The current compaction strategy is that each BE is carried out separately. In subsequent versions, we will implement single-copy compaction, and realize compaction tasks by cloning snapshots, reduce system load while reducing about 2/3 compaction tasks of the cluster, leaving more system resources to the user side.</p></div></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div></div><div class="footer pt-16 pb-10"><div class="container"><div class="footer-box"><div class="left"><img src="/images/asf_logo_apache.svg" alt="" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/images/asf_logo_apache.svg" alt="" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">ASF</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Foundation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="footer__link-item">License<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/events/current-event" target="_blank" rel="noopener noreferrer" class="footer__link-item">Events<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sponsorship<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Security<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Thanks<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/download">Download</a></li><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/ecosystem/cluster-management">Ecosystem</a></li><li class="footer__item"><a class="footer__link-item" href="/users">Users</a></li><li class="footer__item"><a href="https://github.com/apache/doris/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/community/how-to-contribute/">How to contribute</a></li><li class="footer__item"><a href="https://github.com/apache/doris/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Source code<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/community/team">Doris team</a></li><li class="footer__item"><a href="https://github.com/apache/doris/issues/30669" target="_blank" rel="noopener noreferrer" class="footer__link-item">Roadmap<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://cwiki.apache.org/confluence/display/DORIS/Doris+Improvement+Proposals" target="_blank" rel="noopener noreferrer" class="footer__link-item">Improvement proposal<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div><div class="right"><div class="footer__title">Join the community</div><div class="social-list"><div class="social"><a href="mailto:dev@doris.apache.org" target="_blank" title="mail" class="item"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 32 32" fill="none"><path d="M5.6003 6H26.3997C27.8186 6 28.982 7.10964 29 8.46946L16.0045 15.454L3.01202 8.47829C3.02405 7.11258 4.1784 6 5.6003 6ZM3.01202 11.1508L3 23.5011C3 24.8756 4.16938 26 5.6003 26H26.3997C27.8306 26 29 24.8756 29 23.5011V11.145L16.3111 17.8028C16.1157 17.9058 15.8813 17.9058 15.6889 17.8028L3.01202 11.1508Z" fill="currentColor"></path></svg></a><a href="https://github.com/apache/doris" target="_blank" title="github" class="item"><svg width="2em" height="2em" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16.0001 2.66675C8.63342 2.66675 2.66675 8.63341 2.66675 16.0001C2.66524 18.7991 3.54517 21.5276 5.1817 23.7983C6.81824 26.0691 9.12828 27.7668 11.7841 28.6508C12.4508 28.7668 12.7001 28.3668 12.7001 28.0161C12.7001 27.7001 12.6828 26.6508 12.6828 25.5334C9.33342 26.1508 8.46675 24.7174 8.20008 23.9668C8.04942 23.5828 7.40008 22.4001 6.83342 22.0828C6.36675 21.8334 5.70008 21.2161 6.81608 21.2001C7.86675 21.1828 8.61608 22.1668 8.86675 22.5668C10.0668 24.5828 11.9841 24.0161 12.7494 23.6668C12.8668 22.8001 13.2161 22.2174 13.6001 21.8841C10.6334 21.5508 7.53342 20.4001 7.53342 15.3001C7.53342 13.8494 8.04942 12.6507 8.90008 11.7161C8.76675 11.3827 8.30008 10.0161 9.03342 8.18275C9.03342 8.18275 10.1494 7.83342 12.7001 9.55075C13.7855 9.2495 14.907 9.09787 16.0334 9.10008C17.1668 9.10008 18.3001 9.24942 19.3668 9.54942C21.9161 7.81608 23.0334 8.18408 23.0334 8.18408C23.7668 10.0174 23.3001 11.3841 23.1668 11.7174C24.0161 12.6507 24.5334 13.8334 24.5334 15.3001C24.5334 20.4174 21.4174 21.5508 18.4508 21.8841C18.9334 22.3001 19.3508 23.1001 19.3508 24.3508C19.3508 26.1334 19.3334 27.5668 19.3334 28.0174C19.3334 28.3668 19.5841 28.7828 20.2508 28.6494C22.8975 27.7558 25.1973 26.0547 26.8266 23.7856C28.4559 21.5165 29.3327 18.7936 29.3334 16.0001C29.3334 8.63341 23.3668 2.66675 16.0001 2.66675V2.66675Z" fill="currentColor"></path></svg></a><a href="https://twitter.com/doris_apache" target="_blank" title="twitter" class="item"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 32 32" fill="none"><path d="M4.625 4.625H11.2809L27.375 27.375H20.7191L4.625 4.625ZM7.52549 6.10639L21.5236 25.8936H24.4746L10.4764 6.10639H7.52549Z" fill="currentColor"></path><path d="M14.4268 18.4803L6.53447 27.375H4.625L13.5581 17.2525L14.4268 18.4803ZM18.1299 14.3066L26.7203 4.625H24.7017L17.2525 13.0662L18.1299 14.3066Z" fill="currentColor"></path></svg></a><a href="https://join.slack.com/t/apachedoriscommunity/shared_invite/zt-2kl08hzc0-SPJe4VWmL_qzrFd2u2XYQA" title="slack" target="_blank" class="item"><svg width="2em" height="2em" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_125_278)"><path d="M12.5875 16.6906C11.0844 16.6906 9.86562 17.9094 9.86562 19.4125V26.2375C9.86562 26.9594 10.1524 27.6517 10.6628 28.1622C11.1733 28.6726 11.8656 28.9594 12.5875 28.9594C13.3094 28.9594 14.0017 28.6726 14.5122 28.1622C15.0226 27.6517 15.3094 26.9594 15.3094 26.2375V19.4531C15.3094 17.9094 14.0906 16.6906 12.5875 16.6906ZM3 19.4531C3 20.175 3.28677 20.8673 3.79722 21.3778C4.30767 21.8882 4.99999 22.175 5.72187 22.175C6.44376 22.175 7.13608 21.8882 7.64653 21.3778C8.15698 20.8673 8.44375 20.175 8.44375 19.4531V16.7312H5.7625C4.25938 16.6906 3 17.9094 3 19.4531ZM12.5875 3C11.8656 3 11.1733 3.28677 10.6628 3.79722C10.1524 4.30767 9.86562 4.99999 9.86562 5.72187C9.86562 6.44376 10.1524 7.13608 10.6628 7.64653C11.1733 8.15698 11.8656 8.44375 12.5875 8.44375H15.3094V5.72187C15.3094 4.21875 14.0906 3 12.5875 3ZM5.72187 15.3094H12.5469C13.2688 15.3094 13.9611 15.0226 14.4715 14.5122C14.982 14.0017 15.2688 13.3094 15.2688 12.5875C15.2688 11.8656 14.982 11.1733 14.4715 10.6628C13.9611 10.1524 13.2688 9.86562 12.5469 9.86562H5.72187C4.99999 9.86562 4.30767 10.1524 3.79722 10.6628C3.28677 11.1733 3 11.8656 3 12.5875C3 13.3094 3.28677 14.0017 3.79722 14.5122C4.30767 15.0226 4.99999 15.3094 5.72187 15.3094ZM26.2375 9.86562C24.7344 9.86562 23.5156 11.0844 23.5156 12.5875V15.3094H26.2375C26.9594 15.3094 27.6517 15.0226 28.1622 14.5122C28.6726 14.0017 28.9594 13.3094 28.9594 12.5875C28.9594 11.8656 28.6726 11.1733 28.1622 10.6628C27.6517 10.1524 26.9594 9.86562 26.2375 9.86562ZM16.6906 5.72187V12.5875C16.6906 13.3094 16.9774 14.0017 17.4878 14.5122C17.9983 15.0226 18.6906 15.3094 19.4125 15.3094C20.1344 15.3094 20.8267 15.0226 21.3372 14.5122C21.8476 14.0017 22.1344 13.3094 22.1344 12.5875V5.72187C22.1344 4.99999 21.8476 4.30767 21.3372 3.79722C20.8267 3.28677 20.1344 3 19.4125 3C18.6906 3 17.9983 3.28677 17.4878 3.79722C16.9774 4.30767 16.6906 4.99999 16.6906 5.72187ZM22.1344 26.2781C22.1344 24.775 20.9156 23.5562 19.4125 23.5562H16.6906V26.2781C16.6906 27 16.9774 27.6923 17.4878 28.2028C17.9983 28.7132 18.6906 29 19.4125 29C20.1344 29 20.8267 28.7132 21.3372 28.2028C21.8476 27.6923 22.1344 27 22.1344 26.2781ZM26.2781 16.6906H19.4125C18.6906 16.6906 17.9983 16.9774 17.4878 17.4878C16.9774 17.9983 16.6906 18.6906 16.6906 19.4125C16.6906 20.1344 16.9774 20.8267 17.4878 21.3372C17.9983 21.8476 18.6906 22.1344 19.4125 22.1344H26.2375C27.7406 22.1344 28.9594 20.9156 28.9594 19.4125C29 17.9094 27.7812 16.6906 26.2781 16.6906Z" fill="currentColor"></path></g><defs><clipPath id="clip0_125_278"><rect width="26" height="26" fill="currentColor" transform="translate(3 3)"></rect></clipPath></defs></svg></a></div><div class="social"><a href="https://www.youtube.com/@apachedoris/channels" title="youtube" target="_blank" class="item"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 32 32" fill="none"><path d="M28.5167 7.83429C28.9436 8.25423 29.2532 8.77539 29.4154 9.34742C29.8205 11.5462 30.0159 13.7775 29.999 16.0121C30.0144 18.2382 29.819 20.4609 29.4154 22.6515C29.2532 23.2235 28.9436 23.7446 28.5167 24.1645C28.0898 24.5845 27.5601 24.889 26.9785 25.0486C24.7728 25.625 16.0124 25.625 16.0124 25.625C16.0124 25.625 7.22652 25.625 5.04638 25.0486C4.46489 24.889 3.9351 24.5845 3.5082 24.1645C3.08132 23.7446 2.77176 23.2235 2.60948 22.6515C2.19736 20.4617 1.9934 18.239 2.00025 16.0121C1.9918 13.7767 2.19577 11.5455 2.60948 9.34742C2.77176 8.77539 3.08132 8.25423 3.5082 7.83429C3.9351 7.41436 4.46489 7.10985 5.04638 6.95021C7.25103 6.36354 16.0124 6.37502 16.0124 6.37502C16.0124 6.37502 24.796 6.37502 26.9785 6.95021C27.5601 7.10985 28.0898 7.41436 28.5167 7.83429ZM12.5 21.25L21.25 16.008L12.5 10.75V21.25Z" fill="currentColor"></path></svg></a><a href="https://www.linkedin.com/company/doris-apache/" title="linkedin" target="_blank" class="item"><svg width="2rem" height="2rem" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.29925 26.9996H9.66738V11.6781H4.29925V26.9996ZM22.1628 11.1949C19.9409 11.1949 18.7157 11.9388 17.3054 13.7407V11.6777H11.9459V26.9996H17.305V18.6738C17.305 16.9168 18.145 15.1982 20.1535 15.1982C22.162 15.1982 22.6559 16.9164 22.6559 18.632V27H28V18.2902C28 12.2386 24.3854 11.1949 22.1628 11.1949ZM6.99325 4C5.3395 4 4 5.21047 4 6.7046C4 8.19759 5.3395 9.40617 6.99325 9.40617C8.6455 9.40617 9.985 8.19722 9.985 6.7046C9.985 5.21047 8.6455 4 6.99325 4Z" fill="white"></path></svg></a><a href="https://medium.com/@ApacheDoris" title="medium" target="_blank" class="item"><svg width="2em" height="2em" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="Frame"><path id="Vector" d="M17.7967 16.5385C17.8029 18.53 16.9746 20.4425 15.4937 21.8559C14.0128 23.2693 12.0004 24.0681 9.89836 24.0769C7.79633 24.0681 5.78391 23.2693 4.30302 21.8559C2.82212 20.4425 1.99383 18.53 2.00003 16.5385C1.99383 14.5469 2.82212 12.6344 4.30302 11.221C5.78391 9.80759 7.79633 9.00878 9.89836 9C12.0004 9.00878 14.0128 9.80759 15.4937 11.221C16.9746 12.6344 17.8029 14.5469 17.7967 16.5385ZM26.4533 16.5385C26.4533 20.4514 24.6917 23.6348 22.51 23.6348C20.3283 23.6348 18.555 20.4514 18.555 16.5385C18.555 12.6255 20.3283 9.44214 22.51 9.44214C24.6917 9.44214 26.4533 12.6255 26.4533 16.5385ZM30 16.5385C30 20.0424 29.3817 22.8942 28.6117 22.8942C27.8417 22.8942 27.2233 20.0424 27.2233 16.5385C27.2233 13.0345 27.8417 10.1827 28.6117 10.1827C29.3817 10.1827 30 13.0345 30 16.5385Z" fill="currentColor"></path></g></svg></a><a class="item wechat"><svg width="2em" height="2em" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20.7578 11.5169C21.0708 11.5169 21.3795 11.5398 21.6851 11.573C20.8524 7.73517 16.7052 4.88306 11.9718 4.88306C6.67951 4.88306 2.34412 8.45283 2.34412 12.9854C2.34412 15.6013 3.78679 17.7498 6.19667 19.4161L5.2339 22.2827L8.59917 20.6122C9.80411 20.8478 10.7698 21.0906 11.9718 21.0906C12.2738 21.0906 12.5728 21.0759 12.8703 21.0523C12.682 20.4159 12.5728 19.7485 12.5728 19.0566C12.5728 14.8947 16.1847 11.5169 20.7578 11.5169ZM15.5822 8.9335C16.3072 8.9335 16.7871 9.40601 16.7871 10.1229C16.7871 10.8369 16.3072 11.3153 15.5822 11.3153C14.8601 11.3153 14.1365 10.8369 14.1365 10.1229C14.1365 9.40601 14.8601 8.9335 15.5822 8.9335ZM8.84429 11.3153C8.12218 11.3153 7.3942 10.8368 7.3942 10.1229C7.3942 9.40597 8.12218 8.93346 8.84429 8.93346C9.56559 8.93346 10.0463 9.40597 10.0463 10.1229C10.0463 10.8369 9.56559 11.3153 8.84429 11.3153ZM29.5453 18.9422C29.5453 15.1332 25.6935 12.0285 21.3677 12.0285C16.7871 12.0285 13.1797 15.1332 13.1797 18.9422C13.1797 22.7567 16.7871 25.8547 21.3677 25.8547C22.326 25.8547 23.2932 25.6169 24.2559 25.3777L26.897 26.8086L26.1726 24.4282C28.1056 22.993 29.5453 21.0906 29.5453 18.9422ZM18.7126 17.7498C18.2335 17.7498 17.7499 17.278 17.7499 16.7966C17.7499 16.3219 18.2335 15.8442 18.7126 15.8442C19.4406 15.8442 19.9176 16.3219 19.9176 16.7966C19.9176 17.278 19.4406 17.7498 18.7126 17.7498ZM24.0079 17.7498C23.5324 17.7498 23.0518 17.278 23.0518 16.7966C23.0518 16.3219 23.5324 15.8442 24.0079 15.8442C24.73 15.8442 25.2128 16.3219 25.2128 16.7966C25.2128 17.278 24.73 17.7498 24.0079 17.7498Z" fill="currentColor"></path></svg><div class="wechat-dropdown"><p class="text-[#4c576c] text-xs">Connect on WeChat</p><img src="https://cdnd.selectdb.com/assets/images/doris-wechat-b949e908a3bc2776d824f79a9100bd4b.png" alt=""></div></a></div></div></div></div><div class="footer__copyright">Copyright ¬© 2024 The Apache Software Foundation,Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank">Apache License, Version 2.0</a>. Apache, Doris, Apache Doris, the Apache feather logo and the Apache Doris logo are trademarks of The Apache Software Foundation.</div></div></div></div>
<script src="https://cdnd.selectdb.com/assets/js/runtime~main.d78c3de7.js"></script>
<script src="https://cdnd.selectdb.com/assets/js/main.62136e2c.js"></script>
</body>
</html>