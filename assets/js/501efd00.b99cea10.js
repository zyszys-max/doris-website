"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([[651272],{15680:(e,t,n)=>{n.d(t,{xA:()=>p,yg:()=>c});var a=n(296540);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),d=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=d(e.components);return a.createElement(s.Provider,{value:t},e.children)},m="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),m=d(n),u=r,c=m["".concat(s,".").concat(u)]||m[u]||g[u]||l;return n?a.createElement(c,i(i({ref:t},p),{},{components:n})):a.createElement(c,i({ref:t},p))}));function c(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=u;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[m]="string"==typeof e?e:r,i[1]=o;for(var d=2;d<l;d++)i[d]=n[d];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},494630:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>g,frontMatter:()=>l,metadata:()=>o,toc:()=>d});var a=n(58168),r=(n(296540),n(15680));const l={title:"Doris Compute-Storage Decoupled Deployment Preparation",language:"en"},i=void 0,o={unversionedId:"compute-storage-decoupled/before-deployment",id:"version-3.0/compute-storage-decoupled/before-deployment",title:"Doris Compute-Storage Decoupled Deployment Preparation",description:"\x3c!--",source:"@site/versioned_docs/version-3.0/compute-storage-decoupled/before-deployment.md",sourceDirName:"compute-storage-decoupled",slug:"/compute-storage-decoupled/before-deployment",permalink:"/docs/3.0/compute-storage-decoupled/before-deployment",draft:!1,tags:[],version:"3.0",frontMatter:{title:"Doris Compute-Storage Decoupled Deployment Preparation",language:"en"},sidebar:"docs",previous:{title:"Overview",permalink:"/docs/3.0/compute-storage-decoupled/overview"},next:{title:"Compilation and Deployment",permalink:"/docs/3.0/compute-storage-decoupled/compilation-and-deployment"}},s={},d=[{value:"1. Overview",id:"1-overview",level:2},{value:"2. Architecture Components",id:"2-architecture-components",level:2},{value:"3. System Requirements",id:"3-system-requirements",level:2},{value:"3.1 Hardware Requirements",id:"31-hardware-requirements",level:3},{value:"3.2 Software Dependencies",id:"32-software-dependencies",level:3},{value:"4. Deployment Planning",id:"4-deployment-planning",level:2},{value:"4.1 Testing Environment Deployment",id:"41-testing-environment-deployment",level:3},{value:"4.2 Production Deployment",id:"42-production-deployment",level:3},{value:"5. Installation Steps",id:"5-installation-steps",level:2},{value:"5.1 Install FoundationDB",id:"51-install-foundationdb",level:3},{value:"5.1.1 Machine Requirements",id:"511-machine-requirements",level:4},{value:"5.1.2 <code>fdb_vars.sh</code> Configuration",id:"512-fdb_varssh-configuration",level:4},{value:"Required Custom Settings",id:"required-custom-settings",level:5},{value:"Optional Custom Settings",id:"optional-custom-settings",level:5},{value:"5.1.3 Deploy FDB Cluster",id:"513-deploy-fdb-cluster",level:4},{value:"5.1.4 Start FDB Service",id:"514-start-fdb-service",level:3},{value:"5.2 Install OpenJDK 17",id:"52-install-openjdk-17",level:3},{value:"5.3 Install S3 or HDFS (Optional)",id:"53-install-s3-or-hdfs-optional",level:3},{value:"6. Next Steps",id:"6-next-steps",level:2},{value:"7. Notes",id:"7-notes",level:2},{value:"8. References",id:"8-references",level:2}],p={toc:d},m="wrapper";function g(e){let{components:t,...n}=e;return(0,r.yg)(m,(0,a.A)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.yg)("h2",{id:"1-overview"},"1. Overview"),(0,r.yg)("p",null,"This document describes the deployment preparation work for the Apache Doris compute-storage decoupled mode. The decoupled architecture aims to improve system scalability and performance, suitable for large-scale data processing scenarios."),(0,r.yg)("h2",{id:"2-architecture-components"},"2. Architecture Components"),(0,r.yg)("p",null,"The Doris compute-storage decoupled architecture consists of three main modules:"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"Frontend (FE)"),": Handles user requests and manages metadata."),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"Backend (BE)"),": Stateless compute nodes that execute query tasks."),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"Meta Service (MS)"),": Manages metadata operations and data recovery.")),(0,r.yg)("h2",{id:"3-system-requirements"},"3. System Requirements"),(0,r.yg)("h3",{id:"31-hardware-requirements"},"3.1 Hardware Requirements"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Minimum configuration: 3 servers"),(0,r.yg)("li",{parentName:"ul"},"Recommended configuration: 5 or more servers")),(0,r.yg)("h3",{id:"32-software-dependencies"},"3.2 Software Dependencies"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"FoundationDB (FDB) version 7.1.38 or higher"),(0,r.yg)("li",{parentName:"ul"},"OpenJDK 17")),(0,r.yg)("h2",{id:"4-deployment-planning"},"4. Deployment Planning"),(0,r.yg)("h3",{id:"41-testing-environment-deployment"},"4.1 Testing Environment Deployment"),(0,r.yg)("p",null,"Deploy all modules on a single machine, not suitable for production environments."),(0,r.yg)("h3",{id:"42-production-deployment"},"4.2 Production Deployment"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Deploy FDB on 3 or more machines"),(0,r.yg)("li",{parentName:"ul"},"Deploy FE and Meta Service on 3 or more machines"),(0,r.yg)("li",{parentName:"ul"},"Deploy BE on 3 or more machines")),(0,r.yg)("p",null,"When machine configurations are high, consider mixing FDB, FE, and Meta Service, but do not mix disks."),(0,r.yg)("h2",{id:"5-installation-steps"},"5. Installation Steps"),(0,r.yg)("h3",{id:"51-install-foundationdb"},"5.1 Install FoundationDB"),(0,r.yg)("p",null,"This section provides a step-by-step guide to configure, deploy, and start the FoundationDB (FDB) service using the provided scripts ",(0,r.yg)("inlineCode",{parentName:"p"},"fdb_vars.sh")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"fdb_ctl.sh"),". You can download ",(0,r.yg)("a",{parentName:"p",href:"http://apache-doris-releases.oss-accelerate.aliyuncs.com/apache-doris-3.0.2-tools.tar.gz"},"doris tools")," and get ",(0,r.yg)("inlineCode",{parentName:"p"},"fdb_vars.sh")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"fdb_ctl.sh")," from ",(0,r.yg)("inlineCode",{parentName:"p"},"fdb")," directory."),(0,r.yg)("h4",{id:"511-machine-requirements"},"5.1.1 Machine Requirements"),(0,r.yg)("p",null,"Typically, at least 3 machines equipped with SSDs are required to form a FoundationDB cluster with dual data replicas and allow for single machine failures."),(0,r.yg)("admonition",{type:"tip"},(0,r.yg)("p",{parentName:"admonition"},"If only for development/testing purposes, a single machine is sufficient.")),(0,r.yg)("h4",{id:"512-fdb_varssh-configuration"},"5.1.2 ",(0,r.yg)("inlineCode",{parentName:"h4"},"fdb_vars.sh")," Configuration"),(0,r.yg)("h5",{id:"required-custom-settings"},"Required Custom Settings"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Parameter"),(0,r.yg)("th",{parentName:"tr",align:null},"Description"),(0,r.yg)("th",{parentName:"tr",align:null},"Type"),(0,r.yg)("th",{parentName:"tr",align:null},"Example"),(0,r.yg)("th",{parentName:"tr",align:null},"Notes"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"DATA_DIRS")),(0,r.yg)("td",{parentName:"tr",align:null},"Specify the data directory for FoundationDB storage"),(0,r.yg)("td",{parentName:"tr",align:null},"Comma-separated list of absolute paths"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"/mnt/foundationdb/data1,/mnt/foundationdb/data2,/mnt/foundationdb/data3")),(0,r.yg)("td",{parentName:"tr",align:null},"- Ensure directories are created before running the script",(0,r.yg)("br",null),"- SSD and separate directories are recommended for production environments")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"FDB_CLUSTER_IPS")),(0,r.yg)("td",{parentName:"tr",align:null},"Define cluster IPs"),(0,r.yg)("td",{parentName:"tr",align:null},"String (comma-separated IP addresses)"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"172.200.0.2,172.200.0.3,172.200.0.4")),(0,r.yg)("td",{parentName:"tr",align:null},"- At least 3 IP addresses for production clusters",(0,r.yg)("br",null),"- The first IP will be used as the coordinator",(0,r.yg)("br",null),"- For high availability, place machines in different racks")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"FDB_HOME")),(0,r.yg)("td",{parentName:"tr",align:null},"Define the main directory for FoundationDB"),(0,r.yg)("td",{parentName:"tr",align:null},"Absolute path"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"/fdbhome")),(0,r.yg)("td",{parentName:"tr",align:null},"- Default path is /fdbhome",(0,r.yg)("br",null),"- Ensure this path is absolute")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"FDB_CLUSTER_ID")),(0,r.yg)("td",{parentName:"tr",align:null},"Define the cluster ID"),(0,r.yg)("td",{parentName:"tr",align:null},"String"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"SAQESzbh")),(0,r.yg)("td",{parentName:"tr",align:null},"- Each cluster ID must be unique",(0,r.yg)("br",null),"- Can be generated using ",(0,r.yg)("inlineCode",{parentName:"td"},"mktemp -u XXXXXXXX"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"FDB_CLUSTER_DESC")),(0,r.yg)("td",{parentName:"tr",align:null},"Define the description of the FDB cluster"),(0,r.yg)("td",{parentName:"tr",align:null},"String"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"dorisfdb")),(0,r.yg)("td",{parentName:"tr",align:null},"- It is recommended to change this to something meaningful for the deployment")))),(0,r.yg)("h5",{id:"optional-custom-settings"},"Optional Custom Settings"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Parameter"),(0,r.yg)("th",{parentName:"tr",align:null},"Description"),(0,r.yg)("th",{parentName:"tr",align:null},"Type"),(0,r.yg)("th",{parentName:"tr",align:null},"Example"),(0,r.yg)("th",{parentName:"tr",align:null},"Notes"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"MEMORY_LIMIT_GB")),(0,r.yg)("td",{parentName:"tr",align:null},"Define the memory limit for FDB processes in GB"),(0,r.yg)("td",{parentName:"tr",align:null},"Integer"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"MEMORY_LIMIT_GB=16")),(0,r.yg)("td",{parentName:"tr",align:null},"Adjust this value based on available memory resources and FDB process requirements")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"CPU_CORES_LIMIT")),(0,r.yg)("td",{parentName:"tr",align:null},"Define the CPU core limit for FDB processes"),(0,r.yg)("td",{parentName:"tr",align:null},"Integer"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"CPU_CORES_LIMIT=8")),(0,r.yg)("td",{parentName:"tr",align:null},"Set this value based on the number of available CPU cores and FDB process requirements")))),(0,r.yg)("h4",{id:"513-deploy-fdb-cluster"},"5.1.3 Deploy FDB Cluster"),(0,r.yg)("p",null,"After configuring the environment with ",(0,r.yg)("inlineCode",{parentName:"p"},"fdb_vars.sh"),", you can deploy the FDB cluster on each node using the ",(0,r.yg)("inlineCode",{parentName:"p"},"fdb_ctl.sh")," script."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"./fdb_ctl.sh deploy\n")),(0,r.yg)("p",null,"This command initiates the deployment process of the FDB cluster."),(0,r.yg)("h3",{id:"514-start-fdb-service"},"5.1.4 Start FDB Service"),(0,r.yg)("p",null,"Once the FDB cluster is deployed, you can start the FDB service using the ",(0,r.yg)("inlineCode",{parentName:"p"},"fdb_ctl.sh")," script."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"./fdb_ctl.sh start\n")),(0,r.yg)("p",null,"This command starts the FDB service, making the cluster operational and obtaining the FDB cluster connection string, which can be used for configuring the MetaService."),(0,r.yg)("h3",{id:"52-install-openjdk-17"},"5.2 Install OpenJDK 17"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},"Download ",(0,r.yg)("a",{parentName:"li",href:"https://download.java.net/java/GA/jdk17.0.1/2a2082e5a09d4267845be086888add4f/12/GPL/openjdk-17.0.1_linux-x64_bin.tar.gz"},"OpenJDK 17")),(0,r.yg)("li",{parentName:"ol"},"Extract and set the environment variable JAVA_HOME.")),(0,r.yg)("h3",{id:"53-install-s3-or-hdfs-optional"},"5.3 Install S3 or HDFS (Optional)"),(0,r.yg)("p",null,"The Apache Doris (cloud mode) stores data on S3 or HDFS services. If you already have the relevant services, you can use them directly. If not, this document provides a simple deployment tutorial for MinIO:"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},"Choose the appropriate version and operating system on \u5728 MinIO MinIO's ",(0,r.yg)("a",{parentName:"li",href:"https://min.io/download?license=agpl&platform=linux"},"download page")," and download the corresponding binary or installation packages for the server and client."),(0,r.yg)("li",{parentName:"ol"},"start MinIO Server",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"export MINIO_REGION_NAME=us-east-1\nexport MINIO_ROOT_USER=minio # In older versions, the configuration is MINIO_ACCESS_KEY=minio\nexport MINIO_ROOT_PASSWORD=minioadmin # In older versions, the configuration is MINIO_SECRET_KEY=minioadmin\nnohup ./minio server /mnt/data 2>&1 &\n"))),(0,r.yg)("li",{parentName:"ol"},"config MinIO Client",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"# If you are using a client installed with an installation package, the client name is mcli. If you directly download the client binary package, its name is mc\n./mc config host add myminio http://127.0.0.1:9000 minio minioadmin\n"))),(0,r.yg)("li",{parentName:"ol"},"create a bucket",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"./mc mb myminio/doris\n"))),(0,r.yg)("li",{parentName:"ol"},"verify if it is working properly",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"# upload a file\n./mc mv test_file myminio/doris\n# list files\n./mc ls myminio/doris\n")))),(0,r.yg)("h2",{id:"6-next-steps"},"6. Next Steps"),(0,r.yg)("p",null,"After completing the above preparations, please refer to the following documents to continue the deployment:"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("a",{parentName:"li",href:"/docs/3.0/compute-storage-decoupled/compilation-and-deployment"},"Deployment")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("a",{parentName:"li",href:"/docs/3.0/compute-storage-decoupled/managing-compute-cluster"},"Managing Compute Group")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("a",{parentName:"li",href:"/docs/3.0/compute-storage-decoupled/managing-storage-vault"},"Managing Storage Vault"))),(0,r.yg)("h2",{id:"7-notes"},"7. Notes"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Ensure time synchronization across all nodes"),(0,r.yg)("li",{parentName:"ul"},"Regularly back up FoundationDB data"),(0,r.yg)("li",{parentName:"ul"},"Adjust FoundationDB and Doris configuration parameters based on actual load")),(0,r.yg)("h2",{id:"8-references"},"8. References"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"https://apple.github.io/foundationdb/index.html"},"FoundationDB Official Documentation")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"https://doris.apache.org/"},"Apache Doris Official Website"))))}g.isMDXComponent=!0}}]);