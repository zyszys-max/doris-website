"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([[699322],{15680:(e,t,o)=>{o.d(t,{xA:()=>c,yg:()=>d});var a=o(296540);function n(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function r(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function i(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){n(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function s(e,t){if(null==e)return{};var o,a,n=function(e,t){if(null==e)return{};var o,a,n={},r=Object.keys(e);for(a=0;a<r.length;a++)o=r[a],t.indexOf(o)>=0||(n[o]=e[o]);return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)o=r[a],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}var p=a.createContext({}),u=function(e){var t=a.useContext(p),o=t;return e&&(o="function"==typeof e?e(t):i(i({},t),e)),o},c=function(e){var t=u(e.components);return a.createElement(p.Provider,{value:t},e.children)},l="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var o=e.components,n=e.mdxType,r=e.originalType,p=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),l=u(o),m=n,d=l["".concat(p,".").concat(m)]||l[m]||g[m]||r;return o?a.createElement(d,i(i({ref:t},c),{},{components:o})):a.createElement(d,i({ref:t},c))}));function d(e,t){var o=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=o.length,i=new Array(r);i[0]=m;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s[l]="string"==typeof e?e:n,i[1]=s;for(var u=2;u<r;u++)i[u]=o[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,o)}m.displayName="MDXCreateElement"},849084:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>g,frontMatter:()=>r,metadata:()=>s,toc:()=>u});var a=o(58168),n=(o(296540),o(15680));const r={title:"Config ComputeGroups",language:"en"},i=void 0,s={unversionedId:"install/cluster-deployment/k8s-deploy/compute-storage-decoupled/config-cg",id:"version-3.0/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/config-cg",title:"Config ComputeGroups",description:"\x3c!--",source:"@site/versioned_docs/version-3.0/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/config-cg.md",sourceDirName:"install/cluster-deployment/k8s-deploy/compute-storage-decoupled",slug:"/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/config-cg",permalink:"/docs/3.0/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/config-cg",draft:!1,tags:[],version:"3.0",frontMatter:{title:"Config ComputeGroups",language:"en"},sidebar:"docs",previous:{title:"Config FE",permalink:"/docs/3.0/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/config-fe"},next:{title:"Deploying on AWS",permalink:"/docs/3.0/install/cluster-deployment/doris-on-aws"}},p={},u=[{value:"Specify the name of compute group",id:"specify-the-name-of-compute-group",level:2},{value:"Configure multiple compute groups",id:"configure-multiple-compute-groups",level:2},{value:"Configure computing resources",id:"configure-computing-resources",level:2},{value:"Configure cache persistent storage",id:"configure-cache-persistent-storage",level:2},{value:"1.Custom start configuration",id:"1custom-start-configuration",level:3},{value:"2.Custom storage configuration",id:"2custom-storage-configuration",level:3},{value:"3.Mount customized configMap",id:"3mount-customized-configmap",level:3},{value:"4.Config the persistent volume template",id:"4config-the-persistent-volume-template",level:3}],c={toc:u},l="wrapper";function g(e){let{components:t,...o}=e;return(0,n.yg)(l,(0,a.A)({},c,o,{components:t,mdxType:"MDXLayout"}),(0,n.yg)("p",null,"The Compute Group (BEs) is responsible for data import and caching data in storage-computing separation mode, Compute Groups are isolated from each other."),(0,n.yg)("h2",{id:"specify-the-name-of-compute-group"},"Specify the name of compute group"),(0,n.yg)("p",null,"The following configuration deploys a minimal Compute Group:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-yaml"},"spec:\n  computeGroups:\n  - uniqueId: cg1\n    image: {beImage}\n    replicas: 1\n")),(0,n.yg)("p",null,"The above configuration deploys a Compute Group uniqueId is cg1. The deployment of the Compute Group depends on the FE service is available. The above sample variables are explained as follows:"),(0,n.yg)("p",null,(0,n.yg)("inlineCode",{parentName:"p"},"{beImage}")," is the image for deploying the BE service."),(0,n.yg)("admonition",{title:"Tip  ",type:"tip"},(0,n.yg)("p",{parentName:"admonition"},"cg1 is the uniqueId of the Compute Group, also as the name of compute group. Please use the uniqueId as compute group's name, During the execution of SQL.     ")),(0,n.yg)("h2",{id:"configure-multiple-compute-groups"},"Configure multiple compute groups"),(0,n.yg)("p",null,"A ",(0,n.yg)("inlineCode",{parentName:"p"},"DorisDisaggregatedCluster")," resource can deploy multiple Compute Groups. Each Compute Group is independent of each other and operates independently."),(0,n.yg)("p",null,"The simplest deployment of two Compute Groups is as follows:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-yaml"},"spec:\n  computeGroups:\n  - uniqueId: cg1\n    image: {beImage}\n    replicas: 3\n  - uniqueId: cg2\n    image: {beImage}\n    replicas: 2\n")),(0,n.yg)("p",null,"The above is a simple configuration of two Compute Groups, with the cluster name are cg1 and cg2 respectively. When using a storage-computing separation cluster, you can select which Compute Group to use by the name. In actual use, you can specify the compute group name according to the business category."),(0,n.yg)("p",null,"Modify the following configuration to the ",(0,n.yg)("inlineCode",{parentName:"p"},"DorisDisaggregatedCluster")," resource when ",(0,n.yg)("a",{parentName:"p",href:"/docs/3.0/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/install-quickstart#step-2-quickly-deploy-a-storage-and-computing-separation-cluster"},"Deploy storage-computing separation cluster")," to deploy 2 Compute Groups, one of which can deploy 3 pods containing BE services, and the other can deploy 2 pods containing BE services. ",(0,n.yg)("inlineCode",{parentName:"p"},"{beImage}")," specifies the image of the BE service you want to use."),(0,n.yg)("admonition",{title:"Tip  ",type:"tip"},(0,n.yg)("p",{parentName:"admonition"},"Keeping the image used by multiple Compute Groups consistent.  ")),(0,n.yg)("h2",{id:"configure-computing-resources"},"Configure computing resources"),(0,n.yg)("p",null,"Set the CPU and Memory resource usage available to the BE (Compute Service) container in each pod. Specify the CPU and Memory usage in ",(0,n.yg)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#requests-and-limits"},"resources.requests and resources.limits"),"."),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-yaml"},"spec:\n  computeGroups:\n  - uniqueId: cg1\n    image: {beImage}\n    requests:\n      cpu: 4\n      memory: 8Gi\n    limits:\n      cpu: 4\n      memory: 8Gi\n")),(0,n.yg)("p",null,'The above configuration specifies 4c,8Gi computing resources to the Compute Group "cg1". You can config as need when ',(0,n.yg)("a",{parentName:"p",href:"/docs/3.0/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/install-quickstart#step-2-quickly-deploy-a-storage-and-computing-separation-cluster"},"eploy storage and computing separation cluster"),". ",(0,n.yg)("inlineCode",{parentName:"p"},"{beImage}")," is the BE image you want to use."),(0,n.yg)("h2",{id:"configure-cache-persistent-storage"},"Configure cache persistent storage"),(0,n.yg)("p",null,"By default, each BE service uses the ",(0,n.yg)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/storage/volumes/#emptydir"},"EmptyDir")," to cache. In real usage scenarios, please config the Cache with persistent storage."),(0,n.yg)("h3",{id:"1custom-start-configuration"},"1.Custom start configuration"),(0,n.yg)("p",null,"In default, BE using the configuration file in the image to start. In K8s deployment, please use the ConfigMap resource to specify the BE startup configuration. In ",(0,n.yg)("a",{parentName:"p",href:"#3mount-customized-configmap"},"Mount Customized ConfigMap")," shows a example format of Configmap, refer to ",(0,n.yg)("a",{parentName:"p",href:"/docs/3.0/compute-storage-decoupled/compilation-and-deployment#541-configure-beconf"},"Storage-computing separation document")," to configure the startup parameters on ConfigMap. ",(0,n.yg)("inlineCode",{parentName:"p"},"deploy_mode"),"is not needed be filled in."),(0,n.yg)("h3",{id:"2custom-storage-configuration"},"2.Custom storage configuration"),(0,n.yg)("p",null,"Config Cache is required in storage-computing separation mode of start BE, please specify ",(0,n.yg)("inlineCode",{parentName:"p"},"file_cache_path")," according to ",(0,n.yg)("a",{parentName:"p",href:"/docs/3.0/compute-storage-decoupled/compilation-and-deployment#541-configure-beconf"},"storage and computing separation start configuration document"),". Doris-Operator will automatically mount persistent storage according to ",(0,n.yg)("a",{parentName:"p",href:"#4config-the-persistent-volume-template"},"persistent volume template"),"."),(0,n.yg)("p",null,"For example: ",(0,n.yg)("inlineCode",{parentName:"p"},"file_cache_path")," is configured as ",(0,n.yg)("inlineCode",{parentName:"p"},'file_cache_path = [{"path":"/opt/apache-doris/be/file_cache","total_size":107374182400,"query_limit":107374182400}]'),", Doris-Operator related services automatically add storage configuration information for computing services, which can apply for a disk with a mount point of ",(0,n.yg)("inlineCode",{parentName:"p"},"/opt/apache-doris/be/file_cache")," and a capacity of 100Gi."),(0,n.yg)("p",null,"When total_size in file_cache_path is greater than the storage capacity of ",(0,n.yg)("a",{parentName:"p",href:"#4config-the-persistent-volume-template"},"persistent volume template"),", Doris-Operator will use the max size to the mount persistent volume."),(0,n.yg)("h3",{id:"3mount-customized-configmap"},"3.Mount customized configMap"),(0,n.yg)("p",null,"After the configuration file is prepared according to the above rules, deploy it to the namespace of the ",(0,n.yg)("inlineCode",{parentName:"p"},"DorisDisaggregatedCluster")," deployment, after deployed configmap, please config the compute group described in ",(0,n.yg)("inlineCode",{parentName:"p"},"DorisDisaggregatedCluster")," resource to start with the customized configuration."),(0,n.yg)("p",null,"For example, the startup configuration is as follows:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: be-configmap\n  labels:\n    app.kubernetes.io/component: be\ndata:\n  be.conf: |\n    # For jdk 17, this JAVA_OPTS will be used as default JVM options\n    JAVA_OPTS_FOR_JDK_17="-Xmx1024m -DlogPath=$LOG_DIR/jni.log -Xlog:gc*:$LOG_DIR/be.gc.log.$CUR_DATE:time,uptime:filecount=10,filesize=50M -Djavax.security.auth.useSubjectCredsOnly=false -Dsun.security.krb5.debug=true -Dsun.java.command=DorisBE -XX:-CriticalJNINatives -XX:+IgnoreUnrecognizedVMOptions --add-opens=java.base/java.lang=ALL-UNNAMED --add-opens=java.base/java.lang.invoke=ALL-UNNAMED --add-opens=java.base/java.lang.reflect=ALL-UNNAMED --add-opens=java.base/java.io=ALL-UNNAMED --add-opens=java.base/java.net=ALL-UNNAMED --add-opens=java.base/java.nio=ALL-UNNAMED --add-opens=java.base/java.util=ALL-UNNAMED --add-opens=java.base/java.util.concurrent=ALL-UNNAMED --add-opens=java.base/java.util.concurrent.atomic=ALL-UNNAMED --add-opens=java.base/sun.nio.ch=ALL-UNNAMED --add-opens=java.base/sun.nio.cs=ALL-UNNAMED --add-opens=java.base/sun.security.action=ALL-UNNAMED --add-opens=java.base/sun.util.calendar=ALL-UNNAMED --add-opens=java.security.jgss/sun.security.krb5=ALL-UNNAMED --add-opens=java.management/sun.management=ALL-UNNAMED"\n    file_cache_path = [{"path":"/mnt/disk1/doris_cloud/file_cache","total_size":104857600000,"query_limit":10485760000}, {"path":"/mnt/disk2/doris_cloud/file_cache","total_size":104857600000,"query_limit":10485760000}]\n')),(0,n.yg)("p",null,'The below describe "cg1" Compute Group to use the above ConfigMap to start:'),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-yaml"},'spec:\n  computeGroups:\n  - uniqueId: cg1\n    image: {beImage}\n    configMaps:\n    - name: be-configmap\n      mountPath: "/etc/doris"\n')),(0,n.yg)("p",null,"Update the configuration to the Doris ",(0,n.yg)("a",{parentName:"p",href:"/docs/3.0/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/install-quickstart#step-2-quickly-deploy-a-storage-and-computing-separation-cluster"},"DorisDisaggregatedCluster")," resource that to be deployed. "),(0,n.yg)("h3",{id:"4config-the-persistent-volume-template"},"4.Config the persistent volume template"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-yaml"},'spec:\n  computeGroups:\n  - uniqueId: cg1\n    persistentVolume:\n      persistentVolumeClaimSpec:\n        #storageClassName\uff1a{storageClassName}\n        accessModes:\n        - ReadWriteOnce\n        resources:\n          requests:\n            storage: "100Gi"\n')),(0,n.yg)("p",null,"Above, Describe cg1 compute group use 100Gi persistent storage and the persistent storage will create by default ",(0,n.yg)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/storage/storage-classes/"},"StorageClass"),".\nIn K8s deployment mode, Doris-Operator mounts customized persistent storage for each path. If you need to specify multiple paths to mount multiple disks as data cache, please refer to ",(0,n.yg)("a",{parentName:"p",href:"#2custom-storage-configuration"},"Custom Storage Configuration"),"."),(0,n.yg)("admonition",{title:"Tip",type:"tip"},(0,n.yg)("ul",{parentName:"admonition"},(0,n.yg)("li",{parentName:"ul"},"The value of file_cache_path must be a JSON array."),(0,n.yg)("li",{parentName:"ul"},"All startup configurations must be mounted in the /etc/doris directory.  "))))}g.isMDXComponent=!0}}]);