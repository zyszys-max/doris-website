"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([[976263],{15680:(e,t,a)=>{a.d(t,{xA:()=>c,yg:()=>T});var n=a(296540);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var s=n.createContext({}),u=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},c=function(e){var t=u(e.components);return n.createElement(s.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=u(a),m=i,T=p["".concat(s,".").concat(m)]||p[m]||d[m]||r;return a?n.createElement(T,o(o({ref:t},c),{},{components:a})):n.createElement(T,o({ref:t},c))}));function T(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,o=new Array(r);o[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:i,o[1]=l;for(var u=2;u<r;u++)o[u]=a[u];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},119365:(e,t,a)=>{a.d(t,{A:()=>o});var n=a(296540),i=a(320053);const r={tabItem:"tabItem_Ymn6"};function o(e){let{children:t,hidden:a,className:o}=e;return n.createElement("div",{role:"tabpanel",className:(0,i.A)(r.tabItem,o),hidden:a},t)}},411470:(e,t,a)=>{a.d(t,{A:()=>f});var n=a(58168),i=a(296540),r=a(320053),o=a(823104),l=a(956347),s=a(757485),u=a(231682),c=a(289466);function p(e){return function(e){return i.Children.map(e,(e=>{if(!e||(0,i.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:a,attributes:n,default:i}}=e;return{value:t,label:a,attributes:n,default:i}}))}function d(e){const{values:t,children:a}=e;return(0,i.useMemo)((()=>{const e=t??p(a);return function(e){const t=(0,u.X)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,a])}function m(e){let{value:t,tabValues:a}=e;return a.some((e=>e.value===t))}function T(e){let{queryString:t=!1,groupId:a}=e;const n=(0,l.W6)(),r=function(e){let{queryString:t=!1,groupId:a}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return a??null}({queryString:t,groupId:a});return[(0,s.aZ)(r),(0,i.useCallback)((e=>{if(!r)return;const t=new URLSearchParams(n.location.search);t.set(r,e),n.replace({...n.location,search:t.toString()})}),[r,n])]}function g(e){const{defaultValue:t,queryString:a=!1,groupId:n}=e,r=d(e),[o,l]=(0,i.useState)((()=>function(e){let{defaultValue:t,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:a}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${a.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const n=a.find((e=>e.default))??a[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:r}))),[s,u]=T({queryString:a,groupId:n}),[p,g]=function(e){let{groupId:t}=e;const a=function(e){return e?`docusaurus.tab.${e}`:null}(t),[n,r]=(0,c.Dv)(a);return[n,(0,i.useCallback)((e=>{a&&r.set(e)}),[a,r])]}({groupId:n}),E=(()=>{const e=s??p;return m({value:e,tabValues:r})?e:null})();(0,i.useLayoutEffect)((()=>{E&&l(E)}),[E]);return{selectedValue:o,selectValue:(0,i.useCallback)((e=>{if(!m({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),g(e)}),[u,g,r]),tabValues:r}}var E=a(992303);const y={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function N(e){let{className:t,block:a,selectedValue:l,selectValue:s,tabValues:u}=e;const c=[],{blockElementScrollPositionUntilNextRender:p}=(0,o.a_)(),d=e=>{const t=e.currentTarget,a=c.indexOf(t),n=u[a].value;n!==l&&(p(t),s(n))},m=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const a=c.indexOf(e.currentTarget)+1;t=c[a]??c[0];break}case"ArrowLeft":{const a=c.indexOf(e.currentTarget)-1;t=c[a]??c[c.length-1];break}}t?.focus()};return i.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":a},t)},u.map((e=>{let{value:t,label:a,attributes:o}=e;return i.createElement("li",(0,n.A)({role:"tab",tabIndex:l===t?0:-1,"aria-selected":l===t,key:t,ref:e=>c.push(e),onKeyDown:m,onClick:d},o,{className:(0,r.A)("tabs__item",y.tabItem,o?.className,{"tabs__item--active":l===t})}),a??t)})))}function A(e){let{lazy:t,children:a,selectedValue:n}=e;const r=(Array.isArray(a)?a:[a]).filter(Boolean);if(t){const e=r.find((e=>e.props.value===n));return e?(0,i.cloneElement)(e,{className:"margin-top--md"}):null}return i.createElement("div",{className:"margin-top--md"},r.map(((e,t)=>(0,i.cloneElement)(e,{key:t,hidden:e.props.value!==n}))))}function h(e){const t=g(e);return i.createElement("div",{className:(0,r.A)("tabs-container",y.tabList)},i.createElement(N,(0,n.A)({},e,t)),i.createElement(A,(0,n.A)({},e,t)))}function f(e){const t=(0,E.A)();return i.createElement(h,(0,n.A)({key:String(t)},e))}},305101:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>T,frontMatter:()=>l,metadata:()=>u,toc:()=>p});var n=a(58168),i=(a(296540),a(15680)),r=a(411470),o=a(119365);const l={title:"Basic concepts",language:"en"},s=void 0,u={unversionedId:"table-design/data-partitioning/basic-concepts",id:"version-2.1/table-design/data-partitioning/basic-concepts",title:"Basic concepts",description:"\x3c!--",source:"@site/versioned_docs/version-2.1/table-design/data-partitioning/basic-concepts.md",sourceDirName:"table-design/data-partitioning",slug:"/table-design/data-partitioning/basic-concepts",permalink:"/docs/table-design/data-partitioning/basic-concepts",draft:!1,tags:[],version:"2.1",frontMatter:{title:"Basic concepts",language:"en"},sidebar:"docs",previous:{title:"Hybrid Storage",permalink:"/docs/table-design/row-store"},next:{title:"Manual partitioning",permalink:"/docs/table-design/data-partitioning/manual-partitioning"}},c={},p=[{value:"Row &amp; Column",id:"row--column",level:2},{value:"Partition &amp; Bucket",id:"partition--bucket",level:2},{value:"Partition",id:"partition",level:3},{value:"Bucket",id:"bucket",level:3},{value:"Example of creating a table",id:"example-of-creating-a-table",level:2},{value:"Advanced Features and Examples",id:"advanced-features-and-examples",level:3},{value:"View partitions",id:"view-partitions",level:2},{value:"Alter partitions",id:"alter-partitions",level:2},{value:"Partition Retrieval",id:"partition-retrieval",level:2}],d={toc:p},m="wrapper";function T(e){let{components:t,...a}=e;return(0,i.yg)(m,(0,n.A)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,i.yg)("p",null,"This document mainly introduces table creation and data partitioning in Doris, as well as potential problems and solutions encountered during table creation operations."),(0,i.yg)("h2",{id:"row--column"},"Row & Column"),(0,i.yg)("p",null,"In Doris, data is logically described in the form of tables."),(0,i.yg)("p",null,"A table consists of rows and columns:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},"Row: Represents a single line of user data;")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},"Column: Used to describe different fields in a row of data;")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},"Columns can be divided into two types: Key and Value. From a business perspective, Key and Value can correspond to dimension columns and metric columns respectively. The key columns in Apache Doris are those specified in the table creation statement, which are the columns following the keywords  ",(0,i.yg)("inlineCode",{parentName:"p"},"unique key"),", ",(0,i.yg)("inlineCode",{parentName:"p"},"aggregate key"),", or ",(0,i.yg)("inlineCode",{parentName:"p"},"duplicate key"),". The remaining columns are value columns. From the perspective of the aggregation model, rows with the same Key columns will be aggregated into a single row. The aggregation method for value columns is specified by the user during table creation. For more information on aggregation models, refer to the Doris ",(0,i.yg)("a",{parentName:"p",href:"../../table-design/data-model/overview"},"Data Model"),"."))),(0,i.yg)("h2",{id:"partition--bucket"},"Partition & Bucket"),(0,i.yg)("p",null,"Doris uses a two-level partitioning and bucketing method to organize and manage data."),(0,i.yg)("h3",{id:"partition"},"Partition"),(0,i.yg)("p",null,"Partition refers to dividing the table into smaller, more manageable, non-overlapping subsets based on specific column values in the table. Each subset of data is called a partition. Each row of data belongs to exactly one specific partition. Partitions can be seen as the smallest logical management unit."),(0,i.yg)("p",null,"Currently, Doris supports two types of partitioning: Range and List. If no partition is specified during table creation, Doris will generate a default partition containing all the data in the table, which is transparent to the user."),(0,i.yg)("p",null,"Partitioning based on data distribution and query patterns offers several benefits:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},(0,i.yg)("strong",{parentName:"p"},"Improved Query Performance"),": Partitioning allows the system to prune irrelevant partitions based on the query conditions, reducing the amount of data scanned and significantly improving query efficiency. This is especially beneficial when handling large datasets, as the partition strategy can greatly reduce I/O overhead.")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},(0,i.yg)("strong",{parentName:"p"},"Flexible Management"),": Partitioning allows data to be split based on logic such as time or geography, facilitating data archiving, cleaning, and backup. For example, partitioning by time can effectively manage historical and newly added data, supporting efficient time-based data maintenance strategies."))),(0,i.yg)("h3",{id:"bucket"},"Bucket"),(0,i.yg)("p",null,"Bucketing refers to further dividing the data within a partition into smaller, non-overlapping units according to some rule. Each row of data belongs to exactly one specific bucket. Unlike partitioning, which divides data based on specific column values, bucketing attempts to evenly distribute the data across predefined buckets, thereby reducing data skew. Bucketing improves query performance by ensuring even data distribution and enhancing data locality."),(0,i.yg)("p",null,"Currently, Doris supports two types of bucketing: Hash and Random."),(0,i.yg)("p",null,"A bucket corresponds to a data shard (Tablet) at the physical level, and data shards are physically stored independently. They are the smallest physical storage units for operations like data movement and replication."),(0,i.yg)("p",null,"Proper bucketing offers several advantages:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},(0,i.yg)("strong",{parentName:"p"},"Even Data Distribution"),": Bucketing evenly distributes data across buckets, reducing the risk of data concentration or skew, and preventing resource overload on specific nodes or storage devices.")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},(0,i.yg)("strong",{parentName:"p"},"Reduced Hotspots"),": By distributing data evenly, bucketing helps to reduce the risk of overloading specific nodes or partitions, preventing hotspots, and improving system stability and processing capability.")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},(0,i.yg)("strong",{parentName:"p"},"Improved Concurrency Performance"),": Bucketing enhances the performance of concurrent queries, especially when multiple query requests need to access different data within the same partition. The granularity of bucketing allows the system to efficiently process multiple requests in parallel, thereby improving throughput."))),(0,i.yg)("h2",{id:"example-of-creating-a-table"},"Example of creating a table"),(0,i.yg)("p",null,(0,i.yg)("inlineCode",{parentName:"p"},"CREATE TABLE")," in Apache Doris is a synchronous command which returns the result once the SQL is executed. Successful returns indicate successful table creation. For more information, refer to ",(0,i.yg)("a",{parentName:"p",href:"../../sql-manual/sql-statements/Data-Definition-Statements/Create/CREATE-TABLE"},"CREATE-TABLE")," or input  the ",(0,i.yg)("inlineCode",{parentName:"p"},"HELP CREATE TABLE")," command."),(0,i.yg)("p",null,"The following code sample introduces how to create tables in Apache Doris by RANGE partitioning and Hash buckets."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-sql"},'-- Range Partition\nCREATE TABLE IF NOT EXISTS example_range_tbl\n(\n    `user_id` LARGEINT NOT NULL COMMENT "User ID",\n    `date` DATE NOT NULL COMMENT "Date when the data are imported",\n    `timestamp` DATETIME NOT NULL COMMENT "Timestamp when the data are imported",\n    `city` VARCHAR(20) COMMENT "User location city",\n    `age` SMALLINT COMMENT "User age",\n    `sex` TINYINT COMMENT "User gender",\n    `last_visit_date` DATETIME REPLACE DEFAULT "1970-01-01 00:00:00" COMMENT "User last visit time",\n    `cost` BIGINT SUM DEFAULT "0" COMMENT "Total user consumption",\n    `max_dwell_time` INT MAX DEFAULT "0" COMMENT "Maximum user dwell time",\n    `min_dwell_time` INT MIN DEFAULT "99999" COMMENT "Minimum user dwell time"   \n)\nENGINE=OLAP\nAGGREGATE KEY(`user_id`, `date`, `timestamp`, `city`, `age`, `sex`)\nPARTITION BY RANGE(`date`)\n(\n    PARTITION `p201701` VALUES [("2017-01-01"),  ("2017-02-01")),\n    PARTITION `p201702` VALUES [("2017-02-01"), ("2017-03-01")),\n    PARTITION `p201703` VALUES [("2017-03-01"), ("2017-04-01"))\n)\nDISTRIBUTED BY HASH(`user_id`) BUCKETS 16\nPROPERTIES\n(\n    "replication_num" = "1"\n);\n')),(0,i.yg)("p",null,"Here use Aggregate Key Model as an example. In Aggregate Key Model, all columns that are specified with an aggregation type (SUM, REPLACE, MAX, or MIN) are Value columns. The rest are the Key columns."),(0,i.yg)("p",null,"For more information about what fields can be set in the ",(0,i.yg)("inlineCode",{parentName:"p"},"PROPERTIES")," section of  ",(0,i.yg)("inlineCode",{parentName:"p"},"CREATE TABLE"),", refer to ",(0,i.yg)("a",{parentName:"p",href:"/docs/sql-manual/sql-statements/Data-Definition-Statements/Create/CREATE-TABLE"},"CREATE-TABLE"),"."),(0,i.yg)("p",null,"The default type of ",(0,i.yg)("inlineCode",{parentName:"p"},"ENGINE")," is ",(0,i.yg)("inlineCode",{parentName:"p"},"OLAP"),". Only OLAP is responsible for data management and storage by Apache Doris itself. Other engine types, such as MySQL, Broker and ES, are essentially just mappings to tables in other external databases or systems, allowing Apache Doris to read this data. However, Apache Doris itself does not create, manage, or store any tables or data for engine types except OLAP."),(0,i.yg)("p",null,(0,i.yg)("inlineCode",{parentName:"p"},"IF NOT EXISTS"),"  indicates that if the table has not been created before, it will be created. Note that this only checks if the table name exists and does not check if the schema of the new table is the same as the schema of an existing table. Therefore, if there is a table with the same name but a different schema, this command will also return successfully, but it does not mean that a new table with a new schema has been created."),(0,i.yg)("h3",{id:"advanced-features-and-examples"},"Advanced Features and Examples"),(0,i.yg)("p",null,"Doris supports advanced data partitioning methods, including Dynamic Partition, Auto Partition, and Auto Bucket, which enable more flexible data management. The following are examples of implementations:"),(0,i.yg)(r.A,{mdxType:"Tabs"},(0,i.yg)(o.A,{value:"Auto Partition",label:"Auto Partition",default:!0,mdxType:"TabItem"},(0,i.yg)("p",null,(0,i.yg)("p",null,(0,i.yg)("a",{parentName:"p",href:"./auto-partitioning"},"Auto Partition")," supports automatic creation of corresponding partitions according to user-defined rules during data import, which is more convenient. Rewrite the above example with Auto Range Partition as follows:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-sql"},'CREATE TABLE IF NOT EXISTS example_range_tbl\n(\n    `user_id` LARGEINT NOT NULL COMMENT "User ID",\n    `date` DATE NOT NULL COMMENT "Date when the data are imported",\n    `timestamp` DATETIME NOT NULL COMMENT "Timestamp when the data are imported",\n    `city` VARCHAR(20) COMMENT "User location city",\n    `age` SMALLINT COMMENT "User age",\n    `sex` TINYINT COMMENT "User gender",\n    `last_visit_date` DATETIME REPLACE DEFAULT "1970-01-01 00:00:00" COMMENT "User last visit time",\n    `cost` BIGINT SUM DEFAULT "0" COMMENT "Total user consumption",\n    `max_dwell_time` INT MAX DEFAULT "0" COMMENT "Maximum user dwell time",\n    `min_dwell_time` INT MIN DEFAULT "99999" COMMENT "Minimum user dwell time"   \n)\nENGINE=OLAP\nAGGREGATE KEY(`user_id`, `date`, `timestamp`, `city`, `age`, `sex`)\nAUTO PARTITION BY RANGE(date_trunc(`date`, \'month\')) --- Using months as partition granularity\n()\nDISTRIBUTED BY HASH(`user_id`) BUCKETS 16\nPROPERTIES\n(\n    "replication_num" = "1"\n);\n')),(0,i.yg)("p",null,"As above, when the data is imported, Doris will automatically create the corresponding partitions as ",(0,i.yg)("inlineCode",{parentName:"p"},"date")," with a granularity of month level. ",(0,i.yg)("inlineCode",{parentName:"p"},"2018-12-01")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"2018-12-31")," will fall into the same partition, while ",(0,i.yg)("inlineCode",{parentName:"p"},"2018-11-12")," will fall into the leading partition. Auto Partition also supports List partition, please check Auto Partition's documentation for more usage."))),(0,i.yg)(o.A,{value:"Dynamic Partition",label:"Dynamic Partition",mdxType:"TabItem"},(0,i.yg)("p",null,(0,i.yg)("p",null,(0,i.yg)("a",{parentName:"p",href:"./dynamic-partitioning"},"Dynamic Partition")," is an automatic partition creation and recovery management method based on the real time, rewrite the above example with dynamic partitioning as follows:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-sql"},'CREATE TABLE IF NOT EXISTS example_range_tbl\n(\n    `user_id` LARGEINT NOT NULL COMMENT "User ID",\n    `date` DATE NOT NULL COMMENT "Date when the data are imported",\n    `timestamp` DATETIME NOT NULL COMMENT "Timestamp when the data are imported",\n    `city` VARCHAR(20) COMMENT "User location city",\n    `age` SMALLINT COMMENT "User age",\n    `sex` TINYINT COMMENT "User gender",\n    `last_visit_date` DATETIME REPLACE DEFAULT "1970-01-01 00:00:00" COMMENT "User last visit time",\n    `cost` BIGINT SUM DEFAULT "0" COMMENT "Total user consumption",\n    `max_dwell_time` INT MAX DEFAULT "0" COMMENT "Maximum user dwell time",\n    `min_dwell_time` INT MIN DEFAULT "99999" COMMENT "Minimum user dwell time"   \n)\nENGINE=OLAP\nAGGREGATE KEY(`user_id`, `date`, `timestamp`, `city`, `age`, `sex`)\nPARTITION BY RANGE(`date`)\n()\nDISTRIBUTED BY HASH(`user_id`) BUCKETS 16\nPROPERTIES\n(\n    "replication_num" = "1",\n    "dynamic_partition.enable" = "true",\n    "dynamic_partition.time_unit" = "WEEK", --- Partition granularity is week\n    "dynamic_partition.start" = "-2", --- Retain two weeks forward\n    "dynamic_partition.end" = "2", --- Two weeks after creation in advance\n    "dynamic_partition.prefix" = "p",\n    "dynamic_partition.buckets" = "8"\n);\n')),(0,i.yg)("p",null,"Dynamic partition supports tiered storage, customised copy number and other features, see the dynamic partition documentation for details."))),(0,i.yg)(o.A,{value:"Auto&Dynamic Partition",label:"Auto&Dynamic Partition",mdxType:"TabItem"},(0,i.yg)("p",null,(0,i.yg)("admonition",{type:"tip"},(0,i.yg)("p",{parentName:"admonition"},"Supported since Doris 2.1.7")),(0,i.yg)("p",null,"Auto Partition and Dynamic Partition each have their own advantages, and combining the two enables flexible on-demand partition creation and automatic reclamation:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-sql"},'CREATE TABLE IF NOT EXISTS example_range_tbl\n(\n    `user_id` LARGEINT NOT NULL COMMENT "User ID",\n    `date` DATE NOT NULL COMMENT "Date when the data are imported",\n    `timestamp` DATETIME NOT NULL COMMENT "Timestamp when the data are imported",\n    `city` VARCHAR(20) COMMENT "User location city",\n    `age` SMALLINT COMMENT "User age",\n    `sex` TINYINT COMMENT "User gender",\n    `last_visit_date` DATETIME REPLACE DEFAULT "1970-01-01 00:00:00" COMMENT "User last visit time",\n    `cost` BIGINT SUM DEFAULT "0" COMMENT "Total user consumption",\n    `max_dwell_time` INT MAX DEFAULT "0" COMMENT "Maximum user dwell time",\n    `min_dwell_time` INT MIN DEFAULT "99999" COMMENT "Minimum user dwell time"   \n)\nENGINE=OLAP\nAGGREGATE KEY(`user_id`, `date`, `timestamp`, `city`, `age`, `sex`)\nAUTO PARTITION BY RANGE(date_trunc(`date`, \'month\')) --- Using months as partition granularity\n()\nDISTRIBUTED BY HASH(`user_id`) BUCKETS 16\nPROPERTIES\n(\n    "replication_num" = "1",\n    "dynamic_partition.enable" = "true",\n    "dynamic_partition.time_unit" = "month", --- Both must have the same granularity\n    "dynamic_partition.start" = "-2", --- Dynamic Partition automatically cleans up partitions that are more than two weeks old\n    "dynamic_partition.end" = "0", --- Dynamic Partition does not create future partitions. it is left entirely to Auto Partition.\n    "dynamic_partition.prefix" = "p",\n    "dynamic_partition.buckets" = "8"\n);\n')),(0,i.yg)("p",null,"For detailed suggestions on this feature, see ",(0,i.yg)("a",{parentName:"p",href:"./auto-partitioning#conjunct-with-dynamic-partition"},"Auto Partition Conjunct with Dynamic Partition"),"\u3002"))),(0,i.yg)(o.A,{value:"Auto Bucket",label:"Auto Bucket",mdxType:"TabItem"},(0,i.yg)("p",null,(0,i.yg)("p",null,"When the user is not sure of a reasonable number of buckets, ",(0,i.yg)("a",{parentName:"p",href:"./auto-bucket"},"Auto Bucket")," for Doris to complete the estimation, and the user only needs to provide the estimated amount of table data:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-sql"},'CREATE TABLE IF NOT EXISTS example_range_tbl\n(\n    `user_id` LARGEINT NOT NULL COMMENT "User ID",\n    `date` DATE NOT NULL COMMENT "Date when the data are imported",\n    `timestamp` DATETIME NOT NULL COMMENT "Timestamp when the data are imported",\n    `city` VARCHAR(20) COMMENT "User location city",\n    `age` SMALLINT COMMENT "User age",\n    `sex` TINYINT COMMENT "User gender",\n    `last_visit_date` DATETIME REPLACE DEFAULT "1970-01-01 00:00:00" COMMENT "User last visit time",\n    `cost` BIGINT SUM DEFAULT "0" COMMENT "Total user consumption",\n    `max_dwell_time` INT MAX DEFAULT "0" COMMENT "Maximum user dwell time",\n    `min_dwell_time` INT MIN DEFAULT "99999" COMMENT "Minimum user dwell time"   \n)\nENGINE=OLAP\nAGGREGATE KEY(`user_id`, `date`, `timestamp`, `city`, `age`, `sex`)\nPARTITION BY RANGE(`date`)\n(\n    PARTITION `p201701` VALUES LESS THAN ("2017-02-01"),\n    PARTITION `p201702` VALUES LESS THAN ("2017-03-01"),\n    PARTITION `p201703` VALUES LESS THAN ("2017-04-01"),\n    PARTITION `p2018` VALUES [("2018-01-01"), ("2019-01-01"))\n)\nDISTRIBUTED BY HASH(`user_id`) BUCKETS AUTO\nPROPERTIES\n(\n    "replication_num" = "1",\n    "estimate_partition_size" = "2G" --- User estimate of the amount of data a partition will have, defaults to 10G if not provided \n);\n')),(0,i.yg)("p",null,"Note that this approach does not apply to cases where the amount of table data is particularly large. ")))),(0,i.yg)("h2",{id:"view-partitions"},"View partitions"),(0,i.yg)("p",null,"View the partiton information of a table by running the ",(0,i.yg)("inlineCode",{parentName:"p"},"show create table")," command."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-sql"},"> show create table  example_range_tbl \n+-------------------+---------------------------------------------------------------------------------------------------------+                                                                                                            \n| Table             | Create Table                                                                                            |                                                                                                            \n+-------------------+---------------------------------------------------------------------------------------------------------+                                                                                                            \n| example_range_tbl | CREATE TABLE `example_range_tbl` (                                                                      |                                                                                                            \n|                   |   `user_id` largeint(40) NOT NULL COMMENT 'User ID',                                                     |                                                                                                            \n|                   |   `date` date NOT NULL COMMENT 'Date when the data are imported',                                                      |                                                                                                            \n|                   |   `timestamp` datetime NOT NULL COMMENT 'Timestamp when the data are imported',                                             |                                                                                                            \n|                   |   `city` varchar(20) NULL COMMENT 'User location city',                                                       |                                                                                                            \n|                   |   `age` smallint(6) NULL COMMENT 'User age',                                                            |                                                                                                            \n|                   |   `sex` tinyint(4) NULL COMMENT 'User gender',                                                             |                                                                                                            \n|                   |   `last_visit_date` datetime REPLACE NULL DEFAULT \"1970-01-01 00:00:00\" COMMENT 'User last visit time', |                                                                                                            \n|                   |   `cost` bigint(20) SUM NULL DEFAULT \"0\" COMMENT 'Total user consumption',                                          |                                                                                                            \n|                   |   `max_dwell_time` int(11) MAX NULL DEFAULT \"0\" COMMENT 'Maximum user dwell time',                             |                                                                                                            \n|                   |   `min_dwell_time` int(11) MIN NULL DEFAULT \"99999\" COMMENT 'Minimum user dwell time'                          |                                                                                                            \n|                   | ) ENGINE=OLAP                                                                                           |                                                                                                            \n|                   | AGGREGATE KEY(`user_id`, `date`, `timestamp`, `city`, `age`, `sex`)                                     |                                                                                                            \n|                   | COMMENT 'OLAP'                                                                                          |                                                                                                            \n|                   | PARTITION BY RANGE(`date`)                                                                              |                                                                                                            \n|                   | (PARTITION p201701 VALUES [('0000-01-01'), ('2017-02-01')),                                             |                                                                                                            \n|                   | PARTITION p201702 VALUES [('2017-02-01'), ('2017-03-01')),                                              |                                                                                                            \n|                   | PARTITION p201703 VALUES [('2017-03-01'), ('2017-04-01')))                                              |                                                                                                            \n|                   | DISTRIBUTED BY HASH(`user_id`) BUCKETS 16                                                               |                                                                                                            \n|                   | PROPERTIES (                                                                                            |                                                                                                            \n|                   | \"replication_allocation\" = \"tag.location.default: 1\",                                                   |                                                                                                            \n|                   | \"is_being_synced\" = \"false\",                                                                            |                                                                                                            \n|                   | \"storage_format\" = \"V2\",                                                                                |                                                                                                            \n|                   | \"light_schema_change\" = \"true\",                                                                         |                                                                                                            \n|                   | \"disable_auto_compaction\" = \"false\",                                                                    |                                                                                                            \n|                   | \"enable_single_replica_compaction\" = \"false\"                                                            |                                                                                                            \n|                   | );                                                                                                      |                                                                                                            \n+-------------------+---------------------------------------------------------------------------------------------------------+   \n")),(0,i.yg)("p",null,"Or run the ",(0,i.yg)("inlineCode",{parentName:"p"},"show partitions from your_table")," command."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-sql"},"> show partitions from example_range_tbl\n+-------------+---------------+----------------+---------------------+--------+--------------+--------------------------------------------------------------------------------+-----------------+---------+----------------+---------------\n+---------------------+---------------------+--------------------------+----------+------------+-------------------------+-----------+                                                                                                     \n| PartitionId | PartitionName | VisibleVersion | VisibleVersionTime  | State  | PartitionKey | Range                                                                          | DistributionKey | Buckets | ReplicationNum | StorageMedium \n| CooldownTime        | RemoteStoragePolicy | LastConsistencyCheckTime | DataSize | IsInMemory | ReplicaAllocation       | IsMutable |                                                                                                     \n+-------------+---------------+----------------+---------------------+--------+--------------+--------------------------------------------------------------------------------+-----------------+---------+----------------+---------------\n+---------------------+---------------------+--------------------------+----------+------------+-------------------------+-----------+                                                                                                     \n| 28731       | p201701       | 1              | 2024-01-25 10:50:51 | NORMAL | date         | [types: [DATEV2]; keys: [0000-01-01]; ..types: [DATEV2]; keys: [2017-02-01]; ) | user_id         | 16      | 1              | HDD           \n| 9999-12-31 23:59:59 |                     |                    | 0.000    | false      | tag.location.default: 1 | true      |                                                                                                     \n| 28732       | p201702       | 1              | 2024-01-25 10:50:51 | NORMAL | date         | [types: [DATEV2]; keys: [2017-02-01]; ..types: [DATEV2]; keys: [2017-03-01]; ) | user_id         | 16      | 1              | HDD           \n| 9999-12-31 23:59:59 |                     |                    | 0.000    | false      | tag.location.default: 1 | true      |                                                                                                     \n| 28733       | p201703       | 1              | 2024-01-25 10:50:51 | NORMAL | date         | [types: [DATEV2]; keys: [2017-03-01]; ..types: [DATEV2]; keys: [2017-04-01]; ) | user_id         | 16      | 1              | HDD           \n| 9999-12-31 23:59:59 |                     |                    | 0.000    | false      | tag.location.default: 1 | true      |                                                                                                     \n+-------------+---------------+----------------+---------------------+--------+--------------+--------------------------------------------------------------------------------+-----------------+---------+----------------+---------------\n+---------------------+---------------------+--------------------------+----------+------------+-------------------------+-----------+                  \n")),(0,i.yg)("h2",{id:"alter-partitions"},"Alter partitions"),(0,i.yg)("p",null,"You can add a new partition by running the  ",(0,i.yg)("inlineCode",{parentName:"p"},"alter table add partition ")," command."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-sql"},'ALTER TABLE example_range_tbl ADD PARTITION p201704 VALUES LESS THAN("2020-05-01") DISTRIBUTED BY HASH(`user_id`) BUCKETS 5;\n')),(0,i.yg)("p",null,"For more information about how to alter partitions, refer to ",(0,i.yg)("a",{parentName:"p",href:"/docs/sql-manual/sql-statements/Data-Definition-Statements/Alter/ALTER-TABLE-PARTITION"},"ALTER-TABLE-PARTITION"),"."),(0,i.yg)("h2",{id:"partition-retrieval"},"Partition Retrieval"),(0,i.yg)("p",null,"The ",(0,i.yg)("inlineCode",{parentName:"p"},"partitions")," table function( supported since 2.1.5) and the ",(0,i.yg)("inlineCode",{parentName:"p"},"information_schema.partitions")," system table( supported since 2.1.7) record partition information for the cluster. The partition information can be extracted from the corresponding table for use when automatically managing partitions:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-sql"},"--- Find the partition with the corresponding value in the Auto Partition table.\nmysql> select * from partitions(\"catalog\"=\"internal\", \"database\"=\"optest\", \"table\"=\"DAILY_TRADE_VALUE\") where PartitionName = auto_partition_name('range', 'year', '2008-02-03');\n+-------------+-----------------+----------------+---------------------+--------+--------------+--------------------------------------------------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+-----------+------------+-------------------------+-----------+--------------------+--------------+\n| PartitionId | PartitionName   | VisibleVersion | VisibleVersionTime  | State  | PartitionKey | Range                                                                          | DistributionKey | Buckets | ReplicationNum | StorageMedium | CooldownTime        | RemoteStoragePolicy | LastConsistencyCheckTime | DataSize  | IsInMemory | ReplicaAllocation       | IsMutable | SyncWithBaseTables | UnsyncTables |\n+-------------+-----------------+----------------+---------------------+--------+--------------+--------------------------------------------------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+-----------+------------+-------------------------+-----------+--------------------+--------------+\n|      127095 | p20080101000000 |              2 | 2024-11-14 17:29:02 | NORMAL | TRADE_DATE   | [types: [DATEV2]; keys: [2008-01-01]; ..types: [DATEV2]; keys: [2009-01-01]; ) | TRADE_DATE      |      10 |              1 | HDD           | 9999-12-31 23:59:59 |                     | \\N                       | 985.000 B |          0 | tag.location.default: 1 |         1 |                  1 | \\N           |\n+-------------+-----------------+----------------+---------------------+--------+--------------+--------------------------------------------------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+-----------+------------+-------------------------+-----------+--------------------+--------------+\n1 row in set (0.30 sec)\n\nmysql> select * from information_schema.partitions where TABLE_SCHEMA='optest' and TABLE_NAME='list_table1' and PARTITION_NAME=auto_partition_name('list', null);\n+---------------+--------------+-------------+----------------+-------------------+----------------------------+-------------------------------+------------------+---------------------+----------------------+-------------------------+-----------------------+------------+----------------+-------------+-----------------+--------------+-----------+-------------+---------------------+---------------------+----------+-------------------+-----------+-----------------+\n| TABLE_CATALOG | TABLE_SCHEMA | TABLE_NAME  | PARTITION_NAME | SUBPARTITION_NAME | PARTITION_ORDINAL_POSITION | SUBPARTITION_ORDINAL_POSITION | PARTITION_METHOD | SUBPARTITION_METHOD | PARTITION_EXPRESSION | SUBPARTITION_EXPRESSION | PARTITION_DESCRIPTION | TABLE_ROWS | AVG_ROW_LENGTH | DATA_LENGTH | MAX_DATA_LENGTH | INDEX_LENGTH | DATA_FREE | CREATE_TIME | UPDATE_TIME         | CHECK_TIME          | CHECKSUM | PARTITION_COMMENT | NODEGROUP | TABLESPACE_NAME |\n+---------------+--------------+-------------+----------------+-------------------+----------------------------+-------------------------------+------------------+---------------------+----------------------+-------------------------+-----------------------+------------+----------------+-------------+-----------------+--------------+-----------+-------------+---------------------+---------------------+----------+-------------------+-----------+-----------------+\n| internal      | optest       | list_table1 | pX             | NULL              |                          0 |                             0 | LIST             | NULL                | str                  | NULL                    | (NULL)                |          1 |           1266 |        1266 |               0 |            0 |         0 |           0 | 2024-11-14 19:58:45 | 0000-00-00 00:00:00 |        0 |                   |           |                 |\n+---------------+--------------+-------------+----------------+-------------------+----------------------------+-------------------------------+------------------+---------------------+----------------------+-------------------------+-----------------------+------------+----------------+-------------+-----------------+--------------+-----------+-------------+---------------------+---------------------+----------+-------------------+-----------+-----------------+\n1 row in set (0.24 sec)\n\n--- Find the partition that corresponds to the starting point\nmysql> select * from information_schema.partitions where TABLE_NAME='DAILY_TRADE_VALUE' and PARTITION_DESCRIPTION like \"[('2012-01-01'),%\";\n+---------------+--------------+-------------------+-----------------+-------------------+----------------------------+-------------------------------+------------------+---------------------+----------------------+-------------------------+----------------------------------+------------+----------------+-------------+-----------------+--------------+-----------+-------------+---------------------+---------------------+----------+-------------------+-----------+-----------------+\n| TABLE_CATALOG | TABLE_SCHEMA | TABLE_NAME        | PARTITION_NAME  | SUBPARTITION_NAME | PARTITION_ORDINAL_POSITION | SUBPARTITION_ORDINAL_POSITION | PARTITION_METHOD | SUBPARTITION_METHOD | PARTITION_EXPRESSION | SUBPARTITION_EXPRESSION | PARTITION_DESCRIPTION            | TABLE_ROWS | AVG_ROW_LENGTH | DATA_LENGTH | MAX_DATA_LENGTH | INDEX_LENGTH | DATA_FREE | CREATE_TIME | UPDATE_TIME         | CHECK_TIME          | CHECKSUM | PARTITION_COMMENT | NODEGROUP | TABLESPACE_NAME |\n+---------------+--------------+-------------------+-----------------+-------------------+----------------------------+-------------------------------+------------------+---------------------+----------------------+-------------------------+----------------------------------+------------+----------------+-------------+-----------------+--------------+-----------+-------------+---------------------+---------------------+----------+-------------------+-----------+-----------------+\n| internal      | optest       | DAILY_TRADE_VALUE | p20120101000000 | NULL              |                          0 |                             0 | RANGE            | NULL                | TRADE_DATE           | NULL                    | [('2012-01-01'), ('2013-01-01')) |          1 |            985 |         985 |               0 |            0 |         0 |           0 | 2024-11-14 17:29:02 | 0000-00-00 00:00:00 |        0 |                   |           |                 |\n+---------------+--------------+-------------------+-----------------+-------------------+----------------------------+-------------------------------+------------------+---------------------+----------------------+-------------------------+----------------------------------+------------+----------------+-------------+-----------------+--------------+-----------+-------------+---------------------+---------------------+----------+-------------------+-----------+-----------------+\n1 row in set (0.65 sec)\n")))}T.isMDXComponent=!0}}]);