"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([[412848],{15680:(n,e,t)=>{t.d(e,{xA:()=>h,yg:()=>u});var i=t(296540);function a(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function l(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,i)}return t}function s(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?l(Object(t),!0).forEach((function(e){a(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function o(n,e){if(null==n)return{};var t,i,a=function(n,e){if(null==n)return{};var t,i,a={},l=Object.keys(n);for(i=0;i<l.length;i++)t=l[i],e.indexOf(t)>=0||(a[t]=n[t]);return a}(n,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(n);for(i=0;i<l.length;i++)t=l[i],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(a[t]=n[t])}return a}var r=i.createContext({}),c=function(n){var e=i.useContext(r),t=e;return n&&(t="function"==typeof n?n(e):s(s({},e),n)),t},h=function(n){var e=c(n.components);return i.createElement(r.Provider,{value:e},n.children)},p="mdxType",d={inlineCode:"code",wrapper:function(n){var e=n.children;return i.createElement(i.Fragment,{},e)}},y=i.forwardRef((function(n,e){var t=n.components,a=n.mdxType,l=n.originalType,r=n.parentName,h=o(n,["components","mdxType","originalType","parentName"]),p=c(t),y=a,u=p["".concat(r,".").concat(y)]||p[y]||d[y]||l;return t?i.createElement(u,s(s({ref:e},h),{},{components:t})):i.createElement(u,s({ref:e},h))}));function u(n,e){var t=arguments,a=e&&e.mdxType;if("string"==typeof n||a){var l=t.length,s=new Array(l);s[0]=y;var o={};for(var r in e)hasOwnProperty.call(e,r)&&(o[r]=e[r]);o.originalType=n,o[p]="string"==typeof n?n:a,s[1]=o;for(var c=2;c<l;c++)s[c]=t[c];return i.createElement.apply(null,s)}return i.createElement.apply(null,t)}y.displayName="MDXCreateElement"},944718:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>r,contentTitle:()=>s,default:()=>d,frontMatter:()=>l,metadata:()=>o,toc:()=>c});var i=t(58168),a=(t(296540),t(15680));const l={title:"Join Hint using Document",language:"en"},s=void 0,o={unversionedId:"query/join-optimization/join-hint",id:"version-2.0/query/join-optimization/join-hint",title:"Join Hint using Document",description:"\x3c!--",source:"@site/versioned_docs/version-2.0/query/join-optimization/join-hint.md",sourceDirName:"query/join-optimization",slug:"/query/join-optimization/join-hint",permalink:"/docs/2.0/query/join-optimization/join-hint",draft:!1,tags:[],version:"2.0",frontMatter:{title:"Join Hint using Document",language:"en"},sidebar:"docs",previous:{title:"Runtime Filter",permalink:"/docs/2.0/query/join-optimization/runtime-filter"},next:{title:"Orthogonal BITMAP Calculation",permalink:"/docs/2.0/query/duplicate/orthogonal-bitmap-manual"}},r={},c=[{value:"Leading hint",id:"leading-hint",level:2},{value:"Basic cases",id:"basic-cases",level:2},{value:"more cases",id:"more-cases",level:2},{value:"Left deep tree",id:"left-deep-tree",level:3},{value:"Right deep tree",id:"right-deep-tree",level:3},{value:"Bushy tree",id:"bushy-tree",level:3},{value:"Zig-Zag Tree",id:"zig-zag-tree",level:3},{value:"Non-inner join:",id:"non-inner-join",level:2},{value:"View",id:"view",level:2},{value:"mixed with ordered hint",id:"mixed-with-ordered-hint",level:2},{value:"Limitation",id:"limitation",level:2}],h={toc:c},p="wrapper";function d(n){let{components:e,...t}=n;return(0,a.yg)(p,(0,i.A)({},h,t,{components:e,mdxType:"MDXLayout"}),(0,a.yg)("p",null,'In the database, "Hint" is an instruction that instructs the query optimizer to execute a plan. By embedding hints in SQL statements, you can influence the optimizer\'s decision to select the desired execution path. Here is a background example using Hint:'),(0,a.yg)("p",null,"Suppose you have a table that contains a large amount of data, and you know that in some specific circumstances, the join order of the tables in a query may affect query performance. Leading Hint allows you to specify the order of table joins that you want the optimizer to follow."),(0,a.yg)("p",null,"For example, consider the following SQL query:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sql"},"mysql> explain shape plan select * from t1 join t2 on t1.c1 = c2;\n+-------------------------------------------+\n| Explain String                            |\n+-------------------------------------------+\n| PhysicalResultSink                        |\n| --PhysicalDistribute                      |\n| ----PhysicalProject                       |\n| ------hashJoin[INNER_JOIN](t1.c1 = t2.c2) |\n| --------PhysicalOlapScan[t2]              |\n| --------PhysicalDistribute                |\n| ----------PhysicalOlapScan[t1]            |\n+-------------------------------------------+\n7 rows in set (0.06 sec)\n")),(0,a.yg)("p",null,"In the above example, when the execution efficiency is not ideal, we want to adjust the join order without changing the original sql so as to avoid affecting the user's original scene and achieve the purpose of tuning. We can use leading to arbitrarily change the join order of tableA and tableB. For example, it could be written like:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sql"},"mysql> explain shape plan select /*+ leading(t2 t1) */ * from t1 join t2 on c1 = c2;\n+-----------------------------------------------------------------------------------------------------+\n| Explain String(Nereids Planner)                                                                     |\n+-----------------------------------------------------------------------------------------------------+\n| PhysicalResultSink                                                                                  |\n| --PhysicalDistribute                                                                                |\n| ----PhysicalProject                                                                                 |\n| ------hashJoin[INNER_JOIN] hashCondition=((t1.c1 = t2.c2)) otherCondition=() build RFs:RF0 c1->[c2] |\n| --------PhysicalOlapScan[t2] apply RFs: RF0                                                         |\n| --------PhysicalDistribute                                                                          |\n| ----------PhysicalOlapScan[t1]                                                                      |\n|                                                                                                     |\n| Hint log:                                                                                           |\n| Used: leading(t2 t1)                                                                                |\n| UnUsed:                                                                                             |\n| SyntaxError:                                                                                        |\n+-----------------------------------------------------------------------------------------------------+\n12 rows in set (0.06 sec)\n")),(0,a.yg)("p",null,"In this example, the Hint /",(0,a.yg)("em",{parentName:"p"},"+ leading(t2 t1) "),"/ is used. This Hint tells the optimizer to use the specified table (t2) as the driver table in the execution plan, before (t1)."),(0,a.yg)("p",null,"This document mainly describes how to use join related hints in Doris: leading hint, ordered hint and distribute hint"),(0,a.yg)("h2",{id:"leading-hint"},"Leading hint"),(0,a.yg)("p",null,"Leading Hint is used to guide the optimizer in determining the join order of the query plan. In a query, the join order of the tables can affect query performance. Leading Hint allows you to specify the order of table joins that you want the optimizer to follow."),(0,a.yg)("p",null,"In doris, the syntax is /",(0,a.yg)("em",{parentName:"p"},"+LEADING(tablespec ","[tablespec]","... ) "),'/,leading is surrounded by "/',(0,a.yg)("em",{parentName:"p"},'+" and "'),"/\" and placed directly behind the select in the select statement. Note that the '/' after leading and the selectlist need to be separated by at least one separator such as a space. At least two more tables need to be written before the leadinghint is justified. And any join can be bracketed to explicitly specify the shape of the joinTree. Example:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sql"},"mysql> explain shape plan select /*+ leading(t2 t1) */ * from t1 join t2 on c1 = c2;\n+------------------------------------------------------------------------------+\n| Explain String(Nereids Planner)                                              |\n+------------------------------------------------------------------------------+\n| PhysicalResultSink                                                           |\n| --PhysicalDistribute[DistributionSpecGather]                                 |\n| ----PhysicalProject                                                          |\n| ------hashJoin[INNER_JOIN] hashCondition=((t1.c1 = t2.c2)) otherCondition=() |\n| --------PhysicalOlapScan[t2]                                                 |\n| --------PhysicalDistribute[DistributionSpecHash]                             |\n| ----------PhysicalOlapScan[t1]                                               |\n|                                                                              |\n| Hint log:                                                                    |\n| Used: leading(t2 t1)                                                         |\n| UnUsed:                                                                      |\n| SyntaxError:                                                                 |\n+------------------------------------------------------------------------------+\n12 rows in set (0.01 sec)\n")),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},"If the leadinghint fails to take effect, the explain process will be used to generate the leadinghint. The EXPLAIN process will display whether the Leadinghint takes effect. There are three types of hints:"),(0,a.yg)("ul",{parentName:"li"},(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},"Used: leading hint takes effect normally")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},"Unused: Unsupported cases include the feature that the leading specified join order is not equivalent to the original sql or is not supported in this version (see restrictions).")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},"SyntaxError: indicates leading hint syntax errors, such as failure to find the corresponding table")))),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},"The leading hint syntax creates a left deep tree by default. For example, select /",(0,a.yg)("em",{parentName:"p"},"+ leading(t1 t2 t3) "),"/ * from t1 join t2 on... Specify by default"))),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sql"},"      join\n     /    \\\n   join    t3\n  /    \\\n t1    t2\n\nmysql> explain shape plan select /*+ leading(t1 t2 t3) */ * from t1 join t2 on c1 = c2 join t3 on c2=c3;\n+--------------------------------------------------------------------------------+\n| Explain String(Nereids Planner)                                                |\n+--------------------------------------------------------------------------------+\n| PhysicalResultSink                                                             |\n| --PhysicalDistribute[DistributionSpecGather]                                   |\n| ----PhysicalProject                                                            |\n| ------hashJoin[INNER_JOIN] hashCondition=((t2.c2 = t3.c3)) otherCondition=()   |\n| --------hashJoin[INNER_JOIN] hashCondition=((t1.c1 = t2.c2)) otherCondition=() |\n| ----------PhysicalOlapScan[t1]                                                 |\n| ----------PhysicalDistribute[DistributionSpecHash]                             |\n| ------------PhysicalOlapScan[t2]                                               |\n| --------PhysicalDistribute[DistributionSpecHash]                               |\n| ----------PhysicalOlapScan[t3]                                                 |\n|                                                                                |\n| Hint log:                                                                      |\n| Used: leading(t1 t2 t3)                                                        |\n| UnUsed:                                                                        |\n| SyntaxError:                                                                   |\n+--------------------------------------------------------------------------------+\n15 rows in set (0.00 sec)\n")),(0,a.yg)("p",null,"The join tree shape is also allowed to be specified using braces. For example: /",(0,a.yg)("em",{parentName:"p"},"+ leading(t1 {t2 t3}) "),"/  "),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sql"},"      join\n     /    \\\n    t1    join\n  /    \\\n  t2    t3\n\nmysql> explain shape plan select /*+ leading(t1 {t2 t3}) */ * from t1 join t2 on c1 = c2 join t3 on c2=c3;\n+----------------------------------------------------------------------------------+\n| Explain String(Nereids Planner)                                                  |\n+----------------------------------------------------------------------------------+\n| PhysicalResultSink                                                               |\n| --PhysicalDistribute[DistributionSpecGather]                                     |\n| ----PhysicalProject                                                              |\n| ------hashJoin[INNER_JOIN] hashCondition=((t1.c1 = t2.c2)) otherCondition=()     |\n| --------PhysicalOlapScan[t1]                                                     |\n| --------PhysicalDistribute[DistributionSpecHash]                                 |\n| ----------hashJoin[INNER_JOIN] hashCondition=((t2.c2 = t3.c3)) otherCondition=() |\n| ------------PhysicalOlapScan[t2]                                                 |\n| ------------PhysicalDistribute[DistributionSpecHash]                             |\n| --------------PhysicalOlapScan[t3]                                               |\n|                                                                                  |\n| Hint log:                                                                        |\n| Used: leading(t1 { t2 t3 })                                                      |\n| UnUsed:                                                                          |\n| SyntaxError:                                                                     |\n+----------------------------------------------------------------------------------+\n15 rows in set (0.02 sec)\n")),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"When a view is used as an alias in joinReorder, the corresponding view can be specified as the leading parameter. Example:")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sql"},"mysql> explain shape plan select /*+ leading(alias t1) */ count(*) from t1 join (select c2 from t2 join t3 on t2.c2 = t3.c3) as alias on t1.c1 = alias.c2;\n  +--------------------------------------------------------------------------------------+\n  | Explain String(Nereids Planner)                                                      |\n  +--------------------------------------------------------------------------------------+\n  | PhysicalResultSink                                                                   |\n  | --hashAgg[GLOBAL]                                                                    |\n  | ----PhysicalDistribute[DistributionSpecGather]                                       |\n  | ------hashAgg[LOCAL]                                                                 |\n  | --------PhysicalProject                                                              |\n  | ----------hashJoin[INNER_JOIN] hashCondition=((t1.c1 = alias.c2)) otherCondition=()  |\n  | ------------PhysicalProject                                                          |\n  | --------------hashJoin[INNER_JOIN] hashCondition=((t2.c2 = t3.c3)) otherCondition=() |\n  | ----------------PhysicalProject                                                      |\n  | ------------------PhysicalOlapScan[t2]                                               |\n  | ----------------PhysicalDistribute[DistributionSpecHash]                             |\n  | ------------------PhysicalProject                                                    |\n  | --------------------PhysicalOlapScan[t3]                                             |\n  | ------------PhysicalDistribute[DistributionSpecHash]                                 |\n  | --------------PhysicalProject                                                        |\n  | ----------------PhysicalOlapScan[t1]                                                 |\n  |                                                                                      |\n  | Hint log:                                                                            |\n  | Used: leading(alias t1)                                                              |\n  | UnUsed:                                                                              |\n  | SyntaxError:                                                                         |\n  +--------------------------------------------------------------------------------------+\n  21 rows in set (0.06 sec)\n")),(0,a.yg)("h2",{id:"basic-cases"},"Basic cases"),(0,a.yg)("p",null,"  \uff08Note that the column name is related to the table name, for example: only t1 has c1 field, the following example will write t1.c1 directly to c1 for simplicity\uff09"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sql"},"CREATE DATABASE testleading;\nUSE testleading;\n\ncreate table t1 (c1 int, c11 int) distributed by hash(c1) buckets 3 properties('replication_num' = '1');\ncreate table t2 (c2 int, c22 int) distributed by hash(c2) buckets 3 properties('replication_num' = '1');\ncreate table t3 (c3 int, c33 int) distributed by hash(c3) buckets 3 properties('replication_num' = '1');\ncreate table t4 (c4 int, c44 int) distributed by hash(c4) buckets 3 properties('replication_num' = '1');\n\n")),(0,a.yg)("p",null,"For a simple example, when we need to exchange the join order of t1 and t2, we only need to add leading(t2 t1) before it, which will be used in the explain\nShows whether the hint is used.\noriginal plan"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sql"},"mysql> explain shape plan select * from t1 join t2 on t1.c1 = c2;\n+-------------------------------------------+\n| Explain String                            |\n+-------------------------------------------+\n| PhysicalResultSink                        |\n| --PhysicalDistribute                      |\n| ----PhysicalProject                       |\n| ------hashJoin[INNER_JOIN](t1.c1 = t2.c2) |\n| --------PhysicalOlapScan[t2]              |\n| --------PhysicalDistribute                |\n| ----------PhysicalOlapScan[t1]            |\n+-------------------------------------------+\n7 rows in set (0.06 sec)\n")),(0,a.yg)("p",null,"Leading plan"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sql"},"mysql> explain shape plan select /*+ leading(t2 t1) */ * from t1 join t2 on c1 = c2;\n+------------------------------------------------------------------------------+\n| Explain String(Nereids Planner)                                              |\n+------------------------------------------------------------------------------+\n| PhysicalResultSink                                                           |\n| --PhysicalDistribute[DistributionSpecGather]                                 |\n| ----PhysicalProject                                                          |\n| ------hashJoin[INNER_JOIN] hashCondition=((t1.c1 = t2.c2)) otherCondition=() |\n| --------PhysicalOlapScan[t2]                                                 |\n| --------PhysicalDistribute[DistributionSpecHash]                             |\n| ----------PhysicalOlapScan[t1]                                               |\n|                                                                              |\n| Hint log:                                                                    |\n| Used: leading(t2 t1)                                                         |\n| UnUsed:                                                                      |\n| SyntaxError:                                                                 |\n+------------------------------------------------------------------------------+\n12 rows in set (0.00 sec)\n")),(0,a.yg)("p",null,"hint effect display\n\uff08Used unused\uff09\nIf the leading hint has a syntax error, the corresponding information is displayed in the syntax Error when explaining, but the plan is generated as usual, just without leading"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sql"},"mysql> explain shape plan select /*+ leading(t2 t3) */ * from t1 join t2 on t1.c1 = c2;\n+--------------------------------------------------------+\n| Explain String                                         |\n+--------------------------------------------------------+\n| PhysicalResultSink                                     |\n| --PhysicalDistribute                                   |\n| ----PhysicalProject                                    |\n| ------hashJoin[INNER_JOIN](t1.c1 = t2.c2)              |\n| --------PhysicalOlapScan[t1]                           |\n| --------PhysicalDistribute                             |\n| ----------PhysicalOlapScan[t2]                         |\n|                                                        |\n| Used:                                                  |\n| UnUsed:                                                |\n| SyntaxError: leading(t2 t3) Msg:can not find table: t3 |\n+--------------------------------------------------------+\n11 rows in set (0.01 sec)\n")),(0,a.yg)("h2",{id:"more-cases"},"more cases"),(0,a.yg)("h3",{id:"left-deep-tree"},"Left deep tree"),(0,a.yg)("p",null,"leading generates a left deep tree by default when we don't use any parentheses"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sql"},"mysql> explain shape plan select /*+ leading(t1 t2 t3) */ * from t1 join t2 on t1.c1 = c2 join t3 on c2 = c3;\n+--------------------------------------------------------------------------------+\n| Explain String(Nereids Planner)                                                |\n+--------------------------------------------------------------------------------+\n| PhysicalResultSink                                                             |\n| --PhysicalDistribute[DistributionSpecGather]                                   |\n| ----PhysicalProject                                                            |\n| ------hashJoin[INNER_JOIN] hashCondition=((t2.c2 = t3.c3)) otherCondition=()   |\n| --------hashJoin[INNER_JOIN] hashCondition=((t1.c1 = t2.c2)) otherCondition=() |\n| ----------PhysicalOlapScan[t1]                                                 |\n| ----------PhysicalDistribute[DistributionSpecHash]                             |\n| ------------PhysicalOlapScan[t2]                                               |\n| --------PhysicalDistribute[DistributionSpecHash]                               |\n| ----------PhysicalOlapScan[t3]                                                 |\n|                                                                                |\n| Hint log:                                                                      |\n| Used: leading(t1 t2 t3)                                                        |\n| UnUsed:                                                                        |\n| SyntaxError:                                                                   |\n+--------------------------------------------------------------------------------+\n15 rows in set (0.10 sec)\n")),(0,a.yg)("h3",{id:"right-deep-tree"},"Right deep tree"),(0,a.yg)("p",null,"When we want to make the shape of the plan into a right deep tree, bushy tree or zigzag tree, we only need to add curly brackets to limit the shape of the plan, instead of using swap to adjust from the left deep tree step by step like oracle."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sql"},"mysql> explain shape plan select /*+ leading(t1 {t2 t3}) */ * from t1 join t2 on t1.c1 = c2 join t3 on c2 = c3;\n+-----------------------------------------------+\n| Explain String                                |\n+-----------------------------------------------+\n| PhysicalResultSink                            |\n| --PhysicalDistribute                          |\n| ----PhysicalProject                           |\n| ------hashJoin[INNER_JOIN](t1.c1 = t2.c2)     |\n| --------PhysicalOlapScan[t1]                  |\n| --------PhysicalDistribute                    |\n| ----------hashJoin[INNER_JOIN](t2.c2 = t3.c3) |\n| ------------PhysicalOlapScan[t2]              |\n| ------------PhysicalDistribute                |\n| --------------PhysicalOlapScan[t3]            |\n|                                               |\n| Used: leading(t1 { t2 t3 })                   |\n| UnUsed:                                       |\n| SyntaxError:                                  |\n+-----------------------------------------------+\n14 rows in set (0.02 sec)\n")),(0,a.yg)("h3",{id:"bushy-tree"},"Bushy tree"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sql"},"mysql> explain shape plan select /*+ leading({t1 t2} {t3 t4}) */ * from t1 join t2 on t1.c1 = c2 join t3 on c2 = c3 join t4 on c3 = c4;\n+-----------------------------------------------+\n| Explain String                                |\n+-----------------------------------------------+\n| PhysicalResultSink                            |\n| --PhysicalDistribute                          |\n| ----PhysicalProject                           |\n| ------hashJoin[INNER_JOIN](t2.c2 = t3.c3)     |\n| --------hashJoin[INNER_JOIN](t1.c1 = t2.c2)   |\n| ----------PhysicalOlapScan[t1]                |\n| ----------PhysicalDistribute                  |\n| ------------PhysicalOlapScan[t2]              |\n| --------PhysicalDistribute                    |\n| ----------hashJoin[INNER_JOIN](t3.c3 = t4.c4) |\n| ------------PhysicalOlapScan[t3]              |\n| ------------PhysicalDistribute                |\n| --------------PhysicalOlapScan[t4]            |\n|                                               |\n| Used: leading({ t1 t2 } { t3 t4 })            |\n| UnUsed:                                       |\n| SyntaxError:                                  |\n+-----------------------------------------------+\n17 rows in set (0.02 sec)\n")),(0,a.yg)("h3",{id:"zig-zag-tree"},"Zig-Zag Tree"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sql"},"mysql> explain shape plan select /*+ leading(t1 {t2 t3} t4) */ * from t1 join t2 on t1.c1 = c2 join t3 on c2 = c3 join t4 on c3 = c4;\n+--------------------------------------------------------------------------------------+\n| Explain String(Nereids Planner)                                                      |\n+--------------------------------------------------------------------------------------+\n| PhysicalResultSink                                                                   |\n| --PhysicalDistribute[DistributionSpecGather]                                         |\n| ----PhysicalProject                                                                  |\n| ------hashJoin[INNER_JOIN] hashCondition=((t3.c3 = t4.c4)) otherCondition=()         |\n| --------PhysicalDistribute[DistributionSpecHash]                                     |\n| ----------hashJoin[INNER_JOIN] hashCondition=((t1.c1 = t2.c2)) otherCondition=()     |\n| ------------PhysicalOlapScan[t1]                                                     |\n| ------------PhysicalDistribute[DistributionSpecHash]                                 |\n| --------------hashJoin[INNER_JOIN] hashCondition=((t2.c2 = t3.c3)) otherCondition=() |\n| ----------------PhysicalOlapScan[t2]                                                 |\n| ----------------PhysicalDistribute[DistributionSpecHash]                             |\n| ------------------PhysicalOlapScan[t3]                                               |\n| --------PhysicalDistribute[DistributionSpecHash]                                     |\n| ----------PhysicalOlapScan[t4]                                                       |\n|                                                                                      |\n| Hint log:                                                                            |\n| Used: leading(t1 { t2 t3 } t4)                                                       |\n| UnUsed:                                                                              |\n| SyntaxError:                                                                         |\n+--------------------------------------------------------------------------------------+\n19 rows in set (0.02 sec)\n")),(0,a.yg)("h2",{id:"non-inner-join"},"Non-inner join:"),(0,a.yg)("p",null,"When non-inner-joins are encountered, such as Outer join or semi/anti join, leading hint automatically deduces the join mode of each join according to the original sql semantics. If leading hints that differ from the original sql semantics or cannot be generated, they are placed in unused, but do not affect the generation of the normal flow of the plan."),(0,a.yg)("p",null,"Here are examples of things that can't be exchanged:",(0,a.yg)("br",{parentName:"p"}),"\n","-------- test outer join which can not swap",(0,a.yg)("br",{parentName:"p"}),"\n","--  t1 leftjoin (t2 join t3 on (P23)) on (P12) != (t1 leftjoin t2 on (P12)) join t3 on (P23)"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sql"},"mysql> explain shape plan select /*+ leading(t1 {t2 t3}) */ * from t1 left join t2 on c1 = c2 join t3 on c2 = c3;\n+--------------------------------------------------------------------------------+\n| Explain String(Nereids Planner)                                                |\n+--------------------------------------------------------------------------------+\n| PhysicalResultSink                                                             |\n| --PhysicalDistribute[DistributionSpecGather]                                   |\n| ----PhysicalProject                                                            |\n| ------hashJoin[INNER_JOIN] hashCondition=((t2.c2 = t3.c3)) otherCondition=()   |\n| --------hashJoin[INNER_JOIN] hashCondition=((t1.c1 = t2.c2)) otherCondition=() |\n| ----------PhysicalOlapScan[t1]                                                 |\n| ----------PhysicalDistribute[DistributionSpecHash]                             |\n| ------------PhysicalOlapScan[t2]                                               |\n| --------PhysicalDistribute[DistributionSpecHash]                               |\n| ----------PhysicalOlapScan[t3]                                                 |\n|                                                                                |\n| Hint log:                                                                      |\n| Used:                                                                          |\n| UnUsed: leading(t1 { t2 t3 })                                                  |\n| SyntaxError:                                                                   |\n+--------------------------------------------------------------------------------+\n15 rows in set (0.01 sec)\n")),(0,a.yg)("p",null,"Below are some examples that can be exchanged and examples that cannot be exchanged, which readers can verify for themselves"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sql"},"-------- test outer join which can swap\n-- (t1 leftjoin t2  on (P12)) innerjoin t3 on (P13) = (t1 innerjoin t3 on (P13)) leftjoin t2  on (P12)\nexplain shape plan select * from t1 left join t2 on c1 = c2 join t3 on c1 = c3;\nexplain shape plan select /*+ leading(t1 t3 t2) */ * from t1 left join t2 on c1 = c2 join t3 on c1 = c3;\n\n-- (t1 leftjoin t2  on (P12)) leftjoin t3 on (P13) = (t1 leftjoin t3 on (P13)) leftjoin t2  on (P12)\nexplain shape plan select * from t1 left join t2 on c1 = c2 left join t3 on c1 = c3;\nexplain shape plan select /*+ leading(t1 t3 t2) */ * from t1 left join t2 on c1 = c2 left join t3 on c1 = c3;\n\n-- (t1 leftjoin t2  on (P12)) leftjoin t3 on (P23) = t1 leftjoin (t2  leftjoin t3 on (P23)) on (P12)\nselect /*+ leading(t2 t3 t1) SWAP_INPUT(t1) */ * from t1 left join t2 on c1 = c2 left join t3 on c2 = c3;\nexplain shape plan select /*+ leading(t1 {t2 t3}) */ * from t1 left join t2 on c1 = c2 left join t3 on c2 = c3;\nexplain shape plan select /*+ leading(t1 {t2 t3}) */ * from t1 left join t2 on c1 = c2 left join t3 on c2 = c3;\n\n-------- test outer join which can not swap\n--  t1 leftjoin (t2  join t3 on (P23)) on (P12) != (t1 leftjoin t2  on (P12)) join t3 on (P23)\n-- eliminated to inner join\nexplain shape plan select /*+ leading(t1 {t2 t3}) */ * from t1 left join t2 on c1 = c2 join t3 on c2 = c3;\nexplain graph select /*+ leading(t1 t2 t3) */ * from t1 left join (select * from t2 join t3 on c2 = c3) on c1 = c2;\n\n-- test semi join\nexplain shape plan select * from t1 where c1 in (select c2 from t2);\nexplain shape plan select /*+ leading(t2 t1) */ * from t1 where c1 in (select c2 from t2);\n\n-- test anti join\nexplain shape plan select * from t1 where exists (select c2 from t2);\n")),(0,a.yg)("h2",{id:"view"},"View"),(0,a.yg)("p",null,"In the case of aliases, you can specify the alias as a complete subtree with joinOrder generated from text order."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sql"},"mysql>  explain shape plan select /*+ leading(alias t1) */ count(*) from t1 join (select c2 from t2 join t3 on t2.c2 = t3.c3) as alias on t1.c1 = alias.c2;\n+--------------------------------------------------------------------------------------+\n| Explain String(Nereids Planner)                                                      |\n+--------------------------------------------------------------------------------------+\n| PhysicalResultSink                                                                   |\n| --hashAgg[GLOBAL]                                                                    |\n| ----PhysicalDistribute[DistributionSpecGather]                                       |\n| ------hashAgg[LOCAL]                                                                 |\n| --------PhysicalProject                                                              |\n| ----------hashJoin[INNER_JOIN] hashCondition=((t1.c1 = alias.c2)) otherCondition=()  |\n| ------------PhysicalProject                                                          |\n| --------------hashJoin[INNER_JOIN] hashCondition=((t2.c2 = t3.c3)) otherCondition=() |\n| ----------------PhysicalProject                                                      |\n| ------------------PhysicalOlapScan[t2]                                               |\n| ----------------PhysicalDistribute[DistributionSpecHash]                             |\n| ------------------PhysicalProject                                                    |\n| --------------------PhysicalOlapScan[t3]                                             |\n| ------------PhysicalDistribute[DistributionSpecHash]                                 |\n| --------------PhysicalProject                                                        |\n| ----------------PhysicalOlapScan[t1]                                                 |\n|                                                                                      |\n| Hint log:                                                                            |\n| Used: leading(alias t1)                                                              |\n| UnUsed:                                                                              |\n| SyntaxError:                                                                         |\n+--------------------------------------------------------------------------------------+\n21 rows in set (0.02 sec)\n")),(0,a.yg)("h2",{id:"mixed-with-ordered-hint"},"mixed with ordered hint"),(0,a.yg)("p",null,"When ordered hint is used together with ordered hint, ordered hint takes effect with a higher priority than leading hint. Example:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sql"},"mysql>  explain shape plan select /*+ ORDERED LEADING(t1 t2 t3) */ t1.c1 from t2 join t1 on t1.c1 = t2.c2 join t3 on c2 = c3;\n+--------------------------------------------------------------------------------+\n| Explain String(Nereids Planner)                                                |\n+--------------------------------------------------------------------------------+\n| PhysicalResultSink                                                             |\n| --PhysicalDistribute[DistributionSpecGather]                                   |\n| ----PhysicalProject                                                            |\n| ------hashJoin[INNER_JOIN] hashCondition=((t2.c2 = t3.c3)) otherCondition=()   |\n| --------hashJoin[INNER_JOIN] hashCondition=((t1.c1 = t2.c2)) otherCondition=() |\n| ----------PhysicalProject                                                      |\n| ------------PhysicalOlapScan[t2]                                               |\n| ----------PhysicalDistribute[DistributionSpecHash]                             |\n| ------------PhysicalProject                                                    |\n| --------------PhysicalOlapScan[t1]                                             |\n| --------PhysicalDistribute[DistributionSpecHash]                               |\n| ----------PhysicalProject                                                      |\n| ------------PhysicalOlapScan[t3]                                               |\n|                                                                                |\n| Hint log:                                                                      |\n| Used: ORDERED                                                                  |\n| UnUsed: leading(t1 t2 t3)                                                      |\n| SyntaxError:                                                                   |\n+--------------------------------------------------------------------------------+\n18 rows in set (0.02 sec)\n")),(0,a.yg)("h2",{id:"limitation"},"Limitation"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"The current version supports only one leadingHint. If leadinghint is used with a subquery, the query will report an error. Example (This example explain will report an error, but will follow the normal path generation plan) :")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sql"},"mysql>  explain shape plan select /*+ leading(alias t1) */ count(*) from t1 join (select /*+ leading(t3 t2) */ c2 from t2 join t3 on t2.c2 = t3.c3) as alias on t1.c1 = alias.c2;\n  +----------------------------------------------------------------------------------------+\n  | Explain String(Nereids Planner)                                                        |\n  +----------------------------------------------------------------------------------------+\n  | PhysicalResultSink                                                                     |\n  | --hashAgg[GLOBAL]                                                                      |\n  | ----PhysicalDistribute[DistributionSpecGather]                                         |\n  | ------hashAgg[LOCAL]                                                                   |\n  | --------PhysicalProject                                                                |\n  | ----------hashJoin[INNER_JOIN] hashCondition=((t1.c1 = alias.c2)) otherCondition=()    |\n  | ------------PhysicalProject                                                            |\n  | --------------PhysicalOlapScan[t1]                                                     |\n  | ------------PhysicalDistribute[DistributionSpecHash]                                   |\n  | --------------PhysicalProject                                                          |\n  | ----------------hashJoin[INNER_JOIN] hashCondition=((t2.c2 = t3.c3)) otherCondition=() |\n  | ------------------PhysicalProject                                                      |\n  | --------------------PhysicalOlapScan[t2]                                               |\n  | ------------------PhysicalDistribute[DistributionSpecHash]                             |\n  | --------------------PhysicalProject                                                    |\n  | ----------------------PhysicalOlapScan[t3]                                             |\n  |                                                                                        |\n  | Hint log:                                                                              |\n  | Used:                                                                                  |\n  | UnUsed: leading(alias t1)                                                              |\n  | SyntaxError: leading(t3 t2) Msg:one query block can only have one leading clause       |\n  +----------------------------------------------------------------------------------------+\n  21 rows in set (0.01 sec)\n")),(0,a.yg)("h1",{id:"orderedhint"},"OrderedHint"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"Using ordered hint causes the join tree to be fixed in shape and displayed in text order"),(0,a.yg)("li",{parentName:"ul"},"The syntax is /",(0,a.yg)("em",{parentName:"li"},"+ ORDERED "),'/,leading is surrounded by "/',(0,a.yg)("em",{parentName:"li"},'+" and "'),'/" and placed directly behind the select in the select statement, for example:')),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sql"},"  explain shape plan select /*+ ORDERED */ t1.c1 from t2 join t1 on t1.c1 = t2.c2 join t3 on c2 = c3;\n     join\n    /    \\\n   join    t3\n  /    \\\n  t2    t1\n\nmysql> explain shape plan select /*+ ORDERED */ t1.c1 from t2 join t1 on t1.c1 = t2.c2 join t3 on c2 = c3;\n+--------------------------------------------------------------------------------+\n| Explain String(Nereids Planner)                                                |\n+--------------------------------------------------------------------------------+\n| PhysicalResultSink                                                             |\n| --PhysicalDistribute[DistributionSpecGather]                                   |\n| ----PhysicalProject                                                            |\n| ------hashJoin[INNER_JOIN] hashCondition=((t2.c2 = t3.c3)) otherCondition=()   |\n| --------hashJoin[INNER_JOIN] hashCondition=((t1.c1 = t2.c2)) otherCondition=() |\n| ----------PhysicalProject                                                      |\n| ------------PhysicalOlapScan[t2]                                               |\n| ----------PhysicalDistribute[DistributionSpecHash]                             |\n| ------------PhysicalProject                                                    |\n| --------------PhysicalOlapScan[t1]                                             |\n| --------PhysicalDistribute[DistributionSpecHash]                               |\n| ----------PhysicalProject                                                      |\n| ------------PhysicalOlapScan[t3]                                               |\n|                                                                                |\n| Hint log:                                                                      |\n| Used: ORDERED                                                                  |\n| UnUsed:                                                                        |\n| SyntaxError:                                                                   |\n+--------------------------------------------------------------------------------+\n18 rows in set (0.02 sec)\n")),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"When ordered hint and leading hint are used at the same time, the ordered hint prevails and the leading hint becomes invalid")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sql"},"mysql> explain shape plan select /*+ ORDERED LEADING(t1 t2 t3) */ t1.c1 from t2 join t1 on t1.c1 = t2.c2 join t3 on c2 = c3;\n  +--------------------------------------------------------------------------------+\n  | Explain String(Nereids Planner)                                                |\n  +--------------------------------------------------------------------------------+\n  | PhysicalResultSink                                                             |\n  | --PhysicalDistribute[DistributionSpecGather]                                   |\n  | ----PhysicalProject                                                            |\n  | ------hashJoin[INNER_JOIN] hashCondition=((t2.c2 = t3.c3)) otherCondition=()   |\n  | --------hashJoin[INNER_JOIN] hashCondition=((t1.c1 = t2.c2)) otherCondition=() |\n  | ----------PhysicalProject                                                      |\n  | ------------PhysicalOlapScan[t2]                                               |\n  | ----------PhysicalDistribute[DistributionSpecHash]                             |\n  | ------------PhysicalProject                                                    |\n  | --------------PhysicalOlapScan[t1]                                             |\n  | --------PhysicalDistribute[DistributionSpecHash]                               |\n  | ----------PhysicalProject                                                      |\n  | ------------PhysicalOlapScan[t3]                                               |\n  |                                                                                |\n  | Hint log:                                                                      |\n  | Used: ORDERED                                                                  |\n  | UnUsed: leading(t1 t2 t3)                                                      |\n  | SyntaxError:                                                                   |\n  +--------------------------------------------------------------------------------+\n  18 rows in set (0.02 sec)\n")),(0,a.yg)("h1",{id:"distributehint"},"DistributeHint"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},"Currently, only the distribute Type of the right table can be specified, and only two types are available: ","[shuffle]"," and ","[broadcast]",". They are written before the right join table. Brackets and /",(0,a.yg)("em",{parentName:"p"},"+ "),"/ are allowed")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},"Currently you can use any DistributeHint")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},"When a DistributeHint whose plan cannot be correctly generated is not displayed, it takes effect based on maximum effort. Finally, the distribute mode that is displayed is mainly explained")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},"The current distribute version is not combined with leading. It takes effect only when the table specified in DISTRIBUTE is on the right of join.")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},"Mixed with ordered, the text order is used to set the join order and then specify the expected distribute mode in the corresponding join. Example:"))),(0,a.yg)("p",null,"Before use distribute hint:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sql"},"mysql> explain shape plan select count(*) from t1 join t2 on t1.c1 = t2.c2;\n  +----------------------------------------------------------------------------------+\n  | Explain String(Nereids Planner)                                                  |\n  +----------------------------------------------------------------------------------+\n  | PhysicalResultSink                                                               |\n  | --hashAgg[GLOBAL]                                                                |\n  | ----PhysicalDistribute[DistributionSpecGather]                                   |\n  | ------hashAgg[LOCAL]                                                             |\n  | --------PhysicalProject                                                          |\n  | ----------hashJoin[INNER_JOIN] hashCondition=((t1.c1 = t2.c2)) otherCondition=() |\n  | ------------PhysicalProject                                                      |\n  | --------------PhysicalOlapScan[t1]                                               |\n  | ------------PhysicalDistribute[DistributionSpecHash]                             |\n  | --------------PhysicalProject                                                    |\n  | ----------------PhysicalOlapScan[t2]                                             |\n  +----------------------------------------------------------------------------------+\n  11 rows in set (0.01 sec)\n")),(0,a.yg)("p",null,"  after use distribute hint:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sql"},"mysql> explain shape plan select /*+ ordered */ count(*) from t2 join[broadcast] t1 on t1.c1 = t2.c2;\n+----------------------------------------------------------------------------------+\n| Explain String(Nereids Planner)                                                  |\n+----------------------------------------------------------------------------------+\n| PhysicalResultSink                                                               |\n| --hashAgg[GLOBAL]                                                                |\n| ----PhysicalDistribute[DistributionSpecGather]                                   |\n| ------hashAgg[LOCAL]                                                             |\n| --------PhysicalProject                                                          |\n| ----------hashJoin[INNER_JOIN] hashCondition=((t1.c1 = t2.c2)) otherCondition=() |\n| ------------PhysicalProject                                                      |\n| --------------PhysicalOlapScan[t2]                                               |\n| ------------PhysicalDistribute[DistributionSpecReplicated]                       |\n| --------------PhysicalProject                                                    |\n| ----------------PhysicalOlapScan[t1]                                             |\n|                                                                                  |\n| Hint log:                                                                        |\n| Used: ORDERED                                                                    |\n| UnUsed:                                                                          |\n| SyntaxError:                                                                     |\n+----------------------------------------------------------------------------------+\n16 rows in set (0.01 sec)\n")),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"the Explain shape plan will display inside distribute operator related information, including DistributionSpecReplicated said the operator will be corresponding data into a copy of all be node, DistributionSpecGather indicates that data is gathered to fe nodes, and DistributionSpecHash indicates that data is dispersed to different be nodes according to a specific hashKey and algorithm.")),(0,a.yg)("h1",{id:"to-be-supported"},"To be supported"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},"leadingHint indicates that the current query cannot be mixed with the subquery after it is promoted. A hint is required to control whether the subquery can be unnested")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},"A new distributeHint is needed for better and more complete control of the distribute operator")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},"Use leadingHint and distributeHint together to determine the shape of a join"))))}d.isMDXComponent=!0}}]);