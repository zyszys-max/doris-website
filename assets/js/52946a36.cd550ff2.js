"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([[357421],{15680:(e,t,o)=>{o.d(t,{xA:()=>p,yg:()=>b});var n=o(296540);function a(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function r(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function i(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){a(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function s(e,t){if(null==e)return{};var o,n,a=function(e,t){if(null==e)return{};var o,n,a={},r=Object.keys(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||(a[o]=e[o]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}var l=n.createContext({}),d=function(e){var t=n.useContext(l),o=t;return e&&(o="function"==typeof e?e(t):i(i({},t),e)),o},p=function(e){var t=d(e.components);return n.createElement(l.Provider,{value:t},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var o=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=d(o),m=a,b=u["".concat(l,".").concat(m)]||u[m]||c[m]||r;return o?n.createElement(b,i(i({ref:t},p),{},{components:o})):n.createElement(b,i({ref:t},p))}));function b(e,t){var o=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=o.length,i=new Array(r);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[u]="string"==typeof e?e:a,i[1]=s;for(var d=2;d<r;d++)i[d]=o[d];return n.createElement.apply(null,i)}return n.createElement.apply(null,o)}m.displayName="MDXCreateElement"},135454:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>c,frontMatter:()=>r,metadata:()=>s,toc:()=>d});var n=o(58168),a=(o(296540),o(15680));const r={title:"Install FoundationDB",language:"en"},i=void 0,s={unversionedId:"install/cluster-deployment/k8s-deploy/compute-storage-decoupled/install-fdb",id:"install/cluster-deployment/k8s-deploy/compute-storage-decoupled/install-fdb",title:"Install FoundationDB",description:"\x3c!--",source:"@site/docs/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/install-fdb.md",sourceDirName:"install/cluster-deployment/k8s-deploy/compute-storage-decoupled",slug:"/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/install-fdb",permalink:"/docs/dev/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/install-fdb",draft:!1,tags:[],version:"current",frontMatter:{title:"Install FoundationDB",language:"en"},sidebar:"docs",previous:{title:"Quick Start",permalink:"/docs/dev/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/install-quickstart"},next:{title:"Config Metaservice",permalink:"/docs/dev/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/config-ms"}},l={},d=[{value:"Deploy FDB CRDs",id:"deploy-fdb-crds",level:2},{value:"Deploy fdb-kubernetes-operator service",id:"deploy-fdb-kubernetes-operator-service",level:2},{value:"Deploy FDB cluster",id:"deploy-fdb-cluster",level:2},{value:"Confirm FDB status",id:"confirm-fdb-status",level:2}],p={toc:d},u="wrapper";function c(e){let{components:t,...o}=e;return(0,a.yg)(u,(0,n.A)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,a.yg)("p",null,(0,a.yg)("a",{parentName:"p",href:"https://apple.github.io/foundationdb/#overview"},"FDB")," is a distributed, strongly consistent database for storing structured data developed by Apple. Doris storage-computing separation mode uses FDB as metadata storage and manages metadata in FDB through the meta-service component. To deploy a storage-computing separation cluster on Kubernetes, you need to deploy the FDB service in advance. Two deployment methods are recommended: direct deployment on a virtual machine (including a physical machine); Use ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/FoundationDB/fdb-kubernetes-operator"},"fdb-kubernetes-operator")," to deploy FDB.\nFor virtual machine deployment, please refer to the official Doris storage-computing separation document ",(0,a.yg)("a",{parentName:"p",href:"/docs/dev/compute-storage-decoupled/before-deployment"},"before deployment")," to build an FDB cluster. Before deployment, make sure that FDB has the ability to be accessed by the Kubernetes cluster deployed by Doris, that is, the Kubernetes Node and the machine where FDB is deployed are in the same subnet. FDB officially provides the operation and maintenance management service ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/FoundationDB/fdb-kubernetes-operator"},"fdb-kubernetes-operator")," for deployment on Kubernetes."),(0,a.yg)("p",null,"The following briefly describes the use of the latest version of fdb-kubernetes-operator to deploy FDB."),(0,a.yg)("h2",{id:"deploy-fdb-crds"},"Deploy FDB CRDs"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-bash"},"kubectl apply -f https://raw.githubusercontent.com/FoundationDB/fdb-kubernetes-operator/main/config/crd/bases/apps.foundationdb.org_foundationdbclusters.yaml\nkubectl apply -f https://raw.githubusercontent.com/FoundationDB/fdb-kubernetes-operator/main/config/crd/bases/apps.foundationdb.org_foundationdbbackups.yaml\nkubectl apply -f https://raw.githubusercontent.com/FoundationDB/fdb-kubernetes-operator/main/config/crd/bases/apps.foundationdb.org_foundationdbrestores.yaml\n")),(0,a.yg)("p",null,"Expected Results:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-bash"},"kubectl apply -f https://raw.githubusercontent.com/FoundationDB/fdb-kubernetes-operator/main/config/crd/bases/apps.foundationdb.org_foundationdbclusters.yaml\ncustomresourcedefinition.apiextensions.k8s.io/foundationdbclusters.apps.foundationdb.org created\nkubectl apply -f https://raw.githubusercontent.com/FoundationDB/fdb-kubernetes-operator/main/config/crd/bases/apps.foundationdb.org_foundationdbbackups.yaml\ncustomresourcedefinition.apiextensions.k8s.io/foundationdbbackups.apps.foundationdb.org created\nkubectl apply -f https://raw.githubusercontent.com/FoundationDB/fdb-kubernetes-operator/main/config/crd/bases/apps.foundationdb.org_foundationdbrestores.yaml\ncustomresourcedefinition.apiextensions.k8s.io/foundationdbrestores.apps.foundationdb.org created\n")),(0,a.yg)("h2",{id:"deploy-fdb-kubernetes-operator-service"},"Deploy fdb-kubernetes-operator service"),(0,a.yg)("p",null,"The fdb-kubernetes-operator repository provides a deployment sample for deploying the FDB cluster in IP mode. The doris-operator repository provides a sample for deploying the FDB cluster in FQDN mode, which can be downloaded on demand."),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},"Download the deployment sample:")),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},"Download from the fdb-kubernetes-operator official repository:"),(0,a.yg)("p",{parentName:"li"},"By default, fdb-kuberentes-operator deploys FDB Cluster in IP mode. You can download the ",(0,a.yg)("a",{parentName:"p",href:"https://raw.githubusercontent.com/foundationdb/fdb-kubernetes-operator/main/config/samples/deployment.yaml"},"fdb-kubernetes-operator default deployment")," yaml. If you use the FQDN deployment mode, please follow the official documentation ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/FoundationDB/fdb-kubernetes-operator/blob/main/docs/manual/customization.md#using-dns"},"Using DNS section")," to customize the domain name mode."))),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-bash"},"wget -O fdb-operator.yaml https://raw.githubusercontent.com/foundationdb/fdb-kubernetes-operator/main/config/samples/deployment.yaml\n")),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"Download from the doris-operator repository:",(0,a.yg)("br",{parentName:"li"}),"The doris-operator repository has a deployment example based on the fdb-kuberentes-operator 1.46.0 version, which can be used directly to deploy the FDB cluster.")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-bash"},"wget https://raw.githubusercontent.com/apache/doris-operator/master/config/operator/fdb-operator.yaml\n")),(0,a.yg)("ol",{start:2},(0,a.yg)("li",{parentName:"ol"},"Deploy the fdb-kubernetes-operator service:",(0,a.yg)("br",{parentName:"li"}),"After customizing the deployment yaml of ",(0,a.yg)("inlineCode",{parentName:"li"},"fdb-kubernetes-operator"),", use the following command to deploy fdb-kubernetes-operator:")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-bash"},"kubectl apply -f fdb-operator.yaml\n")),(0,a.yg)("p",null,"Expected Results:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-bash"},"serviceaccount/fdb-kubernetes-operator-controller-manager created\nclusterrole.rbac.authorization.k8s.io/fdb-kubernetes-operator-manager-clusterrole created\nclusterrole.rbac.authorization.k8s.io/fdb-kubernetes-operator-manager-role created\nrolebinding.rbac.authorization.k8s.io/fdb-kubernetes-operator-manager-rolebinding created\nclusterrolebinding.rbac.authorization.k8s.io/fdb-kubernetes-operator-manager-clusterrolebinding created\ndeployment.apps/fdb-kubernetes-operator-controller-manager created\n")),(0,a.yg)("h2",{id:"deploy-fdb-cluster"},"Deploy FDB cluster"),(0,a.yg)("p",null,"The deployment sample of FDB is provided in the ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/FoundationDB/fdb-kubernetes-operator/blob/main/config/samples/cluster.yaml"},"fdb-kubernetes-operator repository"),". You can download it directly with the following command"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("p",{parentName:"li"},"Download the deployment sample:"),(0,a.yg)("p",{parentName:"li"},"Download the IP mode deployment sample from the FDB official website:"))),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-bash"},"wget https://raw.githubusercontent.com/foundationdb/fdb-kubernetes-operator/main/config/samples/cluster.yaml\n")),(0,a.yg)("ol",{start:2},(0,a.yg)("li",{parentName:"ol"},"Customized deployment example:")),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"The environment can access dockerhub",(0,a.yg)("br",{parentName:"li"}),"Customize the final deployment state according to the ",(0,a.yg)("a",{parentName:"li",href:"https://github.com/FoundationDB/fdb-kubernetes-operator/blob/main/docs/manual/index.md"},"User Manual")," provided by the official website. If you use FQDN deployment, please set the ",(0,a.yg)("inlineCode",{parentName:"li"},"routing.useDNSInClusterFile")," field to true and configure as follows:\nThe official repository of doris-operator provides a deployment example of ",(0,a.yg)("a",{parentName:"li",href:"https://github.com/apache/doris-operator/blob/master/doc/examples/disaggregated/fdb/cluster.yaml"},"deploying FDB using FQDN")," that can be downloaded and used directly.  ")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-yaml"},"spec:\n  routing:\n  useDNSInClusterFile: true\n")),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},"Private network environment  "),(0,a.yg)("p",{parentName:"li"},"In a private network environment, if you cannot directly access dockerhub, you can download the required image from the official repository of FDB and push it to the private repository. fdb-kubernetes-operator depends on ",(0,a.yg)("a",{parentName:"p",href:"https://hub.docker.com/r/foundationdb/fdb-kubernetes-operator"},"foundationdb/fdb-kubernetes-operator"),", ",(0,a.yg)("a",{parentName:"p",href:"https://hub.docker.com/r/foundationdb/foundationdb-kubernetes-sidecar"},"foundationdb/foundationdb-kubernetes-sidecar")," .\nDeployment of FDB dependent images include: ",(0,a.yg)("a",{parentName:"p",href:"https://hub.docker.com/r/foundationdb/foundationdb"},"foundationdb/foundationdb")," , ",(0,a.yg)("a",{parentName:"p",href:"https://hub.docker.com/r/foundationdb/foundationdb-kubernetes-sidecar"},"foundationdb/foundationdb-kubernetes-sidecar"),".\nAfter pushing to the private repository, follow the fdb-kubernetes-operator official document ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/FoundationDB/fdb-kubernetes-operator/blob/main/docs/manual/customization.md#customizing-the-foundationdb-image"},"Customized Image Configuration")," instructions for configuration.  "),(0,a.yg)("p",{parentName:"li"},"You can refer to the following configuration to add private repository image configuration:  "))),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-yaml"},"spec:\n  mainContainer:\n    imageConfigs:\n    - baseImage: foundationdb/foundationdb\n      tag: 7.1.38\n  sidecarContainer:\n    imageConfigs:\n    - baseImage: foundationdb/foundationdb-kubernetes-sidecar\n      tag: 7.1.36-1\n  version: 7.1.38\n")),(0,a.yg)("admonition",{title:"Tip",type:"tip"},(0,a.yg)("ul",{parentName:"admonition"},(0,a.yg)("li",{parentName:"ul"},"In a private environment, when FDB is pushed to a private repository, the tag must be consistent with the official one, for example: 7.1.38."),(0,a.yg)("li",{parentName:"ul"},"When deploying FDB, FoundationDBCluster resources, .spec.version must be configured."),(0,a.yg)("li",{parentName:"ul"},"When FDB is deployed based on fdb-kubernetes-operator, at least three hosts are required to meet the high availability requirements of the production environment.  "))),(0,a.yg)("h2",{id:"confirm-fdb-status"},"Confirm FDB status"),(0,a.yg)("p",null,"Based on the FDB deployed by fdb-kubernetes-operator, you can view the FDB cluster status through the following command:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-bash"},"kubectl get fdb\n")),(0,a.yg)("p",null,"The expected results are as follows. If ",(0,a.yg)("inlineCode",{parentName:"p"},"AVAILABLE")," is ",(0,a.yg)("inlineCode",{parentName:"p"},"true"),", the cluster is available:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-bash"},"NAME           GENERATION   RECONCILED   AVAILABLE   FULLREPLICATION   VERSION   AGE\ntest-cluster   1            1            true        true              7.1.26    13m\n")))}c.isMDXComponent=!0}}]);