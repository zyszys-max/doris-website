"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([[669639],{15680:(e,n,t)=>{t.d(n,{xA:()=>c,yg:()=>d});var a=t(296540);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var p=a.createContext({}),s=function(e){var n=a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},c=function(e){var n=s(e.components);return a.createElement(p.Provider,{value:n},e.children)},u="mdxType",y={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},g=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,p=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=s(t),g=i,d=u["".concat(p,".").concat(g)]||u[g]||y[g]||r;return t?a.createElement(d,o(o({ref:n},c),{},{components:t})):a.createElement(d,o({ref:n},c))}));function d(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,o=new Array(r);o[0]=g;var l={};for(var p in n)hasOwnProperty.call(n,p)&&(l[p]=n[p]);l.originalType=e,l[u]="string"==typeof e?e:i,o[1]=l;for(var s=2;s<r;s++)o[s]=t[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}g.displayName="MDXCreateElement"},231199:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>o,default:()=>y,frontMatter:()=>r,metadata:()=>l,toc:()=>s});var a=t(58168),i=(t(296540),t(15680));const r={title:"Optimizing Table Scanning",language:"en"},o=void 0,l={unversionedId:"query-acceleration/tuning/tuning-plan/optimizing-table-scanning",id:"query-acceleration/tuning/tuning-plan/optimizing-table-scanning",title:"Optimizing Table Scanning",description:"\x3c!--",source:"@site/docs/query-acceleration/tuning/tuning-plan/optimizing-table-scanning.md",sourceDirName:"query-acceleration/tuning/tuning-plan",slug:"/query-acceleration/tuning/tuning-plan/optimizing-table-scanning",permalink:"/docs/dev/query-acceleration/tuning/tuning-plan/optimizing-table-scanning",draft:!1,tags:[],version:"current",frontMatter:{title:"Optimizing Table Scanning",language:"en"},sidebar:"docs",previous:{title:"Accelerating high-concurrency point queries",permalink:"/docs/dev/query-acceleration/tuning/tuning-plan/accelerating-point-query"},next:{title:"Transparent Rewriting with Sync-Materialized View",permalink:"/docs/dev/query-acceleration/tuning/tuning-plan/transparent-rewriting-with-sync-mv"}},p={},s=[{value:"Principle",id:"principle",level:2},{value:"Use Case",id:"use-case",level:2},{value:"Summary",id:"summary",level:2}],c={toc:s},u="wrapper";function y(e){let{components:n,...t}=e;return(0,i.yg)(u,(0,a.A)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,i.yg)("h2",{id:"principle"},"Principle"),(0,i.yg)("p",null,"Doris, as a high-performance real-time analytics data warehouse, offers a powerful partition pruning feature that can significantly enhance query performance. "),(0,i.yg)("p",null,"Partition pruning is a query optimization technique that intelligently identifies partitions relevant to a query by analyzing its conditions, and scans only the data within these partitions, thereby avoiding unnecessary scans of irrelevant partitions. This approach can greatly reduce I/O operations and computational load, thus accelerating query execution."),(0,i.yg)("h2",{id:"use-case"},"Use Case"),(0,i.yg)("p",null,"Here is a usage case to demonstrate Doris's partition pruning feature."),(0,i.yg)("p",null,"Suppose we have a sales data table named ",(0,i.yg)("inlineCode",{parentName:"p"},"sales"),", which is partitioned by date, with each day's data stored in a separate partition. The table structure is defined as follows:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE sales (\n    date DATE,\n    product VARCHAR(50),\n    amount DECIMAL(10, 2)\n)\nPARTITION BY RANGE(date) (\n    PARTITION p1 VALUES LESS THAN ('2023-01-01'),\n    PARTITION p2 VALUES LESS THAN ('2023-02-01'),\n    PARTITION p3 VALUES LESS THAN ('2023-03-01'),\n    PARTITION p4 VALUES LESS THAN ('2023-04-01')\n)\nDISTRIBUTED BY HASH(date) BUCKETS 16\nPROPERTIES\n(\n    \"replication_num\" = \"1\"\n);\n")),(0,i.yg)("p",null,"Now, we need to query the total sales amount between January 15, 2023 and February 15, 2023. The query statement is as follows:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-sql"},"SELECT SUM(amount) AS total_amount\nFROM sales\nWHERE date BETWEEN '2023-01-15' AND '2023-02-15';\n")),(0,i.yg)("p",null,"For the above query, Doris's partition pruning optimization process is as follows:"),(0,i.yg)("ol",null,(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Doris intelligently analyzes the partition column ",(0,i.yg)("inlineCode",{parentName:"p"},"date")," in the query conditions and identifies the date range of the query as being between '2023-01-15' and '2023-02-15'.")),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"By comparing the query conditions with the partition definitions, Doris precisely locates the range of partitions that need to be scanned. In this example, only partitions ",(0,i.yg)("inlineCode",{parentName:"p"},"p2")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"p3")," need to be scanned, as their date ranges fully cover the query conditions.")),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Doris automatically skips partitions unrelated to the query conditions, such as ",(0,i.yg)("inlineCode",{parentName:"p"},"p1")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"p4"),", avoiding unnecessary data scans and thereby reducing I/O overhead.")),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Finally, Doris performs data scanning and aggregation computations only within partitions ",(0,i.yg)("inlineCode",{parentName:"p"},"p2")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"p3"),", quickly obtaining the query results."))),(0,i.yg)("p",null,"By using the ",(0,i.yg)("inlineCode",{parentName:"p"},"EXPLAIN")," command, we can view the query execution plan and confirm that Doris's partition pruning optimization has taken effect. In the execution plan, the ",(0,i.yg)("inlineCode",{parentName:"p"},"partition")," attribute of the ",(0,i.yg)("inlineCode",{parentName:"p"},"OlapScanNode")," node will display the actually scanned partitions as ",(0,i.yg)("inlineCode",{parentName:"p"},"p2")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"p3"),"."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-sql"},"|   0:VOlapScanNode(212)                                                     |\n|      TABLE: cir.sales(sales), PREAGGREGATION: ON                           |\n|      PREDICATES: (date[#0] >= '2023-01-15') AND (date[#0] <= '2023-02-15') |\n|      partitions=2/4 (p2,p3)                                                |\n")),(0,i.yg)("h2",{id:"summary"},"Summary"),(0,i.yg)("p",null,"In summary, Doris's partition pruning feature can intelligently identify the relevance between query conditions and partitions, automatically prune irrelevant partitions, and scan only necessary data, thereby significantly enhancing query performance. Reasonable utilization of the partition pruning feature can help users build efficient real-time analytics systems and easily handle massive data query demands."))}y.isMDXComponent=!0}}]);