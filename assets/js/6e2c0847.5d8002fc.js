"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([[691090],{15680:(e,n,t)=>{t.d(n,{xA:()=>g,yg:()=>c});var a=t(296540);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=a.createContext({}),d=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},g=function(e){var n=d(e.components);return a.createElement(s.Provider,{value:n},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,g=o(e,["components","mdxType","originalType","parentName"]),p=d(t),u=r,c=p["".concat(s,".").concat(u)]||p[u]||m[u]||l;return t?a.createElement(c,i(i({ref:n},g),{},{components:t})):a.createElement(c,i({ref:n},g))}));function c(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var l=t.length,i=new Array(l);i[0]=u;var o={};for(var s in n)hasOwnProperty.call(n,s)&&(o[s]=n[s]);o.originalType=e,o[p]="string"==typeof e?e:r,i[1]=o;for(var d=2;d<l;d++)i[d]=t[d];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},414085:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>i,default:()=>m,frontMatter:()=>l,metadata:()=>o,toc:()=>d});var a=t(58168),r=(t(296540),t(15680));const l={title:"Flink Doris Connector",language:"en"},i=void 0,o={unversionedId:"ecosystem/flink-doris-connector",id:"version-2.0/ecosystem/flink-doris-connector",title:"Flink Doris Connector",description:"\x3c!--",source:"@site/versioned_docs/version-2.0/ecosystem/flink-doris-connector.md",sourceDirName:"ecosystem",slug:"/ecosystem/flink-doris-connector",permalink:"/docs/2.0/ecosystem/flink-doris-connector",draft:!1,tags:[],version:"2.0",frontMatter:{title:"Flink Doris Connector",language:"en"},sidebar:"ecosystem",previous:{title:"Spark Doris Connector",permalink:"/docs/2.0/ecosystem/spark-doris-connector"},next:{title:"Doris Kafka Connector",permalink:"/docs/2.0/ecosystem/doris-kafka-connector"}},s={},d=[{value:"Version Compatibility",id:"version-compatibility",level:2},{value:"USE",id:"use",level:2},{value:"Maven",id:"maven",level:3},{value:"compile",id:"compile",level:3},{value:"Instructions",id:"instructions",level:2},{value:"Read",id:"read",level:3},{value:"Write",id:"write",level:3},{value:"Lookup Join",id:"lookup-join",level:3},{value:"Configuration",id:"configuration",level:2},{value:"General configuration items",id:"general-configuration-items",level:3},{value:"Source configuration item",id:"source-configuration-item",level:3},{value:"Datastream-specific configuration items",id:"datastream-specific-configuration-items",level:4},{value:"Sink configuration items",id:"sink-configuration-items",level:3},{value:"Lookup Join configuration item",id:"lookup-join-configuration-item",level:3},{value:"Doris &amp; Flink Column Type Mapping",id:"doris--flink-column-type-mapping",level:2},{value:"Flink write Metrics",id:"flink-write-metrics",level:2},{value:"An example of using Flink CDC to access Doris",id:"an-example-of-using-flink-cdc-to-access-doris",level:2},{value:"Example of using FlinkSQL to access and implement partial column updates through CDC",id:"example-of-using-flinksql-to-access-and-implement-partial-column-updates-through-cdc",level:2},{value:"Use Flink CDC to access multiple tables or the entire database (Supports MySQL, Oracle, PostgreSQL, SQLServer, MongoDB)",id:"use-flink-cdc-to-access-multiple-tables-or-the-entire-database-supports-mysql-oracle-postgresql-sqlserver-mongodb",level:2},{value:"Grammar",id:"grammar",level:3},{value:"MySQL synchronization example",id:"mysql-synchronization-example",level:3},{value:"Oracle synchronization example",id:"oracle-synchronization-example",level:3},{value:"PostgreSQL synchronization example",id:"postgresql-synchronization-example",level:3},{value:"SQLServer synchronization example",id:"sqlserver-synchronization-example",level:3},{value:"DB2 synchronization example",id:"db2-synchronization-example",level:3},{value:"MongoDB synchronization example",id:"mongodb-synchronization-example",level:3},{value:"Use Flink CDC to update Key column",id:"use-flink-cdc-to-update-key-column",level:2},{value:"Principle",id:"principle",level:3},{value:"Example",id:"example",level:3},{value:"Use Flink to delete data based on specified columns",id:"use-flink-to-delete-data-based-on-specified-columns",level:2},{value:"Example",id:"example-1",level:3},{value:"Java example",id:"java-example",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Application scenarios",id:"application-scenarios",level:3},{value:"Other",id:"other",level:3},{value:"FAQ",id:"faq",level:2}],g={toc:d},p="wrapper";function m(e){let{components:n,...t}=e;return(0,r.yg)(p,(0,a.A)({},g,t,{components:n,mdxType:"MDXLayout"}),(0,r.yg)("h1",{id:"flink-doris-connector"},"Flink Doris Connector"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"https://github.com/apache/doris-flink-connector"},"Flink Doris Connector")," can support data stored in Doris through Flink operations (read, insert, modify, delete). This document introduces how to operate Doris through Datastream and SQL through Flink.")),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},(0,r.yg)("strong",{parentName:"p"},"Note:")),(0,r.yg)("ol",{parentName:"blockquote"},(0,r.yg)("li",{parentName:"ol"},"Modification and deletion are only supported on the Unique Key model"),(0,r.yg)("li",{parentName:"ol"},"The current deletion is to support Flink CDC to access data to achieve automatic deletion. If it is to delete other data access methods, you need to implement it yourself. For the data deletion usage of Flink CDC, please refer to the last section of this document"))),(0,r.yg)("h2",{id:"version-compatibility"},"Version Compatibility"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Connector Version"),(0,r.yg)("th",{parentName:"tr",align:null},"Flink Version"),(0,r.yg)("th",{parentName:"tr",align:null},"Doris Version"),(0,r.yg)("th",{parentName:"tr",align:null},"Java Version"),(0,r.yg)("th",{parentName:"tr",align:null},"Scala Version"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"1.0.3"),(0,r.yg)("td",{parentName:"tr",align:null},"1.11,1.12,1.13,1.14"),(0,r.yg)("td",{parentName:"tr",align:null},"0.15+"),(0,r.yg)("td",{parentName:"tr",align:null},"8"),(0,r.yg)("td",{parentName:"tr",align:null},"2.11,2.12")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"1.1.1"),(0,r.yg)("td",{parentName:"tr",align:null},"1.14"),(0,r.yg)("td",{parentName:"tr",align:null},"1.0+"),(0,r.yg)("td",{parentName:"tr",align:null},"8"),(0,r.yg)("td",{parentName:"tr",align:null},"2.11,2.12")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"1.2.1"),(0,r.yg)("td",{parentName:"tr",align:null},"1.15"),(0,r.yg)("td",{parentName:"tr",align:null},"1.0+"),(0,r.yg)("td",{parentName:"tr",align:null},"8"),(0,r.yg)("td",{parentName:"tr",align:null},"-")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"1.3.0"),(0,r.yg)("td",{parentName:"tr",align:null},"1.16"),(0,r.yg)("td",{parentName:"tr",align:null},"1.0+"),(0,r.yg)("td",{parentName:"tr",align:null},"8"),(0,r.yg)("td",{parentName:"tr",align:null},"-")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"1.4.0"),(0,r.yg)("td",{parentName:"tr",align:null},"1.15,1.16,1.17"),(0,r.yg)("td",{parentName:"tr",align:null},"1.0+"),(0,r.yg)("td",{parentName:"tr",align:null},"8"),(0,r.yg)("td",{parentName:"tr",align:null},"-")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"1.5.2"),(0,r.yg)("td",{parentName:"tr",align:null},"1.15,1.16,1.17,1.18"),(0,r.yg)("td",{parentName:"tr",align:null},"1.0+"),(0,r.yg)("td",{parentName:"tr",align:null},"8"),(0,r.yg)("td",{parentName:"tr",align:null},"-")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"1.6.2"),(0,r.yg)("td",{parentName:"tr",align:null},"1.15,1.16,1.17,1.18,1.19"),(0,r.yg)("td",{parentName:"tr",align:null},"1.0+"),(0,r.yg)("td",{parentName:"tr",align:null},"8"),(0,r.yg)("td",{parentName:"tr",align:null},"-")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"24.0.1"),(0,r.yg)("td",{parentName:"tr",align:null},"1.15,1.16,1.17,1.18,1.19,1.20"),(0,r.yg)("td",{parentName:"tr",align:null},"1.0+"),(0,r.yg)("td",{parentName:"tr",align:null},"8"),(0,r.yg)("td",{parentName:"tr",align:null},"-")))),(0,r.yg)("h2",{id:"use"},"USE"),(0,r.yg)("h3",{id:"maven"},"Maven"),(0,r.yg)("p",null,"Add flink-doris-connector"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"\x3c!-- flink-doris-connector --\x3e\n<dependency>\n   <groupId>org.apache.doris</groupId>\n   <artifactId>flink-doris-connector-1.16</artifactId>\n   <version>24.0.1</version>\n</dependency>\n")),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Remark")),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Please replace the corresponding Connector and Flink dependent versions according to different Flink versions.")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"You can also download the relevant version jar package from ",(0,r.yg)("a",{parentName:"p",href:"https://repo.maven.apache.org/maven2/org/apache/doris/"},"here"),"."))),(0,r.yg)("h3",{id:"compile"},"compile"),(0,r.yg)("p",null,"When compiling, you can run ",(0,r.yg)("inlineCode",{parentName:"p"},"sh build.sh")," directly. For details, please refer to ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/apache/doris-flink-connector/blob/master/README.md"},"here"),"."),(0,r.yg)("p",null,"After the compilation is successful, the target jar package will be generated in the ",(0,r.yg)("inlineCode",{parentName:"p"},"dist")," directory, such as: ",(0,r.yg)("inlineCode",{parentName:"p"},"flink-doris-connector-1.5.0-SNAPSHOT.jar"),".\nCopy this file to ",(0,r.yg)("inlineCode",{parentName:"p"},"classpath")," of ",(0,r.yg)("inlineCode",{parentName:"p"},"Flink")," to use ",(0,r.yg)("inlineCode",{parentName:"p"},"Flink-Doris-Connector"),". For example, ",(0,r.yg)("inlineCode",{parentName:"p"},"Flink")," running in ",(0,r.yg)("inlineCode",{parentName:"p"},"Local")," mode, put this file in the ",(0,r.yg)("inlineCode",{parentName:"p"},"lib/")," folder. ",(0,r.yg)("inlineCode",{parentName:"p"},"Flink")," running in ",(0,r.yg)("inlineCode",{parentName:"p"},"Yarn")," cluster mode, put this file into the pre-deployment package."),(0,r.yg)("h2",{id:"instructions"},"Instructions"),(0,r.yg)("h3",{id:"read"},"Read"),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"SQL")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"-- doris source\nCREATE TABLE flink_doris_source (\n     name STRING,\n     age INT,\n     price DECIMAL(5,2),\n     sale DOUBLE\n     )\n     WITH (\n       'connector' = 'doris',\n       'fenodes' = 'FE_IP:HTTP_PORT',\n       'table.identifier' = 'database.table',\n       'username' = 'root',\n       'password' = 'password'\n);\n")),(0,r.yg)("admonition",{title:"Note",type:"info"},(0,r.yg)("p",{parentName:"admonition"},"Flink Connector 24.0.0 and later versions support using ",(0,r.yg)("a",{parentName:"p",href:"https://doris.apache.org/docs/dev/db-connect/arrow-flight-sql-connect/"},"Arrow Flight SQL")," to read data")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE doris_source (\nname STRING,\nage int\n) \nWITH (\n  'connector' = 'doris',\n  'fenodes' = 'FE_IP:HTTP_PORT',\n  'table.identifier' = 'database.table',\n  'source.use-flight-sql' = 'true',\n  'source.flight-sql-port' = '{fe.conf:arrow_flight_sql_port}',\n  'username' = 'root',\n  'password' = ''\n)\n")),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"DataStream")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'DorisOptions.Builder builder = DorisOptions.builder()\n         .setFenodes("FE_IP:HTTP_PORT")\n         .setTableIdentifier("db.table")\n         .setUsername("root")\n         .setPassword("password");\n\nDorisSource<List<?>> dorisSource = DorisSource.<List<?>>builder()\n         .setDorisOptions(builder.build())\n         .setDorisReadOptions(DorisReadOptions.builder().build())\n         .setDeserializer(new SimpleListDeserializationSchema())\n         .build();\n\nenv.fromSource(dorisSource, WatermarkStrategy.noWatermarks(), "doris source").print();\n')),(0,r.yg)("h3",{id:"write"},"Write"),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"SQL")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"--enable checkpoint\nSET 'execution.checkpointing.interval' = '10s';\n\n-- doris sink\nCREATE TABLE flink_doris_sink (\n     name STRING,\n     age INT,\n     price DECIMAL(5,2),\n     sale DOUBLE\n     )\n     WITH (\n       'connector' = 'doris',\n       'fenodes' = 'FE_IP:HTTP_PORT',\n       'table.identifier' = 'db.table',\n       'username' = 'root',\n       'password' = 'password',\n       'sink.label-prefix' = 'doris_label'\n);\n\n-- submit insert job\nINSERT INTO flink_doris_sink select name,age,price,sale from flink_doris_source\n")),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"DataStream")),(0,r.yg)("p",null,"DorisSink writes data to Doris through StreamLoad, and DataStream supports different serialization methods when writing"),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"String data stream (SimpleStringSerializer)")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'// enable checkpoint\nenv.enableCheckpointing(10000);\n// using batch mode for bounded data\nenv.setRuntimeMode(RuntimeExecutionMode.BATCH);\n\nDorisSink.Builder<String> builder = DorisSink.builder();\nDorisOptions.Builder dorisBuilder = DorisOptions.builder();\ndorisBuilder.setFenodes("FE_IP:HTTP_PORT")\n         .setTableIdentifier("db.table")\n         .setUsername("root")\n         .setPassword("password");\n\nProperties properties = new Properties();\n// When the upstream is writing json, the configuration needs to be enabled.\n//properties.setProperty("format", "json");\n//properties.setProperty("read_json_by_line", "true");\nDorisExecutionOptions.Builder executionBuilder = DorisExecutionOptions.builder();\nexecutionBuilder.setLabelPrefix("label-doris") //streamload label prefix\n                 .setDeletable(false)\n                 .setStreamLoadProp(properties); ;\n\nbuilder.setDorisReadOptions(DorisReadOptions.builder().build())\n         .setDorisExecutionOptions(executionBuilder.build())\n         .setSerializer(new SimpleStringSerializer()) //serialize according to string\n         .setDorisOptions(dorisBuilder.build());\n\n//mock string source\nList<Tuple2<String, Integer>> data = new ArrayList<>();\ndata.add(new Tuple2<>("doris",1));\nDataStreamSource<Tuple2<String, Integer>> source = env. fromCollection(data);\n\nsource.map((MapFunction<Tuple2<String, Integer>, String>) t -> t.f0 + "\\t" + t.f1)\n       .sinkTo(builder.build());\n\n//mock json string source\n//env.fromElements("{\\"name\\":\\"zhangsan\\",\\"age\\":1}").sinkTo(builder.build());\n')),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"RowData data stream (RowDataSerializer)")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'// enable checkpoint\nenv.enableCheckpointing(10000);\n// using batch mode for bounded data\nenv.setRuntimeMode(RuntimeExecutionMode.BATCH);\n\n//doris sink option\nDorisSink.Builder<RowData> builder = DorisSink.builder();\nDorisOptions.Builder dorisBuilder = DorisOptions.builder();\ndorisBuilder.setFenodes("FE_IP:HTTP_PORT")\n         .setTableIdentifier("db.table")\n         .setUsername("root")\n         .setPassword("password");\n\n// json format to streamload\nProperties properties = new Properties();\nproperties.setProperty("format", "json");\nproperties.setProperty("read_json_by_line", "true");\nDorisExecutionOptions.Builder executionBuilder = DorisExecutionOptions.builder();\nexecutionBuilder.setLabelPrefix("label-doris") //streamload label prefix\n                 .setDeletable(false)\n                 .setStreamLoadProp(properties); //streamload params\n\n//flink rowdata\'s schema\nString[] fields = {"city", "longitude", "latitude", "destroy_date"};\nDataType[] types = {DataTypes.VARCHAR(256), DataTypes.DOUBLE(), DataTypes.DOUBLE(), DataTypes.DATE()};\n\nbuilder.setDorisReadOptions(DorisReadOptions.builder().build())\n         .setDorisExecutionOptions(executionBuilder.build())\n         .setSerializer(RowDataSerializer.builder() //serialize according to rowdata\n                            .setFieldNames(fields)\n                            .setType("json") //json format\n                            .setFieldType(types).build())\n         .setDorisOptions(dorisBuilder.build());\n\n//mock rowdata source\nDataStream<RowData> source = env. fromElements("")\n     .map(new MapFunction<String, RowData>() {\n         @Override\n         public RowData map(String value) throws Exception {\n             GenericRowData genericRowData = new GenericRowData(4);\n             genericRowData.setField(0, StringData.fromString("beijing"));\n             genericRowData.setField(1, 116.405419);\n             genericRowData.setField(2, 39.916927);\n             genericRowData.setField(3, LocalDate.now().toEpochDay());\n             return genericRowData;\n         }\n     });\n\nsource. sinkTo(builder. build());\n')),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"CDC data stream (JsonDebeziumSchemaSerializer)")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'// enable checkpoint\nenv.enableCheckpointing(10000);\n\nProperties props = new Properties();\nprops. setProperty("format", "json");\nprops.setProperty("read_json_by_line", "true");\nDorisOptions dorisOptions = DorisOptions. builder()\n         .setFenodes("127.0.0.1:8030")\n         .setTableIdentifier("test.t1")\n         .setUsername("root")\n         .setPassword("").build();\n\nDorisExecutionOptions.Builder executionBuilder = DorisExecutionOptions.builder();\nexecutionBuilder.setLabelPrefix("label-prefix")\n         .setStreamLoadProp(props).setDeletable(true);\n\nDorisSink.Builder<String> builder = DorisSink.builder();\nbuilder.setDorisReadOptions(DorisReadOptions.builder().build())\n         .setDorisExecutionOptions(executionBuilder.build())\n         .setDorisOptions(dorisOptions)\n         .setSerializer(JsonDebeziumSchemaSerializer.builder().setDorisOptions(dorisOptions).build());\n\nenv.fromSource(mySqlSource, WatermarkStrategy.noWatermarks(), "MySQL Source")\n         .sinkTo(builder.build());\n')),(0,r.yg)("p",null,"Reference: ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/apache/doris-flink-connector/blob/master/flink-doris-connector/src/test/java/org/apache/doris/flink/example/CDCSchemaChangeExample.java"},"CDCSchemaChangeExample")),(0,r.yg)("h3",{id:"lookup-join"},"Lookup Join"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE fact_table (\n  `id` BIGINT,\n  `name` STRING,\n  `city` STRING,\n  `process_time` as proctime()\n) WITH (\n  'connector' = 'kafka',\n  ...\n);\n\ncreate table dim_city(\n  `city` STRING,\n  `level` INT ,\n  `province` STRING,\n  `country` STRING\n) WITH (\n  'connector' = 'doris',\n  'fenodes' = '127.0.0.1:8030',\n  'jdbc-url' = 'jdbc:mysql://127.0.0.1:9030',\n  'table.identifier' = 'dim.dim_city',\n  'username' = 'root',\n  'password' = ''\n);\n\nSELECT a.id, a.name, a.city, c.province, c.country,c.level \nFROM fact_table a\nLEFT JOIN dim_city FOR SYSTEM_TIME AS OF a.process_time AS c\nON a.city = c.city\n")),(0,r.yg)("h2",{id:"configuration"},"Configuration"),(0,r.yg)("h3",{id:"general-configuration-items"},"General configuration items"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Key"),(0,r.yg)("th",{parentName:"tr",align:null},"Default Value"),(0,r.yg)("th",{parentName:"tr",align:null},"Required"),(0,r.yg)("th",{parentName:"tr",align:null},"Comment"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"fenodes"),(0,r.yg)("td",{parentName:"tr",align:null},"--"),(0,r.yg)("td",{parentName:"tr",align:null},"Y"),(0,r.yg)("td",{parentName:"tr",align:null},"Doris FE http address, multiple addresses are supported, separated by commas")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"benodes"),(0,r.yg)("td",{parentName:"tr",align:null},"--"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"Doris BE http address, multiple addresses are supported, separated by commas. refer to ",(0,r.yg)("a",{parentName:"td",href:"https://github.com/apache/doris-flink-connector/pull/187"},"#187"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"jdbc-url"),(0,r.yg)("td",{parentName:"tr",align:null},"--"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"jdbc connection information, such as: jdbc:mysql://127.0.0.1:9030")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"table.identifier"),(0,r.yg)("td",{parentName:"tr",align:null},"--"),(0,r.yg)("td",{parentName:"tr",align:null},"Y"),(0,r.yg)("td",{parentName:"tr",align:null},"Doris table name, such as: db.tbl")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"username"),(0,r.yg)("td",{parentName:"tr",align:null},"--"),(0,r.yg)("td",{parentName:"tr",align:null},"Y"),(0,r.yg)("td",{parentName:"tr",align:null},"username to access Doris")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"password"),(0,r.yg)("td",{parentName:"tr",align:null},"--"),(0,r.yg)("td",{parentName:"tr",align:null},"Y"),(0,r.yg)("td",{parentName:"tr",align:null},"Password to access Doris")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"auto-redirect"),(0,r.yg)("td",{parentName:"tr",align:null},"true"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"Whether to redirect StreamLoad requests. After being turned on, StreamLoad will be written through FE, and BE information will no longer be displayed.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"doris.request.retries"),(0,r.yg)("td",{parentName:"tr",align:null},"3"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"Number of retries to send requests to Doris")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"doris.request.connect.timeout.ms"),(0,r.yg)("td",{parentName:"tr",align:null},"30000"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"Connection timeout for sending requests to Doris")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"doris.request.read.timeout.ms"),(0,r.yg)("td",{parentName:"tr",align:null},"30000"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"Read timeout for sending requests to Doris")))),(0,r.yg)("h3",{id:"source-configuration-item"},"Source configuration item"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Key"),(0,r.yg)("th",{parentName:"tr",align:null},"Default Value"),(0,r.yg)("th",{parentName:"tr",align:null},"Required"),(0,r.yg)("th",{parentName:"tr",align:null},"Comment"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"doris.request.query.timeout.s"),(0,r.yg)("td",{parentName:"tr",align:null},"3600"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"The timeout time for querying Doris, the default value is 1 hour, -1 means no timeout limit")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"doris.request.tablet.size"),(0,r.yg)("td",{parentName:"tr",align:null},"Integer. MAX_VALUE"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"The number of Doris Tablets corresponding to a Partition. The smaller this value is set, the more Partitions will be generated. This improves the parallelism on the Flink side, but at the same time puts more pressure on Doris.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"doris.batch.size"),(0,r.yg)("td",{parentName:"tr",align:null},"1024"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"The maximum number of rows to read data from BE at a time. Increasing this value reduces the number of connections established between Flink and Doris. Thereby reducing the additional time overhead caused by network delay.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"doris.exec.mem.limit"),(0,r.yg)("td",{parentName:"tr",align:null},"2147483648"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"Memory limit for a single query. The default is 2GB, in bytes")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"doris.deserialize.arrow.async"),(0,r.yg)("td",{parentName:"tr",align:null},"FALSE"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"Whether to support asynchronous conversion of Arrow format to RowBatch needed for flink-doris-connector iterations")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"doris.deserialize.queue.size"),(0,r.yg)("td",{parentName:"tr",align:null},"64"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"Asynchronous conversion of internal processing queue in Arrow format, effective when doris.deserialize.arrow.async is true")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"source.use-flight-sql"),(0,r.yg)("td",{parentName:"tr",align:null},"FALSE"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"Whether to use Arrow Flight SQL to read")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"source.flight-sql-port"),(0,r.yg)("td",{parentName:"tr",align:null},"-"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"When using ArrowFlightSQL to read, FE's arrow_flight_sql_port")))),(0,r.yg)("h4",{id:"datastream-specific-configuration-items"},"Datastream-specific configuration items"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Key"),(0,r.yg)("th",{parentName:"tr",align:null},"Default Value"),(0,r.yg)("th",{parentName:"tr",align:null},"Required"),(0,r.yg)("th",{parentName:"tr",align:null},"Comment"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"doris.read.field"),(0,r.yg)("td",{parentName:"tr",align:null},"--"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"Read the list of column names of the Doris table, separated by commas")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"doris.filter.query"),(0,r.yg)("td",{parentName:"tr",align:null},"--"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"The expression to filter the read data, this expression is transparently passed to Doris. Doris uses this expression to complete source-side data filtering. For example age=18.")))),(0,r.yg)("h3",{id:"sink-configuration-items"},"Sink configuration items"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Key"),(0,r.yg)("th",{parentName:"tr",align:null},"Default Value"),(0,r.yg)("th",{parentName:"tr",align:null},"Required"),(0,r.yg)("th",{parentName:"tr",align:null},"Comment"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"sink.label-prefix"),(0,r.yg)("td",{parentName:"tr",align:null},"--"),(0,r.yg)("td",{parentName:"tr",align:null},"Y"),(0,r.yg)("td",{parentName:"tr",align:null},"The label prefix used by Stream load import. In the 2pc scenario, global uniqueness is required to ensure Flink's EOS semantics.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"sink.properties.*"),(0,r.yg)("td",{parentName:"tr",align:null},"--"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"Import parameters for Stream Load. ",(0,r.yg)("br",null),"For example: 'sink.properties.column_separator' = ', ' defines column delimiters, 'sink.properties.escape_delimiters' = 'true' special characters as delimiters, '\\x01' will be converted to binary 0x01 ",(0,r.yg)("br",null),(0,r.yg)("br",null),"JSON format import",(0,r.yg)("br",null),"'sink.properties.format' = 'json' 'sink.properties. read_json_by_line' = 'true'",(0,r.yg)("br",null),"Detailed parameters refer to ",(0,r.yg)("a",{parentName:"td",href:"/docs/2.0/data-operate/import/stream-load-manual"},"here"),".",(0,r.yg)("br",null),(0,r.yg)("br",null),"Group Commit mode",(0,r.yg)("br",null),"'sink.properties.group_commit' = 'sync_mode'",(0,r.yg)("br",null)," Starting from version 1.6.2, we have introduced support for load data with group commit functionality. For a comprehensive understanding of the available parameters, please refer to the Group Commit Manual ",(0,r.yg)("a",{parentName:"td",href:"https://doris.apache.org/docs/data-operate/import/import-way/group-commit-manual/"},"group commit"),".")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"sink.enable-delete"),(0,r.yg)("td",{parentName:"tr",align:null},"TRUE"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"Whether to enable delete. This option requires the Doris table to enable the batch delete function (Doris 0.15+ version is enabled by default), and only supports the Unique model.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"sink.enable-2pc"),(0,r.yg)("td",{parentName:"tr",align:null},"TRUE"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"Whether to enable two-phase commit (2pc), the default is true, to ensure Exactly-Once semantics. For two-phase commit, please refer to ",(0,r.yg)("a",{parentName:"td",href:"/docs/2.0/data-operate/import/stream-load-manual"},"here"),".")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"sink.buffer-size"),(0,r.yg)("td",{parentName:"tr",align:null},"1MB"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"The size of the write data cache buffer, in bytes. It is not recommended to modify, the default configuration is enough")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"sink.buffer-count"),(0,r.yg)("td",{parentName:"tr",align:null},"3"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"The number of write data buffers. It is not recommended to modify, the default configuration is enough")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"sink.max-retries"),(0,r.yg)("td",{parentName:"tr",align:null},"3"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"Maximum number of retries after Commit failure, default 3")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"sink.use-cache"),(0,r.yg)("td",{parentName:"tr",align:null},"false"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"In case of an exception, whether to use the memory cache for recovery. When enabled, the data during the Checkpoint period will be retained in the cache.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"sink.enable.batch-mode"),(0,r.yg)("td",{parentName:"tr",align:null},"false"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"Whether to use the batch mode to write to Doris. After it is enabled, the writing timing does not depend on Checkpoint. The writing is controlled through the sink.buffer-flush.max-rows/sink.buffer-flush.max-bytes/sink.buffer-flush.interval parameter. Enter the opportunity. ",(0,r.yg)("br",null),"After being turned on at the same time, Exactly-once semantics will not be guaranteed. Uniq model can be used to achieve idempotence.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"sink.flush.queue-size"),(0,r.yg)("td",{parentName:"tr",align:null},"2"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"In batch mode, the cached column size.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"sink.buffer-flush.max-rows"),(0,r.yg)("td",{parentName:"tr",align:null},"500000"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"In batch mode, the maximum number of data rows written in a single batch.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"sink.buffer-flush.max-bytes"),(0,r.yg)("td",{parentName:"tr",align:null},"100MB"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"In batch mode, the maximum number of bytes written in a single batch.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"sink.buffer-flush.interval"),(0,r.yg)("td",{parentName:"tr",align:null},"10s"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"In batch mode, the interval for asynchronously refreshing the cache")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"sink.ignore.update-before"),(0,r.yg)("td",{parentName:"tr",align:null},"true"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"Whether to ignore the update-before event, ignored by default.")))),(0,r.yg)("h3",{id:"lookup-join-configuration-item"},"Lookup Join configuration item"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Key"),(0,r.yg)("th",{parentName:"tr",align:null},"Default Value"),(0,r.yg)("th",{parentName:"tr",align:null},"Required"),(0,r.yg)("th",{parentName:"tr",align:null},"Comment"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"lookup.cache.max-rows"),(0,r.yg)("td",{parentName:"tr",align:null},"-1"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"The maximum number of rows in the lookup cache, the default value is -1, and the cache is not enabled")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"lookup.cache.ttl"),(0,r.yg)("td",{parentName:"tr",align:null},"10s"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"The maximum time of lookup cache, the default is 10s")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"lookup.max-retries"),(0,r.yg)("td",{parentName:"tr",align:null},"1"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"The number of retries after a lookup query fails")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"lookup.jdbc.async"),(0,r.yg)("td",{parentName:"tr",align:null},"false"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"Whether to enable asynchronous lookup, the default is false")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"lookup.jdbc.read.batch.size"),(0,r.yg)("td",{parentName:"tr",align:null},"128"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"Under asynchronous lookup, the maximum batch size for each query")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"lookup.jdbc.read.batch.queue-size"),(0,r.yg)("td",{parentName:"tr",align:null},"256"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"The size of the intermediate buffer queue during asynchronous lookup")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"lookup.jdbc.read.thread-size"),(0,r.yg)("td",{parentName:"tr",align:null},"3"),(0,r.yg)("td",{parentName:"tr",align:null},"N"),(0,r.yg)("td",{parentName:"tr",align:null},"The number of jdbc threads for lookup in each task")))),(0,r.yg)("h2",{id:"doris--flink-column-type-mapping"},"Doris & Flink Column Type Mapping"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Doris Type"),(0,r.yg)("th",{parentName:"tr",align:null},"Flink Type"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"NULL_TYPE"),(0,r.yg)("td",{parentName:"tr",align:null},"NULL")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"BOOLEAN"),(0,r.yg)("td",{parentName:"tr",align:null},"BOOLEAN")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"TINYINT"),(0,r.yg)("td",{parentName:"tr",align:null},"TINYINT")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"SMALLINT"),(0,r.yg)("td",{parentName:"tr",align:null},"SMALLINT")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"INT"),(0,r.yg)("td",{parentName:"tr",align:null},"INT")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"BIGINT"),(0,r.yg)("td",{parentName:"tr",align:null},"BIGINT")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"FLOAT"),(0,r.yg)("td",{parentName:"tr",align:null},"FLOAT")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"DOUBLE"),(0,r.yg)("td",{parentName:"tr",align:null},"DOUBLE")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"DATE"),(0,r.yg)("td",{parentName:"tr",align:null},"DATE")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"DATETIME"),(0,r.yg)("td",{parentName:"tr",align:null},"TIMESTAMP")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"DECIMAL"),(0,r.yg)("td",{parentName:"tr",align:null},"DECIMAL")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"CHAR"),(0,r.yg)("td",{parentName:"tr",align:null},"STRING")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"LARGEINT"),(0,r.yg)("td",{parentName:"tr",align:null},"STRING")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"VARCHAR"),(0,r.yg)("td",{parentName:"tr",align:null},"STRING")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"STRING"),(0,r.yg)("td",{parentName:"tr",align:null},"STRING")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"DECIMALV2"),(0,r.yg)("td",{parentName:"tr",align:null},"DECIMAL")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"ARRAY"),(0,r.yg)("td",{parentName:"tr",align:null},"ARRAY")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"MAP"),(0,r.yg)("td",{parentName:"tr",align:null},"MAP")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"JSON"),(0,r.yg)("td",{parentName:"tr",align:null},"STRING")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"VARIANT"),(0,r.yg)("td",{parentName:"tr",align:null},"STRING")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"IPV4"),(0,r.yg)("td",{parentName:"tr",align:null},"STRING")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"IPV6"),(0,r.yg)("td",{parentName:"tr",align:null},"STRING")))),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},"Starting from version connector-1.6.1, support is added for reading three data types: Variant, IPV6, and IPV4. Reading IPV6 and Variant requires Doris version 2.1.1 or higher.         ")),(0,r.yg)("h2",{id:"flink-write-metrics"},"Flink write Metrics"),(0,r.yg)("p",null,"Where the metrics value of type Counter is the cumulative value of the imported task from the beginning to the current time, you can observe each metric in each table in the Flink Webui metrics."),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Name"),(0,r.yg)("th",{parentName:"tr",align:null},"Metric Type"),(0,r.yg)("th",{parentName:"tr",align:null},"Description"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"totalFlushLoadBytes"),(0,r.yg)("td",{parentName:"tr",align:null},"Counter"),(0,r.yg)("td",{parentName:"tr",align:null},"Number of bytes imported.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"flushTotalNumberRows"),(0,r.yg)("td",{parentName:"tr",align:null},"Counter"),(0,r.yg)("td",{parentName:"tr",align:null},"Number of rows imported for total processing")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"totalFlushLoadedRows"),(0,r.yg)("td",{parentName:"tr",align:null},"Counter"),(0,r.yg)("td",{parentName:"tr",align:null},"Number of rows successfully imported.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"totalFlushTimeMs"),(0,r.yg)("td",{parentName:"tr",align:null},"Counter"),(0,r.yg)("td",{parentName:"tr",align:null},"Number of Import completion time. Unit milliseconds")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"totalFlushSucceededNumber"),(0,r.yg)("td",{parentName:"tr",align:null},"Counter"),(0,r.yg)("td",{parentName:"tr",align:null},"Number of times that the data-batch been successfully imported.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"totalFlushFailedNumber"),(0,r.yg)("td",{parentName:"tr",align:null},"Counter"),(0,r.yg)("td",{parentName:"tr",align:null},"Number of times that the data-batch been failed.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"totalFlushFilteredRows"),(0,r.yg)("td",{parentName:"tr",align:null},"Counter"),(0,r.yg)("td",{parentName:"tr",align:null},"Number of rows that do not qualify for data quality flushed")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"totalFlushUnselectedRows"),(0,r.yg)("td",{parentName:"tr",align:null},"Counter"),(0,r.yg)("td",{parentName:"tr",align:null},"Number of rows filtered by where condition flushed")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"beginTxnTimeMs"),(0,r.yg)("td",{parentName:"tr",align:null},"Histogram"),(0,r.yg)("td",{parentName:"tr",align:null},"The time cost for RPC to Fe to begin a transaction, Unit milliseconds.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"putDataTimeMs"),(0,r.yg)("td",{parentName:"tr",align:null},"Histogram"),(0,r.yg)("td",{parentName:"tr",align:null},"The time cost for RPC to Fe to get a stream load plan, Unit milliseconds.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"readDataTimeMs"),(0,r.yg)("td",{parentName:"tr",align:null},"Histogram"),(0,r.yg)("td",{parentName:"tr",align:null},"Read data time, Unit milliseconds.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"writeDataTimeMs"),(0,r.yg)("td",{parentName:"tr",align:null},"Histogram"),(0,r.yg)("td",{parentName:"tr",align:null},"Write data time, Unit milliseconds.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"commitAndPublishTimeMs"),(0,r.yg)("td",{parentName:"tr",align:null},"Histogram"),(0,r.yg)("td",{parentName:"tr",align:null},"The time cost for RPC to Fe to commit and publish a transaction, Unit milliseconds.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"loadTimeMs"),(0,r.yg)("td",{parentName:"tr",align:null},"Histogram"),(0,r.yg)("td",{parentName:"tr",align:null},"Import completion time")))),(0,r.yg)("h2",{id:"an-example-of-using-flink-cdc-to-access-doris"},"An example of using Flink CDC to access Doris"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"SET 'execution.checkpointing.interval' = '10s';\nCREATE TABLE cdc_mysql_source (\n  id int\n  ,name VARCHAR\n  ,PRIMARY KEY (id) NOT ENFORCED\n) WITH (\n 'connector' = 'mysql-cdc',\n 'hostname' = '127.0.0.1',\n 'port' = '3306',\n 'username' = 'root',\n 'password' = 'password',\n 'database-name' = 'database',\n 'table-name' = 'table'\n);\n\n-- Support synchronous insert/update/delete events\nCREATE TABLE doris_sink (\nid INT,\nname STRING\n) \nWITH (\n  'connector' = 'doris',\n  'fenodes' = '127.0.0.1:8030',\n  'table.identifier' = 'database.table',\n  'username' = 'root',\n  'password' = '',\n  'sink.properties.format' = 'json',\n  'sink.properties.read_json_by_line' = 'true',\n  'sink.enable-delete' = 'true', -- Synchronize delete events\n  'sink.label-prefix' = 'doris_label'\n);\n\ninsert into doris_sink select id,name from cdc_mysql_source;\n")),(0,r.yg)("h2",{id:"example-of-using-flinksql-to-access-and-implement-partial-column-updates-through-cdc"},"Example of using FlinkSQL to access and implement partial column updates through CDC"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"-- enable checkpoint\nSET 'execution.checkpointing.interval' = '10s';\n\nCREATE TABLE cdc_mysql_source (\n   id int\n  ,name STRING\n  ,bank STRING\n  ,age int\n  ,PRIMARY KEY (id) NOT ENFORCED\n) WITH (\n 'connector' = 'mysql-cdc',\n 'hostname' = '127.0.0.1',\n 'port' = '3306',\n 'username' = 'root',\n 'password' = 'password',\n 'database-name' = 'database',\n 'table-name' = 'table'\n);\n\nCREATE TABLE doris_sink (\n    id INT,\n    name STRING,\n    bank STRING,\n    age int\n) \nWITH (\n  'connector' = 'doris',\n  'fenodes' = '127.0.0.1:8030',\n  'table.identifier' = 'database.table',\n  'username' = 'root',\n  'password' = '',\n  'sink.properties.format' = 'json',\n  'sink.properties.read_json_by_line' = 'true',\n  'sink.properties.columns' = 'id,name,bank,age',\n  'sink.properties.partial_columns' = 'true' --Enable partial column updates\n);\n\n\ninsert into doris_sink select id,name,bank,age from cdc_mysql_source;\n\n")),(0,r.yg)("h2",{id:"use-flink-cdc-to-access-multiple-tables-or-the-entire-database-supports-mysql-oracle-postgresql-sqlserver-mongodb"},"Use Flink CDC to access multiple tables or the entire database (Supports MySQL, Oracle, PostgreSQL, SQLServer, MongoDB)"),(0,r.yg)("h3",{id:"grammar"},"Grammar"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"<FLINK_HOME>bin/flink run \\\n     -c org.apache.doris.flink.tools.cdc.CdcTools \\\n     lib/flink-doris-connector-1.16-1.4.0-SNAPSHOT.jar\\\n     <mysql-sync-database|oracle-sync-database|postgres-sync-database|sqlserver-sync-database|mongodb-sync-database> \\\n     --database <doris-database-name> \\\n     [--job-name <flink-job-name>] \\\n     [--table-prefix <doris-table-prefix>] \\\n     [--table-suffix <doris-table-suffix>] \\\n     [--including-tables <mysql-table-name|name-regular-expr>] \\\n     [--excluding-tables <mysql-table-name|name-regular-expr>] \\\n     --mysql-conf <mysql-cdc-source-conf> [--mysql-conf <mysql-cdc-source-conf> ...] \\\n     --oracle-conf <oracle-cdc-source-conf> [--oracle-conf <oracle-cdc-source-conf> ...] \\\n     --postgres-conf <postgres-cdc-source-conf> [--postgres-conf <postgres-cdc-source-conf> ...] \\\n     --sqlserver-conf <sqlserver-cdc-source-conf> [--sqlserver-conf <sqlserver-cdc-source-conf> ...] \\\n     --sink-conf <doris-sink-conf> [--table-conf <doris-sink-conf> ...] \\\n     [--table-conf <doris-table-conf> [--table-conf <doris-table-conf> ...]]\n")),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Key"),(0,r.yg)("th",{parentName:"tr",align:null},"Comment"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"--job-name"),(0,r.yg)("td",{parentName:"tr",align:null},"Flink task name, optional")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"--database"),(0,r.yg)("td",{parentName:"tr",align:null},"Database name synchronized to Doris")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"--table-prefix"),(0,r.yg)("td",{parentName:"tr",align:null},"Doris table prefix name, such as --table-prefix ods_.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"--table-suffix"),(0,r.yg)("td",{parentName:"tr",align:null},"Same as above, the suffix name of the Doris table.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"--including-tables"),(0,r.yg)("td",{parentName:"tr",align:null},'For MySQL tables that need to be synchronized, you can use "\uff5c" to separate multiple tables and support regular expressions. For example --including-tables table1')),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"--excluding-tables"),(0,r.yg)("td",{parentName:"tr",align:null},"For tables that do not need to be synchronized, the usage is the same as above.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"--mysql-conf"),(0,r.yg)("td",{parentName:"tr",align:null},"MySQL CDCSource configuration, for example --mysql-conf hostname=127.0.0.1, you can find it ",(0,r.yg)("a",{parentName:"td",href:"https://nightlies.apache.org/flink/flink-cdc-docs-release-3.0/docs/connectors/legacy-flink-cdc-sources/mysql-cdc/"},"here"),"  View all configurations MySQL-CDC, where hostname/username/password/database-name is required. When the synchronized library table contains a non-primary key table, ",(0,r.yg)("inlineCode",{parentName:"td"},"scan.incremental.snapshot.chunk.key-column")," must be set, and only one field of non-null type can be selected. ",(0,r.yg)("br",null),"For example: ",(0,r.yg)("inlineCode",{parentName:"td"},"scan.incremental.snapshot.chunk.key-column=database.table:column,database.table1:column..."),", different database table columns are separated by ",(0,r.yg)("inlineCode",{parentName:"td"},","),".")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"--oracle-conf"),(0,r.yg)("td",{parentName:"tr",align:null},"Oracle CDCSource configuration, for example --oracle-conf hostname=127.0.0.1, you can find ",(0,r.yg)("a",{parentName:"td",href:"https://nightlies.apache.org/flink/flink-cdc-docs-release-3.0/docs/connectors/legacy-flink-cdc-sources/oracle-cdc/"},"here")," View all configurations Oracle-CDC, where hostname/username/password/database-name/schema-name is required.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"--postgres-conf"),(0,r.yg)("td",{parentName:"tr",align:null},"Postgres CDCSource configuration, e.g. --postgres-conf hostname=127.0.0.1, you can find ",(0,r.yg)("a",{parentName:"td",href:"https://nightlies.apache.org/flink/flink-cdc-docs-release-3.0/docs/connectors/legacy-flink-cdc-sources/postgres-cdc/"},"here")," View all configurations Postgres-CDC where hostname/username/password/database-name/schema-name/slot.name is required.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"--sqlserver-conf"),(0,r.yg)("td",{parentName:"tr",align:null},"SQLServer CDCSource configuration, for example --sqlserver-conf hostname=127.0.0.1, you can find it ",(0,r.yg)("a",{parentName:"td",href:"https://nightlies.apache.org/flink/flink-cdc-docs-release-3.0/docs/connectors/legacy-flink-cdc-sources/sqlserver-cdc/"},"here")," View all configurations SQLServer-CDC, where hostname/username/password/database-name/schema-name is required.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"--db2-conf"),(0,r.yg)("td",{parentName:"tr",align:null},"DB2 CDCSource configuration, for example --db2-conf hostname=127.0.0.1, you can find it ",(0,r.yg)("a",{parentName:"td",href:"https://nightlies.apache.org/flink/flink-cdc-docs-release-3.1/docs/connectors/flink-sources/db2-cdc/"},"here")," View all configurations DB2-CDC, where hostname/username/password/database-name/schema-name is required.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"--mongodb-conf"),(0,r.yg)("td",{parentName:"tr",align:null},"MongoDB CDCSource configuration, for example --mongodb-conf hosts=127.0.0.1:27017, you can find all Mongo-CDC configurations ",(0,r.yg)("a",{parentName:"td",href:"https://nightlies.apache.org/flink/flink-cdc-docs-release-3.0/docs/connectors/flink-sources/mongodb-cdc/"},"here"),", where hosts/username/password/database are required. The --mongodb-conf schema.sample-percent configuration is for automatically sampling MongoDB data for creating a table in Doris, with a default value of 0.2.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"--sink-conf"),(0,r.yg)("td",{parentName:"tr",align:null},"All configurations of Doris Sink can be found ",(0,r.yg)("a",{parentName:"td",href:"https://doris.apache.org/zh-CN/docs/dev/ecosystem/flink-doris-connector/#%E9%80%9A%E7%94%A8%E9%85%8D%E7%BD%AE%E9%A1%B9"},"here")," View the complete configuration items.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"--table-conf"),(0,r.yg)("td",{parentName:"tr",align:null},"The configuration items of the Doris table(The exception is table-buckets, non-properties attributes), that is, the content contained in properties. For example ",(0,r.yg)("inlineCode",{parentName:"td"},"--table-conf replication_num=1"),", and the ",(0,r.yg)("inlineCode",{parentName:"td"},'--table-conf table-buckets="tbl1:10,tbl2:20,a.*:30,b.*:40,.*:50"')," option specifies the number of buckets for different tables based on the order of regular expressions. If there is no match, the table is created with the default setting of BUCKETS AUTO.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"--ignore-default-value"),(0,r.yg)("td",{parentName:"tr",align:null},"Turn off the default value of synchronizing MySQL table structure. It is suitable for synchronizing MySQL data to Doris when the field has a default value but the actual inserted data is null. Reference ",(0,r.yg)("a",{parentName:"td",href:"https://github.com/apache/doris-flink-connector/pull/152"},"here"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"--use-new-schema-change"),(0,r.yg)("td",{parentName:"tr",align:null},"Whether to use the new schema change to support synchronization of MySQL multi-column changes and default values. since version 1.6.0, the default value has been set to true. Reference ",(0,r.yg)("a",{parentName:"td",href:"https://github.com/apache/doris-flink-connector/pull/167"},"here"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"--schema-change-mode"),(0,r.yg)("td",{parentName:"tr",align:null},"The mode for parsing schema change supports two parsing modes: ",(0,r.yg)("inlineCode",{parentName:"td"},"debezium_structure")," and ",(0,r.yg)("inlineCode",{parentName:"td"},"sql_parser"),". The default mode is ",(0,r.yg)("inlineCode",{parentName:"td"},"debezium_structure"),". ",(0,r.yg)("br",null),(0,r.yg)("br",null)," ",(0,r.yg)("inlineCode",{parentName:"td"},"debezium_structure")," parses the data structure used when upstream CDC synchronizes data, and determines DDL change operations by parsing this structure. ",(0,r.yg)("br",null)," ",(0,r.yg)("inlineCode",{parentName:"td"},"sql_parser")," determines the DDL change operation by parsing the DDL statement when the upstream CDC synchronizes data, so this parsing mode is more accurate. ",(0,r.yg)("br",null)," Usage example: ",(0,r.yg)("inlineCode",{parentName:"td"},"--schema-change-mode debezium_structure"),(0,r.yg)("br",null)," This feature will be available in versions after 1.6.2.1")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"--single-sink"),(0,r.yg)("td",{parentName:"tr",align:null},"Whether to use a single Sink to synchronize all tables. When turned on, newly created tables in the upstream can also be automatically recognized and tables automatically created.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"--multi-to-one-origin"),(0,r.yg)("td",{parentName:"tr",align:null},'When writing multiple upstream tables into the same table, the configuration of the source table, for example: --multi-to-one-origin "a',"_",".","*","\uff5cb_.","*",'"\uff0c Reference ',(0,r.yg)("a",{parentName:"td",href:"https://github.com/apache/doris-flink-connector/pull/208"},"here"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"--multi-to-one-target"),(0,r.yg)("td",{parentName:"tr",align:null},'Used with multi-to-one-origin, the configuration of the target table, such as: --multi-to-one-target "a',"|",'b"')),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"--create-table-only"),(0,r.yg)("td",{parentName:"tr",align:null},"Whether only the table schema should be synchronized")))),(0,r.yg)("admonition",{title:"Note",type:"info"},(0,r.yg)("ol",{parentName:"admonition"},(0,r.yg)("li",{parentName:"ol"},"When synchronizing, you need to add the corresponding Flink CDC dependencies in the ",(0,r.yg)("inlineCode",{parentName:"li"},"$FLINK_HOME/lib")," directory, such as flink-sql-connector-mysql-cdc-${version}.jar, flink-sql-connector-oracle-cdc-${version}.jar , flink-sql-connector-mongodb-cdc-${version}.jar"),(0,r.yg)("li",{parentName:"ol"},"The Flink CDC version that Connector 24.0.0 depends on must be above 3.1 . If Flink CDC is to be used for synchronizing data from MySQL or Oracle, relevant JDBC drivers also need to be added under ",(0,r.yg)("inlineCode",{parentName:"li"},"$FLINK_HOME/lib"),"."))),(0,r.yg)("h3",{id:"mysql-synchronization-example"},"MySQL synchronization example"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},'<FLINK_HOME>bin/flink run \\\n     -Dexecution.checkpointing.interval=10s\\\n     -Dparallelism.default=1\\\n     -c org.apache.doris.flink.tools.cdc.CdcTools\\\n     lib/flink-doris-connector-1.18-24.0.1.jar \\\n     mysql-sync-database\\\n     --database test_db \\\n     --mysql-conf hostname=127.0.0.1 \\\n     --mysql-conf port=3306 \\\n     --mysql-conf username=root \\\n     --mysql-conf password=123456 \\\n     --mysql-conf database-name=mysql_db \\\n     --including-tables "tbl1|test.*" \\\n     --sink-conf fenodes=127.0.0.1:8030 \\\n     --sink-conf username=root \\\n     --sink-conf password=123456 \\\n     --sink-conf jdbc-url=jdbc:mysql://127.0.0.1:9030 \\\n     --sink-conf sink.label-prefix=label \\\n     --table-conf replication_num=1\n')),(0,r.yg)("h3",{id:"oracle-synchronization-example"},"Oracle synchronization example"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},'<FLINK_HOME>bin/flink run \\\n      -Dexecution.checkpointing.interval=10s \\\n      -Dparallelism.default=1 \\\n      -c org.apache.doris.flink.tools.cdc.CdcTools \\\n      ./lib/flink-doris-connector-1.18-24.0.1.jar \\\n      oracle-sync-database \\\n      --database test_db \\\n      --oracle-conf hostname=127.0.0.1 \\\n      --oracle-conf port=1521 \\\n      --oracle-conf username=admin \\\n      --oracle-conf password="password" \\\n      --oracle-conf database-name=XE \\\n      --oracle-conf schema-name=ADMIN \\\n      --including-tables "tbl1|tbl2" \\\n      --sink-conf fenodes=127.0.0.1:8030 \\\n      --sink-conf username=root \\\n      --sink-conf password=\\\n      --sink-conf jdbc-url=jdbc:mysql://127.0.0.1:9030 \\\n      --sink-conf sink.label-prefix=label \\\n      --table-conf replication_num=1\n')),(0,r.yg)("h3",{id:"postgresql-synchronization-example"},"PostgreSQL synchronization example"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},'<FLINK_HOME>/bin/flink run \\\n     -Dexecution.checkpointing.interval=10s \\\n     -Dparallelism.default=1\\\n     -c org.apache.doris.flink.tools.cdc.CdcTools \\\n     ./lib/flink-doris-connector-1.18-24.0.1.jar \\\n     postgres-sync-database \\\n     --database db1\\\n     --postgres-conf hostname=127.0.0.1 \\\n     --postgres-conf port=5432 \\\n     --postgres-conf username=postgres \\\n     --postgres-conf password="123456" \\\n     --postgres-conf database-name=postgres \\\n     --postgres-conf schema-name=public \\\n     --postgres-conf slot.name=test \\\n     --postgres-conf decoding.plugin.name=pgoutput \\\n     --including-tables "tbl1|tbl2" \\\n     --sink-conf fenodes=127.0.0.1:8030 \\\n     --sink-conf username=root \\\n     --sink-conf password=\\\n     --sink-conf jdbc-url=jdbc:mysql://127.0.0.1:9030 \\\n     --sink-conf sink.label-prefix=label \\\n     --table-conf replication_num=1\n')),(0,r.yg)("h3",{id:"sqlserver-synchronization-example"},"SQLServer synchronization example"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},'<FLINK_HOME>/bin/flink run \\\n     -Dexecution.checkpointing.interval=10s \\\n     -Dparallelism.default=1 \\\n     -c org.apache.doris.flink.tools.cdc.CdcTools \\\n     ./lib/flink-doris-connector-1.18-24.0.1.jar \\\n     sqlserver-sync-database \\\n     --database db1\\\n     --sqlserver-conf hostname=127.0.0.1 \\\n     --sqlserver-conf port=1433 \\\n     --sqlserver-conf username=sa \\\n     --sqlserver-conf password="123456" \\\n     --sqlserver-conf database-name=CDC_DB \\\n     --sqlserver-conf schema-name=dbo \\\n     --including-tables "tbl1|tbl2" \\\n     --sink-conf fenodes=127.0.0.1:8030 \\\n     --sink-conf username=root \\\n     --sink-conf password=\\\n     --sink-conf jdbc-url=jdbc:mysql://127.0.0.1:9030 \\\n     --sink-conf sink.label-prefix=label \\\n     --table-conf replication_num=1\n')),(0,r.yg)("h3",{id:"db2-synchronization-example"},"DB2 synchronization example"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},'<FLINK_HOME>bin/flink run \\\n    -Dexecution.checkpointing.interval=10s \\\n    -Dparallelism.default=1 \\\n    -c org.apache.doris.flink.tools.cdc.CdcTools \\\n    lib/flink-doris-connector-1.16-24.0.1.jar \\\n    db2-sync-database \\\n    --database db2_test \\\n    --db2-conf hostname=127.0.0.1 \\\n    --db2-conf port=50000 \\\n    --db2-conf username=db2inst1 \\\n    --db2-conf password=doris123456 \\\n    --db2-conf database-name=testdb \\\n    --db2-conf schema-name=DB2INST1 \\\n    --including-tables "FULL_TYPES|CUSTOMERS" \\\n    --single-sink true \\\n    --use-new-schema-change true \\\n    --sink-conf fenodes=127.0.0.1:8030 \\\n    --sink-conf username=root \\\n    --sink-conf password=123456 \\\n    --sink-conf jdbc-url=jdbc:mysql://127.0.0.1:9030 \\\n    --sink-conf sink.label-prefix=label \\\n    --table-conf replication_num=1 \n')),(0,r.yg)("h3",{id:"mongodb-synchronization-example"},"MongoDB synchronization example"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},'<FLINK_HOME>/bin/flink run \\\n    -Dexecution.checkpointing.interval=10s \\\n    -Dparallelism.default=1 \\\n    -c org.apache.doris.flink.tools.cdc.CdcTools \\\n    ./lib/flink-doris-connector-1.18-24.0.1.jar \\\n    mongodb-sync-database \\\n    --database doris_db \\\n    --schema-change-mode debezium_structure \\\n    --mongodb-conf hosts=127.0.0.1:27017 \\\n    --mongodb-conf username=flinkuser \\\n    --mongodb-conf password=flinkpwd \\\n    --mongodb-conf database=test \\\n    --mongodb-conf scan.startup.mode=initial \\\n    --mongodb-conf schema.sample-percent=0.2 \\\n    --including-tables "tbl1|tbl2" \\\n    --sink-conf fenodes=127.0.0.1:8030 \\\n    --sink-conf username=root \\\n    --sink-conf password= \\\n    --sink-conf jdbc-url=jdbc:mysql://127.0.0.1:9030 \\\n    --sink-conf sink.label-prefix=label \\\n    --sink-conf sink.enable-2pc=false \\\n    --table-conf replication_num=1\n')),(0,r.yg)("h2",{id:"use-flink-cdc-to-update-key-column"},"Use Flink CDC to update Key column"),(0,r.yg)("p",null,"Generally, in a business database, the number is used as the primary key of the table, such as the Student table, the number (id) is used as the primary key, but with the development of the business, the number corresponding to the data may change.\nIn this scenario, using Flink CDC + Doris Connector to synchronize data can automatically update the data in the Doris primary key column."),(0,r.yg)("h3",{id:"principle"},"Principle"),(0,r.yg)("p",null,"The underlying collection tool of Flink CDC is Debezium. Debezium internally uses the op field to identify the corresponding operation: the values of the op field are c, u, d, and r, corresponding to create, update, delete, and read.\nFor the update of the primary key column, Flink CDC will send DELETE and INSERT events downstream, and after the data is synchronized to Doris, it will automatically update the data of the primary key column."),(0,r.yg)("h3",{id:"example"},"Example"),(0,r.yg)("p",null,"The Flink program can refer to the CDC synchronization example above. After the task is successfully submitted, execute the Update primary key column statement (",(0,r.yg)("inlineCode",{parentName:"p"},"update student set id = '1002' where id = '1001'"),") on the MySQL side to modify the data in Doris ."),(0,r.yg)("h2",{id:"use-flink-to-delete-data-based-on-specified-columns"},"Use Flink to delete data based on specified columns"),(0,r.yg)("p",null,'Generally, messages in Kafka use specific fields to mark the operation type, such as {"op_type":"delete",data:{...}}. For this type of data, it is hoped that the data with op_type=delete will be deleted.'),(0,r.yg)("p",null,"By default, DorisSink will distinguish the type of event based on RowKind. Usually, in the case of cdc, the event type can be obtained directly, and the hidden column ",(0,r.yg)("inlineCode",{parentName:"p"},"__DORIS_DELETE_SIGN__")," is assigned to achieve the purpose of deletion, while Kafka needs to be based on business logic. Judgment, display the value passed in to the hidden column."),(0,r.yg)("h3",{id:"example-1"},"Example"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"-- Such as upstream data: {\"op_type\":\"delete\",data:{\"id\":1,\"name\":\"zhangsan\"}}\nCREATE TABLE KAFKA_SOURCE(\n  data STRING,\n  op_type STRING\n) WITH (\n  'connector' = 'kafka',\n  ...\n);\n\nCREATE TABLE DORIS_SINK(\n  id INT,\n  name STRING,\n  __DORIS_DELETE_SIGN__ INT\n) WITH (\n  'connector' = 'doris',\n  'fenodes' = '127.0.0.1:8030',\n  'table.identifier' = 'db.table',\n  'username' = 'root',\n  'password' = '',\n  'sink.enable-delete' = 'false',        -- false means not to get the event type from RowKind\n  'sink.properties.columns' = 'id, name, __DORIS_DELETE_SIGN__'  -- Display the import column of the specified streamload\n);\n\nINSERT INTO DORIS_SINK\nSELECT json_value(data,'$.id') as id,\njson_value(data,'$.name') as name, \nif(op_type='delete',1,0) as __DORIS_DELETE_SIGN__ \nfrom KAFKA_SOURCE;\n")),(0,r.yg)("h2",{id:"java-example"},"Java example"),(0,r.yg)("p",null,(0,r.yg)("inlineCode",{parentName:"p"},"samples/doris-demo/"),"  An example of the Java version is provided below for reference, see ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/apache/doris/tree/master/samples/doris-demo/"},"here")),(0,r.yg)("h2",{id:"best-practices"},"Best Practices"),(0,r.yg)("h3",{id:"application-scenarios"},"Application scenarios"),(0,r.yg)("p",null,"The most suitable scenario for using Flink Doris Connector is to synchronize source data to Doris (MySQL, Oracle, PostgreSQL) in real time/batch, etc., and use Flink to perform joint analysis on data in Doris and other data sources. You can also use Flink Doris Connector"),(0,r.yg)("h3",{id:"other"},"Other"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},"The Flink Doris Connector mainly relies on Checkpoint for streaming writing, so the interval between Checkpoints is the visible delay time of the data."),(0,r.yg)("li",{parentName:"ol"},"To ensure the Exactly Once semantics of Flink, the Flink Doris Connector enables two-phase commit by default, and Doris enables two-phase commit by default after version 1.1. 1.0 can be enabled by modifying the BE parameters, please refer to ",(0,r.yg)("a",{parentName:"li",href:"/docs/2.0/data-operate/import/stream-load-manual"},"two_phase_commit"),".")),(0,r.yg)("h2",{id:"faq"},"FAQ"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"After Doris Source finishes reading data, why does the stream end?"))),(0,r.yg)("p",null,"Currently Doris Source is a bounded stream and does not support CDC reading."),(0,r.yg)("ol",{start:2},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"Can Flink read Doris and perform conditional pushdown?"))),(0,r.yg)("p",null,"By configuring the doris.filter.query parameter, refer to the configuration section for details."),(0,r.yg)("ol",{start:3},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"How to write Bitmap type?"))),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE bitmap_sink (\ndt int,\npage string,\nuser_id int\n)\nWITH (\n   'connector' = 'doris',\n   'fenodes' = '127.0.0.1:8030',\n   'table.identifier' = 'test.bitmap_test',\n   'username' = 'root',\n   'password' = '',\n   'sink.label-prefix' = 'doris_label',\n   'sink.properties.columns' = 'dt,page,user_id,user_id=to_bitmap(user_id)'\n)\n")),(0,r.yg)("ol",{start:4},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"errCode = 2, detailMessage = Label ","[label_0_1]"," has already been used, relate to txn ","[19650]"))),(0,r.yg)("p",null,"In the Exactly-Once scenario, the Flink Job must be restarted from the latest Checkpoint/Savepoint, otherwise the above error will be reported.\nWhen Exactly-Once is not required, it can also be solved by turning off 2PC commits (sink.enable-2pc=false) or changing to a different sink.label-prefix."),(0,r.yg)("ol",{start:5},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"errCode = 2, detailMessage = transaction ","[19650]"," not found"))),(0,r.yg)("p",null,"Occurred in the Commit phase, the transaction ID recorded in the checkpoint has expired on the FE side, and the above error will occur when committing again at this time.\nAt this time, it cannot be started from the checkpoint, and the expiration time can be extended by modifying the streaming_label_keep_max_second configuration in fe.conf, which defaults to 12 hours."),(0,r.yg)("ol",{start:6},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"errCode = 2, detailMessage = current running txns on db 10006 is 100, larger than limit 100"))),(0,r.yg)("p",null,"This is because the concurrent import of the same library exceeds 100, which can be solved by adjusting the parameter ",(0,r.yg)("inlineCode",{parentName:"p"},"max_running_txn_num_per_db")," of fe.conf. For details, please refer to ",(0,r.yg)("a",{parentName:"p",href:"../admin-manual/config/fe-config#max_running_txn_num_per_db"},"max_running_txn_num_per_db")),(0,r.yg)("p",null,"At the same time, if a task frequently modifies the label and restarts, it may also cause this error. In the 2pc scenario (Duplicate/Aggregate model), the label of each task needs to be unique, and when restarting from the checkpoint, the Flink task will actively abort the txn that has been successfully precommitted before and has not been committed. Frequently modifying the label and restarting will cause a large number of txn that have successfully precommitted to fail to be aborted, occupying the transaction. Under the Unique model, 2pc can also be turned off, which can realize idempotent writing."),(0,r.yg)("ol",{start:7},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"How to ensure the order of a batch of data when Flink writes to the Uniq model?"))),(0,r.yg)("p",null,"You can add sequence column configuration to ensure that, for details, please refer to ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.0/data-operate/update/update-of-unique-model"},"sequence")),(0,r.yg)("ol",{start:8},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"The Flink task does not report an error, but the data cannot be synchronized? "))),(0,r.yg)("p",null,"Before Connector1.1.0, it was written in batches, and the writing was driven by data. It was necessary to determine whether there was data written upstream. After 1.1.0, it depends on Checkpoint, and Checkpoint must be enabled to write."),(0,r.yg)("ol",{start:9},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"tablet writer write failed, tablet_id=190958, txn_id=3505530, err=-235"))),(0,r.yg)("p",null,"It usually occurs before Connector1.1.0, because the writing frequency is too fast, resulting in too many versions. The frequency of Streamload can be reduced by setting the sink.batch.size and sink.batch.interval parameters. After Connector 1.1.0, the default write timing is controlled by Checkpoint, and the write frequency can be reduced by increasing the Checkpoint interval."),(0,r.yg)("ol",{start:10},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"Flink imports dirty data, how to skip it? "))),(0,r.yg)("p",null,"When Flink imports data, if there is dirty data, such as field format, length, etc., it will cause StreamLoad to report an error, and Flink will continue to retry at this time. If you need to skip, you can disable the strict mode of StreamLoad (strict_mode=false, max_filter_ratio=1) or filter the data before the Sink operator."),(0,r.yg)("ol",{start:11},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"How should the source table and Doris table correspond?"),'\nWhen using Flink Connector to import data, pay attention to two aspects. The first is that the columns and types of the source table correspond to the columns and types in flink sql; the second is that the columns and types in flink sql must match those of the Doris table For the correspondence between columns and types, please refer to the above "Doris & Flink Column Type Mapping" for details')),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"TApplicationException: get_next failed: out of sequence response: expected 4 but got 3")))),(0,r.yg)("p",null,"This is due to concurrency bugs in the Thrift. It is recommended that you use the latest connector and compatible Flink version possible."),(0,r.yg)("ol",{start:13},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"DorisRuntimeException: Fail to abort transaction 26153 with url ",(0,r.yg)("a",{parentName:"strong",href:"http://192.168.0.1:8040/api/table_name/_stream_load_2pc"},"http://192.168.0.1:8040/api/table_name/_stream_load_2pc")))),(0,r.yg)("p",null,"You can search for the log ",(0,r.yg)("inlineCode",{parentName:"p"},"abort transaction response")," in TaskManager and determine whether it is a client issue or a server issue based on the HTTP return code."),(0,r.yg)("ol",{start:14},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},'org.apache.flink.table.api.SqlParserException when using doris.filter.query: SQL parsing failed. "xx" encountered at row x, column xx'))),(0,r.yg)("p",null,"This problem is mainly caused by the conditional varchar/string type, which needs to be quoted. The correct way to write it is xxx = ''xxx''. In this way, the Flink SQL parser will interpret two consecutive single quotes as one single quote character instead of The end of the string, and the concatenated string is used as the value of the attribute. For example: ",(0,r.yg)("inlineCode",{parentName:"p"},"t1 >= '2024-01-01'")," can be written as ",(0,r.yg)("inlineCode",{parentName:"p"},"'doris.filter.query' = 't1 >=''2024-01-01'''"),"."),(0,r.yg)("ol",{start:15},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"Failed to connect to backend: http://host:webserver_port, and BE is still alive"))),(0,r.yg)("p",null,"The issue may have occurred due to configuring the IP address of ",(0,r.yg)("inlineCode",{parentName:"p"},"be"),", which is not reachable by the external Flink cluster.This is mainly because when connecting to ",(0,r.yg)("inlineCode",{parentName:"p"},"fe"),", the address of ",(0,r.yg)("inlineCode",{parentName:"p"},"be")," is resolved through fe. For instance, if you add a be address as '127.0.0.1', the be address obtained by the Flink cluster through fe will be '127.0.0.1:webserver_port', and Flink will connect to that address. When this issue arises, you can resolve it by adding the actual corresponding external IP address of the be to the \"with\" attribute:",(0,r.yg)("inlineCode",{parentName:"p"},"'benodes'=\"be_ip:webserver_port,be_ip:webserver_port...\""),".For the entire database synchronization, the following properties are available",(0,r.yg)("inlineCode",{parentName:"p"},"--sink-conf benodes=be_ip:webserver,be_ip:webserver..."),"."),(0,r.yg)("ol",{start:16},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"When using Flink-connector to synchronize MySQL data to Doris, there is a time difference of several hours between the timestamp."))),(0,r.yg)("p",null,"Flink  Connector synchronizes the entire database from MySQL with a default timezone of UTC+8. If your data resides in a different timezone, you can adjust it using the following configuration, for example: ",(0,r.yg)("inlineCode",{parentName:"p"},'--mysql-conf debezium.date.format.timestamp.zone="UTC+3"'),"."),(0,r.yg)("ol",{start:17},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"What is the difference between batch writing and streaming writing"))),(0,r.yg)("p",null,"Connector 1.5.0 and later support batch writing. Batch writing does not rely on Checkpoint. Data is cached in memory and the writing timing is controlled according to the parameters sink.buffer-flush.max-rows/sink.buffer-flush.max-bytes/sink.buffer-flush.interval. Checkpoint must be enabled for streaming writing. During the entire Checkpoint period, upstream data is continuously written to Doris, and data is not cached in memory all the time."))}m.isMDXComponent=!0}}]);