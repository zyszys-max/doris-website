"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([[98401],{15680:(e,t,n)=>{n.d(t,{xA:()=>u,yg:()=>m});var o=n(296540);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=o.createContext({}),c=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=c(e.components);return o.createElement(l.Provider,{value:t},e.children)},p="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,l=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),p=c(n),d=r,m=p["".concat(l,".").concat(d)]||p[d]||g[d]||a;return n?o.createElement(m,s(s({ref:t},u),{},{components:n})):o.createElement(m,s({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,s=new Array(a);s[0]=d;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[p]="string"==typeof e?e:r,s[1]=i;for(var c=2;c<a;c++)s[c]=n[c];return o.createElement.apply(null,s)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},70495:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>g,frontMatter:()=>a,metadata:()=>i,toc:()=>c});var o=n(58168),r=(n(296540),n(15680));const a={title:"Config FE",language:"en"},s=void 0,i={unversionedId:"install/cluster-deployment/k8s-deploy/compute-storage-decoupled/config-fe",id:"version-3.0/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/config-fe",title:"Config FE",description:"\x3c!--",source:"@site/versioned_docs/version-3.0/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/config-fe.md",sourceDirName:"install/cluster-deployment/k8s-deploy/compute-storage-decoupled",slug:"/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/config-fe",permalink:"/docs/3.0/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/config-fe",draft:!1,tags:[],version:"3.0",frontMatter:{title:"Config FE",language:"en"},sidebar:"docs",previous:{title:"Config Metaservice",permalink:"/docs/3.0/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/config-ms"},next:{title:"Config ComputeGroups",permalink:"/docs/3.0/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/config-cg"}},l={},c=[{value:"Configure resources",id:"configure-resources",level:2},{value:"Configure computing resources for services",id:"configure-computing-resources-for-services",level:3},{value:"Configure service storage resources",id:"configure-service-storage-resources",level:3},{value:"Customized configuration file",id:"customized-configuration-file",level:2}],u={toc:c},p="wrapper";function g(e){let{components:t,...n}=e;return(0,r.yg)(p,(0,o.A)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.yg)("p",null,"In the storage-and-computing separation mode, FE is mainly responsible for SQL parsing related work and is also responsible for interacting with the metadata management component MS. FE usually only needs to deploy 2 services, and the replicas are set to 2. The simplest deployment mode is as follows:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},"spec:\n  feSpec:\n    image: {feImage}\n    replicas: 2\n")),(0,r.yg)("p",null,"replace {felmage} with the image version >=3.0.2, that wants to deploy, and update the configuration to the ",(0,r.yg)("a",{parentName:"p",href:"install-quickstart#step-2-quickly-deploy-a-storage-and-computing-separation-cluster"},"storage-and-computing separation resources to be deployed"),"."),(0,r.yg)("h2",{id:"configure-resources"},"Configure resources"),(0,r.yg)("h3",{id:"configure-computing-resources-for-services"},"Configure computing resources for services"),(0,r.yg)("p",null,"Add computing resource configuration for the FE service. ",(0,r.yg)("inlineCode",{parentName:"p"},"DorisDisaggregatedCluster")," reuses K8s requests and limits to configure the resource usage of each component. The following is to configure the FE service using 4c 4Gi:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},"spec:\n  feSpec:\n    requests:\n      cpu: 4\n      memory: 4Gi\n    limits:\n      cpu: 4\n      memory: 4Gi\n")),(0,r.yg)("p",null,"The above example shows how to configure the computing resources of the FE service to 4c 4Gi mode. After configuring the resources that FE wants to use, update the configuration information to ",(0,r.yg)("a",{parentName:"p",href:"install-quickstart#step-2-quickly-deploy-a-storage-and-computing-separation-cluster"},"DorisDisaggregatedCluster resources to be deployed"),"."),(0,r.yg)("h3",{id:"configure-service-storage-resources"},"Configure service storage resources"),(0,r.yg)("p",null,"The storage-and-computing separation cluster FE service is a stateful service. In the K8s deployment mode, the corresponding disk needs to be mounted to store the storage information that the FE service needs to persist."),(0,r.yg)("p",null,"The following is an example of using the default ",(0,r.yg)("a",{parentName:"p",href:"https://kubernetes.io/zh-cn/docs/concepts/storage/storage-classes/"},"StorageClass")," to provide storage services for FE configuration:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},"spec:\n  feSpec:\n    persistentVolume:\n      persistentVolumeClaimSpec:\n        #storageClassName\uff1a{storageClassName}\n        accessModes:\n          - ReadWriteOnce\n        resources:\n          requests:\n            storage: 200Gi\n")),(0,r.yg)("p",null,"The above example shows how to add 200Gi storage to the FE service. ",(0,r.yg)("inlineCode",{parentName:"p"},"{storageClassName}")," is the name of the StorageClass to be used. If it is not filled in, the default StorageClass of the cluster will be used. After configuring the storage information required by the FE service according to the above mode, update the configuration to ",(0,r.yg)("a",{parentName:"p",href:"install-quickstart#step-2-quickly-deploy-a-storage-and-computing-separation-cluster"},"Storage and computing separation resources to be deployed"),"."),(0,r.yg)("h2",{id:"customized-configuration-file"},"Customized configuration file"),(0,r.yg)("p",null,"In K8s deployment, you can use ConfigMap to mount customized configuration for the FE service to start the FE service. Assume that the FE service is started with the following configuration:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: fe-configmap\n  namespace: default\n  labels:\n    app.kubernetes.io/component: fe\ndata:\n  fe.conf: |\n    CUR_DATE=`date +%Y%m%d-%H%M%S`\n    # Log dir\n    LOG_DIR = ${DORIS_HOME}/log\n    # For jdk 17, this JAVA_OPTS will be used as default JVM options\n    JAVA_OPTS_FOR_JDK_17="-Djavax.security.auth.useSubjectCredsOnly=false -Xmx8192m -Xms8192m -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=$LOG_DIR -Xlog:gc*:$LOG_DIR/fe.gc.log.$CUR_DATE:time,uptime:filecount=10,filesize=50M --add-opens=java.base/java.nio=ALL-UNNAMED --add-opens java.base/jdk.internal.ref=ALL-UNNAMED"\n    # INFO, WARN, ERROR, FATAL\n    sys_log_level = INFO\n    # NORMAL, BRIEF, ASYNC\n    sys_log_mode = NORMAL\n    # Default dirs to put jdbc drivers,default value is ${DORIS_HOME}/jdbc_drivers\n    # jdbc_drivers_dir = ${DORIS_HOME}/jdbc_drivers\n    http_port = 8030\n    rpc_port = 9020\n    query_port = 9030\n    edit_log_port = 9010\n    enable_fqdn_mode=true\n')),(0,r.yg)("p",null,"In K8s deployment, ",(0,r.yg)("inlineCode",{parentName:"p"},"enable_fqdn_mode=true")," must be set. FE uses the ",(0,r.yg)("inlineCode",{parentName:"p"},"DorisDisaggregatedCluster")," resource sample of the above ConfigMap:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},"spec:\n  feSpec:\n    replicas: 2\n    configMaps:\n      - name: fe-configmap\n")),(0,r.yg)("p",null,"In the ",(0,r.yg)("inlineCode",{parentName:"p"},"DorisDisaggregatedCluster")," resource, the configMaps for mounting ConfigMap is an array. The name of each element represents the ConfigMap name of the current namespace."),(0,r.yg)("p",null,"Configure the ConfigMap information required by the FE service according to the above mode, and update the configuration to ",(0,r.yg)("a",{parentName:"p",href:"install-quickstart#step-2-quickly-deploy-a-storage-and-computing-separation-cluster"},"Storage and computing separation resources to be deployed"),"."),(0,r.yg)("admonition",{title:"Tip",type:"tip"},(0,r.yg)("ul",{parentName:"admonition"},(0,r.yg)("li",{parentName:"ul"},"In K8s deployment, when using ConfigMap to mount customized configuration files, there is no need to add ",(0,r.yg)("inlineCode",{parentName:"li"},"meta_service_endpoint"),"\u3001",(0,r.yg)("inlineCode",{parentName:"li"},"deploy_mode")," \u4ee5\u53ca ",(0,r.yg)("inlineCode",{parentName:"li"},"cluster_id")," configurations, and Doris-Operator related services will be added automatically."),(0,r.yg)("li",{parentName:"ul"},"In K8s deployment, when using ConfigMap to mount customized configuration files, must to add ",(0,r.yg)("inlineCode",{parentName:"li"},"enable_fqdn_mode=true"),".  "))))}g.isMDXComponent=!0}}]);